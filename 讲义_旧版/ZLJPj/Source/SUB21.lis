Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

打开文件：SUB21.PCO
     1        *****************************************************************
     2        *程序ID         ：SUB21
     3        *程序名         ：学生成绩信息录入
     4        *处理概要       ：新生入学时将学生信息录入到系统中
     5        *
     6        *
     7        *变量           IO       变量名
     8        *
     9        *
    10        *
    11        *日期           作成者             概要
    12        *2007/03/29     张丽娟             作成
    13        *
    14        *****************************************************************
    15        *
    16        *****************************************************************
    17        * 环境部
    18        *****************************************************************
    19  000010 IDENTIFICATION                               DIVISION.
    20  000020 PROGRAM-ID.  Sub21.
    21  000030 ENVIRONMENT                                  DIVISION.
    22  000040 DATA                                         DIVISION.
    23  000050 WORKING-STORAGE                              SECTION.
    24        *
    25        *----------------------------------------------------------------
    26        *数据库用数据定义
    27        *----------------------------------------------------------------
    28  000051     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.
    29  000052     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL
     1  000010*  
     2  000030   01  SQLSTATE                      PIC  X(005).
     3  000040   01  DB-STRING                     PIC  X(020).
     4  000050   01  USERNAME                      PIC  X(010).
     5  000060   01  PASSWD                        PIC  X(010).
     6  000070*
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL
    30  000055     EXEC  SQL  INCLUDE  SQLCA.CBL             END-EXEC.
    31        *
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCA.CBL
     1        ***************************************************************** 
     2        *                                                               * 
     3        *               S  Q  L  C  A                                   * 
     4        *  (This file in ANSI format.  Do NOT bse it).                  * 
     5        *                                                               * 
     6        * MODIFIED                                                      * 
     7        *   Clare      12/06/84 - Ch SQLCA to not be an EXTERNAL.       * 
     8        ***************************************************************** 
     9         01  SQLCA.                                                       
    10             05  SQLCAID               PIC X(8).                          
    11             05  SQLCABC               PIC S9(9) COMPUTATIONAL.           
    12             05  SQLCODE               PIC S9(9) COMPUTATIONAL.           
    13             05  SQLERRM.                                                 
    14                 49 SQLERRML           PIC S9(4) COMPUTATIONAL.           
    15                 49 SQLERRMC           PIC X(70).                         
    16             05  SQLERRP               PIC X(8).                          
    17             05  SQLERRD OCCURS 6 TIMES                                   
    18                                       PIC S9(9) COMPUTATIONAL.           
    19             05  SQLWARN.                                                 
    20                 10 SQLWARN0           PIC X(1).                          
    21                 10 SQLWARN1           PIC X(1).                          
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

    22                 10 SQLWARN2           PIC X(1).                          
    23                 10 SQLWARN3           PIC X(1).                          
    24                 10 SQLWARN4           PIC X(1).                          
    25                 10 SQLWARN5           PIC X(1).                          
    26                 10 SQLWARN6           PIC X(1).                          
    27                 10 SQLWARN7           PIC X(1).                          
    28             05  SQLEXT                PIC X(8).                          
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCA.CBL
    32  000055     EXEC  SQL  INCLUDE  STSCORE.CBL           END-EXEC.
    33        *
打开文件：D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL
     1        *****************************************************************
     2        *程序ID         ：STscore
     3        *程序名         ：学生成绩信息
     4        *
     5        *日期           作成者            概要
     6        *2007/03/18     张丽娟            作成
     7        *
     8        *****************************************************************
     9  000040 01 STscore.
    10             03 SNO                           PIC  9(06).
    11             03 Scourse                       PIC  9(06).
    12  000040     03 SScore                        PIC  9(03).
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL
    34             EXEC  SQL  INCLUDE  SQLWK.CBL             END-EXEC.
    35        *
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL
     1  000010*****************************************************************
     2  000020*SQL WORK AREA
     3  000030*****************************************************************
     4  000040 01 SQLWORKAREA.
     5             03 SQLSTUDENTINFO.
     6                 05 SQLSNO                 PIC  9(06).
     7             03 SQLCOUNT                   PIC 9(4).
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL
    36  000056     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.
    37        *
    38        *----------------------------------------------------------------
    39        *WORKAREA
    40        *----------------------------------------------------------------
    41        *屏幕线型定义
    42         COPY WKSCRLINE.
    43        *
    44         COPY WKAREA.
    45  
    46  000060*
    47  000070 LINKAGE                                      SECTION.
    48        *
    49  000080 SCREEN                                       SECTION.
    50        *画面头
    51  000090 COPY SCRHEAD.
    52        *学生成绩信息画面
    53  000090 COPY SCRSCORE.
    54        *画面底
    55         COPY SCRFLOOR.
    56        *公用提示画面
    57         COPY SCRPUB.
    58        *
    59        *****************************************************************
    60        *过程部
    61        *****************************************************************
    62  000120 PROCEDURE                                    DIVISION.
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

    63  000130 MAINPROCESSRTN                               SECTION.
    64  000160*初期处理
    65             PERFORM STARTRTN.
    66        *主处理
    67             PERFORM MAINRTN.
    68  
    69        *终了处理
    70  000180     PERFORM ENDRTN.
    71        *
    72  000180 MAINPROCESSEXIT.
    73  000190     EXIT PROGRAM .
    74        *****************************************************************
    75        *初期处理
    76        *
    77        *****************************************************************
    78         STARTRTN                                     SECTION.
    79        *    初始化WORK变量
    80             INITIALIZE STSCORE, WKAREA.
    81  
    82        *
    83         STARTEXIT.
    84             EXIT.
    85        *****************************************************************
    86        *主处理
    87        *
    88        *****************************************************************
    89         MAINRTN                                      SECTION.
    90        *    显示屏幕
    91             DISPLAY SCRHEAD.
    92             MOVE "请输入新录入的成绩信息,然后输入I并按回车键确认" TO WKCLUE.
    93             DISPLAY SCRSCORE.
    94             MOVE "输入I并按回车键确认,输入其它字符返回主菜单" TO WKCLUE.
    95             DISPLAY SCRFLOOR.
    96        *    数据输入
    97             ACCEPT  SCRSCORE.
    98        *
    99             IF WKTURN = "I"
   100             THEN
   101        *        判断该课程成绩是否存在,存在则提示是否更新
   102                 PERFORM CHACKDATARTN
   103        *
   104             ELSE
   105                 GO TO MAINEXIT
   106             END-IF.
   107        * 
   108        *    
   109             IF DATACHACKFLAG = 1
   110             THEN
   111        *       判断该生该课程成绩是否存在
   112        *       查询记录数量
   113                EXEC  SQL
   114                   SELECT  COUNT(*)
   115                   INTO  :SQLCOUNT
   116                   FROM  STUDENTSCORE
   117                   WHERE (NO = :SNO) AND (COURSE = :SCOURSE)
   118                END-EXEC
   119  
   120                EVALUATE   SQLCODE
   121                WHEN  0
   122        *          查询记录条数正常
   123                   DISPLAY  "查询记录条数正常sqlcode=", SQLCODE
   124                   CONTINUE
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   125                WHEN OTHER
   126        *          查询记录条数失败
   127                   DISPLAY  "查询记录条数失败sqlcode=", SQLCODE
   128                   MOVE SQLCODE TO EMSGSQLCD
   129        *          错误处理
   130                   CALL "ERRORMSG" USING ERRORKEY
   131                   GO TO MAINEXIT
   132                END-EVALUATE
   133  
   134             ELSE
   135                 CONTINUE
   136             END-IF
   137        *    判断数据是否存在
   138             IF (DATACHACKFLAG = 1) AND (SQLCOUNT = 0)
   139             THEN
   140        *       数据不存在，插入新数据
   141                PERFORM DBUPRTN
   142             ELSE
   143        *        显示输入信息已经存在提示画面
   144                 DISPLAY SCRHEAD
   145                 MOVE "您输入的学生该门课程成绩已存在！" TO WKCLUE
   146                 MOVE SPACE TO WKTURN
   147                 DISPLAY SCRPUB
   148                 MOVE "您输入的学生该门课程成绩已存在！" TO WKCLUE
   149                 DISPLAY SCRFLOOR
   150                 ACCEPT SCRPUB
   151        *
   152             END-IF.
   153  
   154  
   155         MAINEXIT.
   156             EXIT.
   157        *
   158        *----------------------------------------------------------------
   159        *校验数据
   160        *    数据不合格则设置FLAG为0
   161        *----------------------------------------------------------------
   162         CHACKDATARTN                                 SECTION.
   163        *    CHACKFLAG置1
   164             MOVE 1                       TO  DATACHACKFLAG.
   165  
   166        *    录入的数据不为空
   167             IF (SNO     NOT = 0)     AND
   168                (Scourse NOT = 0)     AND
   169                (SScore  NOT = 0)
   170             THEN
   171                CONTINUE
   172             ELSE
   173        *        显示未录入数据画面
   174                 DISPLAY SCRHEAD
   175                 MOVE "请录入数据！" TO WKCLUE
   176                 MOVE SPACE TO WKTURN
   177                 DISPLAY SCRPUB
   178                 MOVE "请录入数据！" TO WKCLUE
   179                 DISPLAY SCRFLOOR
   180                 ACCEPT SCRPUB
   181                GO TO MAINEXIT
   182             END-IF.
   183  
   184         CHACKDATAEXIT.
   185             EXIT.
   186        *
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   187        *----------------------------------------------------------------
   188        *插入新数据
   189        *----------------------------------------------------------------
   190         DBUPRTN                                      SECTION.
   191        *
   192        *    数据插入操作
   193             EXEC SQL
   194                 INSERT INTO STUDENTSCORE( NO
   195                                          ,COURSE
   196                                          ,SCORE
   197                                        )
   198                 VALUES ( :SNO
   199                         ,:SCOURSE 
   200                         ,:SSCORE  
   201                        )
   202             END-EXEC.
   203        *
   204        *    数据库返回码判断
   205             EVALUATE SQLCODE
   206             WHEN 0
   207        *        返回码为“0”数据插入正常
   208        *        数据提交
   209                 DISPLAY  "录入学生成绩成功sqlCODE=", SQLCODE
   210                 EXEC SQL
   211                     COMMIT WORK RELEASE
   212                 END-EXEC
   213        *
   214        *        显示插入成功画面
   215                 DISPLAY SCRHEAD
   216                 MOVE "录入学生成绩成功！" TO WKCLUE
   217                 MOVE SPACE TO WKTURN
   218                 DISPLAY SCRPUB
   219                 MOVE "录入学生成绩成功！" TO WKCLUE
   220                 DISPLAY SCRFLOOR
   221                 ACCEPT SCRPUB
   222        *
   223             WHEN OTHER
   224        *        数据库返回码非“0”，数据插入失败，设定错误码
   225                 MOVE 211 TO ERRPOINT
   226                 MOVE SQLCODE TO EMSGSQLCD
   227        *        错误处理
   228                 CALL "ERRORMSG" USING ERRORKEY
   229             END-EVALUATE.
   230        *
   231         DBUPEXIT.
   232             EXIT.
   233        *
   234        *****************************************************************
   235        *终了处理
   236        *
   237        *****************************************************************
   238         ENDRTN                                       SECTION.
   239        *    调试信息
   240             DISPLAY "SUB21 END-PROGRAM OK".
   241        *
   242         ENDEXIT.
   243             EXIT.
   244        *****************************************************************
   245         END PROGRAM SUB21.
   246        *****************************************************************
关闭文件：SUB21.PCO
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.


宿主变量
--------------

03  SCOURSE OF STSCORE                                  Unsigned Display(6,0)
  D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL     11
  SUB21.PCO    117    199

03  SNO OF STSCORE                                      Unsigned Display(6,0)
  D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL     10
  SUB21.PCO    117    198

03  SQLCOUNT OF SQLWORKAREA                             Unsigned Display(4,0)
  D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL      7
  SUB21.PCO    115

01  SQLSTATE                                            Charf(5)
  D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL      2
  SUB21.PCO    113    193    210

03  SSCORE OF STSCORE                                   Unsigned Display(3,0)
  D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL     12
  SUB21.PCO    200

Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.



                              预编译器选项
-------------------------------------------------------------------------------
选项名称       当前值               设置地点
-------------------------------------------------------------------------------
asacc             否                默认                                        
assume_sqlcode    否                默认                                        
auto_connect      否                默认                                        
close_on_commit   是                mode                                        
comp5             是                d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
config            default config    默认                                        
date_format       local             默认                                        
dbms              native            默认                                        
declare_section   是                mode                                        
define            *none*            默认                                        
dynamic           ansi              mode                                        
end_of_fetch      100               mode                                        
eol_padding       是                默认                                        
errors            是                默认                                        
fips              否                默认                                        
format            ansi              默认                                        
hold_cursor       否                默认                                        
host              cobol             默认                                        
iname             SUB21.PCO         命令行                                      
include           D:\ZLJPj\Source\COd:\oracle\ora92\precomp\admin\pcbcfg.cfg    
ireclen           132               d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
litdelim          quote             默认                                        
lname             *none*            默认                                        
lreclen           132               默认                                        
ltype             long              默认                                        
maxliteral        160               d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
maxopencursors    10                默认                                        
mode              ANSI              d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
nested            是                默认                                        
nls_local         是                d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
oname             SUB21.Cbl         命令行                                      
oraca             否                默认                                        
oreclen           80                默认                                        
pagelen           66                默认                                        
picx              charf             默认                                        
prefetch          1                 默认                                        
release_cursor    否                默认                                        
select_error      是                默认                                        
sqlcheck          FULL              d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
threads           否                默认                                        
type_code         ansi              mode                                        
unsafe_null       否                默认                                        
userid            student/zaq12wsx@cd:\oracle\ora92\precomp\admin\pcbcfg.cfg    
varchar           否                默认                                        
xref              是                默认                                        
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:54 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.


统计信息
----------

返回代码: 0
严重级 I 的消息数量: 0
严重级 W 的消息数量: 0
严重级 E 的消息数量: 0
严重级 F 的消息数量: 0
输入行数: 271
说明的宿主变量个数: 12
游标名数量: 0
语句名数量: 0
可使用的最大内存 (字节): 90926
