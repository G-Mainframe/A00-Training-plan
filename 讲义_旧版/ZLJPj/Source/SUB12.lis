Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

打开文件：SUB12.PCO
     1  000010 IDENTIFICATION                               DIVISION.
     2  000020 PROGRAM-ID.  Sub12.
     3        *****************************************************************
     4        *程序ID         ：Sub12
     5        *程序名         ：学生学籍信息查询修改
     6        *处理概要       ：对学生学籍信息进行查询更新处理
     7        *
     8        *
     9        *变量           IO       变量名
    10        *
    11        *
    12        *
    13        *日期           作成者            概要
    14        *2007/03/18     张丽娟            作成
    15        *
    16        *
    17        *
    18        *****************************************************************
    19  000030 ENVIRONMENT                                  DIVISION.
    20        *****************************************************************
    21        *
    22        *****************************************************************
    23  000040 DATA                                         DIVISION.
    24  000050 WORKING-STORAGE                              SECTION.           
    25        *----------------------------------------------------------------
    26        *    数据库用数据定义
    27        *----------------------------------------------------------------
    28  000051     EXEC  SQL  BEGIN    DECLARE      SECTION  END-EXEC.
    29  000052     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL
     1  000010*  
     2  000030   01  SQLSTATE                      PIC  X(005).
     3  000040   01  DB-STRING                     PIC  X(020).
     4  000050   01  USERNAME                      PIC  X(010).
     5  000060   01  PASSWD                        PIC  X(010).
     6  000070*
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL
    30  000055     EXEC  SQL  INCLUDE  SQLCA.CBL             END-EXEC.
    31        *    学生信息表
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCA.CBL
     1        ***************************************************************** 
     2        *                                                               * 
     3        *               S  Q  L  C  A                                   * 
     4        *  (This file in ANSI format.  Do NOT bse it).                  * 
     5        *                                                               * 
     6        * MODIFIED                                                      * 
     7        *   Clare      12/06/84 - Ch SQLCA to not be an EXTERNAL.       * 
     8        ***************************************************************** 
     9         01  SQLCA.                                                       
    10             05  SQLCAID               PIC X(8).                          
    11             05  SQLCABC               PIC S9(9) COMPUTATIONAL.           
    12             05  SQLCODE               PIC S9(9) COMPUTATIONAL.           
    13             05  SQLERRM.                                                 
    14                 49 SQLERRML           PIC S9(4) COMPUTATIONAL.           
    15                 49 SQLERRMC           PIC X(70).                         
    16             05  SQLERRP               PIC X(8).                          
    17             05  SQLERRD OCCURS 6 TIMES                                   
    18                                       PIC S9(9) COMPUTATIONAL.           
    19             05  SQLWARN.                                                 
    20                 10 SQLWARN0           PIC X(1).                          
    21                 10 SQLWARN1           PIC X(1).                          
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

    22                 10 SQLWARN2           PIC X(1).                          
    23                 10 SQLWARN3           PIC X(1).                          
    24                 10 SQLWARN4           PIC X(1).                          
    25                 10 SQLWARN5           PIC X(1).                          
    26                 10 SQLWARN6           PIC X(1).                          
    27                 10 SQLWARN7           PIC X(1).                          
    28             05  SQLEXT                PIC X(8).                          
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCA.CBL
    32             EXEC  SQL  INCLUDE  STINFO.CBL            END-EXEC.
    33        *    SQL WORK AREA
打开文件：D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL
     1        *****************************************************************
     2        *程序ID         ：STinfo
     3        *程序名         ：学生学籍信息
     4        *
     5        *日期           作成者            概要
     6        *2007/03/18     张丽娟            作成
     7        *
     8        *****************************************************************
     9  000040 01 STinfo.
    10             03 SNO                           PIC  9(06).
    11             03 SCOLLEGIAN                    PIC  9(06).
    12  000040     03 SNAME                         PIC  X(10).
    13  000040     03 SSEX                          PIC  X(02).
    14             03 SAGE                          PIC  9(02).
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL
    34             EXEC  SQL  INCLUDE  SQLWK.CBL            END-EXEC.
    35        *
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL
     1  000010*****************************************************************
     2  000020*SQL WORK AREA
     3  000030*****************************************************************
     4  000040 01 SQLWORKAREA.
     5             03 SQLSTUDENTINFO.
     6                 05 SQLSNO                 PIC  9(06).
     7             03 SQLCOUNT                   PIC 9(4).
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL
    36  000056     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.
    37        *----------------------------------------------------------------
    38        *屏幕线型定义
    39        *----------------------------------------------------------------
    40         COPY WKSCRLine.
    41        *----------------------------------------------------------------
    42        *WORK变量
    43        *----------------------------------------------------------------
    44         COPY WKAREA.
    45        *
    46        *****************************************************************
    47        *
    48        *****************************************************************
    49  000070 LINKAGE                                      SECTION.
    50        *----------------------------------------------------------------
    51        *
    52        *----------------------------------------------------------------
    53  000080 SCREEN                                       SECTION.
    54        *画面头
    55  000090 COPY SCRHead.
    56        *学生信息
    57  000090 COPY SCRSINFO.
    58        *检索画面
    59  000090 COPY SUB12SCS.
    60        *画面底
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

    61         COPY SCRFLOOR.
    62        *公共信息提示
    63         COPY SCRPUB.
    64  
    65        *
    66  000120 PROCEDURE                                    DIVISION.
    67  000130 MAIN-PROCESS                                 SECTION.
    68        *初期处理
    69             PERFORM StartRTN.
    70        *
    71        *主处理
    72             PERFORM MAINRTN.
    73        *                      
    74        *终了处理
    75  000180     PERFORM EndRTN.
    76        *
    77  000180 END-PROGRAM.
    78  000190     EXIT PROGRAM .
    79        *****************************************************************
    80        *初期处理
    81        *
    82        *****************************************************************
    83         StartRTN                                     SECTION.
    84        *    初始化Work变量
    85             INITIALIZE STINFO.
    86        *
    87         StartExit.
    88             EXIT.
    89        *
    90        *****************************************************************
    91        *主处理
    92        *
    93        *****************************************************************
    94         MAINRTN                                      SECTION.
    95  
    96        *    显示查询屏幕
    97             DISPLAY SCRHead.
    98             DISPLAY SUB12SCS.
    99             MOVE "请输入您要查询的学号"    TO WKCLUE.
   100             DISPLAY SCRFLOOR.
   101             ACCEPT  SUB12SCS.
   102        *
   103        *    是否存在判断
   104             PERFORM STINFOCHECKRTN.
   105        *    按输入条件进行查询
   106             IF SQLCOUNT = 0
   107             THEN
   108        *        显示不存在画面
   109                 DISPLAY SCRHEAD
   110                 MOVE "您输入的学号不存在！" TO WKCLUE
   111                 MOVE SPACE TO WKTURN
   112                 DISPLAY SCRPUB
   113                 MOVE "您输入的学号不存在！" TO WKCLUE
   114                 DISPLAY SCRFLOOR
   115                 ACCEPT SCRPUB
   116             ELSE
   117                PERFORM STINFOSELECTRTN
   118             END-IF.
   119        *
   120        *    判断是否进行更新处理
   121             IF WKTURN = "U"
   122             THEN
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   123        *        进行数据更新
   124                 PERFORM STUDENTINFOUPDATARTN
   125             ELSE
   126        *        不进行数据更新
   127                 CONTINUE
   128             END-IF.
   129        *
   130         MAINEXIT.
   131             EXIT.
   132        *----------------------------------------------------------------
   133        *是否存在检查
   134        *----------------------------------------------------------------
   135         STINFOcheckRTN                              SECTION.
   136  
   137        *    查询记录数量
   138             EXEC  SQL
   139                SELECT  COUNT(*)
   140                INTO :SQLCOUNT
   141                FROM  STUDENTINFO
   142                WHERE NO = :SNO
   143             END-EXEC
   144  
   145             EVALUATE   SQLCODE
   146             WHEN  0
   147        *       查询记录条数正常
   148                DISPLAY  "查询记录条数正常sqlcode=", SQLCODE
   149                CONTINUE
   150             WHEN OTHER
   151        *       查询记录条数失败
   152                DISPLAY  "查询记录条数失败sqlcode=", SQLCODE
   153                MOVE SQLCODE TO EMSGSQLCD
   154        *       错误处理
   155                CALL "ERRORMSG" USING ERRORKEY
   156                GO TO MAINEXIT
   157             END-EVALUATE.
   158  
   159         STINFOcheckexit.
   160             exit.
   161        *----------------------------------------------------------------
   162        *查询学生信息
   163        *----------------------------------------------------------------
   164         STINFOSELECTRTN                              SECTION.
   165        * 
   166        *    数据查询操作
   167             DISPLAY  "SNO=", SNO.
   168        *     MOVE SNO TO SQLSNO.
   169             EXEC SQL
   170                 SELECT  NO
   171                        ,COLLEGIAN
   172                        ,NAME
   173                        ,SEX
   174                        ,AGE
   175                 INTO    :SNO
   176                        ,:SCOLLEGIAN
   177                        ,:SNAME
   178                        ,:SSEX
   179                        ,:SAGE
   180                 FROM STUDENTINFO
   181                 WHERE  NO = :SNO
   182             END-EXEC.
   183        *    
   184        *    数据库返回码判断
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   185             EVALUATE SQLCODE
   186             WHEN 0
   187        *        返回码为“0”数据查询正常
   188                 DISPLAY  "查询学生成功sqlcode=", SQLCODE
   189        *        显示被查询学生信息画面
   190                 DISPLAY SCRHEAD
   191                 MOVE "如修改该学生信息，更正相关内容后，键入U并回车确认"
   192                                          TO WKCLUE
   193                 MOVE SPACE TO WKTURN
   194                 DISPLAY SCRSINFO
   195                 MOVE "查询成功！学号不能修改,键入U并回车确认修改"
   196                                                         TO WKCLUE
   197                 DISPLAY SCRFLOOR
   198        *
   199                 ACCEPT SCRSINFO
   200        *
   201             WHEN OTHER
   202        *        数据库返回码非“0”，数据插入失败，设定错误码
   203                 MOVE 121 TO ERRPOINT
   204                 MOVE SQLCODE TO EMSGSQLCD
   205        *        错误处理
   206                 CALL "ERRORMSG" USING ERRORKEY
   207                 GO TO MAINEXIT
   208             END-EVALUATE.
   209        *
   210         STINFOSELECTEXIT.
   211             EXIT.
   212        *
   213        *----------------------------------------------------------------
   214        *更新学生信息
   215        *----------------------------------------------------------------
   216         STUDENTINFOUPDATARTN                              SECTION.
   217  
   218        *    数据查询操作
   219             EXEC SQL 
   220                 UPDATE STUDENTINFO
   221                 SET  NO        = :SNO 
   222                     ,COLLEGIAN = :SCOLLEGIAN
   223                     ,NAME      = :SNAME
   224                     ,SEX       = :SSEX
   225                     ,AGE       = :SAGE
   226                 WHERE NO = :SNO
   227             END-EXEC.
   228        *    
   229        *    数据库返回码判断
   230             EVALUATE SQLCODE
   231             WHEN 0
   232        *       返回码为“0”数据更新正常
   233                DISPLAY  "更新学生信息sqlok=", SQLCODE
   234                EXEC SQL
   235                    COMMIT WORK RELEASE
   236                END-EXEC
   237        *
   238                DISPLAY SCRHEAD
   239                MOVE "学生信息更新成功，按回车返回主菜单"
   240                                         TO WKCLUE
   241                MOVE SPACE TO WKTURN
   242        *       显示被更新学生信息画面
   243                DISPLAY SCRPUB
   244                MOVE "更新学生信息成功！按回车返回主菜单" 
   245                                         TO WKCLUE
   246                DISPLAY SCRFLOOR
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   247                ACCEPT SCRPUB
   248        *
   249             WHEN OTHER
   250        *       数据库返回码非“0”，数据更新失败，设定错误码
   251                MOVE 122 TO ERRPOINT
   252                MOVE SQLCODE TO EMSGSQLCD
   253        *       错误处理
   254                CALL "ERRORMSG" USING ERRORKEY
   255             END-EVALUATE.
   256         STUDENTINFOUPDATAEXIT.
   257             EXIT.
   258        *
   259        *****************************************************************
   260        *终了处理
   261        *
   262        *****************************************************************
   263         EndRTN                                       SECTION.
   264        *    调试信息
   265             DISPLAY "SUB12 END-PROGRAM OK".
   266         EndExit.
   267             EXIT.
   268        *****************************************************************
   269         END PROGRAM Sub12.
   270        *****************************************************************
关闭文件：SUB12.PCO
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.


宿主变量
--------------

03  SAGE OF STINFO                                      Unsigned Display(2,0)
  D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL     14
  SUB12.PCO    179    225

03  SCOLLEGIAN OF STINFO                                Unsigned Display(6,0)
  D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL     11
  SUB12.PCO    176    222

03  SNAME OF STINFO                                     Charf(10)
  D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL     12
  SUB12.PCO    177    223

03  SNO OF STINFO                                       Unsigned Display(6,0)
  D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL     10
  SUB12.PCO    142    175    181    221    226

03  SQLCOUNT OF SQLWORKAREA                             Unsigned Display(4,0)
  D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL      7
  SUB12.PCO    140

01  SQLSTATE                                            Charf(5)
  D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL      2
  SUB12.PCO    138    169    219    234

03  SSEX OF STINFO                                      Charf(2)
  D:\ZLJPj\Source\COPYLIB_DB\STINFO.CBL     13
  SUB12.PCO    178    224

Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.



                              预编译器选项
-------------------------------------------------------------------------------
选项名称       当前值               设置地点
-------------------------------------------------------------------------------
asacc             否                默认                                        
assume_sqlcode    否                默认                                        
auto_connect      否                默认                                        
close_on_commit   是                mode                                        
comp5             是                d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
config            default config    默认                                        
date_format       local             默认                                        
dbms              native            默认                                        
declare_section   是                mode                                        
define            *none*            默认                                        
dynamic           ansi              mode                                        
end_of_fetch      100               mode                                        
eol_padding       是                默认                                        
errors            是                默认                                        
fips              否                默认                                        
format            ansi              默认                                        
hold_cursor       否                默认                                        
host              cobol             默认                                        
iname             SUB12.PCO         命令行                                      
include           D:\ZLJPj\Source\COd:\oracle\ora92\precomp\admin\pcbcfg.cfg    
ireclen           132               d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
litdelim          quote             默认                                        
lname             *none*            默认                                        
lreclen           132               默认                                        
ltype             long              默认                                        
maxliteral        160               d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
maxopencursors    10                默认                                        
mode              ANSI              d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
nested            是                默认                                        
nls_local         是                d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
oname             SUB12.Cbl         命令行                                      
oraca             否                默认                                        
oreclen           80                默认                                        
pagelen           66                默认                                        
picx              charf             默认                                        
prefetch          1                 默认                                        
release_cursor    否                默认                                        
select_error      是                默认                                        
sqlcheck          FULL              d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
threads           否                默认                                        
type_code         ansi              mode                                        
unsafe_null       否                默认                                        
userid            student/zaq12wsx@cd:\oracle\ora92\precomp\admin\pcbcfg.cfg    
varchar           否                默认                                        
xref              是                默认                                        
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:51 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.


统计信息
----------

返回代码: 0
严重级 I 的消息数量: 0
严重级 W 的消息数量: 0
严重级 E 的消息数量: 0
严重级 F 的消息数量: 0
输入行数: 297
说明的宿主变量个数: 14
游标名数量: 0
语句名数量: 0
可使用的最大内存 (字节): 95433
