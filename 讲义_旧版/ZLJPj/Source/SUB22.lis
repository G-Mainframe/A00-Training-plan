Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

打开文件：SUB22.PCO
     1  000010 IDENTIFICATION                               DIVISION.
     2  000020 PROGRAM-ID.  Sub22.
     3        *****************************************************************
     4        *程序ID         ：Sub22
     5        *程序名         ：学生成绩查询修改
     6        *处理概要       ：对学生成绩进行查询更新处理
     7        *
     8        *
     9        *变量           IO       变量名
    10        *
    11        *
    12        *
    13        *日期           作成者            概要
    14        *2007/04/02     张丽娟            作成
    15        *
    16        *
    17        *
    18        *****************************************************************
    19  000030 ENVIRONMENT                                  DIVISION.
    20        *****************************************************************
    21        *
    22        *****************************************************************
    23  000040 DATA                                         DIVISION.
    24  000050 WORKING-STORAGE                              SECTION.           
    25        *----------------------------------------------------------------
    26        *    数据库用数据定义
    27        *----------------------------------------------------------------
    28  000051     EXEC  SQL  BEGIN    DECLARE      SECTION  END-EXEC.
    29  000052     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL
     1  000010*  
     2  000030   01  SQLSTATE                      PIC  X(005).
     3  000040   01  DB-STRING                     PIC  X(020).
     4  000050   01  USERNAME                      PIC  X(010).
     5  000060   01  PASSWD                        PIC  X(010).
     6  000070*
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL
    30  000055     EXEC  SQL  INCLUDE  SQLCA.CBL             END-EXEC.
    31        *    学生成绩
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCA.CBL
     1        ***************************************************************** 
     2        *                                                               * 
     3        *               S  Q  L  C  A                                   * 
     4        *  (This file in ANSI format.  Do NOT bse it).                  * 
     5        *                                                               * 
     6        * MODIFIED                                                      * 
     7        *   Clare      12/06/84 - Ch SQLCA to not be an EXTERNAL.       * 
     8        ***************************************************************** 
     9         01  SQLCA.                                                       
    10             05  SQLCAID               PIC X(8).                          
    11             05  SQLCABC               PIC S9(9) COMPUTATIONAL.           
    12             05  SQLCODE               PIC S9(9) COMPUTATIONAL.           
    13             05  SQLERRM.                                                 
    14                 49 SQLERRML           PIC S9(4) COMPUTATIONAL.           
    15                 49 SQLERRMC           PIC X(70).                         
    16             05  SQLERRP               PIC X(8).                          
    17             05  SQLERRD OCCURS 6 TIMES                                   
    18                                       PIC S9(9) COMPUTATIONAL.           
    19             05  SQLWARN.                                                 
    20                 10 SQLWARN0           PIC X(1).                          
    21                 10 SQLWARN1           PIC X(1).                          
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

    22                 10 SQLWARN2           PIC X(1).                          
    23                 10 SQLWARN3           PIC X(1).                          
    24                 10 SQLWARN4           PIC X(1).                          
    25                 10 SQLWARN5           PIC X(1).                          
    26                 10 SQLWARN6           PIC X(1).                          
    27                 10 SQLWARN7           PIC X(1).                          
    28             05  SQLEXT                PIC X(8).                          
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLCA.CBL
    32             EXEC  SQL  INCLUDE  STSCORE.CBL            END-EXEC.
    33        *    SQL WORK AREA
打开文件：D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL
     1        *****************************************************************
     2        *程序ID         ：STscore
     3        *程序名         ：学生成绩信息
     4        *
     5        *日期           作成者            概要
     6        *2007/03/18     张丽娟            作成
     7        *
     8        *****************************************************************
     9  000040 01 STscore.
    10             03 SNO                           PIC  9(06).
    11             03 Scourse                       PIC  9(06).
    12  000040     03 SScore                        PIC  9(03).
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL
    34             EXEC  SQL  INCLUDE  SQLWK.CBL            END-EXEC.
    35        *
打开文件：D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL
     1  000010*****************************************************************
     2  000020*SQL WORK AREA
     3  000030*****************************************************************
     4  000040 01 SQLWORKAREA.
     5             03 SQLSTUDENTINFO.
     6                 05 SQLSNO                 PIC  9(06).
     7             03 SQLCOUNT                   PIC 9(4).
关闭文件：D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL
    36  000056     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.
    37        *----------------------------------------------------------------
    38        *屏幕线型定义
    39        *----------------------------------------------------------------
    40         COPY WKSCRLine.
    41        *----------------------------------------------------------------
    42        *WORK变量
    43        *----------------------------------------------------------------
    44         COPY WKAREA.
    45        *
    46        *****************************************************************
    47        *
    48        *****************************************************************
    49  000070 LINKAGE                                      SECTION.
    50        *----------------------------------------------------------------
    51        *
    52        *----------------------------------------------------------------
    53  000080 SCREEN                                       SECTION.
    54        *画面头
    55  000090 COPY SCRHead.
    56        *学生信息
    57  000090 COPY SCRSCORE.
    58        *检索画面
    59  000090 COPY SUB22SCS.
    60        *画面底
    61         COPY SCRFLOOR.
    62        *公共信息提示
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

    63         COPY SCRPUB.
    64  
    65        *
    66  000120 PROCEDURE                                    DIVISION.
    67  000130 MAIN-PROCESS                                 SECTION.
    68        *初期处理
    69             PERFORM StartRTN.
    70        *
    71        *主处理
    72             PERFORM MAINRTN.
    73        *                      
    74        *终了处理
    75  000180     PERFORM EndRTN.
    76        *
    77  000180 END-PROGRAM.
    78  000190     EXIT PROGRAM .
    79        *****************************************************************
    80        *初期处理
    81        *
    82        *****************************************************************
    83         StartRTN                                     SECTION.
    84        *    初始化Work变量
    85             INITIALIZE STSCORE, WKAREA.
    86        *
    87         StartExit.
    88             EXIT.
    89        *
    90        *****************************************************************
    91        *主处理
    92        *
    93        *****************************************************************
    94         MAINRTN                                      SECTION.
    95  
    96        *    显示查询屏幕
    97             DISPLAY SCRHead.
    98             MOVE "请输入您要查询的学号和课程号"    TO WKCLUE.
    99             DISPLAY SUB22SCS.
   100             MOVE "请输入您要查询的学号和课程号"    TO WKCLUE.
   101             DISPLAY SCRFLOOR.
   102  
   103             ACCEPT  SUB22SCS.
   104        *
   105        *    是否存在判断
   106             PERFORM CHACKDATARTN.
   107        *
   108        *    按输入条件进行查询
   109             IF SQLCOUNT = 0
   110             THEN
   111        *        显示不存在画面
   112                 DISPLAY SCRHEAD
   113                 MOVE "您输入的学号不存在！" TO WKCLUE
   114                 MOVE SPACE TO WKTURN
   115                 DISPLAY SCRPUB
   116                 MOVE "您输入的学号不存在！" TO WKCLUE
   117                 DISPLAY SCRFLOOR
   118                 ACCEPT  SCRPUB
   119                 GO TO MAINEXIT
   120             ELSE
   121                PERFORM SELECTRTN
   122             END-IF.
   123        *
   124        *    判断是否进行更新处理
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   125             IF WKTURN = "U"
   126             THEN
   127        *        进行数据更新
   128                DISPLAY "进行数据更新"
   129                 PERFORM DBUPRTN
   130             ELSE
   131        *        不进行数据更新
   132                 CONTINUE
   133             END-IF.
   134        *
   135         MAINEXIT.
   136             EXIT.
   137        *----------------------------------------------------------------
   138        *是否存在检查
   139        *----------------------------------------------------------------
   140         CHACKDATARTN                                 SECTION.
   141  
   142        *    查询记录数量
   143             EXEC  SQL
   144                SELECT  COUNT(*)
   145                INTO :SQLCOUNT
   146                FROM  STUDENTSCORE
   147                WHERE (NO = :SNO) AND (COURSE = :SCOURSE)
   148             END-EXEC
   149  
   150             EVALUATE   SQLCODE
   151             WHEN  0
   152        *       查询记录条数正常
   153                DISPLAY  "查询记录条数正常sqlcode=", SQLCODE
   154                CONTINUE
   155             WHEN OTHER
   156        *       查询记录条数失败
   157                DISPLAY  "查询记录条数失败sqlcode=", SQLCODE
   158                MOVE SQLCODE TO EMSGSQLCD
   159        *       错误处理
   160                CALL "ERRORMSG" USING ERRORKEY
   161                GO TO MAINEXIT
   162             END-EVALUATE.
   163  
   164         CHACKDATAEXIT.
   165             exit.
   166        *----------------------------------------------------------------
   167        *查询学生信息
   168        *----------------------------------------------------------------
   169         SELECTRTN                                    SECTION.
   170        * 
   171        *    数据查询操作
   172             DISPLAY  "SNO=", SNO.
   173        *     MOVE SNO TO SQLSNO.
   174             EXEC SQL
   175                 SELECT  NO    
   176                        ,COURSE
   177                        ,SCORE 
   178                 INTO    :SNO    
   179                        ,:SCOURSE
   180                        ,:SSCORE 
   181                 FROM  STUDENTSCORE
   182                 WHERE (NO = :SNO) AND (COURSE = :SCOURSE)
   183             END-EXEC.
   184        *    
   185        *    数据库返回码判断
   186             EVALUATE SQLCODE
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   187             WHEN 0
   188        *        返回码为“0”数据查询正常
   189                 DISPLAY  "查询学生成绩成功sqlcode=", SQLCODE
   190        *        显示被查询学生信息画面
   191                 DISPLAY SCRHEAD
   192                 MOVE "如修改该学生课程成绩，更正内容后，键入U并回车确认"
   193                                          TO WKCLUE
   194                 MOVE SPACE TO WKTURN
   195                 DISPLAY SCRSCORE
   196                 MOVE "查询成绩成功！修改学生课程成绩请键入U并回车确认"
   197                                          TO WKCLUE
   198                 DISPLAY SCRFLOOR
   199        *
   200                 ACCEPT SCRSCORE
   201        *
   202             WHEN OTHER
   203        *        数据库返回码非“0”，数据插入失败，设定错误码
   204                 MOVE 221 TO ERRPOINT
   205                 MOVE SQLCODE TO EMSGSQLCD
   206        *        错误处理
   207                 CALL "ERRORMSG" USING ERRORKEY
   208                 GO TO MAINEXIT
   209             END-EVALUATE.
   210        *
   211         SELECTEXIT.
   212             EXIT.
   213        *
   214        *----------------------------------------------------------------
   215        *更新学生信息
   216        *----------------------------------------------------------------
   217         DBUPRTN                                      SECTION.
   218  
   219        *    数据查询操作
   220             EXEC SQL 
   221                 UPDATE STUDENTSCORE
   222                 SET  NO      =  :SNO     
   223                     ,COURSE  =  :SCOURSE 
   224                     ,SCORE   =  :SSCORE  
   225                 WHERE (NO = :SNO) AND (COURSE = :SCOURSE)
   226             END-EXEC.
   227        *    
   228        *    数据库返回码判断
   229             EVALUATE SQLCODE
   230             WHEN 0
   231        *       返回码为“0”数据更新正常
   232                DISPLAY  "更新学生信息sqlok=", SQLCODE
   233                EXEC SQL
   234                    COMMIT WORK RELEASE
   235                END-EXEC
   236        *
   237                DISPLAY SCRHEAD
   238                MOVE "学生信息更新成功，按回车返回主菜单"
   239                                         TO WKCLUE
   240                MOVE SPACE TO WKTURN
   241        *       显示被更新学生信息画面
   242                DISPLAY SCRPUB
   243                MOVE "更新学生信息成功！按回车返回主菜单" 
   244                                         TO WKCLUE
   245                DISPLAY SCRFLOOR
   246                ACCEPT SCRPUB
   247        *
   248             WHEN OTHER
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.

   249        *       数据库返回码非“0”，数据更新失败，设定错误码
   250                DISPLAY "更新失败"
   251                MOVE 122 TO ERRPOINT
   252                MOVE SQLCODE TO EMSGSQLCD
   253        *       错误处理
   254                CALL "ERRORMSG" USING ERRORKEY
   255             END-EVALUATE.
   256         DBUPEXIT.
   257             EXIT.
   258        *
   259        *****************************************************************
   260        *终了处理
   261        *
   262        *****************************************************************
   263         EndRTN                                       SECTION.
   264        *    调试信息
   265             DISPLAY "SUB22 END-PROGRAM OK".
   266         EndExit.
   267             EXIT.
   268        *****************************************************************
   269         END PROGRAM Sub22.
   270        *****************************************************************
关闭文件：SUB22.PCO
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.


宿主变量
--------------

03  SCOURSE OF STSCORE                                  Unsigned Display(6,0)
  D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL     11
  SUB22.PCO    147    179    182    223    225

03  SNO OF STSCORE                                      Unsigned Display(6,0)
  D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL     10
  SUB22.PCO    147    178    182    222    225

03  SQLCOUNT OF SQLWORKAREA                             Unsigned Display(4,0)
  D:\ZLJPj\Source\COPYLIB_DB\SQLWK.CBL      7
  SUB22.PCO    145

01  SQLSTATE                                            Charf(5)
  D:\ZLJPj\Source\COPYLIB_DB\SQLCOM.CBL      2
  SUB22.PCO    143    174    220    233

03  SSCORE OF STSCORE                                   Unsigned Display(3,0)
  D:\ZLJPj\Source\COPYLIB_DB\STSCORE.CBL     12
  SUB22.PCO    180    224

Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.



                              预编译器选项
-------------------------------------------------------------------------------
选项名称       当前值               设置地点
-------------------------------------------------------------------------------
asacc             否                默认                                        
assume_sqlcode    否                默认                                        
auto_connect      否                默认                                        
close_on_commit   是                mode                                        
comp5             是                d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
config            default config    默认                                        
date_format       local             默认                                        
dbms              native            默认                                        
declare_section   是                mode                                        
define            *none*            默认                                        
dynamic           ansi              mode                                        
end_of_fetch      100               mode                                        
eol_padding       是                默认                                        
errors            是                默认                                        
fips              否                默认                                        
format            ansi              默认                                        
hold_cursor       否                默认                                        
host              cobol             默认                                        
iname             SUB22.PCO         命令行                                      
include           D:\ZLJPj\Source\COd:\oracle\ora92\precomp\admin\pcbcfg.cfg    
ireclen           132               d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
litdelim          quote             默认                                        
lname             *none*            默认                                        
lreclen           132               默认                                        
ltype             long              默认                                        
maxliteral        160               d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
maxopencursors    10                默认                                        
mode              ANSI              d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
nested            是                默认                                        
nls_local         是                d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
oname             SUB22.Cbl         命令行                                      
oraca             否                默认                                        
oreclen           80                默认                                        
pagelen           66                默认                                        
picx              charf             默认                                        
prefetch          1                 默认                                        
release_cursor    否                默认                                        
select_error      是                默认                                        
sqlcheck          FULL              d:\oracle\ora92\precomp\admin\pcbcfg.cfg    
threads           否                默认                                        
type_code         ansi              mode                                        
unsafe_null       否                默认                                        
userid            student/zaq12wsx@cd:\oracle\ora92\precomp\admin\pcbcfg.cfg    
varchar           否                默认                                        
xref              是                默认                                        
Pro*COBOL: Release 9.2.0.1.0 - Production on 星期六 6月 23 20:23:55 2007

Copyright (c) 1982, 2002, Oracle Corporation.  All rights reserved.


统计信息
----------

返回代码: 0
严重级 I 的消息数量: 0
严重级 W 的消息数量: 0
严重级 E 的消息数量: 0
严重级 F 的消息数量: 0
输入行数: 295
说明的宿主变量个数: 12
游标名数量: 0
语句名数量: 0
可使用的最大内存 (字节): 94652
