000010******************************************************************
000020*         ＜ＮＮＮＮＮ＞                                         *
000030*      1. プログラム名    ：Ybコ`ドQマスタ移行I理         *
000040*      2. プログラムID    ：COBIS130                             *
000050*      3. I理概要        ：提携先指定のコ`ドからＢＯＴＬYb   *
000060*                           コ`ドのQテ`ブル                 *
000070*                                                                *
000080*      4. 作成者          ：ＮＮ                                 *
000090*      5. 作成日          ：XXXX.XX.XX                           *
000100******************************************************************
000110*                                                                 
000120******************************************************************
000130*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000140******************************************************************
000150 IDENTIFICATION                       DIVISION.                   
000160*                                                                 
000170 PROGRAM-ID.                          COBIS130.                   
000180******************************************************************
000190*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000200******************************************************************
000210 ENVIRONMENT                          DIVISION.                   
000220******************************************************************
000230*    ＩＮＰＵＴ－ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260 FILE-CONTROL.                                                    
000270*                                                                 
000280     SELECT         入力ファイル      ASSIGN    TO   U05          
000290     FILE STATUS    IS     ファイル状B                           
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*    入力ファイル                                                *
000420*----------------------------------------------------------------*
000430 FD  入力ファイル                                                 
000440     LABEL  RECORD    IS              STANDARD                    
000450     BLOCK  CONTAINS  0               RECORDS.                    
000460*                                                                 
000470 01  入力－レコ`ド.                                              
000480     COPY   CISPF001   REPLACING      ==()==  BY  ==入力－==.     
000490*                                                                 
000500******************************************************************
000510*  ＷＯＲＫＩＮＧ－ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000520******************************************************************
000530 WORKING-STORAGE                      SECTION.                    
000540*----------------------------------------------------------------*
000550*    ホスト涫定xエリア                                        *
000560*----------------------------------------------------------------*
000570     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000580*                                                                 
000590 01  ＷＳ－ジョモ商品                 PIC  X(08) VALUE "K3401966".
000600*                                                                 
000610*--< ＯＲＡＣＬＥ共通涫 >                                       
000620     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000630*                                                                 
000640*--< ジョモ商品マスタ >                                           
000650     EXEC  SQL  INCLUDE  JOM_SYOHIN_MST.CBL    END-EXEC.          
000660*                                                                 
000670*--< リ`ス提携先コ`ドQテ`ブル >                           
000680     EXEC  SQL  INCLUDE  IKOTBL004.CBL         END-EXEC.          
000690*                                                                 
000700*--< Ybコ`ドQマスタ >                                       
000710     EXEC  SQL  INCLUDE  D077SSH.CBL           END-EXEC.          
000720*                                                                 
000730*--< ＯＲＡＣＬＥ ＳＱＬg行情 (SQLCA) >                        
000740     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000750*                                                                 
000760     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000770*----------------------------------------------------------------*
000780*   作II域定x                                                 *
000790*----------------------------------------------------------------*
000800 01  ＷＯＲＫ－エリア.                                            
000810*--< エラ`コ`ド >                                               
000820     03  Ｗ－エラ`コ`ド             PIC S9(04).                 
000830*                                                                 
000840*--< ファイル状B >                                               
000850     03  ファイル状B                 PIC  X(02).                 
000860*                                                                 
000870*--< 件数エリア >                                                 
000880     03  件数エリア.                                              
000890         05  Ｗ－入力－件数１         PIC  9(09).                 
000900         05  Ｗ－入力－件数２         PIC  9(09).                 
000910         05  Ｗ－出力－件数           PIC  9(09).                 
000920*                                                                 
000930*--< フラグアリア >                                               
000940     03  フラグ－エリア.                                          
000950         05  Ｗ－K了－フラグ         PIC  X(01).                 
000960         05  Ｗ－K了－フラグ１       PIC  X(01).                 
000970         05  常K了－フラグ         PIC  X(01).                 
000980*                                                                 
000990*--< ファイル状B >                                               
001000     03  Ｗ－m用日                   PIC  X(08).                 
001010*                                                                 
001020*----------------------------------------------------------------*
001030*   I理rg定x                                                 *
001040*----------------------------------------------------------------*
001050*--< 共通情 >                                                   
001060 01  Ｗ－共通情.                                                
001070     03  Ｗ－システム日付.                                        
001080         05  Ｗ－世o                 PIC  X(02) VALUE  "20".     
001090         05  Ｗ－年月日               PIC  X(06).                 
001100     03  Ｗ－システムr刻             PIC  X(08).                 
001110     03  Ｗ－担当者                   PIC  X(08) VALUE "IKOPG   ".
001120*----------------------------------------------------------------*
001130*    サブル`チン名                                              *
001140*----------------------------------------------------------------*
001150 01  CALL-AREA.                                                   
001160*--< 共通ログサブル`チン >                                       
001170     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001180     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001190*----------------------------------------------------------------*
001200*    ＣＯＰＹI域                                                *
001210*----------------------------------------------------------------*
001220*--< 共通ログ用パラメ`タ >                                       
001230 01  IF-CHOCO001.                                                 
001240     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１－==.           
001250*                                                                 
001260*----------------------------------------------------------------*
001270*    ＩＮＩファイルizサブル`チン用パラメタI域                *
001280*----------------------------------------------------------------*
001290 01  PARA-AREA.                                                   
001300     COPY CPBCO001.                                               
001310******************************************************************
001320*    定数用デ`タ定xエリア                                      *
001330******************************************************************
001340 CONSTANT                             SECTION.                    
001350 01  定数I域.                                                    
001360     03  定数－プログラムＩＤ         PIC  X(08) VALUE "COBIS130".
001370     03  定数－プログラム名           PIC  X(80)                  
001380                                VALUE  "Ybコ`ドQマスタ移行".
001390     03  定数－ＳＱＬＯＫ             PIC  9(04)  VALUE  0000.    
001400     03  定数－ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001410     03  定数－正常状B               PIC  9(04)  VALUE  ZERO.    
001420     03  定数－常状B               PIC  9(04)  VALUE  0009.    
001430******************************************************************
001440*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001450******************************************************************
001460 PROCEDURE                            DIVISION.                   
001470*                                                                 
001480     PERFORM   初期I理.                                          
001490*                                                                 
001500     PERFORM   主I理  UNTIL  Ｗ－K了－フラグ  =  "Y".           
001510*                                                                 
001520     PERFORM   K了I理.                                          
001530*                                                                 
001540     STOP RUN.                                                    
001550*                                                                 
001560******************************************************************
001570*    初期I理                                            <1.0>   *
001580******************************************************************
001590 初期I理                             SECTION.                    
001600 初期I理－ＳＴＡＲＴ.                                            
001610*                                                                 
001620*----------------------------------------------------------------*
001630*    _始メッセ`ジ出力                                          *
001640*----------------------------------------------------------------*
001650     INITIALIZE                       IF-CHOCO001.                
001660     MOVE  "3"                        TO  共１－イベントNe.     
001670     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
001680     MOVE  "0"                        TO  共１－コ`ド.       
001690     MOVE  "START"                    TO  共１－I理Re.         
001700     MOVE  定数－プログラム名         TO  共１－その他メッセ`ジ. 
001710     CALL  CLOCO001                USING  IF-CHOCO001.            
001720*                                                                 
001730*----------------------------------------------------------------*
001740*    作II域の初期O定                                        *
001750*----------------------------------------------------------------*
001760     MOVE  SPACE                      TO  ＷＯＲＫ－エリア.       
001770     INITIALIZE                           ＷＯＲＫ－エリア.       
001780*                                                                 
001790*--< ＣＰＵ日付を取得 >                                           
001800     ACCEPT  Ｗ－年月日               FROM  DATE.                 
001810*                                                                 
001820*--< ＣＰＵr刻を取得 >                                           
001830     ACCEPT  Ｗ－システムr刻         FROM  TIME.                 
001840*----------------------------------------------------------------*
001850*    ＯＲＡＣＬＥ接A                                    <1.1>   *
001860*----------------------------------------------------------------*
001870     PERFORM  ＯＲＡＣＬＥ接A.                                   
001880*                                                                 
001890*----------------------------------------------------------------*
001900*    カ`ソル宣言                                        <1.2>   *
001910*----------------------------------------------------------------*
001920     PERFORM  カ`ソル宣言.                                       
001930*                                                                 
001940*--< ファイルオ`プン >                                           
001950     OPEN  INPUT  入力ファイル.                                   
001960*                                                                 
001970*----------------------------------------------------------------*
001980*    ファイルオ`プン状B判定                                    *
001990*----------------------------------------------------------------*
002000     EVALUATE  ファイル状B                                       
002010        WHEN  ZERO                                                
002020           CONTINUE                                               
002030        WHEN  OTHER                                               
002040*--<       ファイルオ`プンエラ` >                               
002050           MOVE     -1                TO  Ｗ－エラ`コ`ド        
002060           PERFORM  エラ`I理                                    
002070     END-EVALUATE.                                                
002080*----------------------------------------------------------------*
002090*    ジョモ商品izI理(１件目)                          <C.1>   *
002100*----------------------------------------------------------------*
002110     PERFORM   ジョモ商品izI理.                                
002120*                                                                 
002130*----------------------------------------------------------------*
002140*    基蔬m用日izI理(１件目)                          <C.2>   *
002150*----------------------------------------------------------------*
002160     PERFORM   基蔬m用日izI理.                                
002170*                                                                 
002180 初期I理－ＥＸＩＴ.                                              
002190     EXIT.                                                        
002200******************************************************************
002210*    主I理                                              <2.0>   *
002220******************************************************************
002230 主I理                               SECTION.                    
002240 主I理－ＳＴＡＲＴ.                                              
002250*                                                                 
002260*----------------------------------------------------------------*
002270*    集I理                                            <2.1>   *
002280*----------------------------------------------------------------*
002290     PERFORM  集I理.                                           
002300*                                                                 
002310*----------------------------------------------------------------*
002320*    Ybコ`ドQマスタ追加I理                        <2.2>   *
002330*----------------------------------------------------------------*
002340     PERFORM  Ybコ`ドQマスタ追加I理.                       
002350*                                                                 
002360*----------------------------------------------------------------*
002370*    ジョモ商品izI理. (２件目以降)                    <C.1>   *
002380*----------------------------------------------------------------*
002390     PERFORM   ジョモ商品izI理.                                
002400*                                                                 
002410 主I理－ＥＸＩＴ.                                                
002420     EXIT.                                                        
002430******************************************************************
002440*    K了I理                                            <3.0>   *
002450******************************************************************
002460 K了I理                             SECTION.                    
002470 K了I理－ＳＴＡＲＴ.                                            
002480*                                                                 
002490*----------------------------------------------------------------*
002500*    ＤＢクロ`ズ                                        <3.1>   *
002510*----------------------------------------------------------------*
002520     PERFORM   ＤＢクロ`ズ.                                      
002530*                                                                 
002540*----------------------------------------------------------------*
002550*    ＤＢコミットI理                                    <3.2>   *
002560*----------------------------------------------------------------*
002570     PERFORM   ＤＢコミットI理.                                  
002580*                                                                 
002590*--< ファイルクロ`ズ >                                           
002600     CLOSE  入力ファイル.                                         
002610*                                                                 
002620*----------------------------------------------------------------*
002630*    K了メッセ`ジ出力I理                              <C.3>   *
002640*----------------------------------------------------------------*
002650     PERFORM  K了メッセ`ジ出力.                                 
002660*                                                                 
002670*--< プログラム正常K了 >                                         
002680     MOVE  定数－正常状B             TO  PROGRAM-STATUS.         
002690*                                                                 
002700 K了I理－ＥＸＩＴ.                                              
002710     EXIT.                                                        
002720******************************************************************
002730*    K了メッセ`ジ出力                                  <C.3>   *
002740******************************************************************
002750  K了メッセ`ジ出力                  SECTION.                    
002760  K了メッセ`ジ出力－ＳＴＡＲＴ.                                 
002770*                                                                 
002780*----------------------------------------------------------------*
002790*    ジョモ商品マスタ入力件数                                    *
002800*----------------------------------------------------------------*
002810     INITIALIZE                       IF-CHOCO001.                
002820     MOVE  "3"                        TO  共１－イベントNe.     
002830     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
002840     MOVE  "0"                        TO  共１－コ`ド.       
002850     MOVE  "JOM_MST"                  TO  共１－I理テ`ブルＩＤ. 
002860     MOVE  "COUNT"                    TO  共１－I理Re.         
002870     MOVE  Ｗ－入力－件数１           TO  共１－デ`タ内容.       
002880     MOVE  "ジョモ商品マスタiz件数" TO  共１－その他メッセ`ジ. 
002890     CALL  CLOCO001                USING  IF-CHOCO001.            
002900*                                                                 
002910*----------------------------------------------------------------*
002920*    基蔬m用日ファイル入力件数                                  *
002930*----------------------------------------------------------------*
002940     INITIALIZE                       IF-CHOCO001.                
002950     MOVE  "3"                        TO  共１－イベントNe.     
002960     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
002970     MOVE  "0"                        TO  共１－コ`ド.       
002980     MOVE  "FFUSIA01"                  TO  共１－I理テ`ブルＩＤ. 
002990     MOVE  "COUNT"                    TO  共１－I理Re.         
003000     MOVE  Ｗ－入力－件数２           TO  共１－デ`タ内容.       
003010     MOVE  "基蔬m用日ファイルiz件数"                           
003020                                      TO  共１－その他メッセ`ジ. 
003030     CALL  CLOCO001                USING  IF-CHOCO001.            
003040*                                                                 
003050*----------------------------------------------------------------*
003060*    Ybコ`ドQマスタ出力件数                                *
003070*----------------------------------------------------------------*
003080     INITIALIZE                       IF-CHOCO001.                
003090     MOVE  "3"                        TO  共１－イベントNe.     
003100     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
003110     MOVE  "0"                        TO  共１－コ`ド.       
003120     MOVE  "D077SSH"                  TO  共１－I理テ`ブルＩＤ. 
003130     MOVE  "COUNT"                    TO  共１－I理Re.         
003140     MOVE  Ｗ－出力－件数             TO  共１－デ`タ内容.       
003150     MOVE  "Ybコ`ドQマスタ出力件数"                         
003160                                      TO  共１－その他メッセ`ジ. 
003170     CALL  CLOCO001                USING  IF-CHOCO001.            
003180*                                                                 
003190*----------------------------------------------------------------*
003200*    K了メッセ`ジ 出力                                         *
003210*----------------------------------------------------------------*
003220     INITIALIZE                       IF-CHOCO001.                
003230     MOVE  "3"                        TO  共１－イベントNe.     
003240     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
003250     MOVE  "0"                        TO  共１－コ`ド.       
003260     MOVE  "END"                      TO  共１－I理Re.         
003270     MOVE  定数－プログラム名         TO  共１－その他メッセ`ジ. 
003280     CALL  CLOCO001                USING  IF-CHOCO001.            
003290*                                                                 
003300 K了メッセ`ジ出力－ＥＸＩＴ.                                    
003310     EXIT.                                                        
003320******************************************************************
003330*    ＯＲＡＣＬＥ接A                                    <1.1>   *
003340******************************************************************
003350 ＯＲＡＣＬＥ接A                     SECTION.                    
003360 ＯＲＡＣＬＥ接A－ＳＴＡＲＴ.                                    
003370*                                                                 
003380*--< ＩＮＩファイルizサブル`チン呼び出し >                     
003390     CALL  COBCO001                USING  PARA-AREA.              
003400*                                                                 
003410     MOVE  PARA-DBSTRING              TO  DB-STRING.              
003420     MOVE  PARA-USERNAME              TO  USERNAME.               
003430     MOVE  PARA-PASSWORD              TO  PASSWD.                 
003440*                                                                 
003450*----------------------------------------------------------------*
003460*    _始接A                                                    *
003470*----------------------------------------------------------------*
003480     IF  DB-STRING  =  SPACE                                      
003490        EXEC  SQL                                                 
003500           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
003510        END-EXEC                                                  
003520     ELSE                                                         
003530        EXEC  SQL                                                 
003540           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
003550             USING  :DB-STRING                                    
003560        END-EXEC                                                  
003570     END-IF.                                                      
003580*                                                                 
003590*----------------------------------------------------------------*
003600*    接A状B判定                                                *
003610*----------------------------------------------------------------*
003620     EVALUATE  SQLCODE                                            
003630        WHEN  定数－ＳＱＬＯＫ                                    
003640*--<       接A正常 >                                             
003650           CONTINUE                                               
003660        WHEN  OTHER                                               
003670*--<       接Aエラ` >                                           
003680           MOVE     -10               TO  Ｗ－エラ`コ`ド        
003690           PERFORM  エラ`I理                                    
003700     END-EVALUATE.                                                
003710*                                                                 
003720 ＯＲＡＣＬＥ接A－ＥＸＩＴ.                                      
003730     EXIT.                                                        
003740******************************************************************
003750*    カ`ソル宣言                                        <1.2>   *
003760******************************************************************
003770*                                                                 
003780 カ`ソル宣言                         SECTION.                    
003790 カ`ソル宣言－ＳＴＡＲＴ.                                        
003800*                                                                 
003810*----------------------------------------------------------------*
003820*    カ`ソル宣言                                                *
003830*----------------------------------------------------------------*
003840     EXEC  SQL                                                    
003850        DECLARE  CUR1  CURSOR  FOR                                
003860           SELECT  ジョモ商品コ`ド                               
003870                  ,ジョモ商品分名                               
003880                  ,物件名＿h字                                   
003890                  ,物件名                                         
003900                  ,CN名                                         
003910                  ,税区分                                         
003920                  ,Ybコ`ド                                     
003930                  ,泳t保コ`ド                                 
003940                  ,信用保コ`ド＿リ`ス                         
003950                  ,信用保コ`ド＿割x                           
003960             FROM  JOM_SYOHIN_MST                                 
003970     END-EXEC.                                                    
003980*                                                                 
003990*----------------------------------------------------------------*
004000*    カ`ソルオ`プン                                            *
004010*----------------------------------------------------------------*
004020     EXEC  SQL                                                    
004030        OPEN  CUR1                                                
004040     END-EXEC.                                                    
004050*                                                                 
004060*----------------------------------------------------------------*
004070*    カ`ソルオ`プンを_J                                      *
004080*----------------------------------------------------------------*
004090     EVALUATE   SQLCODE                                           
004100        WHEN   定数－ＳＱＬＯＫ                                   
004110*--<       正常 >                                                 
004120           CONTINUE                                               
004130        WHEN   OTHER                                              
004140*--<       カ`ソルオ`プン失　プログラムが常K了 >           
004150           MOVE      -20              TO  Ｗ－エラ`コ`ド        
004160           PERFORM   エラ`I理                                   
004170     END-EVALUATE.                                                
004180*                                                                 
004190 カ`ソル宣言－ＥＸＩＴ.                                          
004200     EXIT.                                                        
004210******************************************************************
004220*    ジョモ商品izI理                                  <C.1>   *
004230******************************************************************
004240 ジョモ商品izI理                   SECTION.                    
004250 ジョモ商品izI理－ＳＴＡＲＴ.                                  
004260*                                                                 
004270     EXEC  SQL                                                    
004280        FETCH  CUR1                                               
004290           INTO                                                   
004300             :ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－ジョモ商品コ`ド      
004310            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－ジョモ商品分名      
004320            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－物件名－h字          
004330            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－物件名                
004340            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－CN名                
004350            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－税区分                
004360            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－Ybコ`ド            
004370            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－泳t保コ`ド        
004380            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－信用保コ`ド－リ`ス
004390            ,:ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－信用保コ`ド－割x  
004400     END-EXEC.                                                    
004410*                                                                 
004420*----------------------------------------------------------------*
004430*    ジョモ商品iz_J                                          *
004440*----------------------------------------------------------------*
004450     EVALUATE  SQLCODE                                            
004460        WHEN  定数－ＳＱＬＯＫ                                    
004470*--<       正常 >                                                 
004480           COMPUTE   Ｗ－入力－件数１ =  Ｗ－入力－件数１ +  1    
004490        WHEN  定数－ＳＱＬＥＮＤ                                  
004500*--<       izK了 >                                             
004510           MOVE      "Y"              TO  Ｗ－K了－フラグ        
004520        WHEN  OTHER                                               
004530*--<       izエラ`、プログラムが常K了 >                     
004540           MOVE      -30              TO  Ｗ－エラ`コ`ド        
004550           PERFORM   エラ`I理                                   
004560     END-EVALUATE.                                                
004570*                                                                 
004580 ジョモ商品izI理－ＥＸＩＴ.                                    
004590     EXIT.                                                        
004600******************************************************************
004610*    基蔬m用日izI理                                  <C.2>   *
004620******************************************************************
004630 基蔬m用日izI理                   SECTION.                    
004640 基蔬m用日izI理－ＳＴＡＲＴ.                                  
004650*--<    基蔬m用日iz >                                          
004660        READ  入力ファイル                                        
004670           AT  END                                                
004680*--<          izK了 >                                          
004690              MOVE  "Y"               TO  Ｗ－K了－フラグ１      
004700              GO  TO  基蔬m用日izI理－ＥＸＩＴ                
004710           NOT  AT  END                                           
004720              COMPUTE  Ｗ－入力－件数２  =  Ｗ－入力－件数２ + 1  
004730        END-READ.                                                 
004740*                                                                 
004750*----------------------------------------------------------------*
004760*    ファイルオ`プン状B判定                                    *
004770*----------------------------------------------------------------*
004780     EVALUATE  ファイル状B                                       
004790        WHEN  ZERO                                                
004800           MOVE  入力－m用日         TO  Ｗ－m用日              
004810        WHEN  OTHER                                               
004820*--<       iみzみエラ` >                                       
004830           MOVE     ZERO              TO  Ｗ－m用日              
004840           MOVE     -2                TO  Ｗ－エラ`コ`ド        
004850           PERFORM  エラ`I理                                    
004860     END-EVALUATE.                                                
004870*                                                                 
004880 基蔬m用日izI理－ＥＸＩＴ.                                    
004890     EXIT.                                                        
004900******************************************************************
004910*    集I理                                            <2.1>   *
004920******************************************************************
004930 集I理                             SECTION.                    
004940 集I理－ＳＴＡＲＴ.                                            
004950*                                                                 
004960*--< 出力レコ`ドを初期化 >                                       
004970*                                                                 
004980     MOVE  SPACE                      TO  Ybコ`ドQマスタ.   
004990     INITIALIZE                           Ybコ`ドQマスタ.   
005000*----------------------------------------------------------------*
005010*    リ`スコ`ド取得I理                              <2.1.1> *
005020*----------------------------------------------------------------*
005030     PERFORM       リ`スコ`ド取得I理.                        
005040*                                                                 
005050*----------------------------------------------------------------*
005060*    集I理                                                    *
005070*----------------------------------------------------------------*
005080     MOVE  ＩＫＯ００４－リ`ス提携先コ`ド                     
005090                             TO  Ｄ０７７－リ`ス提携先コ`ド.  
005100*                                                                 
005110     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－ジョモ商品コ`ド         
005120                             TO  Ｄ０７７－先方商品コ`ド.        
005130*                                                                 
005140     MOVE  Ｗ－m用日        TO  Ｄ０７７－m用年月日.            
005150*                                                                 
005160     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－Ybコ`ド               
005170                             TO  Ｄ０７７－Ybコ`ド.            
005180*                                                                 
005190     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－泳t保コ`ド           
005200                             TO  Ｄ０７７－泳t保コ`ド.        
005210*                                                                 
005220     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－信用保コ`ド－リ`ス   
005230                             TO  Ｄ０７７－信用保コ`ド－リ`ス.
005240*                                                                 
005250     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－信用保コ`ド－割x     
005260                             TO  Ｄ０７７－信用保コ`ド－割x.  
005270*                                                                 
005280*----------------------------------------------------------------*
005290*    税区分判定                                                  *
005300*----------------------------------------------------------------*
005310     EVALUATE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－税区分               
005320*--<    "0"非n税 >                                               
005330        WHEN  "0"                                                 
005340           MOVE    "0"                TO  Ｄ０７７－税担区分    
005350*--<    "1"非n税 >                                               
005360        WHEN  "1"                                                 
005370           MOVE    "1"                TO  Ｄ０７７－税担区分    
005380*--<    "2"非n税 >                                               
005390        WHEN  "2"                                                 
005400           MOVE    "2"                TO  Ｄ０７７－税担区分    
005410*--<    "3"非n税 >                                               
005420        WHEN  "3"                                                 
005430           MOVE    "3"                TO  Ｄ０７７－税担区分    
005440*--<    "4"非n税 >                                               
005450        WHEN  "4"                                                 
005460           MOVE    "4"                TO  Ｄ０７７－税担区分    
005470     END-EVALUATE.                                                
005480*                                                                 
005490     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－ジョモ商品分名         
005500                                      TO  Ｄ０７７－商品分名.   
005510     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－物件名－h字             
005520                                      TO  Ｄ０７７－物件名h字.   
005530     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－物件名                   
005540                                      TO  Ｄ０７７－物件名.       
005550     MOVE  ＪＯＭ－ＳＹＯＨＩＮ－ＭＳＴ－CN名                   
005560                                      TO  Ｄ０７７－CN名.       
005570     MOVE  Ｗ－システム日付           TO  Ｄ０７７－登h年月日.   
005580     MOVE  Ｗ－システムr刻           TO  Ｄ０７７－登hrg.     
005590     MOVE  Ｗ－担当者                 TO  Ｄ０７７－登h担当者.   
005600     MOVE  Ｗ－システム日付           TO  Ｄ０７７－更新年月日.   
005610     MOVE  Ｗ－システムr刻           TO  Ｄ０７７－更新rg.     
005620     MOVE  Ｗ－担当者                 TO  Ｄ０７７－更新者.       
005630     MOVE  Ｗ－担当者                 TO                          
005640                                      Ｄ０７７－入力担当者コ`ド. 
005650*                                                                 
005660 集I理－ＥＸＩＴ.                                              
005670     EXIT.                                                        
005680******************************************************************
005690*    リ`スコ`ド取得I理                              <2.1.1> *
005700******************************************************************
005710 リ`スコ`ド取得I理               SECTION.                    
005720 リ`スコ`ド取得I理－ＳＴＡＲＴ.                              
005730                                                                  
005740     MOVE  SPACE                      TO                          
005750                               ＩＫＯ００４－リ`ス提携先コ`ド.
005760*--< リ`ス提携先コ`ド取得 >                                   
005770     EXEC SQL                                                     
005780        SELECT  リ`ス提携先コ`ド                              
005790          INTO :ＩＫＯ００４－リ`ス提携先コ`ド                
005800          FROM  IKOTBL004                                         
005810        WHERE   取引先コ`ド  =  :ＷＳ－ジョモ商品                
005820     END-EXEC.                                                    
005830*                                                                 
005840*--< リ`ステ`ブルiz_J >                                   
005850     EVALUATE  SQLCODE                                            
005860        WHEN  定数－ＳＱＬＯＫ                                    
005870*--<       正常 >                                                 
005880           CONTINUE                                               
005890        WHEN  OTHER                                               
005900*--<       リ`ス提携先コ`ドを取得しない >                     
005910           MOVE      -40              TO  Ｗ－エラ`コ`ド        
005920           PERFORM   エラ`I理                                   
005930           MOVE  ZERO                 TO                          
005940                               ＩＫＯ００４－リ`ス提携先コ`ド 
005950     END-EVALUATE.                                                
005960*                                                                 
005970 リ`スコ`ド取得I理－ＥＸＩＴ.                                
005980     EXIT.                                                        
005990******************************************************************
006000*    Ybコ`ドQマスタ追加I理                        <2.2>   *
006010******************************************************************
006020 Ybコ`ドQマスタ追加I理         SECTION.                    
006030 Ybコ`ドQマスタ追加I理－ＳＴＡＲＴ.                        
006040*                                                                 
006050     EXEC  SQL                                                    
006060        INSERT  INTO  D077SSH_TBL                                 
006070           (リ`ス提携先コ`ド                                  
006080           ,先方商品コ`ド                                        
006090           ,m用年月日                                            
006100           ,Ybコ`ド                                            
006110           ,泳t保コ`ド                                        
006120           ,信用保コ`ド＿リ`ス                              
006130           ,信用保コ`ド＿割x                                    
006140           ,税担区分                                            
006150           ,商品分名                                            
006160           ,物件名h字                                            
006170           ,物件名                                                
006180           ,CN名                                                
006190           ,登h年月日                                            
006200           ,登hrg                                              
006210           ,登h担当者                                            
006220           ,更新年月日                                            
006230           ,更新rg                                              
006240           ,更新者                                                
006250           ,入力担当者コ`ド)                                     
006260       VALUES                                                     
006270           (:Ｄ０７７－リ`ス提携先コ`ド                       
006280           ,:Ｄ０７７－先方商品コ`ド                             
006290           ,:Ｄ０７７－m用年月日                                 
006300           ,:Ｄ０７７－Ybコ`ド                                 
006310           ,:Ｄ０７７－泳t保コ`ド                             
006320           ,:Ｄ０７７－信用保コ`ド－リ`ス                     
006330           ,:Ｄ０７７－信用保コ`ド－割x                       
006340           ,:Ｄ０７７－税担区分                                 
006350           ,:Ｄ０７７－商品分名                                 
006360           ,:Ｄ０７７－物件名h字                                 
006370           ,:Ｄ０７７－物件名                                     
006380           ,:Ｄ０７７－CN名                                     
006390           ,:Ｄ０７７－登h年月日                                 
006400           ,:Ｄ０７７－登hrg                                   
006410           ,:Ｄ０７７－登h担当者                                 
006420           ,:Ｄ０７７－更新年月日                                 
006430           ,:Ｄ０７７－更新rg                                   
006440           ,:Ｄ０７７－更新者                                     
006450           ,:Ｄ０７７－入力担当者コ`ド)                          
006460     END-EXEC.                                                    
006470*                                                                 
006480*----------------------------------------------------------------*
006490*    ＤＢ追加I理を_J                                          *
006500*----------------------------------------------------------------*
006510     EVALUATE  SQLCODE                                            
006520        WHEN   定数－ＳＱＬＯＫ                                   
006530*--<       追加成功 >                                             
006540           COMPUTE  Ｗ－出力－件数    =  Ｗ－出力－件数  +  1     
006550        WHEN   OTHER                                              
006560*--<       追加失　プログラムを常K了する >                   
006570           MOVE     -50               TO  Ｗ－エラ`コ`ド        
006580           PERFORM  エラ`I理                                    
006590     END-EVALUATE.                                                
006600*                                                                 
006610 Ybコ`ドQマスタ追加I理－ＥＸＩＴ.                          
006620     EXIT.                                                        
006630******************************************************************
006640*    ＤＢクロ`ズ                                        <3.1>   *
006650******************************************************************
006660 ＤＢクロ`ズ                         SECTION.                    
006670 ＤＢクロ`ズ－ＳＴＡＲＴ.                                        
006680*                                                                 
006690*--< カ`ソルのクロ`ズ >                                         
006700     EXEC  SQL                                                    
006710        CLOSE  CUR1                                               
006720     END-EXEC.                                                    
006730*                                                                 
006740 ＤＢクロ`ズ－ＥＸＩＴ.                                          
006750     EXIT.                                                        
006760******************************************************************
006770*    ＤＢコミットI理                                    <3.2>   *
006780******************************************************************
006790 ＤＢコミットI理                     SECTION.                    
006800 ＤＢコミットI理－ＳＴＡＲＴ.                                    
006810*                                                                 
006820     EXEC  SQL                                                    
006830        COMMIT  WORK  RELEASE                                     
006840     END-EXEC.                                                    
006850*                                                                 
006860*--< コミットI理 >                                               
006870     INITIALIZE                       IF-CHOCO001.                
006880     MOVE  "3"                        TO  共１－イベントNe.     
006890     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
006900     MOVE  "0"                        TO  共１－コ`ド.       
006910     MOVE  "COMMIT"                   TO  共１－I理Re.         
006920     MOVE  "コミットg施"             TO  共１－その他メッセ`ジ. 
006930     CALL  CLOCO001                USING  IF-CHOCO001.            
006940*                                                                 
006950 ＤＢコミットI理－ＥＸＩＴ.                                      
006960     EXIT.                                                        
006970******************************************************************
006980*    ＤＢロ`ルバックI理                                <4.1>   *
006990******************************************************************
007000 ＤＢロ`ルバックI理                 SECTION.                    
007010 ＤＢロ`ルバックI理－ＳＴＡＲＴ.                                
007020*                                                                 
007030     EXEC  SQL                                                    
007040         ROLLBACK WORK  RELEASE                                   
007050     END-EXEC.                                                    
007060*                                                                 
007070*--< ロ`ルバックI理 >                                           
007080     INITIALIZE                       IF-CHOCO001.                
007090     MOVE  "1"                        TO  共１－イベントNe.     
007100     MOVE  定数－プログラムＩＤ       TO  共１－ソ`スＩＤ.       
007110     MOVE  "9"                        TO  共１－コ`ド.       
007120     MOVE  "ROLLBACK"                 TO  共１－I理Re.         
007130     MOVE  "ロ`ルバックg施"         TO  共１－その他メッセ`ジ. 
007140     CALL  CLOCO001                USING  IF-CHOCO001.            
007150*                                                                 
007160 ＤＢロ`ルバックI理－ＥＸＩＴ.                                  
007170     EXIT.                                                        
007180******************************************************************
007190*    エラ`I理                                          <4.0>   *
007200******************************************************************
007210 エラ`I理                           SECTION.                    
007220 エラ`I理－ＳＴＡＲＴ.                                          
007230*                                                                 
007240     MOVE  "Y"                        TO  常K了－フラグ.       
007250     INITIALIZE                       IF-CHOCO001.                
007260*                                                                 
007270     EVALUATE  Ｗ－エラ`コ`ド                                   
007280        WHEN  -1                                                  
007290*--<       基蔬m用日ファイルオ`プンエラ` >                     
007300           MOVE  "2"                  TO  共１－イベントNe      
007310           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
007320           MOVE  "9"                  TO  共１－コ`ド        
007330           MOVE  "FFUISA01"           TO  共１－I理テ`ブルＩＤ  
007340           MOVE  "OPEN"               TO  共１－I理Re          
007350           MOVE  ファイル状B         TO  共１－デ`タ内容        
007360           MOVE  "基蔬m用日ファイルオ`プンエラ`"               
007370                                      TO  共１－その他メッセ`ジ  
007380           CALL  CLOCO001          USING  IF-CHOCO001             
007390           MOVE  "N"                  TO  常K了－フラグ        
007400*                                                                 
007410        WHEN  -2                                                  
007420*--<       基蔬m用日iみzみファイルエラ` >                     
007430           MOVE  "2"                  TO  共１－イベントNe      
007440           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
007450           MOVE  "9"                  TO  共１－コ`ド        
007460           MOVE  "FFUISA01"           TO  共１－I理テ`ブルＩＤ  
007470           MOVE  "READ"               TO  共１－I理Re          
007480           MOVE  ファイル状B         TO  共１－デ`タ内容        
007490           MOVE  "基蔬m用日ファイルiみzみエラ`"               
007500                                      TO  共１－その他メッセ`ジ  
007510           CALL  CLOCO001          USING  IF-CHOCO001             
007520           MOVE  "N"                  TO  常K了－フラグ        
007530*                                                                 
007540        WHEN  -10                                                 
007550*--<       ＯＲＡＣＬＥ接A失 >                                 
007560           MOVE  "1"                  TO  共１－イベントNe      
007570           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
007580           MOVE  "9"                  TO  共１－コ`ド        
007590           MOVE  "CONNECT"            TO  共１－I理Re          
007600           MOVE  SQLCODE              TO  共１－デ`タ内容        
007610           MOVE  SQLERRMC             TO  共１－その他メッセ`ジ  
007620           CALL  CLOCO001          USING  IF-CHOCO001             
007630*                                                                 
007640        WHEN  -20                                                 
007650*--<       カ`ソルオ`プン失 >                                 
007660           MOVE  "1"                  TO  共１－イベントNe      
007670           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
007680           MOVE  "9"                  TO  共１－コ`ド        
007690           MOVE  "JOM_MST"            TO  共１－I理テ`ブルＩＤ  
007700           MOVE  "OPEN"               TO  共１－I理Re          
007710           MOVE  SQLCODE              TO  共１－デ`タ内容        
007720           MOVE  SQLERRMC             TO  共１－その他メッセ`ジ  
007730           CALL  CLOCO001          USING  IF-CHOCO001             
007740*                                                                 
007750        WHEN  -30                                                 
007760*--<       ジョモ商品のiz失 >                                 
007770           MOVE  "1"                  TO  共１－イベントNe      
007780           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
007790           MOVE  "9"                  TO  共１－コ`ド        
007800           MOVE  "JOM_MST"            TO  共１－I理テ`ブルＩＤ  
007810           MOVE  "FETCH"              TO  共１－I理Re          
007820           MOVE  SQLCODE              TO  共１－デ`タ内容        
007830           MOVE  SQLERRMC             TO  共１－その他メッセ`ジ  
007840           CALL  CLOCO001          USING  IF-CHOCO001             
007850*                                                                 
007860        WHEN  -40                                                 
007870*--<       リ`ス提携先コ`ドを取得しない >                     
007880           MOVE  "2"                  TO  共１－イベントNe      
007890           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
007900           MOVE  "9"                  TO  共１－コ`ド        
007910           MOVE  "IKO004"             TO  共１－I理テ`ブルＩＤ  
007920           MOVE  "SELECT"             TO  共１－I理Re          
007930           MOVE  ＷＳ－ジョモ商品     TO  共１－キ`情          
007940           MOVE  SQLCODE              TO  共１－デ`タ内容        
007950           MOVE  SQLERRMC             TO  共１－その他メッセ`ジ  
007960           CALL  CLOCO001          USING  IF-CHOCO001             
007970           MOVE  "N"                  TO  常K了－フラグ        
007980*                                                                 
007990        WHEN  -50                                                 
008000*--<       Ybコ`ドQマスタ追加失 >                         
008010           MOVE  "1"                  TO  共１－イベントNe      
008020           MOVE  定数－プログラムＩＤ TO  共１－ソ`スＩＤ        
008030           MOVE  "9"                  TO  共１－コ`ド        
008040           MOVE  "D077SSH"            TO  共１－I理テ`ブルＩＤ  
008050           MOVE  "INSERT"             TO  共１－I理Re          
008060           MOVE  SQLCODE              TO  共１－デ`タ内容        
008070           MOVE  SQLERRMC             TO  共１－その他メッセ`ジ  
008080           CALL  CLOCO001          USING  IF-CHOCO001             
008090*                                                                 
008100        WHEN  OTHER                                               
008110           MOVE  "N"                  TO  常K了－フラグ        
008120     END-EVALUATE.                                                
008130*                                                                 
008140     IF  常K了－フラグ  =  "Y"                                 
008150*----------------------------------------------------------------*
008160*    K了メッセ`ジ出力I理                                      *
008170*----------------------------------------------------------------*
008180        PERFORM  K了メッセ`ジ出力                               
008190*                                                                 
008200        PERFORM  ＤＢロ`ルバックI理                             
008210*--<    プログラムリタ`ンコ`ド >                                
008220        MOVE  定数－常状B          TO  PROGRAM-STATUS          
008230        EXIT  PROGRAM                                             
008240     END-IF.                                                      
008250*                                                                 
008260 エラ`I理－ＥＸＩＴ.                                            
008270      EXIT.                                                       
008280******************************************************************
008290*                  END OF PROGRAM                                *
008300******************************************************************
 
