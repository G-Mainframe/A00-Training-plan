<html>

<head>
<title>3.2 帳票印刷コントロールのイベントの流れ</title>
</head>

<body BGCOLOR="#FFFFFF">

<table WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">
  <tr>
    <td ALIGN="LEFT"><strong>帳票印刷コントロール使用手引書</strong> 
    </td>
  </tr>
  <tr>
    <td ALIGN="RIGHT"><a HREF="../index.htm" TARGET="_top">目次</a>&nbsp; <a HREF="pctl0320.htm"><img SRC="../pctlosrc/previous.gif" BORDER="0" ALT="前ページ" WIDTH="56" HEIGHT="21"></a><a HREF="pctl0340.htm"><img SRC="../pctlosrc/next.gif" BORDER="0" ALT="次ページ" WIDTH="56" HEIGHT="21"></a> </td>             
  </tr>             
</table>             
             
<hr>             
             
<dl>             
  <dl>             
    <dt><a HREF="../pctlo002/pctl0210.htm"><img SRC="../pctlosrc/up.gif" BORDER="0" ALT="上へ" WIDTH="16" HEIGHT="15">第3章              
      </a><a HREF="pctl0310.htm" TARGET="fmain">帳票印刷コントロールの処理を記述する</a>              
    </dt>             
  </dl>             
</dl>             
             
<hr>             
             
<h2>3.2 帳票印刷コントロールのイベントの流れ</h2>             
             
<p>帳票印刷コントロールのイベントは、帳票の種類や構成にも関連します。</p>             
             
<p>ここでは、各イベントの発生するタイミングと、どのような処理を記述するかを、イベントの流れに沿って説明します。             
            
<ul>            
  <li><a HREF="pctl0330.htm#aIDH_G00_0E_06_02_01">基本的なイベント</a> </li>            
  <li><a HREF="pctl0330.htm#aIDH_G00_0E_06_02_02">起動と終了に関するイベント</a> </li>            
  <li><a HREF="pctl0330.htm#aIDH_G00_0E_06_02_03">複数の帳票定義体を利用する場合のイベントの流れ</a>            
  </li>           
  <li><a HREF="pctl0330.htm#aIDH_G00_0E_06_02_04">イベントに関する定義</a></li>           
</ul>           
           
<h3><a NAME="aIDH_G00_0E_06_02_01">■基本的なイベント</a></h3>           
           
<p>ここでは、基本的に使用するイベントの流れ、および、イベントの種類について説明します。</p>          
          
<h4>◆イベントの流れ</h4>          
          
<p>基本的なイベントの流れを、下図に示します。</p>          
          
<h4>[基本的なイベントの流れ]</h4>          
          
<p><img SRC="../pctlosrc/prt00001.gif" ALT="image" WIDTH="491" HEIGHT="688"></p>          
          
<h4>◆イベントの種類</h4>          
          
<p>基本的なイベントには、次のものがあります。           
          
<ul>          
  <li>明細計算(CalculateDE)イベント（省略可能） </li>          
  <li>明細出力(PrintDE)イベント（省略可能） </li>          
  <li>報告書頭書き(ReportHead)イベント（省略可能） </li>          
  <li>報告書脚書き(ReportFoot)イベント（省略可能） </li>          
  <li>ページ頭書き(PageHead)イベント（省略可能） </li>          
  <li>ページ脚書き(PageFoot)イベント（省略可能） </li>          
  <li>制御頭書き(CBHead)イベント（省略可能） </li>          
  <li>制御脚書き(CBFoot)イベント（省略可能） </li>          
  <li>レコード読込み(ReadRecord)イベント（省略不可）</li>          
</ul>          
          
<h4>(1) レコード読込み(ReadRecord)イベン<a NAME="READRECORDIBENNTO">ト</a></h4>             
             
<p>レコード読込み(ReadRecord)イベントでは、印刷するレコードを帳票定義体の項目に設定する処理を記述します。読み込むレコードがなくなったら、「レコードEOF（RecordEOF）」プロパティで「true:処理対象レコードなし」を設定する必要があります。</p>         
         
<p>また、集計表形式、または、段組み集計表形式の帳票定義体で複数の明細を使っている場合、このイベントで明細名を指定します。どの明細を使うかを、「明細名（DEName）」プロパティを使って設定します。</p>         
         
<p>１つの帳票印刷コントロールで複数の帳票定義体を利用する時に、使用する帳票定義体を変更する場合は、「帳票フォーム名（FormName）」プロパティで使用する帳票定義体名を指定します。帳票定義体を切り替える方法やイベントの流れについては、関連項目の“複数の帳票定義体を定義している場合のイベントの流れ”を参照してください。</p>         
         
<h4>(2) 明細計算(CalculateDE)イベン<a NAME="CALCULATEDEIBENNTO">ト</a></h4>            
            
<p>明細計算(CalculateDE)イベントは、１つの明細内での、ある項目から他の項目への計算を行います。レコード読込み(ReadRecord)イベントで値が設定されていない明細の項目は、ここで値を設定する必要があります。</p>          
          
<h4>(3) 最初の１レコードに関する処理</h4>            
            
<p>レコード読込み(ReadRecord)イベントで設定された最初の１レコードに対して、明細計算(CalculateDE)イベントの後に、報告書頭書<a NAME="HOUKOKUSHILYOATAMAGAKI">き</a>など、先頭に印刷するパーティションの印刷が行われます。つまり、報告書頭書き(ReportHead)イベントの処理を記述する時に、明細計算(CalculateDE)イベントで設定された項目の値を参照して利用することができます。</p>         
         
<h4>(4) 報告書頭書き(ReportHead)イベン<a NAME="REPORTHEADIBENNTO">ト</a>と報告書脚書き(ReportFoot)イベン<a NAME="REPORTFOOTIBENNTO">ト</a></h4>            
            
<p>報告書頭書き(ReportHead)イベントと報告書脚書き(ReportFoot)イベントでは、報告書頭書きや報告書脚書きの項目に値を設定する処理を記述します。</p>          
          
<p>            
このイベントは、集計表形式、または、段組み集計表形式の帳票定義体で発生します。また、報告書頭書き、報告書脚書きの有無にかかわらず発生します。</p>         
         
<h4>(5) ページ頭書き(PageHead)イベン<a NAME="PAGEHEADIBENNTO">ト</a>とページ脚書き(PageFoot)イベン<a NAME="PAGEFOOTIBENNTO">ト</a></h4>            
            
<p>ページ頭書きイベントとページ脚書きイベントは、それぞれページの先頭と末尾に印刷されるページ頭書きやページ脚書きの項目に値を設定する処理を記述します。</p>          
          
<p>このイベントは、段組み伝票形式、集計表形式、または、段組み集計表形式の帳票定義体で発生します。また、ページ頭書き、ページ脚書きの有無にかかわらず発生します。</p>        
        
<p>集計表形式、または、段組み集計表形式の帳票定義体では、報告書頭書きの印刷の後に、最初のページのページ頭書きが印刷されます。また、最後のページのページ脚書きの印刷の後に、報告書脚書きが印刷されます。</p>        
        
<h4>(6) 制御頭書き(CBHead)イベン<a NAME="CBHEADIBENNTO">ト</a>と制御脚書き(CBFoot)イベン<a NAME="CBFOOTIBENNTO">ト</a></h4>            
            
<p>制御頭書き(CBHead)イベントと制御脚書き(CBFoot)イベントでは、制御頭書きや制御脚書きの項目に値を設定する処理を、対応づけられているブレーク項目ごとに記述します。</p>          
          
<p>           
このイベントは、集計表形式、または、段組み集計表形式の帳票定義体で発生します。また、制御頭書き、制御脚書きの有無にかかわらず発生します。</p>         
         
<p>ブレーク項<a NAME="BURE_815bKUKOUMOKU">目</a>とは、その項目の値が変化したかどうかを、明細計算(CalculateDE)イベントの後で常にチェックする項目です。ブレーク項目として定義する項目、および、ブレーク項目に対応する制御頭書きや制御脚書きのパーティションは、帳票定義体を作成/編集する時に定義します。<br>       
たとえば、ブレーク項目の値が変化するごとにそれまでの合計を印刷したい場合は、以下のようにします。<br>       
　　1.　ブレーク項目に対応する制御頭書き(CBHead)イベントで、変数の値を0にする処理を記述します。</p>   
   
<p>　　2.　明細出力(PrintDE)イベントで、変数に値を加算していく処理を記述します。</p> 
<p>　　3.　ブレーク項目に対応する制御脚書き(CBFoot)イベントで、変数の値を設定する処理を記述します。</p> 
   
<h4>[コントロールブレークの制御方<a NAME="KONNTORO_815bRUBURE_815bKUNOSEIGILYOHOUHOU">法</a>]</h4>   
   
<p>あるブレーク項目の値が変化した時などに、帳票印刷コントロールは制御頭書き(CBHead)イベントや制御脚書き(CBFoot)イベントを発生させます。この動作/制御のことを、“コントロールブレーク”といいます。</p>

<p>コントロールブレーク発生時の制御として、制御頭書きや制御脚書きを印刷する制御と改ページ、段組み集計表形式での改ブロックを行う指定があります。</p>   
   
<p>コントロールブレークの制御は、以下のタイミングで処理が行われます。</p>   
   
<ul>
  <li>最初のレコードを読み込んだ時: <ul>
      <p>   
    すべての制御頭書きをブレークが浅い順に処理します（上図の注１）。</p>      
    </ul>      
  </li>      
  <li>ブレーク項目の値が変化した時: <ul>     
      <p>値が変化したブレーク項目に対応する制御頭書き/制御脚書きより深い制御頭書き/制御脚書きについても、同じタイミングで処理します。<br>
      制御脚書きをブレークが深い順に処理します。また、制御頭書きをブレークが浅い順に処理します（上図の注２）。</p>      
    </ul>      
  </li>      
  <li>レコードの読込みが終了した時: <ul>     
      <p>   
    すべての制御脚書きをブレークが深い順に処理します（上図の注３）。</p>      
    </ul>      
  </li>      
</ul>      
      
<p>なお、ブレーク項目の優先順位は、そのブレーク項目に対応づけられている制御頭書きと制御脚書きによって決定します。</p>      
      
<p>制御頭書きイベントの発生時のブレーク項目の優先順位はブレーク項目に対応づけられている制御頭書きパーティションに影響して次のとおりになります。       
      
<ul>      
  <table BORDER="1">      
    <tr>      
      <th>優先順位</th>      
      <th>最も高い ← ... → 最も低い</th>            
    </tr>            
    <tr>            
      <td>印刷される順番</td>            
      <td ALIGN="CENTER">先 → ... → 後</td>            
    </tr>            
    <tr>            
      <td>制御頭書きパーティション名</td>            
      <td ALIGN="CENTER">CH1, CH2, CH3 ... CH14, CH15, CH16</td>            
    </tr>            
  </table>            
</ul>            
            
<p>制御脚書きイベントの発生時のブレーク項目の優先順位はブレーク項目に対応づけられている制御脚書きパーティションに影響して次のとおりになります。            
           
<ul>           
  <table BORDER="1">           
    <tr>           
      <th>優先順位</th>           
      <th>最も高い ← ... → 最も低い</th>            
    </tr>            
    <tr>            
      <td>印刷される順番</td>            
      <td ALIGN="CENTER">後 ← ... ← 先</td>            
    </tr>            
    <tr>            
      <td>制御脚書きパーティション名</td>            
      <td ALIGN="CENTER">CF1, CF2, CF3 ... CF14, CF15, CF16</td>            
    </tr>            
  </table>            
</ul>            
            
<p><img SRC="../pctlosrc/boxchuui.gif" ALT="[注意]" width="47" height="31">             
            
<ul>            
  <li>一つのブレーク項目であっても、制御頭書きパーティション名の番号と制御脚書きパーティション名の番号が異なる場合、制御頭書きイベントの発生での優先順位と制御脚書きイベントの発生での優先順位は異なることになりますので注意してください。<br>      
  </li>            
  <li>複数のブレーク項目から同じ制御頭書きパーティションに対応づけられている場合と、複数のブレーク項目から同じ制御脚書きパーティションに対応づけられている場合の各ブレーク項目の優先順位は不定となります。帳票定義体を作成する時は、このように複数のブレーク項目に同じ制御頭書きパーティションや制御脚書きパーティションを対応づけないようにしてください。</li>           
</ul>           
           
<p>下図に、帳票定義体に複数のブレーク項目が定義された場合の例を示します。ここでは、部名と課名をブレーク項目に指定し、それぞれの制御頭書きパーティションと制御脚書きパーティションを定義しています。</p>           
           
<table BORDER="1">           
  <tr>           
    <td><a NAME="figure.3"><img SRC="../pctlosrc/prt00003.gif" ALT="gif/prt00003.gif" BORDER="0" WIDTH="480" HEIGHT="448"></a> </td>           
  </tr>           
</table>           
           
<h4>[コントロールブレークと改ページ/改ブロック]</h4>       
       
<p>コントロールブレークでの改ブロックと改ページ指定時の動作は、以下のとおりです。</p>       
       
<ul>    
  <li>ブレーク項目の属性が改ブロック/改ページ属性の場合でも、コントロールブレークが発生時に制御脚書き(CBFoot)イベント、および、制御頭書き(CBHead)イベントが発行されます。<br>    
  </li>    
  <li>改ページ指定の場合は、改ページ処理を行います。<br>    
  <li>段組み集計表形式で改ブロック指定の場合は、改ブロック処理を行います。なお、最終段位置の印刷時は、改ページを行います。     
  <li>改ページ処理後に、「改ページ時出力」の指定がある制御頭書きの印刷を行います。<br>    
  <li>改ブロック処理後に、「改ページ時出力」の指定がある制御頭書きの印刷を行います。</li>     
</ul>    
       
<h4>(7) 明細出力(PrintDE)イベン<a NAME="PRINTDEIBENNTO">ト</a></h4>            
            
<p>明細出力(PrintDE)イベントでは、各種の脚書きパーティションに印刷する合計を加算する処理を記述します。</p>           
           
<p>また、明細内の項目の属性を変更したい場合は、ここで変更する処理を記述します。</p>           
           
<p>なお、ページの先頭以外で、前の行のある項目が今回と同じ値ならレコードデータを変える（たとえば、空白にする）という集団印刷については、帳票定義体を作成/編集する時に指定することができます。このような処理を行いたい場合に、集団印刷の機能を使えば、このイベントで処理を記述する必要はありません。</p>          
          
<h4>(8) 最後のレコードに関する処理</h4>            
            
<p>レコード読込み(ReadRecord)イベントでEOFを設定すると、報告書脚書<a NAME="HOUKOKUSHILYOASHIGAKI">き</a>などの印刷が行われます。ただし、レコードが１件もない場合、何も印刷されません。</p>           
           
<p><br>         
<img SRC="../pctlosrc/boxchuui.gif" ALT="image" width="47" height="31"></p>           
           
<p>段組み伝票形式の帳票定義体を使用した場合、以下のイベントは発生しません。         
<ul>         
  <li>報告書頭書きイベント         
  <li>報告書脚書きイベント         
  <li>制御頭書きイベント         
  <li>制御脚書きイベント</li>         
</ul>         
<p>ページ形式とタックシール形式の帳票定義体を使用した場合、以下のイベントは発生しません。       
<ul>       
  <li>報告書頭書きイベント       
  <li>報告書脚書きイベント       
  <li>制御頭書きイベント       
  <li>制御脚書きイベント       
  <li>ページ頭書きイベント       
  <li>ページ脚書きイベント</li>       
</ul>       
         
<h4><br>       
◆改ペー<a NAME="KAIPE_815bJI">ジ</a>に関するイベントの流れ</h4>         
         
<p>各パーティションを印刷する時にページ内に入らない場合、改ページしてから印刷されます。改ページすると、ページ頭書<a NAME="PE_815bJIATAMAGAKI">き</a>、および、ページ脚書<a NAME="PE_815bJIASHIGAKI">き</a>が印刷されます。</p>         
         
<p>下図に、改ページに関するイベントの流れを示します。</p>         
         
<h4>[改ページに関するイベントの流れ]</h4>         
         
<p><img SRC="../pctlosrc/prt00005.gif" ALT="image" WIDTH="435" HEIGHT="393"></p>         
         
<hr>         
         
<p>□ 関連項目</p>            
            
<p>→ <a HREF="pctl0330.htm#aIDH_G00_0E_06_02_03">複数の帳票定義体を利用する場合のイベントの流れ</a></p>           
           
<p>　</p>           
           
<h3><a NAME="aIDH_G00_0E_06_02_02">■起動と終了に関するイベン</a><a NAME="KIDOUTOSHILYUURILYOUNIKANNSURUIBENNTO">ト</a></h3>           
           
<p>ここでは、起動と終了に関するイベントの流れ、および、イベントの種類について説明します。</p>          
          
<h4>◆イベントの流れ</h4>          
          
<p>起動と終了に関するイベントの流れを、下図に示します。</p>          
          
<h4>[起動と終了に関するイベントの流れ]</h4>          
          
<p><img SRC="../pctlosrc/prt00006.gif" ALT="image" width="416" height="359"></p>          
          
<h4>◆イベントの種類</h4>          
          
<p>起動と終了に関するイベントには、次のものがあります。           
          
<ul>          
  <li>帳票開設(OpenReport)イベント </li>          
  <li>帳票閉鎖(CloseReport)イベント </li>          
  <li>帳票フォーム開設(OpenForm)イベント </li>          
  <li>帳票フォーム閉鎖(CloseForm)イベント </li>          
  <li>エラーメッセージ(ErrorMessage)イベント </li>          
  <li>印刷キャンセル(CancelPrint)イベント</li>          
</ul>          
          
<h4>(1) 帳票開設(OpenReport)イベン<a NAME="OPENREPORTIBENNTO">ト</a>と帳票閉鎖(CloseReport)イベン<a NAME="CLOSEREPORTIBENNTO">ト</a></h4>            
            
<p>帳票開設(OpenReport)イベント、および、帳票閉鎖(CloseReport)イベントでは、他のイベントの処理を記述する上で必要になる、初期設定や終了に関する処理を記述します。</p>           
           
<h4>(2) 帳票フォーム開設(OpenForm)イベン<a NAME="OPENFORMIBENNTO">ト</a>と帳票フォーム閉鎖(CloseForm)イベン<a NAME="CLOSEFORMIBENNTO">ト</a></h4>            
            
<p>帳票フォーム開設(OpenForm)イベント、および、帳票フォーム閉鎖(CloseForm)イベントでは、他のイベントの処理を記述する上で必要となる、帳票定義体に対する初期設定や終了処理を記述します。</p>           
           
<h4>(3) エラーメッセージ(ErrorMessage)イベン<a NAME="ERRORMESSAGEIBENNTO">ト</a></h4>            
            
<p>エラーメッセージ(ErrorMessage)イベントでは、他の任意のイベント処理後に印刷エラーが発生した場合に行う処理を記述します。</p>           
           
<h4>(4) 印刷キャンセル(CancelPrint)イベン<a NAME="CANCELPRINTIBENNTO">ト</a></h4>            
            
<p>印刷キャンセル(CancelPrint)イベントでは、オペレータの指示などにより印刷が中止された場合に行う処理を記述します。</p>            
            
<p>印刷中ダイアログでオペレータが印刷中止を指示した場合、エラーメッセージ(ErrorMessage)イベントの後に印刷キャンセル(CancelPrint)イベントが通知されます。<br>       
</p>           
           
<h3><a NAME="aIDH_G00_0E_06_02_03">■複数の帳票定義体を利用する場合のイベントの流</a><a NAME="FUKUSUUNOCHILYOUHILYOUFULO_815bMUWOTEIGISHITEIRUBAAINOIBENNTONONAGARE">れ</a></h3>         
         
<p>ここでは、複数の帳票定義体を利用する場合のイベントの流れについて説明します。</p>         
         
<p>帳票の印刷を行う1つのアプリケーションプログラムで、複数の帳票定義体を指定することができます。これは、帳票定義体を切り替えることによって可能となります。</p>        
        
<p>帳票定義体を切り替えるには、以下のイベントで、「帳票フォーム名（FormName）」プロパティに切り替える帳票定義体名を指定します。         
        
<ul>        
  <li>帳票開設(OpenReport)イベント </li>        
  <li>レコード読込み(ReadRecord)イベント</li>        
</ul>        
        
<p>なお、現在印刷対象となっている帳票定義体名を参照する場合は、「帳票フォーム名（FormName）」プロパティを参照します。</p>        
        
<p>帳票定義体の切替えを行う場合、レコードを読み込んだ回数によって、処理動作やイベントの流れが異なります。最初のレコード読込み(ReadRecord)イベントでの切替えの場合と2回目以降のレコード読込み(ReadRecord)イベントでの切替えの場合について以下に説明します。         
        
<ul>        
  <li><a HREF="#aIDH_G00_0E_06_02_03_01">最初のレコード読込み(ReadRecord)イベントでの切り替え</a>         
  </li>        
  <li><a HREF="#aIDH_G00_0E_06_02_03_02">２回目以降のレコード読込み(ReadRecord)イベントでの切り替え</a></li>        
</ul>        
        
<p><img SRC="../pctlosrc/boxchuui.gif" ALT="image" WIDTH="47" HEIGHT="31"></p>        
        
<blockquote>        
  <p>タックシール形式の帳票定義体は、切替え前、および、切替え後の帳票定義体としては、使用することができません。</p>       
  <p>集計表形式、または、段組み集計表形式の帳票定義体を切り替える場合、切替え前と切替え後の帳票定義体は、以下の点に留意して作成する必要があります。</p>       
        
<ul>        
  <li>項目の構成、および、配置、長さを同じにする </li>        
  <li>ブレーク項目に関する定義を同じにする </li>        
</ul>        
        
</blockquote>       
       
<h4><a NAME="aIDH_G00_0E_06_02_03_01"><br>     
◆最初のレコード読込み(ReadRecord)イベントでの切り替え</a></h4>       
       
<p>帳票印刷を開始した後、最初のレコード読込み(ReadRecord)イベントで帳票定義体の切替えを行う場合のイベントの流れについて以下に示します。</p>       
       
<h4>[最初のレコード読込み(ReadRecord)イベントで切替えを行う場合のイベントの流れ]</h4>       
       
<p><img SRC="../pctlosrc/prt00007.gif" ALT="image" WIDTH="491" HEIGHT="624"></p>       
       
<p>レコード読込み(ReadRecord)イベントの処理が終わるまでの(1)の間では、帳票印刷コントロールが認識している帳票定義体は、「帳票フォーム名(FormName)」プロパティに指定した帳票定義体となります。レコード読込み(ReadRecord)イベントで新しく設定した帳票定義体はまだ有効になっていません。</p>      
      
<p>初回のレコード読込みでEOFが設定されない（「レコードEOF(RecordEOF)」プロパティに「true:処理対象レコードなし」が設定されない）場合は、(2)の間の処理を行います。すでに、初期帳票定義体の開設が行われているので、まず、初期帳票定義体に対して帳票フォーム閉鎖(CloseForm)イベントが発生します。その後、切替え対象の帳票定義体の読込みが完了した時点で、切り替える帳票定義体に対して帳票フォーム開設(OpenForm)イベントが発生します。</p>      
      
<p>帳票定義体の切替えが完了した(3)の間では、切替え後の帳票定義体に対してのイベントが発生し、パーティションの印刷などを行います。</p>      
      
<p>また、初回のレコード読込みでEOFが通知された場合（「レコードEOF(RecordEOF)」プロパティに「true:処理対象レコードなし」が設定された場合）は、帳票定義体の切替えを行いません。この場合は、複数の帳票定義体を定義しない場合と同じイベントの流れになります。</p>      
      
<p>初回のレコード読込イベントでEOFが通知された場合のイベントの流れについて以下に示します。</p>      
      
<h4>[初回のレコード読込イベントでEOFが通知された場合のイベントの流れ]</h4>      
      
<p><img SRC="../pctlosrc/prt00008.gif" ALT="image" WIDTH="302" HEIGHT="147"></p>      
      
<h4><a NAME="aIDH_G00_0E_06_02_03_02">◆２回目以降のレコード読込み(ReadRecord)イベントでの切替え</a></h4>      
      
<p>２回目以降のレコード読込み(ReadRecord)イベントで帳票定義体の切替えを行う場合、切替え前の帳票定義体に対する印刷ページの行の制御を行うために、切替え前の帳票定義体の改ページを行った後に切替えを行います。</p>      
      
<p>２回目以降のレコード読込み(ReadRecord)イベントで切替えを行う場合のイベントの流れについて以下に示します。</p>      
      
<h4>[２回目以降のレコード読込み(ReadRecord)イベントで切替えを行う場合のイベントの流れ]</h4>      
      
<p><img SRC="../pctlosrc/prt00009.gif" ALT="image" width="499" height="707"></p>      
      
<p>２回目以降のレコード読込み(ReadRecord)イベントで帳票定義体の切替え依頼を行い、改ページ後に帳票定義体の切替えを行う(1)の間では、切替え前の帳票定義体を使用してイベントが発生し、帳票出力を行います。集計表形式、または、段組み集計表形式の帳票定義体を利用した印刷で、コントロールブレークを処理中の場合は、全ブレークを深い順に出力して切替え前の帳票定義体に対するブレーク処理を終了します。</p>      
      
<p>帳票定義体の切替えが完了した(2)の間では、切替え後の帳票定義体を使用します。この時、集団印刷の状態は解除されます。たとえば、集計表形式、または、段組み集計表形式の帳票定義体を利用した印刷で、明細に集団印刷を指定した「商品名」について、帳票定義体の切替えを行った場合と行わない場合の印刷結果を以下に示します。</p>      
      
<h4>[集団印刷指定した項目の印刷結果]</h4>      
      
<p><img SRC="../pctlosrc/pxd08.gif" ALT="image" width="483" height="388"></p>      
      
<p>また、レコード読込み(ReadRecord)イベントでEOFを設定した場合（「レコードEOF(RecordEOF)」プロパティに「true:処理対象レコードなし」を設定した場合）は、帳票定義体の切替えを行いません。この場合は、複数の帳票定義体を定義しない場合と同じイベントの流れになります。</p>      
      
<p>2回目以降のレコード読込み(ReadRecord)イベントでEOFを設定した場合のイベントの流れについて以下に示します。</p>      
      
<h4>[2回目以降のレコード読込み(ReadRecord)イベントでEOFを設定した場合のイベントの流れ]</h4>      
      
<p><img SRC="../pctlosrc/prt00011.gif" ALT="image" WIDTH="416" HEIGHT="427"></p>      
      
<p>　</p>   
   
<h3><a NAME="aIDH_G00_0E_06_02_04">■イベントに関する定義</a></h3>   
   
<p>ここでは、イベントの流れに影響する、次の定義について説明します。    
   
<ul>   
  <li>「帳票定義体名(FormName)」プロパティの指定 </li>   
  <li>「印刷種別(PrintType)」プロパティの指定</li>   
</ul>   
   
<h4>◆「帳票定義体名(FormName)」プロパティの指定</h4>   
   
<p>制御頭書き(CBHead)イベント、制御脚書き(CBFoot)イベントが発生するのは、集計表形式、または、段組み集計表形式の帳票定義体で、ブレーク項目を指定した場合です。指定されたブレーク項目の値が変化した場合に、対応する制御頭書き(CBHead)・制御脚書き(CBFoot)イベントが発生します。</p>   
   
<h4>◆「印刷種別(PrintType)」プロパティの指定</h4>   
   
<p>「印刷種別(PrintType)」プロパティでは、次の印刷種別を指定することができます。    
   
<ul>   
  <li>通常印刷１回：<br>   
    データを読込みながら、帳票定義体の情報に基づいて印刷します。<br>
  </li>   
  <li>通常印刷２回：<br>   
    １回目にデータを読込み、明細の合計などを算出した後、２回目に再びデータを読込みながら、帳票定義体の情報に基づいて印刷します。各種頭書きに明細の合計などを印刷する場合に使用します。<br>
  </li>   
  <li>サマリ印刷１回：<br>   
    データを読込みながら、各種頭書き・脚書きだけを印刷します（明細を印刷しません）。<br>
  </li>   
  <li>サマリ印刷２回：<br>   
    １回目にデータを読込み、明細の合計などを算出した後、２回目に再びデータを読込みながら、各種頭書き・脚書きだけを印刷します（明細を印刷しません）。各種頭書きに明細の合計などを印刷する場合に使用します。</li>   
</ul>   
   
<p>印刷種別が、通常印刷２回、または、サマリ印刷２回の場合、帳票のイベントは２回発生します（１回目に帳票開設(OpenReport)イベントから帳票閉鎖(CloseReport)イベントまでのイベントが発生した後、再び帳票開設(OpenReport)イベントから帳票閉鎖(CloseReport)イベントまでのイベントが発生します）。</p>   
   
<p>サマリ印刷は、集計表形式、または、段組み集計表形式の帳票定義体を使用した場合に有効です。<br> 
集計表形式、または、段組み集計表形式以外の帳票定義体を利用して、「サマリ印刷１回」を指定した場合、「通常印刷１回」が指定されたものとみなします。同様に、「サマリ印刷２回」を指定した場合は、「通常印刷２回」が指定されたものとみなします。</p>   
   
<hr>   
   
<table WIDTH="100%" BORDER="0" CELLSPACING="0" CELLPADDING="0">   
  <tr>   
    <td ALIGN="RIGHT"><a HREF="../index.htm" TARGET="_top">目次</a>&nbsp; <a HREF="pctl0320.htm"><img SRC="../pctlosrc/previous.gif" BORDER="0" ALT="前ページ" WIDTH="56" HEIGHT="21"></a><a HREF="pctl0340.htm"><img SRC="../pctlosrc/next.gif" BORDER="0" ALT="次ページ" WIDTH="56" HEIGHT="21"></a> </td>        
  </tr>        
</table>        
        
<hr>        
        
<p align="right">All Rights Reserved, Copyright (C) 富士通株式会社 
1998-2001</p>      
</body>      
</html>      
