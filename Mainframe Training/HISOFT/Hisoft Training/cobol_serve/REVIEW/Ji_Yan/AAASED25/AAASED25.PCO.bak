000010******************************************************************
000020*         ＜ＮＮＮＮＮ＞                                         *
000030*      1. プログラム名    ：前受金受払残高ファイル作成           *
000040*      2. プログラムID    ：AAASED25  (抽出)                     *
000050*      3. 処理概要        ：前受情報ＤＢをメインに、             *
      *                           マスタと表結合して読込み、           *
      *                           前受金受払残高中間ファイルを作成する。*
000080*      4. 作成者          ：紀岩                                 *
000090*      5. 作成日          ：2005.03.25                           *
000100******************************************************************
000110*                                                                 
000120******************************************************************
000130*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000140******************************************************************
000150 IDENTIFICATION                       DIVISION.                   
000160*                                                                 
000170 PROGRAM-ID.                          AAASED25.                   
000180******************************************************************
000190*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000200******************************************************************
000210 ENVIRONMENT                          DIVISION.                   
000220******************************************************************
000230*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260 FILE-CONTROL.                                                    
000270*                                                                 
000280     SELECT         前受金受払残高中間ファイル  ASSIGN    TO   U11          
000290     FILE STATUS    IS     Ｗ−状態                           
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*    出力ファイル                                                *
000420*----------------------------------------------------------------*
000430 FD  前受金受払残高中間ファイル                                                 
000440     LABEL  RECORD    IS              STANDARD                    
000450     BLOCK  CONTAINS  0               RECORDS.                    
000460*                                                                 
000470 01  出力−レコード.                                              
000480     COPY   CPSCE50   REPLACING      ==()==  BY  ==出力−==.     
000490*                                                                 
000500******************************************************************
000510*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000520******************************************************************
000530 WORKING-STORAGE                      SECTION.                    
000540*----------------------------------------------------------------*
000550*    ホスト変数定義エリア                                        *
000560*----------------------------------------------------------------*
000570     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
      *
       01  WS−名称1                     PIC  X(060).
       01  WS−名称2                     PIC  X(060).
000580*                                                                 
000610*--< ＯＲＡＣＬＥ共通変数 >                                       
000620     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000630*                                                                 
000640*--< 前受情報ＤＢ >                                           
000650     EXEC  SQL  INCLUDE  M40MAB.CBL            END-EXEC.          
000660*                                                                 
000670*--< 業務管理テーブル >                           
000680     EXEC  SQL  INCLUDE  D70GYM.CBL            END-EXEC.          
000690*                                                                 
000700*--< 取引先マスタ >                                       
000710     EXEC  SQL  INCLUDE  D01TRS.CBL            END-EXEC.          
000720*                                                                 
000700*--< 請求先マスタ >                                       
000710     EXEC  SQL  INCLUDE  D02SQS.CBL            END-EXEC.          
000720*                                                                 
000700*--< 項目名称マスタ >                                       
000710     EXEC  SQL  INCLUDE  D19MSY.CBL            END-EXEC.          
000720*                                                                 
000700*--< 債権情報（一般）ＤＢ >                                       
000710     EXEC  SQL  INCLUDE  M01SAJ.CBL            END-EXEC.          
000720*                                                                 
000730*--< ＯＲＡＣＬＥ ＳＱＬ実行情報 (SQLCA) >                        
000740     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000750*                                                                 
000760     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000770*----------------------------------------------------------------*
000780*   作業領域定義                                                 *
000790*----------------------------------------------------------------*
000800 01  ＷＯＲＫ−エリア.                                            
000810*--< エラーコード >                                               
000820     03  Ｗ−エラーコード             PIC S9(04).                 
000830*                                                                 
000840*--< ファイル状態 >                                               
000850     03  ファイル状態                 PIC  X(02).                 
000860*                                                                 
000870*--< 件数エリア >                                                 
000880     03  件数エリア.                                              
000890         05  Ｗ−入力−件数１         PIC  9(09).                 
000900         05  Ｗ−入力−件数２         PIC  9(09).                 
000910         05  Ｗ−出力−件数           PIC  9(09).                 
000920*                                                                 
000930*--< フラグアリア >                                               
000940     03  フラグ−エリア.                                          
000950         05  Ｗ−終了−フラグ         PIC  X(01).                 
000960         05  Ｗ−終了−フラグ１       PIC  X(01).                 
000970         05  異常終了−フラグ         PIC  X(01).                 
000980*                                                                 
000990*--< ファイル状態 >                                               
001000     03  Ｗ−適用日                   PIC  X(08).                 
001010*                                                                 
001020*----------------------------------------------------------------*
001030*   処理時間定義                                                 *
001040*----------------------------------------------------------------*
001050*--< 共通情報 >                                                   
001060 01  Ｗ−共通情報.                                                
001070     03  Ｗ−システム日付.                                        
001080         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001090         05  Ｗ−年月日               PIC  X(06).                 
001100     03  Ｗ−システム時刻             PIC  X(08).                 
001110     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001120*----------------------------------------------------------------*
001130*    サブルーチン名                                              *
001140*----------------------------------------------------------------*
001150 01  CALL-AREA.                                                   
001160*--< 共通ログサブルーチン >                                       
001170     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001180     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001190*----------------------------------------------------------------*
001200*    ＣＯＰＹ領域                                                *
001210*----------------------------------------------------------------*
001220*--< 共通ログ用パラメータ >                                       
001230 01  IF-CHOCO001.                                                 
001240     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001250*                                                                 
001260*----------------------------------------------------------------*
001270*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001280*----------------------------------------------------------------*
001290 01  PARA-AREA.                                                   
001300     COPY CPBCO001.                                               
001310******************************************************************
001320*    定数用データ定義エリア                                      *
001330******************************************************************
001340 CONSTANT                             SECTION.                    
001350 01  定数領域.                                                    
001360     03  定数−プログラムＩＤ         PIC  X(08) VALUE "AAASED25".
001370     03  定数−プログラム名           PIC  X(80)                  
001380                              VALUE  "前受金受払残高ファイル作成".
001390     03  定数−ＳＱＬＯＫ             PIC  9(04)  VALUE  0000.    
001400     03  定数−ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001410     03  定数−正常状態               PIC  9(04)  VALUE  ZERO.    
001420     03  定数−異常状態               PIC  9(04)  VALUE  0009.    
001430******************************************************************
001440*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001450******************************************************************
001460 PROCEDURE                            DIVISION.                   
001470*                                                                 
001480     PERFORM   初期処理.                                          
001490*                                                                 
001500     PERFORM   主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".           
001510*                                                                 
001520     PERFORM   終了処理.                                          
001530*                                                                 
001540     STOP RUN.                                                    
001550*                                                                 
001560******************************************************************
001570*    初期処理                                            <1.0>   *
001580******************************************************************
001590 初期処理                             SECTION.                    
001600 初期処理−ＳＴＡＲＴ.                                            
001610*                                                                 
001620*----------------------------------------------------------------*
001630*    開始メッセージ出力                                          *
001640*----------------------------------------------------------------*
001650     INITIALIZE                       IF-CHOCO001.                
001660     MOVE  "3"                        TO  共１−イベント種別.     
001670     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001680     MOVE  "0"                        TO  共１−復帰コード.       
001690     MOVE  "START"                    TO  共１−処理識別.         
001700     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001710     CALL  CLOCO001                USING  IF-CHOCO001.            
001720*                                                                 
001730*----------------------------------------------------------------*
001740*    作業領域の初期値設定                                        *
001750*----------------------------------------------------------------*
001760     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001770     INITIALIZE                           ＷＯＲＫ−エリア.       
001780*                                                                 
001790*--< ＣＰＵ日付を取得 >                                           
001800     ACCEPT  Ｗ−年月日               FROM  DATE.                 
001810*                                                                 
001820*--< ＣＰＵ時刻を取得 >                                           
001830     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
001840*----------------------------------------------------------------*
001850*    ＯＲＡＣＬＥ接続                                    <1.1>   *
001860*----------------------------------------------------------------*
001870     PERFORM  ＯＲＡＣＬＥ接続.   
001880*                                                                 
001890*----------------------------------------------------------------*
001900*    業務管理テーブル読込                                <1.2>   *
001910*----------------------------------------------------------------*
001920     PERFORM  業務管理テーブル読込.                                       
001880*                                                                 
001890*----------------------------------------------------------------*
001900*    結合テーブルカーソル宣言                            <1.2>   *
001910*----------------------------------------------------------------*
001920     PERFORM  結合テーブルカーソル宣言.                                       
001930*                                                                 
002080*----------------------------------------------------------------*
002090*    結合テーブル読込（１件目）                          <C.1>   *
002100*----------------------------------------------------------------*
002110     PERFORM   結合テーブル読込.                                
002120*                                                                 
002180 初期処理−ＥＸＩＴ.                                              
002190     EXIT.                                                        
002200******************************************************************
002210*    主処理                                              <2.0>   *
002220******************************************************************
002230 主処理                               SECTION.                    
002240 主処理−ＳＴＡＲＴ.                                              
002250*                                                                 
002260*----------------------------------------------------------------*
002270*    編集処理                                            <2.1>   *
002280*----------------------------------------------------------------*
002290     PERFORM  編集処理.                                           
002300*                                                                 
002310*----------------------------------------------------------------*
002320*    資産コード変換マスタ追加処理                        <2.2>   *
002330*----------------------------------------------------------------*
002340     PERFORM  資産コード変換マスタ追加処理.                       
002350*                                                                 
002360*----------------------------------------------------------------*
002370*    ジョモ商品読込処理. (２件目以降)                    <C.1>   *
002380*----------------------------------------------------------------*
002390     PERFORM   ジョモ商品読込処理.                                
002400*                                                                 
002410 主処理−ＥＸＩＴ.                                                
002420     EXIT.                                                        
002430******************************************************************
002440*    終了処理                                            <3.0>   *
002450******************************************************************
002460 終了処理                             SECTION.                    
002470 終了処理−ＳＴＡＲＴ.                                            
002480*                                                                 
002490*----------------------------------------------------------------*
002500*    ＤＢクローズ                                        <3.1>   *
002510*----------------------------------------------------------------*
002520     PERFORM   ＤＢクローズ.                                      
002530*                                                                 
002540*----------------------------------------------------------------*
002550*    ＤＢコミット処理                                    <3.2>   *
002560*----------------------------------------------------------------*
002570     PERFORM   ＤＢコミット処理.                                  
002580*                                                                 
002590*--< ファイルクローズ >                                           
002600     CLOSE  入力ファイル.                                         
002610*                                                                 
002620*----------------------------------------------------------------*
002630*    終了メッセージ出力処理                              <C.3>   *
002640*----------------------------------------------------------------*
002650     PERFORM  終了メッセージ出力.                                 
002660*                                                                 
002670*--< プログラム正常終了 >                                         
002680     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
002690*                                                                 
002700 終了処理−ＥＸＩＴ.                                              
002710     EXIT.                                                        
002720******************************************************************
002730*    終了メッセージ出力                                  <C.3>   *
002740******************************************************************
002750  終了メッセージ出力                  SECTION.                    
002760  終了メッセージ出力−ＳＴＡＲＴ.                                 
002770*                                                                 
002780*----------------------------------------------------------------*
002790*    ジョモ商品マスタ入力件数                                    *
002800*----------------------------------------------------------------*
002810     INITIALIZE                       IF-CHOCO001.                
002820     MOVE  "3"                        TO  共１−イベント種別.     
002830     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
002840     MOVE  "0"                        TO  共１−復帰コード.       
002850     MOVE  "JOM_MST"                  TO  共１−処理テーブルＩＤ. 
002860     MOVE  "COUNT"                    TO  共１−処理識別.         
002870     MOVE  Ｗ−入力−件数１           TO  共１−データ内容.       
002880     MOVE  "ジョモ商品マスタ読込件数" TO  共１−その他メッセージ. 
002890     CALL  CLOCO001                USING  IF-CHOCO001.            
003040*                                                                 
003050*----------------------------------------------------------------*
003060*    資産コード変換マスタ出力件数                                *
003070*----------------------------------------------------------------*
003080     INITIALIZE                       IF-CHOCO001.                
003090     MOVE  "3"                        TO  共１−イベント種別.     
003100     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
003110     MOVE  "0"                        TO  共１−復帰コード.       
003120     MOVE  "D077SSH"                  TO  共１−処理テーブルＩＤ. 
003130     MOVE  "COUNT"                    TO  共１−処理識別.         
003140     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
003150     MOVE  "資産コード変換マスタ出力件数"                         
003160                                      TO  共１−その他メッセージ. 
003170     CALL  CLOCO001                USING  IF-CHOCO001.            
003180*                                                                 
003190*----------------------------------------------------------------*
003200*    終了メッセージ 出力                                         *
003210*----------------------------------------------------------------*
003220     INITIALIZE                       IF-CHOCO001.                
003230     MOVE  "3"                        TO  共１−イベント種別.     
003240     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
003250     MOVE  "0"                        TO  共１−復帰コード.       
003260     MOVE  "END"                      TO  共１−処理識別.         
003270     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
003280     CALL  CLOCO001                USING  IF-CHOCO001.            
003290*                                                                 
003300 終了メッセージ出力−ＥＸＩＴ.                                    
003310     EXIT.                                                        
003320******************************************************************
003330*    ＯＲＡＣＬＥ接続                                    <1.1>   *
003340******************************************************************
003350 ＯＲＡＣＬＥ接続                     SECTION.                    
003360 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
003370*                                                                 
003380*--< ＩＮＩファイル読込サブルーチン呼び出し >                     
003390     CALL  COBCO001                USING  PARA-AREA.              
003400*                                                                 
003410     MOVE  PARA-DBSTRING              TO  DB-STRING.              
003420     MOVE  PARA-USERNAME              TO  USERNAME.               
003430     MOVE  PARA-PASSWORD              TO  PASSWD.                 
003440*                                                                 
003450*----------------------------------------------------------------*
003460*    開始接続                                                    *
003470*----------------------------------------------------------------*
003480     IF  DB-STRING  =  SPACE                                      
003490        EXEC  SQL                                                 
003500           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
003510        END-EXEC                                                  
003520     ELSE                                                         
003530        EXEC  SQL                                                 
003540           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
003550             USING  :DB-STRING                                    
003560        END-EXEC                                                  
003570     END-IF.                                                      
003580*                                                                 
003590*----------------------------------------------------------------*
003600*    接続状態判定                                                *
003610*----------------------------------------------------------------*
003620     EVALUATE  SQLCODE                                            
003630        WHEN  定数−ＳＱＬＯＫ                                    
003640*--<       接続正常 >                                             
003650           CONTINUE                                               
003660        WHEN  OTHER                                               
003670*--<       接続エラー >                                           
003680           MOVE     -10               TO  Ｗ−エラーコード        
003690           PERFORM  エラー処理                                    
003700     END-EVALUATE.                                                
003710*                                                                 
003720 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
003730     EXIT.  
003740******************************************************************
003750*    業務管理テーブル読込                                <1.2>   *
003760******************************************************************
003770*                                                                 
003780 業務管理テーブル読込                         SECTION.                    
003790 業務管理テーブル読込−ＳＴＡＲＴ.                                        
003800*                                                                 
003810*----------------------------------------------------------------*
003820*    業務管理テーブル読込                                        *
003830*----------------------------------------------------------------*
005770     EXEC SQL                                                     
005780        SELECT  業務年月                             
005790          INTO : Ｄ７０−業務年月         
005800          FROM  D70GYM_TBL                                         
005810        WHERE   業務管理ＩＤ  =  'GYMKNRRC'                
005820     END-EXEC.     
004060*----------------------------------------------------------------*
004070*    業務管理テーブル読込確認                                    *
004080*----------------------------------------------------------------*
004090     EVALUATE   SQLCODE                                           
004100        WHEN   定数−ＳＱＬＯＫ                                   
004110*--<       正常 >                                                 
004120           CONTINUE                                               
004130        WHEN   OTHER                                              
004140*--<       業務管理テーブル読込失敗、プログラムが異常終了 >           
004150           MOVE      -80              TO  Ｗ−エラーコード        
004160           PERFORM   エラー処理                                   
004170     END-EVALUATE.                                                
004180* 
004190 業務管理テーブル読込−ＥＸＩＴ.                                          
004200     EXIT.                                                        

003740******************************************************************
003750*    結合テーブルカーソル宣言                            <1.2>   *
003760******************************************************************
003770*                                                                 
003780 結合テーブルカーソル宣言                         SECTION.                    
003790 結合テーブルカーソル宣言−ＳＴＡＲＴ.                                        
003800*                                                                 
003810*----------------------------------------------------------------*
003820*    結合テーブルカーソル宣言                                    *
003830*----------------------------------------------------------------*
003840     EXEC  SQL                                                    
003850        DECLARE  CUR1  CURSOR  FOR                                
003860           SELECT  M40MAB_TBL．レコード区分                               
003870                  ,M40MAB_TBL．経理用主契約区分                              
003880                  ,M40MAB_TBL．顧客区分                                  
003900                  ,M40MAB_TBL．請求先取引先コード                                         
003910                  ,M40MAB_TBL．請求先コード                                        
003920                  ,M40MAB_TBL．契約番号                                     
003930                  ,M40MAB_TBL．契約種類                                
003940                  ,M40MAB_TBL．担当部課コード                       
003950                  ,M40MAB_TBL．再リース回数
                        ,M40MAB_TBL．充当開始年月
			,M40MAB_TBL．充当月数
			,M40MAB_TBL．前払回収方法
			,M40MAB_TBL．入金日
			,M40MAB_TBL．入金区分
			,M40MAB_TBL．前月末残高
			,M40MAB_TBL．当月回収額
			,M40MAB_TBL．当月消化額
			,M40MAB_TBL．当月末残高
003890                  ,D01TRS_TBL．名寄せコード
			,D01TRS_TBL．取引先名称
			,D02SQS_TBL．請求先名称
003960             FROM  M40MAB_TBL
                        ,D01TRS_TBL
			,D02SQS_TBL
		  WHERE  M40MAB_TBL.前受金受払残高表対象フラグ = '1'
		    AND  M40MAB_TBL.請求先取引先コード = D01TRS_TBL.取引先コード (+)
		    AND  M40MAB_TBL.請求先取引先コード = D02SQS_TBL.取引先コード(+)
		    AND  M40MAB_TBL.請求先コード = D02SQS_TBL.請求先コード(+)
   	       ORDER BY  M40MAB_TBL.レコード区分 
	                ,M40MAB_TBL.契約番号.
003970     END-EXEC.                                                    
003980*                                                                 
003990*----------------------------------------------------------------*
004000*    結合テーブルカーソルオープン                                *
004010*----------------------------------------------------------------*
004020     EXEC  SQL                                                    
004030        OPEN  CUR1                                                
004040     END-EXEC.                                                    
004050*                                                                 
004060*----------------------------------------------------------------*
004070*    結合テーブルカーソルオープンを確認                          *
004080*----------------------------------------------------------------*
004090     EVALUATE   SQLCODE                                           
004100        WHEN   定数−ＳＱＬＯＫ                                   
004110*--<       正常 >                                                 
004120           CONTINUE                                               
004130        WHEN   OTHER                                              
004140*--<       結合テーブルカーソルオープン失敗、プログラムが異常終了 >           
004150           MOVE      -90              TO  Ｗ−エラーコード        
004160           PERFORM   エラー処理                                   
004170     END-EVALUATE.                                                
004180*                                                                 
004190 結合テーブルカーソル宣言−ＥＸＩＴ.                                          
004200     EXIT.                                                        
004210******************************************************************
004220*    結合テーブル読込                                    <C.1>   *
004230******************************************************************
004240 結合テーブル読込                   SECTION.                    
004250 結合テーブル読込−ＳＴＡＲＴ.                                  
004260*                                                                 
004270     EXEC  SQL                                                    
004280        FETCH  CUR1                                               
004290           INTO                                                   
004300             :前受区分       
004310            ,:主契約区分      
004320            ,:連結区分         
004330            ,:名寄せコード                 
004340            ,:取引先コード   
004350            ,:請求先コード   
004360            ,:契約番号       
004370            ,:契約種類       
004380            ,:業務年月       
004390            ,:担当部課コード 
		  ,:再リース回数   
		  ,:充当開始年月   
		  ,:充当月数       
		  ,:前払回収方法   
		  ,:入金日         
		  ,:入金区分       
		  ,:取引先名称     
		  ,:請求先名称     
		  ,:主契約区分名称 
		  ,:前月末残高     
		  ,:当月入金額     
		  ,:当月消化額     
		  ,:当月末残高     
004400     END-EXEC.                                                    
004410*                                                                 
004420*----------------------------------------------------------------*
004430*    結合テーブル読込確認                                          *
004440*----------------------------------------------------------------*
004450     EVALUATE  SQLCODE                                            
004460        WHEN  定数−ＳＱＬＯＫ                                    
004470*--<       正常 >                                                 
004480           COMPUTE   Ｗ−入力−件数１ =  Ｗ−入力−件数１ +  1    
004490        WHEN  定数−ＳＱＬＥＮＤ                                  
004500*--<       読込終了 >                                             
004510           MOVE      "Y"              TO  Ｗ−終了−フラグ        
004520        WHEN  OTHER                                               
004530*--<       読込エラー、プログラムが異常終了 >                     
004540           MOVE      -100             TO  Ｗ−エラーコード        
004550           PERFORM   エラー処理                                   
004560     END-EVALUATE.                                                
004570*                                                                 
004580 結合テーブル読込処理−ＥＸＩＴ.                                    
004590     EXIT.                                                        







007180******************************************************************
007190*    エラー処理                                          <4.0>   *
007200******************************************************************
007210 エラー処理                           SECTION.                    
007220 エラー処理−ＳＴＡＲＴ.                                          
007230*                                                                 
007240     MOVE  "Y"                        TO  異常終了−フラグ.       
007250     INITIALIZE                       IF-CHOCO001.                
007260*                                                                 
007280        WHEN  -1                                                  
007290*--<       基準適用日ファイルオープンエラー >                     
007300           MOVE  "2"                  TO  共１−イベント種別      
007310           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007320           MOVE  "9"                  TO  共１−復帰コード        
007330           MOVE  "FFUISA01"           TO  共１−処理テーブルＩＤ  
007340           MOVE  "OPEN"               TO  共１−処理識別          
007350           MOVE  Ｗ−状態         TO  共１−データ内容        
007360           MOVE  "基準適用日ファイルオープンエラー"               
007370                                      TO  共１−その他メッセージ  
007380           CALL  CLOCO001          USING  IF-CHOCO001             
007390           MOVE  "N"                  TO  異常終了−フラグ        
007400*                                                                 
007410        WHEN  -2                                                  
007420*--<       基準適用日読み込みファイルエラー >                     
007430           MOVE  "2"                  TO  共１−イベント種別      
007440           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007450           MOVE  "9"                  TO  共１−復帰コード        
007460           MOVE  "FFUISA01"           TO  共１−処理テーブルＩＤ  
007470           MOVE  "READ"               TO  共１−処理識別          
007480           MOVE  Ｗ−状態         TO  共１−データ内容        
007490           MOVE  "基準適用日ファイル読み込みエラー"               
007500                                      TO  共１−その他メッセージ  
007510           CALL  CLOCO001          USING  IF-CHOCO001             
007520           MOVE  "N"                  TO  異常終了−フラグ        
007530*                                                                 
007540        WHEN  -10                                                 
007550*--<       ＯＲＡＣＬＥ接続失敗 >                                 
007560           MOVE  "1"                  TO  共１−イベント種別      
007570           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007580           MOVE  "9"                  TO  共１−復帰コード        
007590           MOVE  "CONNECT"            TO  共１−処理識別          
007600           MOVE  SQLCODE              TO  共１−データ内容        
007610           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007620           CALL  CLOCO001          USING  IF-CHOCO001             
007630*                                                                 
007640        WHEN  -20                                                 
007650*--<       カーソルオープン失敗 >                                 
007660           MOVE  "1"                  TO  共１−イベント種別      
007670           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007680           MOVE  "9"                  TO  共１−復帰コード        
007690           MOVE  "JOM_MST"            TO  共１−処理テーブルＩＤ  
007700           MOVE  "OPEN"               TO  共１−処理識別          
007710           MOVE  SQLCODE              TO  共１−データ内容        
007720           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007730           CALL  CLOCO001          USING  IF-CHOCO001             
007740*                                                                 
007750        WHEN  -30                                                 
007760*--<       ジョモ商品の読込失敗 >                                 
007770           MOVE  "1"                  TO  共１−イベント種別      
007780           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007790           MOVE  "9"                  TO  共１−復帰コード        
007800           MOVE  "JOM_MST"            TO  共１−処理テーブルＩＤ  
007810           MOVE  "FETCH"              TO  共１−処理識別          
007820           MOVE  SQLCODE              TO  共１−データ内容        
007830           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007840           CALL  CLOCO001          USING  IF-CHOCO001             
007850*                                                                 
007860        WHEN  -40                                                 
007870*--<       転リース提携先コードを取得しない >                     
007880           MOVE  "2"                  TO  共１−イベント種別      
007890           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007900           MOVE  "9"                  TO  共１−復帰コード        
007910           MOVE  "IKO004"             TO  共１−処理テーブルＩＤ  
007920           MOVE  "SELECT"             TO  共１−処理識別          
007930           MOVE  ＷＳ−ジョモ商品     TO  共１−キー情報          
007940           MOVE  SQLCODE              TO  共１−データ内容        
007950           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007960           CALL  CLOCO001          USING  IF-CHOCO001             
007970           MOVE  "N"                  TO  異常終了−フラグ        
007980*                                                                 
007990        WHEN  -50                                                 
008000*--<       資産コード変換マスタ追加失敗 >                         
008010           MOVE  "1"                  TO  共１−イベント種別      
008020           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008030           MOVE  "9"                  TO  共１−復帰コード        
008040           MOVE  "D077SSH"            TO  共１−処理テーブルＩＤ  
008050           MOVE  "INSERT"             TO  共１−処理識別          
008060           MOVE  SQLCODE              TO  共１−データ内容        
008070           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008080           CALL  CLOCO001          USING  IF-CHOCO001             
007270     EVALUATE  Ｗ−エラーコード                                  
007740*                                                                 
007750        WHEN  -80                                                 
007760*--<       業務管理テーブル読込失敗 >                                 
007880           MOVE  "2"                  TO  共１−イベント種別      
007890           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007900           MOVE  "9"                  TO  共１−復帰コード        
007910           MOVE  "D70GYM"             TO  共１−処理テーブルＩＤ  
007920           MOVE  "SELECT"             TO  共１−処理識別          
007710           MOVE  SQLCODE              TO  共１−データ内容        
007720           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007960           CALL  CLOCO001          USING  IF-CHOCO001             
007740*                                                                 
007750        WHEN  -90                                                 
007760*--<       結合テーブルカーソルオープン失敗 >                                 
007880           MOVE  "2"                  TO  共１−イベント種別      
007890           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007900           MOVE  "9"                  TO  共１−復帰コード        
007910           MOVE  "CURSOR"             TO  共１−処理テーブルＩＤ  
007920           MOVE  "OPEN"             TO  共１−処理識別          
007710           MOVE  SQLCODE              TO  共１−データ内容        
007720           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007960           CALL  CLOCO001          USING  IF-CHOCO001             
007740*                                                                 
007750        WHEN  -100                                                 
007760*--<       結合テーブルカーソルオープン失敗 >                                 
007880           MOVE  "2"                  TO  共１−イベント種別      
007890           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007900           MOVE  "9"                  TO  共１−復帰コード        
007910           MOVE  "結合テーブル"       TO  共１−処理テーブルＩＤ  
007920           MOVE  "FETCH"             TO  共１−処理識別          
007710           MOVE  SQLCODE              TO  共１−データ内容        
007720           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007960           CALL  CLOCO001          USING  IF-CHOCO001             
007850*   
008100        WHEN  OTHER                                               
008110           MOVE  "N"                  TO  異常終了−フラグ        
008120     END-EVALUATE.                                                
008130*                                                                 
008140     IF  異常終了−フラグ  =  "Y"                                 
008150*----------------------------------------------------------------*
008160*    終了メッセージ出力処理                                      *
008170*----------------------------------------------------------------*
008180        PERFORM  終了メッセージ出力                               
008190*                                                                 
008200        PERFORM  ＤＢロールバック処理                             
008210*--<    プログラムリターンコード >                                
008220        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
008230        EXIT  PROGRAM                                             
008240     END-IF.                                                      
008250*                                                                 
008260 エラー処理−ＥＸＩＴ.                                            
008270      EXIT.                                                       
008280******************************************************************
008290*                  END OF PROGRAM                                *
008300******************************************************************
