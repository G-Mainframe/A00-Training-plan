000010******************************************************************
000020*         ＜ＮＮＮＮＮ＞                                         *
000030*      1. プログラム名    ：前受金受払残高ファイル作成           *
000040*      2. プログラムID    ：AAASED25                             *
000050*      3. 処理概要        ：経理締処理（帳票作成）               *
000060*                           （リース前受関連帳票抽出）           *
000070*                                                                *
000080*      4. 作成者          ：cuilin                               *
000090*      5. 作成日          ：XXXX.XX.XX                           *
000180******************************************************************
000190*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000200******************************************************************
000210 ENVIRONMENT                          DIVISION.                   
000220******************************************************************
000220******************************************************************
000230*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260 FILE-CONTROL.                                                    
000270*                                                                 
000280     SELECT         出力ファイル  ASSIGN　　　　TO   U11          
000290     FILE STATUS    IS     ファイル状態                           
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*  前受金受払残高中間ファイル                                    *
000420*----------------------------------------------------------------*
000430 FD  出力ファイル                               　　　　　　　　　
000440     LABEL  RECORD    IS              STANDARD                    
000450     BLOCK  CONTAINS  0               RECORDS.                    
000460*                                                                 
000470 01  OUT-FILE.                                              
000480     COPY   CPSCE50   REPLACING      ==()==  BY  ==出力−==.     
000490*                                                                 
000230*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000240******************************************************************
000250 DATA                                 DIVISION.                   
000260******************************************************************
000270*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000280******************************************************************
000290  WORKING-STORAGE                     SECTION.                    

       77  Ｄ１９−名称1          PIC  X(060).
       77  Ｄ１９−名称2          PIC  X(060).

000300*----------------------------------------------------------------*
000310*    ホスト変数定義エリア                                        *
000320*----------------------------------------------------------------*
000330     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000340*                                                                 
000350*--< ＯＲＡＣＬＥ共通変数 >                                       
000360     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000370*                                                                 
000380*--< ＯＲＡＣＬＥ  ＳＱＬ実行情報 >                               
000390     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000400*                                                                 
000410*--< 前受情報ＤＢ >                                               
000420     EXEC  SQL  INCLUDE  M40MAB.CBL           END-EXEC.           
000430*                                                                 
000440*--< 業務管理テーブル >                                           
000450     EXEC  SQL  INCLUDE  D70GYM.CBL            END-EXEC.          
000460*                                                                 
000470*--< 取引先マスタ>                                                
000480     EXEC  SQL  INCLUDE  D01TRS.CBL            END-EXEC.          

000470*--< 請求先マスタ>                                                
000480     EXEC  SQL  INCLUDE  D02SQS.CBL            END-EXEC.          

000470*--< 項目名称マスタ>                                                
000480     EXEC  SQL  INCLUDE  D19MSY.CBL            END-EXEC.          

000470*--< 債権情報（一般）ＤＢ>                                                
000480     EXEC  SQL  INCLUDE  M01SAJ.CBL            END-EXEC.          
000470*--< 前受金受払残高中間ファイル>                                                 
000480     EXEC  SQL  INCLUDE  SFHSED25.CBL          END-EXEC.          
000490*                                                                 
000500     EXEC  SQL  END  DECLARE          SECTION  END-EXEC.          
000510*                                                                 
000520*----------------------------------------------------------------*
000530*    ＷＯＲＫエリア                                              *
000540*----------------------------------------------------------------*
000550 01  ＷＯＲＫ−エリア.                                            
000560*--< エラー判定用 >                                               
000570     03  Ｗ−エラーコード             PIC S9(04).                 
000580*                                                                 
000590*--< フラグアリア >                                               
000600     03  フラグアリア.                                            
000610         05  Ｗ−終了−フラグ         PIC  X(01).                 
000620         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
000630*                                                                 
000640*--< 件数エリア >                                                 
000650     03  件数エリア.                                              
000660         05  Ｗ−入力−件数           PIC  9(09).                 
000670         05  Ｗ−出力−件数           PIC  9(09).                 

000680*                                                                 
000690*--< キーエリア >                                                 
000700*     03  ＫＥＹ−エリア.                                          
000710*       05  ＮＥＷキー.                                           
000720*           07 Ｎ−契約番号           PIC  X(09).                 
000730*           07 Ｎ−再リース回数       PIC  9(02).                 
000740*           07 Ｎ−契約種類           PIC  X(03).                 
000750*           07 Ｎ−請求額             PIC  9(13).                 
000760*       05  ＯＬＤキー.                                           
000770*           07 Ｏ−契約番号           PIC  X(09).                 
000780*           07 Ｏ−再リース回数       PIC  9(02).                 
000790*           07 Ｏ−契約種類           PIC  X(03).                 
000800*           07 Ｏ−請求額             PIC  9(13).                 
000810*                                                                 

000820*--< 共通情報 >                                                   
000830 01  Ｗ−共通情報.                                                
000840     03  Ｗ−システム日付.                                        
000850         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
000860         05  Ｗ−年月日               PIC  X(06).                 
000870     03  Ｗ−システム時刻             PIC  X(08).                 
000880     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
000890*                                                                 
000900*----------------------------------------------------------------*
000910*    サブルーチン名                                              *
000920*----------------------------------------------------------------*
000930 01  CALL-AREA.                                                   
000940*--< 共通ログサブルーチン >                                       
000950     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
000960     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
000970*                                                                 
000980*----------------------------------------------------------------*
000990*    ＣＯＰＹ領域                                                *
001000*----------------------------------------------------------------*
001010*--< 共通ログ用パラメータ >                                       
001020 01  IF-CHOCO001.                                                 
001030     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001040*                                                                 
001050*----------------------------------------------------------------*
001060*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001070*----------------------------------------------------------------*
001080 01  PARA-AREA.                                                   
001090     COPY CPBCO001.                                               
001100******************************************************************
001110*    定数用データ定義エリア                                      *
001120******************************************************************
001130 CONSTANT                             SECTION.                    
001140 01  定数領域.                                                    
001150     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS430".
001160     03  定数−プログラム名           PIC  X(80)                  
001170                                      VALUE  "変則払移行".        
001180     03  定数−ＳＱＬＯＫ             PIC S9(04)  VALUE  ZERO.    
001190     03  定数−ＳＱＬＥＮＤ           PIC S9(04)  VALUE  0100.    
001200     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001210     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001220******************************************************************
001230*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001240******************************************************************
001250 PROCEDURE                            DIVISION.                   
001260*                                                                 
001270     PERFORM  初期処理.                                           
001280*                                                                 
001290     PERFORM  主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".            
001300*                                                                 
001310     PERFORM  終了処理.                                           
001320*                                                                 
001330     STOP     RUN.                                                
001340*                                                                 
001350******************************************************************
001360*    初期処理                                                    *
001370******************************************************************
001380 初期処理                             SECTION.                    
001390 初期処理−ＳＴＡＲＴ.                                            
001400*                                                                 
001410*----------------------------------------------------------------*
001420*    開始メッセージ出力処理                                      *
001430*----------------------------------------------------------------*
001440     INITIALIZE                       IF-CHOCO001.                
001450     MOVE  "3"                        TO  共１−イベント種別.     
001460     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001470     MOVE  "0"                        TO  共１−復帰コード.       
001480     MOVE  "START"                    TO  共１−処理識別.         
001490     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001500     CALL  CLOCO001                USING  IF-CHOCO001.            
001510*                                                                 
001520*----------------------------------------------------------------*
001530*    作業領域の初期値処理                                        *
001540*----------------------------------------------------------------*
001550     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001560     INITIALIZE                           ＷＯＲＫ−エリア.       

001660*--< ＯＲＡＣＬＥ接続 >                                           
001670     PERFORM   ＯＲＡＣＬＥ接続.                                  
001680*                                   
002270     EXEC SQL                                                     
002290     SELECT  バッチ用業務年月  INTO  :Ｄ７０−バッチ用業務年月                                   
002360       FROM  D70GYM_TBL                                           
002380      WHERE  業務管理ＩＤ = 'GYMKNRRC'
002470     END-EXEC.                                                    

002590     EVALUATE  SQLCODE                                            
002600        WHEN  定数−ＳＱＬＯＫ                                    
002610*--<       正常 >                                                 
002620           CONTINUE                                               
002630        WHEN  OTHER                                               
002640*--<       ＴＡＢＬＥ　ＳＥＬＥＣＴ　エラー >                       
002650           MOVE -20                   TO  Ｗ−エラーコード        
002660           PERFORM  エラー判定処理                                
002670     END-EVALUATE.                                                

001690*--< 結合テーブルカーソル定義 >                                   
001700     PERFORM  結合テーブルカーソル定義.                           
001710*                                                                 
001720*--< 結合テーブルカーソル読込(１件目) >                           
001730     PERFORM  結合テーブルカーソル読込.                           
001740*                                                                 
001750 初期処理−ＥＸＩＴ.                                              
001760     EXIT.                                                        
001770******************************************************************
001780*    ＯＲＡＣＬＥ接続                                            *
001790******************************************************************
001800 ＯＲＡＣＬＥ接続                     SECTION.                    
001810 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
001820*                                                                 
001830*--< ＤＢ接続用情報を取得処理 >                                   
001840     CALL  COBCO001                USING  PARA-AREA.              
001850*                                                                 
001860     MOVE  PARA-DBSTRING              TO  DB-STRING.              
001870     MOVE  PARA-USERNAME              TO  USERNAME.               
001880     MOVE  PARA-PASSWORD              TO  PASSWD.                 
001890*                                                                 
001900*----------------------------------------------------------------*
001910*    開始接続                                                    *
001920*----------------------------------------------------------------*
001930     IF    DB-STRING  =  SPACE                                    
001940        EXEC SQL                                                  
001950           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
001960        END-EXEC                                                  
001970     ELSE                                                         
001980        EXEC SQL                                                  
001990           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002000             USING  :DB-STRING                                    
002010        END-EXEC                                                  
002020     END-IF.                                                      
002030*                                                                 
002040*----------------------------------------------------------------*
002050*    接続確認                                                    *
002060*----------------------------------------------------------------*
002070     EVALUATE  SQLCODE                                            
002080        WHEN   定数−ＳＱＬＯＫ                                   
002090           CONTINUE                                               
002100        WHEN   OTHER                                              
002110*--<       接続エラー >                                           
002120           MOVE     -10               TO  Ｗ−エラーコード        
002130           PERFORM  エラー判定処理                                
002140     END-EVALUATE.                                                
002150*                                                                 
002160 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002170     EXIT.                                                        
002180******************************************************************
002190*        結合テーブルカーソル定義                                *
002200******************************************************************
002210 結合テーブルカーソル定義             SECTION.                    
002220 結合テーブルカーソル定義−ＳＴＡＲＴ.                            
002230*                                                                 
002240*----------------------------------------------------------------*
002250*    カーソルＯＰＥＮ処理                                        *
002260*----------------------------------------------------------------*
002270     EXEC SQL                                                     
002280        DECLARE CUR1  CURSOR FOR                                  
002290           SELECT  *                                    
002360             FROM  M40MAB_TBL
                        ,D01TRS_TBL
                        ,D02SQS_TBL
002380            WHERE  M40MAB_TBL.前受金受払残高表対象フラグ  =  '1'
                    AND  M40MAB_TBL.請求先取引先コード = D01TRS_TBL.取引先コード
                    AND  M40MAB_TBL.請求先取引先コード = D02SQS_TBL.取引先コード
                    AND  M40MAB_TBL.請求先コード       = D02SQS_TBL.請求先コード
002430         ORDER BY  M40MAB_TBL.レコード区分
                        ,M40MAB_TBL.契約番号                                        
002470     END-EXEC.                                                    
002480*                                                                 
002490*----------------------------------------------------------------*
002500*    カーソルＯＰＥＮ処理                                        *
002510*----------------------------------------------------------------*
002520     EXEC  SQL                                                    
002530        OPEN  CUR1                                                
002540     END-EXEC.                                                    
002550*                                                                 
002560*----------------------------------------------------------------*
002570*    カーソルＯＰＥＮ確認                                        *
002580*----------------------------------------------------------------*
002590     EVALUATE  SQLCODE                                            
002600        WHEN  定数−ＳＱＬＯＫ                                    
002610*--<       正常 >                                                 
002620           CONTINUE                                               
002630        WHEN  OTHER                                               
002640*--<       カーソルＯＰＥＮエラー >                               
002650           MOVE -20                   TO  Ｗ−エラーコード        
002660           PERFORM  エラー判定処理                                
002670     END-EVALUATE.                                                
002680*                                                                 
002690 結合テーブルカーソル定義−ＥＸＩＴ.                              
002700     EXIT.                                                        
002710******************************************************************
002720*    結合テーブルカーソル読込                                    *
002730******************************************************************
002740 結合テーブルカーソル読込             SECTION.                    
002750 結合テーブルカーソル読込−ＳＴＡＲＴ.                            
002760*                                                                 
002770*--< 結合テーブルカーソル読込 >                                   
002780     EXEC SQL                                                     
002790         FETCH  CUR1                                              
002800          INTO  :Ｄ４１１−契約番号                               
002810               ,:Ｄ４１１−再リース回数                           
002820               ,:Ｄ４１１−契約種類                               
002830               ,:Ｄ４１１−請求額                                 
002840               ,:Ｄ４１１−請求消費税                             
002850               ,:Ｄ４１１−売上年月                               
002860               ,:Ｄ４１１−連番                                   
002870     END-EXEC.                                                    
002880*                                                                 
002890*----------------------------------------------------------------*
002900*    結合テーブルカーソル読込を確認                              *
002910*----------------------------------------------------------------*
002920     EVALUATE   SQLCODE                                           
002930        WHEN   定数−ＳＱＬＯＫ                                   
002940*--<       正常 >                                                 
002950           MOVE  Ｄ４１１−契約番号   TO  Ｎ−契約番号            
002960           MOVE  Ｄ４１１−再リース回数                           
002970                                      TO  Ｎ−再リース回数        
002980           MOVE  Ｄ４１１−契約種類   TO  Ｎ−契約種類            
002990           MOVE  Ｄ４１１−請求額     TO  Ｎ−請求額              
003000*                                                                 
003010           COMPUTE  Ｗ−入力−件数  =  Ｗ−入力−件数  +  1       
003020        WHEN   定数−ＳＱＬＥＮＤ                                 
003030*--<       読込終了 >                                             
003040           MOVE  "Y"                  TO  Ｗ−終了−フラグ        
003050        WHEN   OTHER                                              
003060*--<       読込エラー >                                           
003070           MOVE     -30               TO  Ｗ−エラーコード        
003080           PERFORM  エラー判定処理                                
003090     END-EVALUATE.                                                
003100*                                                                 
003110 結合テーブルカーソル読込−ＥＸＩＴ.                              
003120     EXIT.                                                        
003130******************************************************************
003140*    主処理                                                      *
003150******************************************************************
003160 主処理                               SECTION.                    
003170 主処理−ＳＴＡＲＴ.                                              
003180*                                                                 
003190     PERFORM  編集出力処理.                                       
003200*                                                                 
003210*--< 結合テーブルカーソル読込（２件目以降） >                     
003220     PERFORM  結合テーブルカーソル読込.                           
003230*                                                                 
003240     IF  Ｗ−終了−フラグ  =  "Y"                                 
003250*--<    入力データ終わる時最後出力処理 >                          
003260        PERFORM  出力処理                                         
003270     END-IF.                                                      
003280*                                                                 
003290 主処理−ＥＸＩＴ.                                                
003300     EXIT.                                                        
003310******************************************************************
003320*     編集出力処理                                               *
003330******************************************************************
003340 編集出力処理                         SECTION.                    
003350 編集出力処理−ＳＴＡＲＴ.                                        
003360*                                                                 
003370     IF  ＮＥＷキー  =  ＯＬＤキー                                
003380*--<    No.06 >                                                   
003390        MOVE  Ｄ４１１−連番          TO  Ｄ３４−終了回          
003400*--<    No.07 >                                                   
003410        MOVE  Ｄ４１１−売上年月      TO  Ｄ３４−終了年月        
003420     ELSE                                                         
003430        IF  Ｗ−入力−件数  >  1                                  
003440*--<       ２件目以降、且つキー変わる時、出力する >               
003450           PERFORM  出力処理                                      
003460        END-IF                                                    
003470*                                                                 
003480*----------------------------------------------------------------*
003490*       初期化処理                                               *
003500*----------------------------------------------------------------*
003510        MOVE  SPACE                   TO  変則払                  
003520        INITIALIZE                        変則払                  
003530*                                                                 
003540*----------------------------------------------------------------*
003550*       項目編集処理                                             *
003560*----------------------------------------------------------------*
003570*--<    No.01 >                                                   
003580        MOVE  Ｄ４１１−契約番号(1:9) TO  Ｄ３４−契約番号        
003590*                                                                 
003600*--<    No.02 >                                                   
003610        MOVE  Ｄ４１１−再リース回数  TO  Ｄ３４−再リース回数    
003620                                                                  
003630*--<    No.03 >                                                   
003640        MOVE  Ｄ４１１−契約種類      TO  Ｄ３４−契約種類        
003650*                                                                 
003660*--<    No.04 >                                                   
003670        MOVE  Ｄ４１１−連番          TO  Ｄ３４−開始回          
003680*                                                                 
003690*--<    No.05 >                                                   
003700        MOVE  Ｄ４１１−売上年月      TO  Ｄ３４−開始年月        
003710*                                                                 
003720*--<    No.06 >                                                   
003730        MOVE  Ｄ４１１−連番          TO  Ｄ３４−終了回          
003740*                                                                 
003750*--<    No.07 >                                                   
003760        MOVE  Ｄ４１１−売上年月      TO  Ｄ３４−終了年月        
003770*                                                                 
003780*--<    No.08 >                                                   
003790        MOVE  Ｄ４１１−請求額        TO  Ｄ３４−金額            
003800*                                                                 
003810*--<    No.09 >                                                   
003820        MOVE  Ｄ４１１−請求消費税    TO  Ｄ３４−消費税          
003830*                                                                 
003840*--<    No.10 >                                                   
003850        MOVE  Ｗ−システム日付        TO  Ｄ３４−更新年月日      
003860*                                                                 
003870*--<    No.11 >                                                   
003880        MOVE  Ｗ−システム時刻        TO  Ｄ３４−更新時間        
003890*                                                                 
003900*--<    No.12 >                                                   
003910        MOVE  Ｗ−担当者              TO  Ｄ３４−更新者          
003920*                                                                 
003930*--<    No.13 >                                                   
003940        MOVE  Ｗ−担当者              TO  Ｄ３４−入力担当者コード
003950*                                                                 
003960*--<    No.14 >                                                   
003970        MOVE  Ｗ−システム日付        TO  Ｄ３４−登録年月日      
003980*                                                                 
003990*--<    No.15 >                                                   
004000        MOVE  Ｗ−システム時刻        TO  Ｄ３４−登録時間        
004010*                                                                 
004020*--<    No.16 >                                                   
004030        MOVE  Ｗ−担当者              TO  Ｄ３４−登録担当者      
004040*                                                                 
004050     END-IF.                                                      
004060*                                                                 
004070     MOVE ＮＥＷキー                  TO  ＯＬＤキー.             
004080*                                                                 
004090 編集出力処理−ＥＸＩＴ.                                          
004100     EXIT.                                                        
004110******************************************************************
004120*    出力処理                                                    *
004130******************************************************************
004140 出力処理                             SECTION.                    
004150 出力処理−ＳＴＡＲＴ.                                            
004160*                                                                 
004170       EXEC  SQL                                                  
004180        INSERT  INTO  D34HNS_TBL                                  
004190           ( 契約番号                                             
004200            ,再リース回数                                         
004210            ,契約種類                                             
004220            ,開始回                                               
004230            ,開始年月                                             
004240            ,終了回                                               
004250            ,終了年月                                             
004260            ,金額                                                 
004270            ,消費税                                               
004280            ,更新年月日                                           
004290            ,更新時間                                             
004300            ,更新者                                               
004310            ,入力担当者コード                                     
004320            ,登録年月日                                           
004330            ,登録時間                                             
004340            ,登録担当者)                                          
004350       VALUES                                                     
004360           ( :Ｄ３４−契約番号                                    
004370            ,:Ｄ３４−再リース回数                                
004380            ,:Ｄ３４−契約種類                                    
004390            ,:Ｄ３４−開始回                                      
004400            ,:Ｄ３４−開始年月                                    
004410            ,:Ｄ３４−終了回                                      
004420            ,:Ｄ３４−終了年月                                    
004430            ,:Ｄ３４−金額                                        
004440            ,:Ｄ３４−消費税                                      
004450            ,:Ｄ３４−更新年月日                                  
004460            ,:Ｄ３４−更新時間                                    
004470            ,:Ｄ３４−更新者                                      
004480            ,:Ｄ３４−入力担当者コード                            
004490            ,:Ｄ３４−登録年月日                                  
004500            ,:Ｄ３４−登録時間                                    
004510            ,:Ｄ３４−登録担当者)                                 
004520     END-EXEC.                                                    
004530*                                                                 
004540*----------------------------------------------------------------*
004550*    追加処理を確認                                              *
004560*----------------------------------------------------------------*
004570     EVALUATE  SQLCODE                                            
004580        WHEN   定数−ＳＱＬＯＫ                                   
004590*--<       追加成功 >                                             
004600           COMPUTE  Ｗ−出力−件数  =  Ｗ−出力−件数  +  1       
004610        WHEN   OTHER                                              
004620*--<       追加処理エラー >                                       
004630           MOVE     -40               TO  Ｗ−エラーコード        
004640           PERFORM  エラー判定処理                                
004650     END-EVALUATE.                                                
004660*                                                                 
004670 出力処理−ＥＸＩＴ.                                              
004680     EXIT.                                                        
004690******************************************************************
004700*    終了処理                                                    *
004710******************************************************************
004720 終了処理                             SECTION.                    
004730 終了処理−ＳＴＡＲＴ.                                            
004740*                                                                 
004750     PERFORM  ＤＢクローズ処理.                                   
004760*                                                                 
004770     PERFORM  ＤＢコミット処理.                                   
004780*                                                                 
004790     PERFORM  終了メッセージ出力.                                 
004800*                                                                 
004810*--< プログラム正常終了 >                                         
004820     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
004830*                                                                 
004840 終了処理−ＥＸＩＴ.                                              
004850     EXIT.                                                        
004860******************************************************************
004870*    終了メッセージ出力                                          *
004880******************************************************************
004890 終了メッセージ出力                   SECTION.                    
004900 終了メッセージ出力−ＳＴＡＲＴ.                                  
004910*                                                                 
004920*----------------------------------------------------------------*
004930*    件数メッセージ出力処理                                      *
004940*----------------------------------------------------------------*
004950     INITIALIZE                       IF-CHOCO001.                
004960     MOVE  "3"                        TO  共１−イベント種別.     
004970     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
004980     MOVE  "0"                        TO  共１−復帰コード.       
004990     MOVE  "D411STK"                  TO  共１−処理テーブルＩＤ. 
005000     MOVE  "COUNT"                    TO  共１−処理識別.         
005010     MOVE  Ｗ−入力−件数             TO  共１−データ内容.       
005020     MOVE  "レベルアップ債権展開入力件数"                         
005030                                      TO  共１−その他メッセージ. 
005040     CALL  CLOCO001                USING  IF-CHOCO001.            
005050*                                                                 
005060     INITIALIZE                       IF-CHOCO001.                
005070     MOVE  "3"                        TO  共１−イベント種別.     
005080     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005090     MOVE  "0"                        TO  共１−復帰コード.       
005100     MOVE  "D34HNS"                   TO  共１−処理テーブルＩＤ. 
005110     MOVE  "COUNT"                    TO  共１−処理識別.         
005120     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
005130     MOVE  "変則払DB出力件数"         TO  共１−その他メッセージ. 
005140     CALL  CLOCO001                USING  IF-CHOCO001.            
005150*                                                                 
005160*----------------------------------------------------------------*
005170*    終了メッセージ出力                                          *
005180*----------------------------------------------------------------*
005190     INITIALIZE                       IF-CHOCO001.                
005200     MOVE  "3"                        TO  共１−イベント種別.     
005210     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005220     MOVE  "0"                        TO  共１−復帰コード.       
005230     MOVE  "END"                      TO  共１−処理識別.         
005240     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
005250     CALL  CLOCO001                USING  IF-CHOCO001.            
005260*                                                                 
005270 終了メッセージ出力−ＥＸＩＴ.                                    
005280     EXIT.                                                        
005290******************************************************************
005300*    ＤＢクローズ                                                *
005310******************************************************************
005320 ＤＢクローズ処理                     SECTION.                    
005330 ＤＢクローズ処理−ＳＴＡＲＴ.                                    
005340*                                                                 
005350*--< カーソル クローズ >                                          
005360     EXEC SQL                                                     
005370        CLOSE  CUR1                                               
005380     END-EXEC.                                                    
005390*                                                                 
005400 ＤＢクローズ処理−ＥＸＩＴ.                                      
005410     EXIT.                                                        
005420******************************************************************
005430*    ＤＢコミット処理                                            *
005440******************************************************************
005450 ＤＢコミット処理                     SECTION.                    
005460 ＤＢコミット処理−ＳＴＡＲＴ.                                    
005470*                                                                 
005480     EXEC  SQL                                                    
005490        COMMIT  WORK  RELEASE                                     
005500     END-EXEC.                                                    
005510*                                                                 
005520     INITIALIZE                       IF-CHOCO001.                
005530     MOVE  "3"                        TO  共１−イベント種別.     
005540     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005550     MOVE  "0"                        TO  共１−復帰コード.       
005560     MOVE  "COMMIT"                   TO  共１−処理識別.         
005570     MOVE  "コミット実施"             TO  共１−その他メッセージ. 
005580     CALL  CLOCO001                USING  IF-CHOCO001.            
005590*                                                                 
005600 ＤＢコミット処理−ＥＸＩＴ.                                      
005610     EXIT.                                                        
005620******************************************************************
005630*    ＤＢロールバック処理                                        *
005640******************************************************************
005650 ＤＢロールバック処理                 SECTION.                    
005660 ＤＢロールバック処理−ＳＴＡＲＴ.                                
005670*                                                                 
005680     EXEC  SQL                                                    
005690        ROLLBACK WORK  RELEASE                                    
005700     END-EXEC.                                                    
005710*                                                                 
005720     INITIALIZE                       IF-CHOCO001.                
005730     MOVE  "1"                        TO  共１−イベント種別.     
005740     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005750     MOVE  "9"                        TO  共１−復帰コード.       
005760     MOVE  "ROLLBACK"                 TO  共１−処理識別.         
005770     MOVE  "ロールバック実施"         TO  共１−その他メッセージ. 
005780     CALL  CLOCO001                USING  IF-CHOCO001.            
005790*                                                                 
005800 ＤＢロールバック処理−ＥＸＩＴ.                                  
005810     EXIT.                                                        
005820******************************************************************
005830*    エラー処理                                                  *
005840******************************************************************
005850 エラー判定処理                       SECTION.                    
005860 エラー判定処理−ＳＴＡＲＴ.                                      
005870*                                                                 
005880     MOVE  "Y"                        TO Ｗ−異常終了−フラグ.    
005890     INITIALIZE                           IF-CHOCO001.            
005900*                                                                 
005910     EVALUATE  Ｗ−エラーコード                                   
005920        WHEN  -10                                                 
005930*--<       ＯＲＡＣＬＥ接続失敗 >                                 
005940           MOVE  "1"                  TO  共１−イベント種別      
005950           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
005960           MOVE  "9"                  TO  共１−復帰コード        
005970           MOVE  "CONNECT"            TO  共１−処理識別          
005980           MOVE  SQLCODE              TO  共１−データ内容        
005990           MOVE  SQLERRMC             TO  共１−その他メッセージ  
006000           CALL  CLOCO001          USING  IF-CHOCO001             
006010*                                                                 
006020        WHEN  -20                                                 
006030*--<       結合テーブルカーソルオープン失敗 >                     
006040           MOVE  "1"                  TO  共１−イベント種別      
006050           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006060           MOVE  "9"                  TO  共１−復帰コード        
006070           MOVE  "D32SAK"             TO  共１−処理テーブルＩＤ  
006080           MOVE  "OPEN"               TO  共１−処理識別          
006090           MOVE  SQLCODE              TO  共１−データ内容        
006100           MOVE  SQLERRMC             TO  共１−その他メッセージ  
006110           CALL  CLOCO001          USING  IF-CHOCO001             
006120*                                                                 
006130        WHEN  -30                                                 
006140*--<       結合テーブル読込失敗 >                                 
006150           MOVE  "1"                  TO  共１−イベント種別      
006160           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006170           MOVE  "9"                  TO  共１−復帰コード        
006180           MOVE  "D11STK"             TO  共１−処理テーブルＩＤ  
006190           MOVE  "FETCH"              TO  共１−処理識別          
006200           MOVE  SQLCODE              TO  共１−データ内容        
006210           MOVE  SQLERRMC             TO  共１−その他メッセージ  
006220           CALL  CLOCO001          USING  IF-CHOCO001             
006230*                                                                 
006240        WHEN  -40                                                 
006250*--<       変則払ＤＢ追加失敗 >                                   
006260           MOVE  "1"                  TO  共１−イベント種別      
006270           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006280           MOVE  "9"                  TO  共１−復帰コード        
006290           MOVE  "D34HNS"             TO  共１−処理テーブルＩＤ  
006300           MOVE  "INSERT"             TO  共１−処理識別          
006310           MOVE  SQLCODE              TO  共１−データ内容        
006320           MOVE  SQLERRMC             TO  共１−その他メッセージ  
006330           CALL  CLOCO001          USING  IF-CHOCO001             
006340*                                                                 
006350        WHEN  OTHER                                               
006360           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
006370     END-EVALUATE.                                                
006380*                                                                 
006390     IF Ｗ−異常終了−フラグ  =  "Y"                              
006400        PERFORM  ＤＢロールバック処理                             
006410*                                                                 
006420        PERFORM  終了メッセージ出力                               
006430*                                                                 
006440*--<    プログラム異常終了のリターンコード >                      
006450        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
006460*                                                                 
006470        EXIT  PROGRAM                                             
006480     END-IF.                                                      
006490*                                                                 
006500 エラー処理−ＥＸＩＴ.                                            
006510     EXIT.                                                        
006520******************************************************************
006530*                  END OF PROGRAM                                *
006540******************************************************************
