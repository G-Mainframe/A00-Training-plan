000010******************************************************************
000020*         ＜ＮＮＮＮＮ＞                                         *
000030*      1. プログラム名    ：資産コード変換マスタ移行処理         *
000040*      2. プログラムID    ：COBIS130                             *
000050*      3. 処理概要        ：提携先指定のコードからＢＯＴＬ資産   *
000060*                           コードの変換テーブル                 *
000070*                                                                *
000080*      4. 作成者          ：cfj                                  *
000090*      5. 作成日          ：XXXX.XX.XX                           *
000100******************************************************************
000110*                                                                 
000120******************************************************************
000130*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000140******************************************************************
000150 IDENTIFICATION                       DIVISION.                   
000160*                                                                 
000170 PROGRAM-ID.                          AAASED25.                   
000180******************************************************************
000190*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000200******************************************************************
000210 ENVIRONMENT                          DIVISION.                   
000220******************************************************************
000230*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260*                                                                 
000270 FILE-CONTROL.                                                    
000280     SELECT         出力ファイル      ASSIGN    TO   U11          
000290     FILE STATUS    IS     ファイル状態                           
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*    入力ファイル                                                *
000420*----------------------------------------------------------------*
000430 FD  出力ファイル                                                 
000440     LABEL  RECORD    IS              STANDARD                    
000450     BLOCK  CONTAINS  0               RECORDS.                    
000460*                                                                 
000470 01  出力−レコード.                                              
000480     COPY   CPSCE50   REPLACING      ==()==  BY  ==出力−==.      
000490*                                                                 
000500******************************************************************
000510*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000520******************************************************************
000530 WORKING-STORAGE                      SECTION.                    
000540*----------------------------------------------------------------*
000550*    ホスト変数定義エリア                                        *
000560*----------------------------------------------------------------*
000570     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000600*                                                                 
000601 01  ＷＳ−当月消化額             PIC S9(13).                     
000602 01  ＷＳ−当月末残高             PIC S9(13).                     
000603*                                                                 
000610 01  ＷＳ−名称１                 PIC  X(60).                     
000620 01  ＷＳ−名称２                 PIC  X(60).                     
000621*                                                                 
000630 01  ＷＳ−業務管理ＩＤ           PIC  X(08) VALUE 'GYMKNRRC'.    
000640*                                                                 
000650*--< ＯＲＡＣＬＥ共通変数 >                                       
000660     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000670*                                                                 
000680*--< ＯＲＡＣＬＥ実行情報(SQLCA) >                                
000690     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000700*                                                                 
000710*--<前受情報ＤＢ >                                                
000720     EXEC  SQL  INCLUDE  M40MAB.CBL            END-EXEC.          
000730*                                                                 
000740*--<業務管理テーブル >                                            
000750     EXEC  SQL  INCLUDE  D70GYM.CBL            END-EXEC.          
000760*                                                                 
000770*--<取引先マスタ >                                                
000780     EXEC  SQL  INCLUDE  D01TRS.CBL            END-EXEC.          
000790*                                                                 
000800*--<請求先マスタ >                                                
000810     EXEC  SQL  INCLUDE  D02SQS.CBL            END-EXEC.          
000820*                                                                 
000830*--<項目名称マスタ >                                              
000840     EXEC  SQL  INCLUDE  D19MSY.CBL            END-EXEC.          
000850*                                                                 
000860*--<債権情報（一般）ＤＢ >                                        
000870     EXEC  SQL  INCLUDE  M01SAJ.CBL            END-EXEC.          
000880*                                                                 
000890     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000900*----------------------------------------------------------------*
000910*   作業領域定義                                                 *
000920*----------------------------------------------------------------*
000930 01  ＷＯＲＫ−エリア.                                            
000940*--< エラーコード >                                               
000950     03  Ｗ−エラーコード             PIC S9(04).                 
000960*                                                                 
000970*--< ファイル状態 >                                               
000980     03  ファイル状態                 PIC  X(02).                 
000990*                                                                 
001000*--< 件数エリア >                                                 
001010     03  件数エリア.                                              
001020         05  Ｗ−入力−件数１         PIC  9(09).                 
001030         05  Ｗ−入力−件数２         PIC  9(09).                 
001040         05  Ｗ−出力−件数           PIC  9(09).                 
001050*                                                                 
001060*--< フラグアリア >                                               
001070     03  フラグ−エリア.                                          
001080         05  Ｗ−終了−フラグ         PIC  X(01).                 
001090         05  Ｗ−終了−フラグ１       PIC  X(01).                 
001100         05  異常終了−フラグ         PIC  X(01).                 
001110*                                                                 
001120*--< ファイル状態 >                                               
001130     03  Ｗ−適用日                   PIC  X(08).                 
001140*                                                                 
001150*----------------------------------------------------------------*
001160*   処理時間定義                                                 *
001170*----------------------------------------------------------------*
001180*--< 共通情報 >                                                   
001190 01  Ｗ−共通情報.                                                
001200     03  Ｗ−システム日付.                                        
001210         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001220         05  Ｗ−年月日               PIC  X(06).                 
001230     03  Ｗ−システム時刻             PIC  X(08).                 
001240     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001250*----------------------------------------------------------------*
001260*    サブルーチン名                                              *
001270*----------------------------------------------------------------*
001280 01  CALL-AREA.                                                   
001290*--< 共通ログサブルーチン >                                       
001300     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001310     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001320*----------------------------------------------------------------*
001330*    ＣＯＰＹ領域                                                *
001340*----------------------------------------------------------------*
001350*--< 共通ログ用パラメータ >                                       
001360 01  IF-CHOCO001.                                                 
001370     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001380*                                                                 
001390*----------------------------------------------------------------*
001400*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001410*----------------------------------------------------------------*
001420 01  PARA-AREA.                                                   
001430     COPY CPBCO001.                                               
001440******************************************************************
001450*    定数用データ定義エリア                                      *
001460******************************************************************
001470 CONSTANT                             SECTION.                    
001480 01  定数領域.                                                    
001490     03  定数−プログラムＩＤ         PIC  X(08) VALUE "AAASED25".
001500     03  定数−プログラム名           PIC  X(80)                  
001510                              VALUE  "前受金受払残高ファイル作成".
001520     03  定数−ＳＱＬＯＫ             PIC  9(04)  VALUE  0000.    
001530     03  定数−ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001540     03  定数−正常状態               PIC  9(04)  VALUE  ZERO.    
001550     03  定数−異常状態               PIC  9(04)  VALUE  0009.    
001560******************************************************************
001570*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001580******************************************************************
001590 PROCEDURE                            DIVISION.                   
001600*                                                                 
001610     PERFORM   初期処理.                                          
001620*                                                                 
001630     PERFORM   主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".           
001640*                                                                 
001650     PERFORM   終了処理.                                          
001660*                                                                 
001670******************************************************************
001680*    初期処理                                            <1.0>   *
001690******************************************************************
001700 初期処理                             SECTION.                    
001710 初期処理−ＳＴＡＲＴ.                                            
001720*                                                                 
001730*----------------------------------------------------------------*
001740*    開始メッセージ出力                                          *
001750*----------------------------------------------------------------*
001760     INITIALIZE                       IF-CHOCO001.                
001770     MOVE  "3"                        TO  共１−イベント種別.     
001780     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001790     MOVE  "0"                        TO  共１−復帰コード.       
001800     MOVE  "START"                    TO  共１−処理識別.         
001810     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001820     CALL  CLOCO001                USING  IF-CHOCO001.            
001830*                                                                 
001840*----------------------------------------------------------------*
001850*    作業領域の初期値設定                                        *
001860*----------------------------------------------------------------*
001870     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001880     INITIALIZE                           ＷＯＲＫ−エリア.       
001890*                                                                 
001900*----------------------------------------------------------------*
001910*    ＯＲＡＣＬＥ接続                                    <1.1>   *
001920*----------------------------------------------------------------*
001930     PERFORM  ＯＲＡＣＬＥ接続.                                   
001940*                                                                 
001950*--< ファイルオープン >                                           
001960     PERFORM  ファイルオープン.
001970*----------------------------------------------------------------*
001980*    業務管理テーブル読込処理(１件目)                    <C.1>   *
001990*----------------------------------------------------------------*
002000     PERFORM   業務管理テーブル読込処理.                          
002010*                                                                 
002020*----------------------------------------------------------------*
002030*    結合テーブルカーソル処                              <C.1>   *
002040*----------------------------------------------------------------*
002050     PERFORM   結合テーブルカーソル処理.                          
002060*----------------------------------------------------------------*
002070*    結合テーブル(１件目)                                <C.1>   *
002080*----------------------------------------------------------------*
002090     PERFORM   結合テーブル読込処理.                              
002100*                                                                 
002110 初期処理−ＥＸＩＴ.                                              
002120     EXIT.                                                        
002130*                                                                 
002140******************************************************************
002150*    ＯＲＡＣＬＥ接続                                            *
002160******************************************************************
002170 ＯＲＡＣＬＥ接続                     SECTION.                    
002180 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002190*                                                                 
002200*--< ＤＢ接続用情報を取得処理 >                                   
002210     CALL  COBCO001                USING  PARA-AREA.              
002220*                                                                 
002230     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002240     MOVE  PARA-USERNAME              TO  USERNAME.               
002250     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002260*                                                                 
002270*----------------------------------------------------------------*
002280*    開始接続                                                    *
002290*----------------------------------------------------------------*
002300     IF    DB-STRING  =  SPACE                                    
002310        EXEC SQL                                                  
002320           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002330        END-EXEC                                                  
002340     ELSE                                                         
002350        EXEC SQL                                                  
002360           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002370             USING  :DB-STRING                                    
002380        END-EXEC                                                  
002390     END-IF.                                                      
002400*                                                                 
002410*----------------------------------------------------------------*
002420*    接続確認                                                    *
002430*----------------------------------------------------------------*
002440     EVALUATE  SQLCODE                                            
002450        WHEN   定数−ＳＱＬＯＫ                                   
002460           CONTINUE                                               
002470        WHEN   OTHER                                              
002480*--<       接続エラー >                                           
002490           MOVE     -10               TO  Ｗ−エラーコード        
002500           PERFORM  エラー判定処理                                
002510     END-EVALUATE.                                                
002520*                                                                 
002530 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002540     EXIT.                                                        
002550******************************************************************
002560*    ファイルオープン                                            *
002570******************************************************************
002580 ファイルオープン                     SECTION.                    
002590 ファイルオープン−ＳＴＡＲＴ.                                    
002600*                                                                 
002610*----------------------------------------------------------------*
002620*    前受金受払残高中間ファイルのオープン                        *
002630*----------------------------------------------------------------*
002640     OPEN  OUTPUT   出力ファイル.                                 
002650*                                                                 
002660*--< ファイルオープンの状態判定 >                                 
002670     EVALUATE  ファイル状態                                           
002680        WHEN  ZERO                                                
002690           CONTINUE                                               
002700        WHEN  OTHER                                               
002710*--< ファイルオープンエラー >                                     
002720           MOVE     -70                TO  Ｗ−エラーコード       
002730           PERFORM  エラー判定処理                                
002740     END-EVALUATE.                                                
002750*                                                                 
002760 ファイルオープン−ＥＸＩＴ.                                      
002770     EXIT.                                                       
002780*                                                                 
002790******************************************************************
002800*    業務管理テーブル読込処理                            <C.1>   *
002810******************************************************************
002820 業務管理テーブル読込処理                   SECTION.              
002830 業務管理テーブル読込処理−ＳＴＡＲＴ.                            
002840*                                                                 
002850     EXEC  SQL                                                    
002860        SELECT バッチ用業務年月                                   
002870          INTO :Ｄ７０−バッチ用業務年月                          
002880          FROM  D70GYM_TBL                                        
002890          WHERE D70GYM_TBL.業務管理ＩＤ = :ＷＳ−業務管理ＩＤ     
002900     END-EXEC.                                                    
002910*                                                                 
002920*----------------------------------------------------------------*
002930*    業務管理テーブル読込確認                                    *
002940*----------------------------------------------------------------*
002950     EVALUATE  SQLCODE                                            
002960        WHEN  定数−ＳＱＬＯＫ                                    
002970*--<       正常 >                                                 
002980           CONTINUE                                               
002990        WHEN  OTHER                                               
003000*--<       読込エラー、プログラムが異常終了 >                     
003010           MOVE      -20              TO  Ｗ−エラーコード        
003020           PERFORM   エラー判定処理                               
003030     END-EVALUATE.                                                
003040*                                                                 
003050 業務管理テーブル読込処理−ＥＸＩＴ.                              
003060     EXIT.                                                        
003070******************************************************************
003080*     結合テーブルカーソル処                            <C.1>    *
003090******************************************************************
003100 結合テーブルカーソル処理                    SECTION.             
003110 結合テーブルカーソル処理−ＳＴＡＲＴ.                            
003120*                                                                 
003130     EXEC SQL                                                     
003140        DECLARE  CUR1  CURSOR  FOR                                
003150         SELECT  M40MAB_TBL.レコード区分   		        
003160                ,M40MAB_TBL.経理用主契約区分			
003170                ,M40MAB_TBL.顧客区分	    		        
003180                ,NVL(D01TRS_TBL.名寄せコード,RPAD(' ',40,' '))    
003190                ,M40MAB_TBL.請求先取引先コード                    
003200                ,M40MAB_TBL.請求先コード	                        
003210                ,M40MAB_TBL.契約番号		           	
003220                ,M40MAB_TBL.契約種類  		        	
003230                ,M40MAB_TBL.担当部課コード			
003240                ,M40MAB_TBL.再リース回数		 	        
003250                ,M40MAB_TBL.充当開始年月		        	
003260                ,M40MAB_TBL.充当月数		        	
003270                ,M40MAB_TBL.前払回収方法		        	
003280                ,M40MAB_TBL.入金日		        	
003290                ,M40MAB_TBL.入金区分		        	
003300                ,NVL(D01TRS_TBL.取引先名称,RPAD(' ',80,' '))     	
003310                ,NVL(D02SQS_TBL.請求先名称,RPAD(' ',80,' '))     	
003320                ,M40MAB_TBL.前月末残高		        	
003330                ,M40MAB_TBL.当月回収額		        	
003340                ,M40MAB_TBL.当月消化額		        	
003350                ,M40MAB_TBL.当月末残高		        	
003360                ,M40MAB_TBL.協調区分                              
003370                ,M40MAB_TBL.前月末残高他社	                
003380                ,M40MAB_TBL.当月回収額他社                 	
003390                ,M40MAB_TBL.当月消化額他社                        
003400                ,M40MAB_TBL.当月他社解約分料金                    
003410                ,M40MAB_TBL.当月他社解約分消費税                  
003420                ,M40MAB_TBL.当月末残高他社                        
003430           FROM  M40MAB_TBL                                       
003440                ,D01TRS_TBL                                       
003450                ,D02SQS_TBL                                       
003460         WHERE  M40MAB_TBL.前受金受払残高表対象フラグ = '1'       
003470           AND  M40MAB_TBL.請求先取引先コード                     
003480                = D01TRS_TBL.取引先コード (+)                     
003490           AND  M40MAB_TBL.請求先取引先コード                     
003500                = D02SQS_TBL.取引先コード (+)                     
003510           AND  M40MAB_TBL.請求先コード                           
003520                = D02SQS_TBL.請求先コード (+)                     
003530      ORDER BY  M40MAB_TBL.レコード区分                           
003540               ,M40MAB_TBL.契約番号                               
003550     END-EXEC.                                                    
003560*                                                                 
003570*----------------------------------------------------------------*
003580*    カーソルＯＰＥＮ処理                                        *
003590*----------------------------------------------------------------*
003600     EXEC  SQL                                                    
003610        OPEN  CUR1                                                
003620     END-EXEC.                                                    
003630*----------------------------------------------------------------*
003640*    カーソルＯＰＥＮ確認                                        *
003650*----------------------------------------------------------------*
003660     EVALUATE  SQLCODE                                            
003670        WHEN  定数−ＳＱＬＯＫ                                    
003680*--<       正常 >                                                 
003690           CONTINUE                                               
003700        WHEN  OTHER                                               
003710*--<       カーソルＯＰＥＮエラー >                               
003720           MOVE -30                   TO  Ｗ−エラーコード        
003730           PERFORM  エラー判定処理                                
003740     END-EVALUATE.                                                
003750*                                                                 
003760 結合テーブルカーソル処理−ＥＸＩＴ.                              
003770     EXIT.                                                        
003780*                                                                 
003790******************************************************************
003800*    結合テーブル読込処理                                 <C.1>  *
003810******************************************************************
003820 結合テーブル読込処理                   SECTION.                  
003830 結合テーブル読込処理−ＳＴＡＲＴ.                                
003840*                                                                 
003850     EXEC  SQL                                                    
003860        FETCH  CUR1                                               
003870           INTO  :Ｍ４０−レコード区分		        	
003880                ,:Ｍ４０−経理用主契約区分	        	
003890                ,:Ｍ４０−顧客区分		               	
003900                ,:Ｄ０１−名寄せコード		        	
003910                ,:Ｍ４０−請求先取引先コード	        	
003920                ,:Ｍ４０−請求先コード	                	
003930                ,:Ｍ４０−契約番号		               	
003940                ,:Ｍ４０−契約種類  		        	
003950                ,:Ｍ４０−担当部課コード				
003960                ,:Ｍ４０−再リース回数		        	
003970                ,:Ｍ４０−充当開始年月		        	
003980                ,:Ｍ４０−充当月数		               	
003990                ,:Ｍ４０−前払回収方法	            		
004000                ,:Ｍ４０−入金日		                	
004010                ,:Ｍ４０−入金区分		               	
004020                ,:Ｄ０１−取引先名称		          	
004030                ,:Ｄ０２−請求先名称		        	
004040                ,:Ｍ４０−前月末残高	              		
004050                ,:Ｍ４０−当月回収額	            		
004060                ,:Ｍ４０−当月消化額	            		
004070                ,:Ｍ４０−当月末残高	            	        
004080                ,:Ｍ４０−協調区分                                
004090                ,:Ｍ４０−前月末残高他社                   	
004100                ,:Ｍ４０−当月回収額他社                      	
004110                ,:Ｍ４０−当月消化額他社                          
004120                ,:Ｍ４０−当月他社解約分料金                      
004130                ,:Ｍ４０−当月他社解約分消費税                    
004140                ,:Ｍ４０−当月末残高他社                          
004150     END-EXEC.                                                    
004160*                                                                 
004170*----------------------------------------------------------------*
004180*    結合テーブル読込確認                                        *
004190*----------------------------------------------------------------*
004200     EVALUATE  SQLCODE                                            
004210        WHEN  定数−ＳＱＬＯＫ                                    
004220*--<       正常 >                                                 
004230*            COMPUTE  Ｗ−入力−件数  =  Ｗ−入力−件数  +  1     
004240           CONTINUE                                               
004250        WHEN  定数−ＳＱＬＥＮＤ                                  
004260*--<       読込終了 >                                             
004270           MOVE      "Y"              TO  Ｗ−終了−フラグ        
004280        WHEN  OTHER                                               
004290*--<       読込エラー、プログラムが異常終了 >                     
004300           MOVE      -40              TO  Ｗ−エラーコード        
004310           PERFORM   エラー判定処理                               
004320     END-EVALUATE.                                                
004330*                                                                 
004340 結合テーブル読込処理−ＥＸＩＴ.                                  
004350     EXIT.                                                        
004360******************************************************************
004370*    主処理                                                      *
004380******************************************************************
004390 主処理                               SECTION.                    
004400 主処理−ＳＴＡＲＴ.                                              
004410*                                                                 
004420     PERFORM  項目名称マスタ抽出処理.                             
004430*                                                                 
004440     PERFORM  債権情報抽出処理.                                   
004450*                                                                 
004460*     PERFORM  編集出力処理.                                      
004470     IF Ｍ０１−担保区分 NOT = 1                                  
004480        PERFORM  出力処理自社分.                                  
004490*        IF  Ｍ４０−前月末残高 = 0                               
004500*              AND Ｍ４０−当月回収額 = 0                         
004510*               AND Ｍ４０−当月消化額 = 0                        
004520*               AND Ｍ４０−当月末残高 = 0                        
004530*           CONTINUE                                              
004540*        WRITE 出力−レコード.                                    
004550      IF  Ｍ４０−協調区分 = '2'                                 
004560         PERFORM  出力処理他社分.                                 
004570*         IF  Ｍ４０−前月末残高 = 0                              
004580*               AND Ｍ４０−当月回収額 = 0                        
004590*               AND Ｍ４０−当月消化額 = 0                        
004600*               AND Ｍ４０−当月末残高 = 0                        
004610*            CONTINUE                                             
004620*         ELSE WRITE 出力−レコード.                              
004630     PERFORM  結合テーブル読込処理２.                             
004640*                                                                 
004650 主処理−ＥＸＩＴ.                                                
004660     EXIT.                                                        
004670*                                                                 
004680******************************************************************
004690*     項目名称マスタ抽出処理                                     *
004700******************************************************************
004710 項目名称マスタ抽出処理                         SECTION.          
004720 項目名称マスタ抽出処理−ＳＴＡＲＴ.                              
004730*                                                                 
004740     EXEC  SQL                                                    
004750        SELECT  名称                                              
004760          INTO  ＷＳ−名称１                                      
004770          FROM  D19MSY_TBL                                        
004780         WHERE  コードＮＯ = '038'                                
004790           AND  SUBSTR (コード,1,1)                               
004800                     = :Ｍ４０−経理用主契約区分                  
004810     END-EXEC.                                                    
004820*                                                                 
004830     EVALUATE SQLCODE                                             
004840        WHEN 定数−ＳＱＬＯＫ                                     
004850*--< 正常の時>                                                    
004860           CONTINUE                                               
004870        WHEN OTHER                                                
004880*--< 取得しない、初期値をセット>                                  
004890*           MOVE ZERO TO ＩＫＯ００１−新取引先コード             
004900*           MOVE ZERO TO ＩＫＯ００１−枝番                       
004910           MOVE -50      TO             Ｗ−エラーコード          
004920           PERFORM エラー判定処理                                 
004930           END-EVALUATE.                                          
004940*                                                                 
004950*                                                                 
004960     EXEC  SQL                                                    
004970        SELECT  名称                                              
004980          INTO  ＷＳ−名称２                                      
004990          FROM  D19MSY_TBL                                        
005000         WHERE  コードＮＯ = '005'                                
005010           AND  SUBSTR(コード,1,2)                                
005020                = :Ｍ４０−顧客区分                               
005030     END-EXEC.                                                    
005040*                                                                 
005050     EVALUATE SQLCODE                                             
005060        WHEN 定数−ＳＱＬＯＫ                                     
005070*--< 正常の時>                                                    
005080           CONTINUE                                               
005090        WHEN OTHER                                                
005100*--< 取得しない、初期値をセット>                                  
005110*           MOVE ZERO TO ＩＫＯ００１−新取引先コード             
005120*           MOVE ZERO TO ＩＫＯ００１−枝番                       
005130           MOVE -50      TO             Ｗ−エラーコード          
005140           PERFORM エラー判定処理                                 
005150           END-EVALUATE.                                          
005160*                                                                 
005170  項目名称マスタ抽出処理−ＥＸＩＴ.                               
005180     EXIT.                                                        
005190******************************************************************
005200*     債権情報抽出処理                                           *
005210******************************************************************
005220 債権情報抽出処理                         SECTION.                
005230 債権情報抽出処理−ＳＴＡＲＴ.                                    
005240*                                                                 
005250     EXEC  SQL                                                    
005260        SELECT  状態フラグ                                        
005270               ,債権契約件名                                      
005280               ,担保区分                                          
005290         INTO  :Ｍ０１−状態フラグ                                
005300              ,:Ｍ０１−債権契約件名                              
005310              ,:Ｍ０１−担保区分                                  
005320         FROM   M01SAJ_TBL                                        
005330        WHERE   レコード区分 = '1'                                
005340          AND   契約番号 = :Ｍ４０−契約番号                      
005350          AND   再リース回数 = :Ｍ４０−再リース回数              
005360          AND   契約種類 = :Ｍ４０−契約種類                      
005370     END-EXEC.                                                    
005380*                                                                 
005390     EVALUATE SQLCODE                                             
005400        WHEN 定数−ＳＱＬＯＫ                                     
005410*--< 正常の時>                                                    
005420           CONTINUE                                               
005430        WHEN OTHER                                                
005440*--< 取得しない、初期値をセット>                                  
005450*           MOVE ZERO TO ＩＫＯ００１−新取引先コード             
005460*           MOVE ZERO TO ＩＫＯ００１−枝番                       
005470           MOVE -60 TO Ｗ−エラーコード                           
005480           PERFORM エラー判定処理                                 
005490           END-EVALUATE.                                          
005500*                                                                 
005510 債権情報抽出処理−ＥＸＩＴ.                                      
005520     EXIT.                                                        
005530******************************************************************
005540*     出力処理自社分                                           *  
005550******************************************************************
005560 出力処理自社分                     SECTION.                      
005570 出力処理自社分−ＳＴＡＲＴ.                                      
005580*                                                                 
005590*--< No.1 >                                                       
005600     IF Ｍ０１−状態フラグ < 3                                    
005610        MOVE '3' TO  出力−自他社区分                             
005620     ELSE                                                         
005630     MOVE '1' TO  出力−自他社区分.                               
005640*--< No.2 >                                                       
005650     MOVE  Ｍ４０−レコード区分   TO  出力−前受区分.	        
005660*--<   No.3 >                                                     
005670     MOVE  Ｍ４０−経理用主契約区分   TO  出力−主契約区分.       
005680*--< No.4 >                                                       
005690     MOVE  Ｍ４０−顧客区分   TO 出力−連結区分.			
005700*--< No.5 >                                                       
005710     MOVE  Ｄ０１−名寄せコード TO 出力−名寄せコード.     	
005720*--< No.6 >                                                       
005730     MOVE  Ｍ４０−請求先取引先コード TO 出力−取引先コード.	
005740*--< No.7 >                                                       
005750     MOVE  Ｍ４０−請求先コード TO 出力−請求先コード.    	
005760*--< No.8 >                                                       
005770     MOVE  Ｍ４０−契約番号 TO 出力−契約番号.	        	
005780*--< No.9 >                                                       
005790     MOVE  Ｍ４０−契約種類 TO 出力−契約種類.	        	
005800*--< No.10 >                                                      
005810     MOVE  Ｄ７０−バッチ用業務年月 TO 出力−業務年月.		
005820*--< No.11 >                                                      
005830     MOVE  Ｍ４０−担当部課コード TO 出力−担当部課コード.	
005840*--< No.12 >                                                      
005850     MOVE  Ｍ０１−債権契約件名 TO 出力−契約件名.		
005860*--< No.13 >                                                      
005870     MOVE  Ｍ４０−再リース回数 TO 出力−再リース回数.		
005880*--< No.14 >                                                      
005890     MOVE  Ｍ４０−充当開始年月 TO 出力−充当開始年月.		
005900*--< No.15 >                                                      
005910     MOVE  Ｍ４０−充当月数 TO 出力−充当月数.		        
005920*--< No.16 >                                                      
005930     MOVE  Ｍ４０−前払回収方法 TO 出力−前払回収方法.		
005940*--< No.17 >                                                      
005950     MOVE  Ｍ４０−入金日 TO 出力−入金日.		        
005960*--< No.18 >                                                      
005970     MOVE  Ｍ４０−入金区分 TO 出力−入金区分.			
005980*--< No.19 >                                                      
005990     MOVE  Ｄ０１−取引先名称 TO 出力−取引先名称	.		
006000*--< No.20 >                                                      
006010     MOVE  Ｄ０２−請求先名称 TO 出力−請求先名称	.		
006020*--< No.21 >                                                      
006030     MOVE  ＷＳ−名称１ TO 出力−主契約区分名称.	        	
006040*--< No.22 >                                                      
006050     MOVE  ＷＳ−名称２ TO 出力−連結区分名称.			
006060*--< No.23 >                                                      
006070     MOVE  Ｍ４０−前月末残高 TO 出力−前月末残高.		
006080*--< No.24 >                                                      
006090     MOVE  Ｍ４０−当月回収額 TO 出力−当月入金額.		
006100*--< No.25 >                                                      
006110     MOVE  Ｍ４０−当月消化額 TO 出力−当月消化額.		
006120*--< No.26 >                                                      
006130     MOVE  Ｍ４０−当月末残高 TO 出力−当月末残高.                
006140*                                                                 
006141     IF  Ｍ４０−前月末残高 = 0                                   
006142              AND Ｍ４０−当月回収額 = 0                          
006143               AND Ｍ４０−当月消化額 = 0                         
006144               AND Ｍ４０−当月末残高 = 0                         
006145        CONTINUE                                                  
006146      ELSE  WRITE 出力−レコード.                                 
006150 出力処理自社分−ＥＸＩＴ.                                        
006160     EXIT.                                                        
006170*                                                                 
006180******************************************************************
006190*     出力処理他社分                                             *
006200******************************************************************
006210 出力処理他社分                     SECTION.                      
006220 出力処理他社分−ＳＴＡＲＴ.                                      
006230*                                                                 
006240     COMPUTE ＷＳ−当月消化額 = Ｍ４０−当月消化額他社            
006250                           + Ｍ４０−当月他社解約分料金           
006260                           + Ｍ４０−当月他社解約分消費税.        
006270     COMPUTE ＷＳ−当月末残高 = Ｍ４０−当月末残高他社            
006280                           - Ｍ４０−当月他社解約分料金           
006290                           - Ｍ４０−当月他社解約分消費税.        
006300*--<   No.1 >                                                     
006310     IF Ｍ０１−状態フラグ < 3                                    
006320        MOVE '4' TO  出力−自他社区分                             
006330     ELSE MOVE '2' TO  出力−自他社区分.                          
006340*--<   No.2 >                                                     
006350     MOVE  Ｍ４０−レコード区分   TO  出力−前受区分.       	
006360*--<   No.3 >                                                     
006370     MOVE  Ｍ４０−経理用主契約区分   TO  出力−主契約区分.       
006380*--<   No.4 >                                                     
006390     MOVE  Ｍ４０−顧客区分   TO 出力−連結区分.			
006400*--<   No.5 >                                                     
006410     MOVE  Ｄ０１−名寄せコード TO 出力−名寄せコード.		
006420*--<   No.6 >                                                     
006430     MOVE  Ｍ４０−請求先取引先コード TO 出力−取引先コード.	
006440*--<   No.7 >                                                     
006450     MOVE  Ｍ４０−請求先コード TO 出力−請求先コード.	        
006460*--<   No.8 >                                                     
006470     MOVE  Ｍ４０−契約番号 TO 出力−契約番号.		        
006480*--<   No.9 >                                                     
006490     MOVE  Ｍ４０−契約種類 TO 出力−契約種類.		        
006500*--<   No.10 >                                                    
006510     MOVE  Ｄ７０−バッチ用業務年月 TO 出力−業務年月.		
006520*--<   No.11 >                                                    
006530     MOVE  Ｍ４０−担当部課コード TO 出力−担当部課コード.	
006540*--<   No.12 >                                                     
006550     MOVE  Ｍ０１−債権契約件名 TO 出力−契約件名.	        
006560*--<   No.13 >                                                     
006570     MOVE  Ｍ４０−再リース回数 TO 出力−再リース回数.		
006580*--<   No.14 >                                                     
006590     MOVE  Ｍ４０−充当開始年月 TO 出力−充当開始年月.		
006600*--<   No.15 >                                                     
006610     MOVE  Ｍ４０−充当月数 TO 出力−充当月数.		        
006620*--<   No.16 >                                                     
006630     MOVE  Ｍ４０−前払回収方法 TO 出力−前払回収方法.		
006640*--<   No.17 >                                                     
006650     MOVE  Ｍ４０−入金日 TO 出力−入金日.			
006660*--<   No.18 >                                                     
006670     MOVE  Ｍ４０−入金区分 TO 出力−入金区分.			
006680*--<   No.19 >                                                     
006690     MOVE  Ｄ０１−取引先名称 TO 出力−取引先名称	.		
006700*--<   No.20 >                                                     
006710     MOVE  Ｄ０２−請求先名称 TO 出力−請求先名称	.		
006720*--<   No.21 >                                                     
006730     MOVE  ＷＳ−名称１ TO 出力−主契約区分名称	.		
006740*--<   No.22 >                                                     
006750     MOVE  ＷＳ−名称２ TO 出力−連結区分名称.			
006760*--<   No.23 >                                                     
006770     MOVE  Ｍ４０−前月末残高他社 TO 出力−前月末残高.		
006780*--<   No.24 >                                                     
006790     MOVE  Ｍ４０−当月回収額他社 TO 出力−当月入金額.		
006800*--<   No.25 >                                                     
006810     MOVE  ＷＳ−当月消化額 TO 出力−当月消化額.	                
006820*--<   No.26 >                                                     
006830     MOVE  ＷＳ−当月末残高 TO 出力−当月末残高.                  
006840*                                                                 
006841     IF  Ｍ４０−前月末残高 = 0                                        
006842               AND Ｍ４０−当月回収額 = 0                         
006843               AND Ｍ４０−当月消化額 = 0                         
006844               AND Ｍ４０−当月末残高 = 0                         
006845        CONTINUE                                              
006846     ELSE WRITE 出力−レコード.
006850 出力処理他社分−ＥＸＩＴ.                                        
006860     EXIT.                                                        
006870******************************************************************
006880*    結合テーブル読込処理                                 <C.1>  *
006890******************************************************************
006900 結合テーブル読込処理２                   SECTION.                
006910 結合テーブル読込処理２−ＳＴＡＲＴ.                              
006920*                                                                 
006930     EXEC  SQL                                                    
006940        FETCH  CUR1                                               
006950           INTO  :Ｍ４０−レコード区分		        	
006960                ,:Ｍ４０−経理用主契約区分	        	
006970                ,:Ｍ４０−顧客区分		               	
006980                ,:Ｄ０１−名寄せコード		        	
006990                ,:Ｍ４０−請求先取引先コード	        	
007000                ,:Ｍ４０−請求先コード	                	
007010                ,:Ｍ４０−契約番号		               	
007020                ,:Ｍ４０−契約種類  		        	
007030                ,:Ｍ４０−担当部課コード				
007040                ,:Ｍ４０−再リース回数		        	
007050                ,:Ｍ４０−充当開始年月		        	
007060                ,:Ｍ４０−充当月数		               	
007070                ,:Ｍ４０−前払回収方法	            		
007080                ,:Ｍ４０−入金日		                	
007090                ,:Ｍ４０−入金区分		               	
007100                ,:Ｄ０１−取引先名称		          	
007110                ,:Ｄ０２−請求先名称		        	
007120                ,:Ｍ４０−前月末残高	              		
007130                ,:Ｍ４０−当月回収額	            		
007140                ,:Ｍ４０−当月消化額	            		
007150                ,:Ｍ４０−当月末残高	            	        
007160                ,:Ｍ４０−前月末残高他社                   	
007170                ,:Ｍ４０−当月回収額他社                      	
007180     END-EXEC.                                                    
007190*                                                                 
007200*----------------------------------------------------------------*
007210*    結合テーブル読込確認２                                      *
007220*----------------------------------------------------------------*
007230     EVALUATE  SQLCODE                                            
007240        WHEN  定数−ＳＱＬＯＫ                                    
007250*--<       正常 >                                                 
007260*            COMPUTE  Ｗ−入力−件数  =  Ｗ−入力−件数  +  1     
007270           CONTINUE                                               
007280        WHEN  定数−ＳＱＬＥＮＤ                                  
007290*--<       読込終了 >                                             
007300           MOVE      "Y"              TO  Ｗ−終了−フラグ        
007310        WHEN  OTHER                                               
007320*--<       読込エラー、プログラムが異常終了 >                     
007330           MOVE      -40              TO  Ｗ−エラーコード        
007340           PERFORM   エラー判定処理                               
007350     END-EVALUATE.                                                
007360*                                                                 
007370 結合テーブル読込処理２−ＥＸＩＴ.                                
007380     EXIT.                                                        
007390
007400******************************************************************
007410*    終了処理                                                    *
007420******************************************************************
007430 終了処理                             SECTION.                    
007440 終了処理−ＳＴＡＲＴ.                                            
007450*                                                                 
007460     PERFORM  ＤＢクローズ処理.                                   
007470*                                                                 
007480     PERFORM  ファイルクローズ.                                   
007490*                                                                 
007500     PERFORM  件数メッセージ出力.                                 
007510*                                                                 
007520     PERFORM  終了メッセージ出力.                                 
007530*                                                                 
007540*--< プログラム正常終了 >                                         
007550     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
007560*                                                                 
007570 終了処理−ＥＸＩＴ.                                              
007580     EXIT.                                                        
007590******************************************************************
007600*    ＤＢクローズ                                                *
007610******************************************************************
007620 ＤＢクローズ処理                     SECTION.                    
007630 ＤＢクローズ処理−ＳＴＡＲＴ.                                    
007640*                                                                 
007650*--< カーソル クローズ >                                          
007660     EXEC SQL                                                     
007670        CLOSE  CUR1                                               
007680     END-EXEC.                                                    
007690*                                                                 
007700 ＤＢクローズ処理−ＥＸＩＴ.                                      
007710     EXIT.                                                        
007720******************************************************************
007730*    ファイルクローズ                                            *
007740******************************************************************
007750 ファイルクローズ                     SECTION.                    
007760 ファイルクローズ−ＳＴＡＲＴ.                                    
007770*                                                                 
007780*     EXEC  SQL                                                   
007790        CLOSE 出力ファイル.                                       
007800*     END-EXEC.                                                   
007810 ファイルクローズ−ＥＸＩＴ.                                      
007820     EXIT.                                                        
007830******************************************************************
007840*    件数メッセージ出力                                          *
007850******************************************************************
007860 件数メッセージ出力                     SECTION.                  
007870 件数メッセージ出力−ＳＴＡＲＴ.                                  
007880*                                                                 
007890     INITIALIZE                       IF-CHOCO001.                
007900     MOVE  "3"                        TO  共１−イベント種別.     
007910     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007920     MOVE  "0"                        TO  共１−復帰コード.       
007930     MOVE  "D34HNS"                   TO  共１−処理テーブルＩＤ. 
007940     MOVE  "COUNT"                    TO  共１−処理識別.         
007950     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
007960     MOVE  "変則払DB出力件数"         TO  共１−その他メッセージ. 
007970     CALL  CLOCO001                USING  IF-CHOCO001.            
007980*                                                                 
007990 件数メッセージ出力−ＥＸＩＴ.                                    
008000     EXIT.                                                        
008010                                                                  
008020******************************************************************
008030*    終了メッセージ出力                                          *
008040******************************************************************
008050 終了メッセージ出力                   SECTION.                    
008060 終了メッセージ出力−ＳＴＡＲＴ.                                  
008070*                                                                 
008080     INITIALIZE                       IF-CHOCO001.                
008090     MOVE  "3"                        TO  共１−イベント種別.     
008100     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008110     MOVE  "0"                        TO  共１−復帰コード.       
008120     MOVE  "END"                      TO  共１−処理識別.         
008130     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
008140     CALL  CLOCO001                USING  IF-CHOCO001.            
008150*                                                                 
008160 終了メッセージ出力−ＥＸＩＴ.                                    
008170     EXIT.                                                        
008180******************************************************************
008190*    エラー判定処理                                              *
008200******************************************************************
008210 エラー判定処理                       SECTION.                    
008220 エラー判定処理−ＳＴＡＲＴ.                                      
008230*                                                                 
008240     MOVE  "Y"                        TO  Ｗ−終了−フラグ.       
008250     INITIALIZE                           IF-CHOCO001.            
008260*                                                                 
008270     EVALUATE  Ｗ−エラーコード                                   
008280        WHEN  -10                                                 
008290*--<       ＯＲＡＣＬＥ接続失敗 >                                 
008300           MOVE  "1"                  TO  共１−イベント種別      
008310           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008320           MOVE  "9"                  TO  共１−復帰コード        
008330           MOVE  "CONNECT"            TO  共１−処理識別          
008340           MOVE  SQLCODE              TO  共１−データ内容        
008350           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008360           CALL  CLOCO001          USING  IF-CHOCO001             
008370*                                                                 
008380        WHEN  -20                                                 
008390*--<       結合テーブルカーソルオープン失敗 >                     
008400           MOVE  "1"                  TO  共１−イベント種別      
008410           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008420           MOVE  "9"                  TO  共１−復帰コード        
008430           MOVE  "D70GYM_TBL"         TO  共１−処理テーブルＩＤ  
008440           MOVE  "SELECT2"            TO  共１−処理識別          
008450           MOVE  SQLCODE              TO  共１−データ内容        
008460           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008470           CALL  CLOCO001          USING  IF-CHOCO001             
008480*                                                                 
008490        WHEN  -30                                                 
008500*--<       結合テーブル読込失敗 >                                 
008510           MOVE  "1"                  TO  共１−イベント種別      
008520           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008530           MOVE  "9"                  TO  共１−復帰コード        
008540           MOVE  "CUR1"               TO  共１−処理テーブルＩＤ  
008550           MOVE  "OPEN"               TO  共１−処理識別          
008560           MOVE  SQLCODE              TO  共１−データ内容        
008570           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008580           CALL  CLOCO001          USING  IF-CHOCO001             
008590*                                                                 
008600        WHEN  -40                                                 
008610*--<       変則払ＤＢ追加失敗 >                                   
008620           MOVE  "1"                  TO  共１−イベント種別      
008630           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008640           MOVE  "9"                  TO  共１−復帰コード        
008650           MOVE  "CUR1"               TO  共１−処理テーブルＩＤ  
008660           MOVE  "FETCH"              TO  共１−処理識別          
008670           MOVE  SQLCODE              TO  共１−データ内容        
008680           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008690           CALL  CLOCO001          USING  IF-CHOCO001             
008700*                                                                 
008710        WHEN  -50                                                 
008720*--<                          >                                   
008730           MOVE  "1"                  TO  共１−イベント種別      
008740           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008750           MOVE  "9"                  TO  共１−復帰コード        
008760           MOVE  "D19MSY_TBL"         TO  共１−処理テーブルＩＤ  
008770           MOVE  "SELECT"             TO  共１−処理識別          
008780           MOVE  SQLCODE              TO  共１−データ内容        
008790           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008800           CALL  CLOCO001          USING  IF-CHOCO001             
008810*                                                                 
008820*                                                                 
008830        WHEN  -60                                                 
008840*--<                          >                                   
008850           MOVE  "1"                  TO  共１−イベント種別      
008860           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008870           MOVE  "9"                  TO  共１−復帰コード        
008880           MOVE  "M01SAJ_TBL"         TO  共１−処理テーブルＩＤ  
008890           MOVE  "SELECT1"            TO  共１−処理識別          
008900           MOVE  SQLCODE              TO  共１−データ内容        
008910           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008920           CALL  CLOCO001          USING  IF-CHOCO001             
008930*                                                                 
008940        WHEN  -70                                                 
008950*--<                          >                                   
008960           MOVE  "1"                  TO  共１−イベント種別      
008970           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008980           MOVE  "9"                  TO  共１−復帰コード        
008990           MOVE  "M01SAJ"         TO  共１−処理テーブルＩＤ  
009000           MOVE  "OPEN"               TO  共１−処理識別          
009010           MOVE  SQLCODE              TO  共１−データ内容        
009020           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009030           CALL  CLOCO001          USING  IF-CHOCO001             
009040*                                                                 
009050        WHEN  OTHER                                               
009060           MOVE  "N"                  TO  Ｗ−終了−フラグ        
009070     END-EVALUATE.                                                
009080*                                                                 
009090     IF Ｗ−終了−フラグ  =  "Y"                                  
009100        PERFORM  ＤＢクローズ処理                                 
009110*                                                                 
009120        PERFORM  終了メッセージ出力                               
009130*                                                                 
009140*--<    プログラム異常終了のリターンコード >                      
009150        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
009160*                                                                 
009170        EXIT  PROGRAM                                             
009180     END-IF.                                                      
009190*                                                                 
009200 エラー判定処理−ＥＸＩＴ.                                        
009210     EXIT.                                                        
009220*                                                                 
