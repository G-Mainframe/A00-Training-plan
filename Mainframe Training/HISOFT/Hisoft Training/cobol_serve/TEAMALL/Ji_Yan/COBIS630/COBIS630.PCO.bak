000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名    ：受取手形移行処理                     *
000040*      2. プログラムID    ：COBIS630                             *
000050*      3. 処理概要        ：契約ＮＯをKEYとし、                  *
000060*                           ソート後の手形基本ファイルと         *
000070*                           ソート後の受取手形ファイルで         *
000080*                           マッチング処理を行う                 *
000090*      4. 作成者          ：紀岩                                 *
000100*      5. 作成日          ：2005.04.02                           *
000110******************************************************************
000120*                                                                 
000130******************************************************************
000140*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000150******************************************************************
000160 IDENTIFICATION                       DIVISION.                   
000170*                                                                 
000180 PROGRAM-ID.                          COBIS630.                   
000190******************************************************************
000200*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000210******************************************************************
000220 ENVIRONMENT                          DIVISION.                   
000230******************************************************************
000240*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000250******************************************************************
000260 INPUT-OUTPUT                         SECTION.                    
000280*                                                                 
000290 FILE-CONTROL.                                                    
000300     SELECT    入力ファイル１         ASSIGN    TO     U01        
000310     FILE      STATUS     IS          Ｗ−状態                    
000320     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000330*                                                                 
000340     SELECT    入力ファイル２         ASSIGN    TO     U02        
000350     FILE      STATUS     IS          Ｗ−状態                    
000360     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000370*                                                                 
000380******************************************************************
000390*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000400******************************************************************
000410 DATA                                 DIVISION.                   
000420******************************************************************
000430*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000440******************************************************************
000450 FILE                                 SECTION.                    
000460*----------------------------------------------------------------*
000470*    入力ファイル                                                *
000480*----------------------------------------------------------------*
000490 FD  入力ファイル１                                               
000500     LABEL     RECORD     IS          STANDARD                    
000510     BLOCK     CONTAINS   0           RECORDS.                    
000520*                                                                 
000530 01  入力１−レコード.                                            
000540     COPY  CPBIS061  REPLACING  ==()==  BY  ==入力１−==.         
000550*                                                                 
000560 FD  入力ファイル２                                               
000570     LABEL     RECORD     IS          STANDARD                    
000580     BLOCK     CONTAINS   0           RECORDS.                    
000590*                                                                 
000600 01  入力２−レコード.                                            
000610     COPY  CPBIS062  REPLACING  ==()==  BY  ==入力２−==.         
000620*                                                                 
000630******************************************************************
000640*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000650******************************************************************
000660  WORKING-STORAGE                     SECTION.                    
000670*----------------------------------------------------------------*
000680*    ホスト変数定義エリア                                        *
000690*----------------------------------------------------------------*
000700     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000710*                                                                 
000720 01 ＷＳ−取引先コード                PIC X(08).
000730 01 ＷＳ−目的ＣＤ                    PIC X(01)  VALUE '2'. 
000740 01 ＷＳ−契約ＮＯ                    PIC X(09). 
000750 01 ＷＳ−支払人コード                PIC X(08). 
000760*                                                                 
000770*--< ＯＲＡＣＬＥ共通変数 >                                       
000780     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000790*--< 受取手形テーブル >                                               
000800     EXEC  SQL  INCLUDE  D642UTG.CBL           END-EXEC.          
000810*--< 受取手形展開テーブル >                                           
000820     EXEC  SQL  INCLUDE  D645UTT.CBL           END-EXEC.          
000830*--< 変換テーブル >                                           
000840     EXEC  SQL  INCLUDE  IKOTBL001.CBL         END-EXEC.          
000850*--< 契約種類等変換テーブル >                                           
000860     EXEC  SQL  INCLUDE  IKOTBL002.CBL         END-EXEC.          
000870*--< ＯＲＡＣＬＥ ＳＱＬ実行情報 (SQLCA) >                        
000880     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000890*                                                                 
000900     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000910*----------------------------------------------------------------*
000920*    ＷＯＲＫエリア                                              *
000930*----------------------------------------------------------------*
000940 01  ＷＯＲＫ−エリア.  
000970*--< 連番処理 >                                               
001240     03  Ｗ−連番                     PIC S9(03).                        
000970*--< 日期処理 >                                               
001240     03  Ｗ−入力日期                 PIC  X(07).                        
001240     03  Ｗ−出力日期                 PIC  X(08).                        
000970*--< エラー判定用 >                                               
000980     03  Ｗ−エラーコード             PIC S9(04).                 
000990*--< ファイル状態 >                                               
001000     03  Ｗ−状態エリア.                                          
001010         05  Ｗ−状態                 PIC  X(02).                 
001020*--< フラグエリア >                                               
001030     03  Ｗ−フラッグエリア.                                      
001040         05  Ｗ−終了−フラグ１       PIC  X(01).                 
001050         05  Ｗ−終了−フラグ２       PIC  X(01).                 
001060         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001070*--< 件数エリア >                                                 
001080     03  件数エリア.                                              
001090         05  Ｗ−入力−件数１         PIC  9(09).                 
001100         05  Ｗ−入力−件数２         PIC  9(09).                 
001110         05  Ｗ−出力−件数１         PIC  9(09).                 
001120         05  Ｗ−出力−件数２         PIC  9(09).                 
001130*--< キーエリア >                                                 
001140     03  ＫＥＹ−エリア.                                          
001150        05  ＮＥＷキー.                                           
001160            07 Ｗ−Ｎ−契約ＮＯ１     PIC  X(09).                 
001170            07 Ｗ−Ｎ−契約ＮＯ２     PIC  X(09).                 
001180            07 Ｗ−Ｎ−束数           PIC  S9(2).                 
001190        05  ＯＬＤキー.                                           
001200            07 Ｗ−Ｏ−契約ＮＯ１     PIC  X(09).                 
001210            07 Ｗ−Ｏ−束数           PIC  S9(2).                 
001220*--< 共通情報 >                                                   
001230 01  Ｗ−共通情報.                                                
001240     03  Ｗ−システム日付.                                        
001250         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001260         05  Ｗ−年月日               PIC  X(06).                 
001270     03  Ｗ−システム時刻             PIC  X(08).                 
001280     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001290*                                                                 
001300*----------------------------------------------------------------*
001310*    サブルーチン名                                              *
001320*----------------------------------------------------------------*
001330 01  CALL-AREA.                                                   
001340*--< 共通ログサブルーチン >                                       
001350     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001360     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001370*                                                                 
001380*----------------------------------------------------------------*
001390*    ＣＯＰＹ領域                                                *
001400*----------------------------------------------------------------*
001410*--< 共通ログ用パラメータ >                                       
001420 01  IF-CHOCO001.                                                 
001430     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001440*                                                                 
001450*----------------------------------------------------------------*
001460*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001470*----------------------------------------------------------------*
001480 01  PARA-AREA.                                                   
001490     COPY CPBCO001.                                               
001500******************************************************************
001510*    定数用データ定義エリア                                      *
001520******************************************************************
001530 CONSTANT                             SECTION.                    
001540 01  定数領域.                                                    
001550     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS630".
001560     03  定数−プログラム名           PIC  X(80)                  
001570                                        VALUE  "受取手形移行処理". 
001580     03  定数−ＳＱＬＯＫ             PIC  9(04)  VALUE  ZERO.    
001580     03  定数−ＳＱＬＬＯＴ           PIC S9(04)  VALUE -2112.    
001590     03  定数−ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001600     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001610     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001620******************************************************************
001630*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001640******************************************************************
001650 PROCEDURE                            DIVISION.                   
001660*                                                                 
001670     PERFORM  初期処理.                                           
001680*                                                                 
001690     PERFORM   主処理     UNTIL  (Ｗ−終了−フラグ１ = "Y")       
001700                          AND    (Ｗ−終了−フラグ２ = "Y").      
001710*                                                                 
001720     PERFORM  終了処理.                                           
001730*                                                                 
001740     STOP     RUN.                                                
001750*                                                                 
001760******************************************************************
001770*    初期処理                                            <1.0>   *
001780******************************************************************
001790 初期処理                             SECTION.                    
001800 初期処理−ＳＴＡＲＴ.                                            
001810*                                                                 
001820*----------------------------------------------------------------*
001830*    開始メッセージ出力処理                              <1.1>   *
001840*----------------------------------------------------------------*
001850     INITIALIZE                       IF-CHOCO001.                
001860     MOVE  "3"                        TO  共１−イベント種別.     
001870     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001880     MOVE  ZERO                       TO  共１−復帰コード.       
001890     MOVE  "START"                    TO  共１−処理識別.         
001900     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001910     CALL  CLOCO001                USING  IF-CHOCO001.            
001920*                                                                 
001930*----------------------------------------------------------------*
001940*    作業領域の初期値処理                                <1.2>   *
001950*----------------------------------------------------------------*
001960     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001970     INITIALIZE                           ＷＯＲＫ−エリア.       
001980*--< ＣＰＵ日付を取得 >                                           
001990     ACCEPT  Ｗ−年月日               FROM  DATE.                 
002000*--< ＣＰＵ時刻を取得 >                                           
002010     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
002020*--< ＯＲＡＣＬＥ接続  >                         
002030     PERFORM   ＯＲＡＣＬＥ接続.                                  
002040*--< ファイルオープン >
002050     PERFORM  ファイルオープン.                                   
002060*--< 入力ファイル１(手形基本ファイル)読込処理 >                         
002070     PERFORM  手形基本ファイル読込処理.                           
002080*--< 入力ファイル２(受取手形ファイル)読込処理 >                     
002090     PERFORM  受取手形ファイル読込処理.                               
002100*                                                                 
002110 初期処理−ＥＸＩＴ.                                              
002120     EXIT.                                                        
002130******************************************************************
002140*    ＯＲＡＣＬＥ接続                                            *
002150******************************************************************
002160 ＯＲＡＣＬＥ接続                     SECTION.                    
002170 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002180*                                                                 
002190*--< ＤＢ接続用情報を取得処理 >                                   
002200     CALL  COBCO001                USING  PARA-AREA.              
002210*                                                                 
002220     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002230     MOVE  PARA-USERNAME              TO  USERNAME.               
002240     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002250*                                                                 
002260*----------------------------------------------------------------*
002270*    開始接続                                                    *
002280*----------------------------------------------------------------*
002290     IF    DB-STRING  =  SPACE                                    
002300        EXEC SQL                                                  
002310           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002320        END-EXEC                                                  
002330     ELSE                                                         
002340        EXEC SQL                                                  
002350           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002360             USING  :DB-STRING                                    
002370        END-EXEC                                                  
002380     END-IF.                                                      
002390*                                                                 
002400*----------------------------------------------------------------*
002410*    接続確認                                                    *
002420*----------------------------------------------------------------*
002430     EVALUATE  SQLCODE                                            
002440        WHEN   定数−ＳＱＬＯＫ                                   
002450           CONTINUE                                               
002460        WHEN   OTHER                                              
002470*--<       接続エラー >                                           
002480           MOVE     -10               TO  Ｗ−エラーコード        
002490           PERFORM  エラー処理                                    
002500     END-EVALUATE.                                                
002510*                                                                 
002520 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002530     EXIT.                                                        
002540******************************************************************
002550*    ファイルオープン                                            *
002560******************************************************************
002570 ファイルオープン                     SECTION.                    
002580 ファイルオープン−ＳＴＡＲＴ.                                    
002590*----------------------------------------------------------------*
002600*    入力ファイル１オープン                        *
002610*----------------------------------------------------------------*
002620     OPEN  INPUT   入力ファイル１.                                 
002630*                                                                 
002640*--< 入力ファイル１オープンの状態判定 >                                 
002650     EVALUATE  Ｗ−状態                                           
002660        WHEN  ZERO                                                
002670           CONTINUE                                               
002680        WHEN  OTHER                                               
002690*--<       入力ファイル１オープンエラー >                               
002700           MOVE     -20               TO  Ｗ−エラーコード        
002710           PERFORM  エラー処理                                    
002720     END-EVALUATE.                                                
002730*                                                                 
002740*----------------------------------------------------------------*
002750*    入力ファイル２オープン                        *
002760*---------------------------------------------------------------*
002770     OPEN  INPUT   入力ファイル２.                                 
002780*                                                                 
002790*--< 入力ファイル２オープンの状態判定 >                                 
002800     EVALUATE  Ｗ−状態                                           
002810        WHEN  ZERO                                                
002820           CONTINUE                                               
002830        WHEN  OTHER                                               
002840*--<       入力ファイル２オープンエラー >                               
002850           MOVE     -30               TO  Ｗ−エラーコード        
002860           PERFORM  エラー処理                                    
002870     END-EVALUATE.                                                
002880 ファイルオープン−ＥＸＩＴ.                                      
002890     EXIT.                                                        
002900******************************************************************
002910*    手形基本ファイル読込処理                                    *
002920******************************************************************
002930 手形基本ファイル読込処理             SECTION.                    
002940 手形基本ファイル読込処理−ＳＴＡＲＴ.                            
002950*                                                                 
002960     READ  入力ファイル１                                         
002970        AT END                                                    
002980           MOVE  "Y"                  TO  Ｗ−終了−フラグ１      
002990           MOVE  HIGH-VALUE           TO  Ｗ−Ｎ−契約ＮＯ１    
003000           GO    TO   手形基本ファイル読込処理−ＥＸＩＴ          
003010     END-READ.                                                    
003020*                                                                 
003030*--< ファイル読込状態判定 >                                       
003040     EVALUATE  Ｗ−状態                                           
003050        WHEN  ZERO                                                
003060           MOVE  入力１−契約ＮＯ     TO  Ｗ−Ｎ−契約ＮＯ１ 
003070           MOVE  入力１−契約ＮＯ     TO  ＷＳ−契約ＮＯ 
003080           MOVE  入力１−取引先コード TO  ＷＳ−取引先コード 
003090
003100*--<       手形基本ファイル入力件数のカウント >                   
003110           COMPUTE  Ｗ−入力−件数１ = Ｗ−入力−件数１ + 1
003120        WHEN  OTHER                                               
003130*--<       手形基本ファイル読込エラー >                           
003140           MOVE     -40               TO  Ｗ−エラーコード        
003150           PERFORM  エラー処理                                    
003160     END-EVALUATE.                                                
003170*                                                                 
003180 手形基本ファイル読込処理−ＥＸＩＴ.                              
003190     EXIT.                                                        
003200******************************************************************
003210*    受取手形ファイル読込処理                                    *
003220******************************************************************
003230 受取手形ファイル読込処理             SECTION.                    
003240 受取手形ファイル読込処理−ＳＴＡＲＴ.                                
003250*                                                                 
003260     READ  入力ファイル２                                         
003270        AT END                                                    
003280           MOVE  "Y"                  TO  Ｗ−終了−フラグ２      
003290           MOVE  HIGH-VALUE           TO  Ｗ−Ｎ−契約ＮＯ２        
003300           GO    TO   受取手形ファイル読込処理−ＥＸＩＴ              
003310     END-READ.                                                    
003320*                                                                 
003330*--< ファイル読込状態判定 >                                       
003340     EVALUATE  Ｗ−状態                                           
003350        WHEN  ZERO                                                
003360           MOVE  入力２−契約ＮＯ     TO  Ｗ−Ｎ−契約ＮＯ２         
003370           MOVE  入力２−束数         TO  Ｗ−Ｎ−束数         
003380           MOVE  入力２−支払人コード TO  ＷＳ−支払人コード        
003390*--<       受取手形ファイル入力件数の加算 >                           
003400           COMPUTE  Ｗ−入力−件数２ = Ｗ−入力−件数２ + 1      
003410        WHEN  OTHER                                               
003420*--<       受取手形ファイル読込エラー >                               
003430           MOVE     -50               TO  Ｗ−エラーコード        
003440           PERFORM  エラー処理                                    
003450     END-EVALUATE.                                                
003460*                                                                 
003470 受取手形ファイル読込処理−ＥＸＩＴ.                                  
003480     EXIT.                                                        
003490******************************************************************
003500*    主処理                                                      *
003510******************************************************************
003520 主処理                               SECTION.                    
003530 主処理−ＳＴＡＲＴ.                                              
003540*                                                                 
003550     EVALUATE  TRUE                                               
003560*--<    手形基本ファイルのみの場合 >                                  
003570        WHEN  Ｗ−Ｎ−契約ＮＯ１ > Ｗ−Ｎ−契約ＮＯ２                 
003580           PERFORM  受取手形ファイル読込処理                      
003590*                                                                 
003600*--<    マッチングの場合 >                                        
003610        WHEN  Ｗ−Ｎ−契約ＮＯ１ = Ｗ−Ｎ−契約ＮＯ２                 
003620           PERFORM  マッチング編集出力処理                                  
003630*                                                                 
003640           PERFORM  受取手形ファイル読込処理                      
003650*                                                                 
003660*--<    受取手形ファイルのみの場合 >                              
003670        WHEN  Ｗ−Ｎ−契約ＮＯ１ < Ｗ−Ｎ−契約ＮＯ２
                 IF Ｗ−Ｎ−契約ＮＯ１ NOT = Ｗ−Ｏ−契約ＮＯ１
		    DISPLAY "***** COBIS630:受取手形ファイルなし ", 
                            "契約ＮＯ=" , Ｗ−Ｎ−契約ＮＯ１
                 END-IF
003680           PERFORM  手形基本ファイル読込処理                      
003690*                                                                 
003700     END-EVALUATE.                                                
003710*                                                                 
003720 主処理−ＥＸＩＴ.                                                
003730     EXIT.                                                        
003740******************************************************************
003750*    マッチング編集出力処理                                      *
003760******************************************************************
003770 マッチング編集出力処理               SECTION.                    
003780 マッチング編集出力処理−ＳＴＡＲＴ.                              
003790     PERFORM 受取手形テーブル編集.
003800*                                                                 
003830	   PERFORM 受取手形展開テーブル編集.
003820*                                                                 
007000     IF     Ｗ−Ｎ−契約ＮＯ１ = Ｗ−Ｏ−契約ＮＯ１
007010        AND Ｗ−Ｎ−束数       = Ｗ−Ｏ−束数 
003850           PERFORM 受取手形展開テーブル出力
007030     ELSE
003810           PERFORM 受取手形テーブル出力
003850           PERFORM 受取手形展開テーブル出力
007050     END-IF.
007400*
007380	   MOVE Ｗ−Ｎ−契約ＮＯ１          TO  Ｗ−Ｏ−契約ＮＯ１.             
007390	   MOVE Ｗ−Ｎ−束数                TO  Ｗ−Ｏ−束数.             
007400*
003860 マッチング編集出力処理−ＥＸＩＴ.                              
003870******************************************************************
003880*     受取手形テーブル編集                                       *
003890******************************************************************
003900 受取手形テーブル編集                 SECTION.                    
003910 受取手形テーブル編集−ＳＴＡＲＴ.                                        
003920*----------------------------------------------------------------*
003930*       初期化処理                                               *
003940*----------------------------------------------------------------*
003950        MOVE  SPACE                   TO  受取手形.                  
003960        INITIALIZE                        受取手形.                  
003970*----------------------------------------------------------------*
003980*       項目編集処理                                             *
003990*----------------------------------------------------------------*
004000*--<    No.01 >                                                   
004010        MOVE  入力１−契約ＮＯ        TO  Ｄ６４２−代表契約番号.        
004020*--<    No.02 >                                                   
004030        MOVE  入力２−束数            TO  Ｄ６４２−束数.        
004040*--<    No.03 AND No.04 >                                                              
004050        PERFORM 取引先コードと契約先コード項目抽出.
004060        MOVE  ＩＫＯ００１−新取引先コード
004070                                      TO  Ｄ６４２−取引先コード.        
004080        MOVE  ＩＫＯ００１−枝番      TO  Ｄ６４２−契約先コード.        
004090*--<    No.05 >                                                   
004100        MOVE  入力１−名称漢字        TO  Ｄ６４２−契約先名称.        
004110*--<    No.06 >                                                   
004120        MOVE  入力１−名称カナ        TO Ｄ６４２−契約先名称カナ.        
004130*--<    No.07 >                                                   
004140        MOVE  入力１−事業所コード    TO  Ｄ６４２−部店コード.        
004150*--<    No.08 >                                                              
004160        PERFORM 主契約区分項目抽出.
004170        MOVE ＩＫＯ００２−主契約区分 TO  Ｄ６４２−主契約区分.        
004180*--<    No.09 >                                                   
004190        MOVE  ZERO                    TO  Ｄ６４２−手形状態.        
004200*--<    No.10 >                                                   
004230        MOVE  入力２−取引日          TO  Ｗ−入力日期.  
004160        PERFORM 日期処理.
004210        MOVE  Ｗ−出力日期            TO  Ｄ６４２−取引日.
004220*--<    No.11 >                      
004230        MOVE  入力２−伝票発行日      TO  Ｗ−入力日期.  
004160        PERFORM 日期処理.
004210        MOVE  Ｗ−出力日期            TO  Ｄ６４２−伝票発行日.  
004240*--<    No.12 >                         
004250        MOVE  入力２−手形種類        TO  Ｄ６４２−手形種類.    
004260*--<    No.13 >                         
004230        MOVE  入力２−期日基準日      TO  Ｗ−入力日期.  
004160        PERFORM 日期処理.
004210        MOVE  Ｗ−出力日期            TO  Ｄ６４２−期日基準日.  
004280*--<    No.14 >                          
004290        MOVE  入力２−期日サイクル    TO  Ｄ６４２−期日サイクル.
004300*--<    No.15 >                                                 
004310        MOVE  入力２−束合計金額      TO  Ｄ６４２−束合計金額.  
004320*--<    No.16 >                          
004330        MOVE  入力２−手形枚数        TO  Ｄ６４２−手形枚数.    
004340*--<    No.17 >                          
004350        MOVE  入力２−取立依頼銀行コード
004360                                     TO Ｄ６４２−取立銀行コード.
004370*--<    No.18 >                                                 
004380        MOVE  入力２−支払銀行コード TO Ｄ６４２−支払銀行コード.
004390*--<    No.19 >                                                                                           
004400        MOVE  入力１−契約ＮＯ１      TO  Ｄ６４２−契約番号１. 
004410*--<    No.20 >                         
004420        MOVE  入力１−契約ＮＯ２      TO  Ｄ６４２−契約番号２.  
004430*--<    No.21 >                          
004440        MOVE  入力１−契約ＮＯ３      TO  Ｄ６４２−契約番号３.  
004450*--<    No.22 >                          
004460        MOVE  入力１−契約ＮＯ４      TO  Ｄ６４２−契約番号４.  
004470*--<    No.23 >                           
004480        MOVE  入力１−契約ＮＯ５      TO  Ｄ６４２−契約番号５.  
004490*--<    No.24 >                          
004500        MOVE  入力１−契約ＮＯ６      TO  Ｄ６４２−契約番号６.  
004510*--<    No.25 >                         
004520        MOVE  入力１−契約ＮＯ７      TO  Ｄ６４２−契約番号７.  
004530*--<    No.26 >                          
004540        MOVE  入力１−契約ＮＯ８      TO  Ｄ６４２−契約番号８.  
004550*--<    No.27 >                          
004560        MOVE  入力１−契約ＮＯ９      TO  Ｄ６４２−契約番号９.  
004570*--<    No.28>                           
004580        MOVE  入力１−契約ＮＯ１０    TO  Ｄ６４２−契約番号１０.
004590*--<    No.29 >                                                
004600        MOVE  入力２−備考欄          TO  Ｄ６４２−備考欄.   
004610*--<    No.30>
004620        MOVE  ZERO                    TO  Ｄ６４２−手形内容種別.
004630*--<    No.31 >                                                 
004640        MOVE  Ｗ−システム日付        TO  Ｄ６４２−登録年月日.  
004650*--<    No.32 >                           
004660        MOVE  Ｗ−システム時刻        TO  Ｄ６４２−登録時間.    
004670*--<    No.33 >                           
004680        MOVE  Ｗ−担当者              TO  Ｄ６４２−登録担当者.  
004690*--<    No.34 >                           
004700        MOVE  Ｗ−システム日付        TO  Ｄ６４２−更新年月日.  
004710*--<    No.35 >                           
004720        MOVE  Ｗ−システム時刻        TO  Ｄ６４２−更新時間.    
004730*--<    No.36 >                           
004740        MOVE  Ｗ−担当者              TO  Ｄ６４２−更新者.      
004750*--<    No.37 >                           
004760        MOVE  Ｗ−担当者          TO  Ｄ６４２−入力担当者コード.
004770*--<    No.38 >                          
004780        MOVE  ZERO                    TO  Ｄ６４２−売却代金区分.
004790*--<    No.39 AND No.40 >                          
004800        PERFORM 振出人取引先コードと契約先コード項目抽出.
004810        MOVE  ＩＫＯ００１−新取引先コード
004820                                  TO Ｄ６４２−振出人取引先コード.
004830        MOVE  ＩＫＯ００１−枝番  TO Ｄ６４２−振出人契約先コード.
004840*--<    No.41>                          
004850        MOVE  入力２−名称漢字        TO  Ｄ６４２−振出人名称.    
004860*--<    No.42 >                          
004870        MOVE  入力２−名称カナ        TO Ｄ６４２−振出人名称カナ.
004880*
004890 受取手形テーブル編集−ＥＸＩＴ.          
004900******************************************************************
004910*     取引先コードと契約先コード項目抽出                         *
004920******************************************************************
004930 取引先コードと契約先コード項目抽出   SECTION.                    
004940 取引先コードと契約先コード項目抽出−ＳＴＡＲＴ.                                        
004950     EXEC SQL                                                    
004960        SELECT  新取引先コード
                     ,枝番
004970	        INTO :ＩＫＯ００１−新取引先コード ,
004980	             :ＩＫＯ００１−枝番
004990	        FROM  IKOTBL001
005000	       WHERE  取引先コード = :ＷＳ−取引先コード 
005010	         AND  目的ＣＤ     = :ＷＳ−目的ＣＤ
005020     END-EXEC.                                                    
005030*----------------------------------------------------------------*
005040*    取引先コードと契約先コード項目抽出確認                      *
005050*----------------------------------------------------------------*
005060     EVALUATE   SQLCODE                                           
005070        WHEN   定数−ＳＱＬＯＫ                                   
005080*--<       正常 >                                                 
005090           CONTINUE                                               
005100        WHEN   OTHER                                              
005110*--<       取引先コードと契約先コード項目抽出失敗>
                 MOVE      SPACE         TO ＩＫＯ００１−新取引先コード
                 MOVE      SPACE         TO ＩＫＯ００１−枝番
005120           MOVE      -60           TO  Ｗ−エラーコード        
005130           PERFORM   エラー処理                                   
005140     END-EVALUATE.                                                
005150*                                                                 
005160 取引先コードと契約先コード項目抽出−ＥＸＩＴ.                            
005170******************************************************************
005180*     主契約区分項目抽出                                         *
005190******************************************************************
005200 主契約区分項目抽出                   SECTION.                    
005210 主契約区分項目抽出−ＳＴＡＲＴ.                                        
005220     EXEC SQL                                                     
005230        SELECT  主契約区分
005240	        INTO :ＩＫＯ００２−主契約区分
005250	        FROM  IKOTBL002
005260	       WHERE  契約ＮＯ = :ＷＳ−契約ＮＯ
005270     END-EXEC.                                                    
005280*----------------------------------------------------------------*
005290*    主契約区分項目抽出確認                                      *
005300*----------------------------------------------------------------*
005310     EVALUATE   SQLCODE                                           
005320        WHEN   定数−ＳＱＬＯＫ                                   
005330*--<       正常 >                                                 
005340           CONTINUE                                               
005350        WHEN   定数−ＳＱＬＬＯＴ                              
005360*--<       正常 >                                                 
005370           CONTINUE                                               
005380        WHEN   OTHER                                              
005390*--<       主契約区分項目抽出失敗>                          
                 MOVE      SPACE            TO ＩＫＯ００２−主契約区分  
005400           MOVE      -70              TO  Ｗ−エラーコード        
005410           PERFORM   エラー処理                                   
005420     END-EVALUATE.                                                
005430*                                                                 
005440 主契約区分項目抽出−ＥＸＩＴ.                            
005170******************************************************************
005180*     日期処理                                                   *
005190******************************************************************
005200 日期処理                   SECTION.                    
005210 日期処理−ＳＴＡＲＴ.                                        
005430*  
	   EVALUATE Ｗ−入力日期 
010500        WHEN  ZERO                                                 
	         MOVE   ZERO                TO Ｗ−出力日期
010500        WHEN  OTHER                                                 
010490           EVALUATE  Ｗ−入力日期(1:1)                           
010500              WHEN  "1"                                                 
	               MOVE "20"            TO Ｗ−出力日期(1:2)
010520              WHEN  "0"                                                 
	               MOVE "19"            TO Ｗ−出力日期(1:2)
010540           END-EVALUATE                                                
	         MOVE Ｗ−入力日期(2:6)     TO Ｗ−出力日期(3:6)
010540     END-EVALUATE.                                                
005430*                                                                 
005440 日期処理−ＥＸＩＴ.                            
005450******************************************************************
005460*     振出人取引先コードと契約先コード項目抽出                   *
005470******************************************************************
005480 振出人取引先コードと契約先コード項目抽出  SECTION.                    
005490 振出人取引先コードと契約先コード項目抽出−ＳＴＡＲＴ.                                        
005500     EXEC SQL                                                    
005510        SELECT  新取引先コード
                     ,枝番
005520	        INTO :ＩＫＯ００１−新取引先コード ,
005530	             :ＩＫＯ００１−枝番
005540	        FROM  IKOTBL001
005550	       WHERE  取引先コード = :ＷＳ−支払人コード 
005560	         AND  目的ＣＤ     = :ＷＳ−目的ＣＤ
005570     END-EXEC.                                                    
005580*----------------------------------------------------------------*
005590*    振出人取引先コードと契約先コード項目抽出確認                *
005600*----------------------------------------------------------------*
005610     EVALUATE   SQLCODE                                           
005620        WHEN   定数−ＳＱＬＯＫ                                   
005630*--<       正常 >                                                 
005640           CONTINUE                                               
005650        WHEN   OTHER                                              
005660*--<       振出人取引先コードと契約先コード項目抽出失敗>                          
                 MOVE      SPACE         TO ＩＫＯ００１−新取引先コード
                 MOVE      SPACE         TO ＩＫＯ００１−枝番
005670           MOVE      -80           TO  Ｗ−エラーコード        
005680           PERFORM   エラー処理                                   
005690     END-EVALUATE.                                                
005700*                                                                 
005710 振出人取引先コードと契約先コード項目抽出−ＥＸＩＴ.                            
006820******************************************************************
006830*     受取手形展開テーブル編集                                   *
006840******************************************************************
006850 受取手形展開テーブル編集             SECTION.                    
006860 受取手形展開テーブル編集−ＳＴＡＲＴ.                                        
006870*----------------------------------------------------------------*
006880*       初期化処理                                               *
006890*----------------------------------------------------------------*
006900        MOVE  SPACE                   TO  受取手形展開.                  
006910        INITIALIZE                        受取手形展開.                  
006920*----------------------------------------------------------------*
006930*       項目編集処理                                             *
006940*----------------------------------------------------------------*
006950*--<    No.01 >                                                   
006960        MOVE  入力１−契約ＮＯ        TO  Ｄ６４５−代表契約番号.        
006970*--<    No.02 >                                                   
006980        MOVE  入力２−束数            TO  Ｄ６４５−束数.        
006990*--<    No.03 >                                                              
007000        IF     Ｗ−Ｎ−契約ＮＯ１ = Ｗ−Ｏ−契約ＮＯ１
007010           AND Ｗ−Ｎ−束数       = Ｗ−Ｏ−束数 
007020              COMPUTE  Ｗ−連番  =  Ｗ−連番  +  1
007030        ELSE
007040              MOVE  1                 TO  Ｗ−連番
007050        END-IF.
007040        MOVE  Ｗ−連番                TO  Ｄ６４５−連番
007060*--<    No.04 >                                                              
007070        MOVE  入力２−手形ＮＯ        TO  Ｄ６４５−手形番号.        
007080*--<    No.05 >                                                   
004230        MOVE  入力２−期日            TO  Ｗ−入力日期.  
004160        PERFORM 日期処理.
004210        MOVE  Ｗ−出力日期            TO  Ｄ６４５−期日.         
007100*--<    No.06 >                                                   
007110        MOVE  入力２−金額            TO  Ｄ６４５−金額.         
007120*--<    No.07 >                                                   
007130        MOVE  ＩＫＯ００１−新取引先コード
007140                                  TO Ｄ６４５−振出人取引先コード.
007150*--<    No.08 >                                                   
007160        MOVE  ＩＫＯ００１−枝番  TO Ｄ６４５−振出人契約先コード.
007170*--<    No.09 >                                                   
007180        MOVE  入力２−名称漢字        TO  Ｄ６４５−振出人名称.   
007190*--<    No.10 >                                                   
007200        MOVE  入力２−名称カナ        TO  Ｄ６４５−振出人名称カナ.
007210*--<    No.31 >                                                 
007220        MOVE  Ｗ−システム日付        TO  Ｄ６４５−登録年月日.  
007230*--<    No.32 >                           
007240        MOVE  Ｗ−システム時刻        TO  Ｄ６４５−登録時間.    
007250*--<    No.33 >                           
007260        MOVE  Ｗ−担当者              TO  Ｄ６４５−登録担当者.  
007270*--<    No.34 >                           
007280        MOVE  Ｗ−システム日付        TO  Ｄ６４５−更新年月日.  
007290*--<    No.35 >                           
007300        MOVE  Ｗ−システム時刻        TO  Ｄ６４５−更新時間.    
007310*--<    No.36 >                           
007320        MOVE  Ｗ−担当者              TO  Ｄ６４５−更新者.      
007330*--<    No.37 >                           
007340        MOVE  Ｗ−担当者          TO  Ｄ６４５−入力担当者コード.
007350*--<    No.37 >                           
007360        MOVE  入力２−手形区分        TO  Ｄ６４５−手形状態.
007370*
007410 受取手形展開テーブル編集−ＥＸＩＴ.          
005720******************************************************************
005730*    受取手形テーブル出力                                        *
005740******************************************************************
005750 受取手形テーブル出力                 SECTION.                    
005760 受取手形テーブル出力−ＳＴＡＲＴ.                                            
005770*                                                                 
005780       EXEC  SQL                                                  
005790        INSERT  INTO  D642UTG_TBL                                  
005800           ( 代表契約番号           
005810            ,束数                   
005820            ,取引先コード           
005830            ,契約先コード           
005840            ,契約先名称             
005850            ,契約先名称カナ         
005860            ,部店コード             
005870            ,主契約区分             
005880            ,手形状態               
005890            ,取引日                 
005900            ,伝票発行日             
005910            ,手形種類               
005920            ,期日基準日             
005930            ,期日サイクル           
005940            ,束合計金額             
005950            ,手形枚数               
005960            ,取立銀行コード     
005970            ,支払銀行コード     
005980            ,契約番号１         
005990            ,契約番号２         
006000            ,契約番号３         
006010            ,契約番号４         
006020            ,契約番号５         
006030            ,契約番号６         
006040            ,契約番号７         
006050            ,契約番号８         
006060            ,契約番号９         
006070            ,契約番号１０       
006080            ,備考欄             
006090            ,手形内容種別       
006100            ,登録年月日         
006110            ,登録時間           
006120            ,登録担当者         
006130            ,更新年月日         
006140            ,更新時間           
006150            ,更新者             
006160            ,入力担当者コード   
006170            ,売却代金区分       
006180            ,振出人取引先コード 
006190            ,振出人契約先コード 
006200            ,振出人名称         
006210            ,振出人名称カナ )
006220      VALUES                                                     
006230           ( :Ｄ６４２−代表契約番号         
006240            ,:Ｄ６４２−束数                 
006250            ,:Ｄ６４２−取引先コード         
006260            ,:Ｄ６４２−契約先コード         
006270            ,:Ｄ６４２−契約先名称           
006280            ,:Ｄ６４２−契約先名称カナ         
006290            ,:Ｄ６４２−部店コード           
006300            ,:Ｄ６４２−主契約区分           
006310            ,:Ｄ６４２−手形状態             
006320            ,:Ｄ６４２−取引日               
006330            ,:Ｄ６４２−伝票発行日           
006340            ,:Ｄ６４２−手形種類             
006350            ,:Ｄ６４２−期日基準日                 
006360            ,:Ｄ６４２−期日サイクル               
006370            ,:Ｄ６４２−束合計金額                 
006380            ,:Ｄ６４２−手形枚数                   
006390            ,:Ｄ６４２−取立銀行コード            
006400            ,:Ｄ６４２−支払銀行コード               
006410            ,:Ｄ６４２−契約番号１                 
006420            ,:Ｄ６４２−契約番号２                 
006430            ,:Ｄ６４２−契約番号３                 
006440            ,:Ｄ６４２−契約番号４                 
006450            ,:Ｄ６４２−契約番号５                 
006460            ,:Ｄ６４２−契約番号６                 
006470            ,:Ｄ６４２−契約番号７  
006480            ,:Ｄ６４２−契約番号８  
006490            ,:Ｄ６４２−契約番号９  
006500            ,:Ｄ６４２−契約番号１０
006510            ,:Ｄ６４２−備考欄      
006520            ,:Ｄ６４２−手形内容種別
006530            ,:Ｄ６４２−登録年月日  
006540            ,:Ｄ６４２−登録時間    
006550            ,:Ｄ６４２−登録担当者  
006560            ,:Ｄ６４２−更新年月日  
006570            ,:Ｄ６４２−更新時間    
006580            ,:Ｄ６４２−更新者      
006590            ,:Ｄ６４２−入力担当者コード 
006600            ,:Ｄ６４２−売却代金区分
006610            ,:Ｄ６４２−振出人取引先コード 
006620            ,:Ｄ６４２−振出人契約先コード 
006630            ,:Ｄ６４２−振出人名称  
006640            ,:Ｄ６４２−振出人名称カナ )
006650     END-EXEC.                                                    
006660*                                                                 
006670*----------------------------------------------------------------*
006680*    受取手形テーブル出力(追加)処理を確認                                              *
006690*----------------------------------------------------------------*
006700     EVALUATE  SQLCODE                                            
006710        WHEN   定数−ＳＱＬＯＫ                                   
006720*--<       追加成功 >                                             
006730           COMPUTE  Ｗ−出力−件数１  =  Ｗ−出力−件数１  +  1       
006740        WHEN   OTHER                                              
006750*--<       追加処理エラー >                                       
006760           MOVE     -90               TO  Ｗ−エラーコード        
006770           PERFORM  エラー処理                                
006780     END-EVALUATE.                                                
006790*                                                                 
006800 受取手形テーブル出力−ＥＸＩＴ.                                              
006810     EXIT.                                                        
007420******************************************************************
007430*    受取手形展開テーブル出力                                    *
007440******************************************************************
007450 受取手形展開テーブル出力             SECTION.                    
007460 受取手形展開テーブル出力−ＳＴＡＲＴ.                                            
007470*                                                                 
007480     EXEC  SQL                                                  
007490        INSERT  INTO  D645UTT_TBL                                  
007500           ( 代表契約番号      
007510            ,束数              
007520            ,連番              
007530            ,手形番号          
007540            ,期日              
007550            ,金額              
007560            ,振出人取引先コード
007570            ,振出人契約先コード
007580            ,振出人名称        
007590            ,振出人名称カナ    
007600            ,登録年月日        
007610            ,登録時間          
007620            ,登録担当者        
007630            ,更新年月日        
007640            ,更新時間          
007650            ,更新者            
007660            ,入力担当者コード  
007670            ,手形状態 )         
007920        VALUES                                                     
007930           ( :Ｄ６４５−代表契約番号
007940            ,:Ｄ６４５−束数        
007960            ,:Ｄ６４５−連番        
007970            ,:Ｄ６４５−手形番号    
007980            ,:Ｄ６４５−期日        
007990            ,:Ｄ６４５−金額        
008000            ,:Ｄ６４５−振出人取引先コード
008020            ,:Ｄ６４５−振出人契約先コード
008040            ,:Ｄ６４５−振出人名称  
008050            ,:Ｄ６４５−振出人名称カナ
008070            ,:Ｄ６４５−登録年月日  
008080            ,:Ｄ６４５−登録時間    
008090            ,:Ｄ６４５−登録担当者  
008100            ,:Ｄ６４５−更新年月日  
008110            ,:Ｄ６４５−更新時間    
008120            ,:Ｄ６４５−更新者      
008130            ,:Ｄ６４５−入力担当者コード
008150            ,:Ｄ６４５−手形状態 )   
008160     END-EXEC.                                                    
008360*                                                                 
008370*----------------------------------------------------------------*
008380*    受取手形展開テーブル出力(追加)処理を確認                    *
008390*----------------------------------------------------------------*
008400     EVALUATE  SQLCODE                                            
008410        WHEN   定数−ＳＱＬＯＫ                                   
008420*--<       追加成功 >                                             
008430           COMPUTE  Ｗ−出力−件数２ =  Ｗ−出力−件数２ +  1       
008440        WHEN   OTHER                                              
008450*--<       追加処理エラー >                                       
008460           MOVE     -100              TO  Ｗ−エラーコード        
008470           PERFORM  エラー処理                                
008480     END-EVALUATE.                                                
008490*                                                                 
008500 受取手形展開テーブル出力−ＥＸＩＴ.                                              
008510     EXIT.                                                        
008560******************************************************************
008570*    終了処理                                                    *
008580******************************************************************
008590 終了処理                             SECTION.                    
008600 終了処理−ＳＴＡＲＴ.                                            
008610*                                                                 
008620     PERFORM  ファイルクローズ処理.                               
008630*                                                                 
008640     PERFORM  ＤＢコミット処理.                                   
011180*                                    
011190     PERFORM  件数メッセージ出力処理                            
011200*                                                                 
011190     PERFORM  終了メッセージ出力                               
011200*                                                                 
008680*--< プログラム正常終了 >                                         
008690     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
008700*                                                                 
008710 終了処理−ＥＸＩＴ.                                              
008720     EXIT.                                                        
008730******************************************************************
008740*    ファイルクローズ処理                                        *
008750******************************************************************
008760 ファイルクローズ処理                 SECTION.                    
008770 ファイルクローズ処理−ＳＴＡＲＴ.                                
008780*                                                                 
008790     CLOSE  入力ファイル１.                                         
008800     CLOSE  入力ファイル２.                                         
008810*                                                                 
008820 ファイルクローズ処理−ＥＸＩＴ.                                  
008830     EXIT.                                                        
008840******************************************************************
008850*    件数メッセージ出力処理                                      *
008860******************************************************************
008870 件数メッセージ出力処理               SECTION.                    
008880 件数メッセージ出力処理−ＳＴＡＲＴ.                                  
008890*                                                                 
008900*----------------------------------------------------------------*
008910*    件数メッセージ出力処理                                      *
008920*----------------------------------------------------------------*
008930     INITIALIZE                       IF-CHOCO001.                
008940     MOVE  "3"                        TO  共１−イベント種別.     
008950     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008960     MOVE  "0"                        TO  共１−復帰コード.       
008970     MOVE  "FFUIS630"                 TO  共１−処理テーブルＩＤ. 
008980     MOVE  "COUNT"                    TO  共１−処理識別.         
008990     MOVE  Ｗ−入力−件数１           TO  共１−データ内容.       
009000     MOVE  "手形基本読込件数"         TO  共１−その他メッセージ. 
009020     CALL  CLOCO001                USING  IF-CHOCO001.            
009030*                                                                 
009040     INITIALIZE                       IF-CHOCO001.                
009050     MOVE  "3"                        TO  共１−イベント種別.     
009060     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009070     MOVE  "0"                        TO  共１−復帰コード.       
009080     MOVE  "FFUIS631"                 TO  共１−処理テーブルＩＤ. 
009090     MOVE  "COUNT"                    TO  共１−処理識別.         
009100     MOVE  Ｗ−入力−件数２           TO  共１−データ内容.       
009110     MOVE  "受取手形読込件数"         TO  共１−その他メッセージ. 
009130     CALL  CLOCO001                USING  IF-CHOCO001.            
009140*                                                                 
009150     INITIALIZE                       IF-CHOCO001.                
009160     MOVE  "3"                        TO  共１−イベント種別.     
009170     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009180     MOVE  "0"                        TO  共１−復帰コード.       
009190     MOVE  "D642UTG"                  TO  共１−処理テーブルＩＤ. 
009200     MOVE  "COUNT"                    TO  共１−処理識別.         
009210     MOVE  Ｗ−出力−件数１           TO  共１−データ内容.       
009220     MOVE  "受取手形出力件数"         TO  共１−その他メッセージ. 
009230     CALL  CLOCO001                USING  IF-CHOCO001.            
009240*                                                                 
009250     INITIALIZE                       IF-CHOCO001.                
009260     MOVE  "3"                        TO  共１−イベント種別.     
009270     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009280     MOVE  "0"                        TO  共１−復帰コード.       
009290     MOVE  "D645UTT"                  TO  共１−処理テーブルＩＤ. 
009300     MOVE  "COUNT"                    TO  共１−処理識別.         
009310     MOVE  Ｗ−出力−件数２           TO  共１−データ内容.       
009320     MOVE  "受取手形展開出力件数"     TO  共１−その他メッセージ. 
009340     CALL  CLOCO001                USING  IF-CHOCO001.            
009460*                                                                 
009470 件数メッセージ出力処理−ＥＸＩＴ.                                    
009480     EXIT.                                                        
008840******************************************************************
008850*    終了メッセージ出力                                          *
008860******************************************************************
008870 終了メッセージ出力                   SECTION.                    
008880 終了メッセージ出力−ＳＴＡＲＴ.                                  
008890*                                                                 
009360*----------------------------------------------------------------*
009370*    終了メッセージ出力                                          *
009380*----------------------------------------------------------------*
009390     INITIALIZE                       IF-CHOCO001.                
009400     MOVE  "3"                        TO  共１−イベント種別.     
009410     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009420     MOVE  "0"                        TO  共１−復帰コード.       
009430     MOVE  "END"                      TO  共１−処理識別.         
009440     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
009450     CALL  CLOCO001                USING  IF-CHOCO001.            
009460*                                                                 
009470 終了メッセージ出力−ＥＸＩＴ.                                    
009480     EXIT.                                                        
009490******************************************************************
009500*    ＤＢコミット処理                                            *
009510******************************************************************
009520 ＤＢコミット処理                     SECTION.                    
009530 ＤＢコミット処理−ＳＴＡＲＴ.                                    
009540*                                                                 
009550     EXEC  SQL                                                    
009560        COMMIT  WORK  RELEASE                                     
009570     END-EXEC.                                                    
009580*                                                                 
009590     INITIALIZE                       IF-CHOCO001.                
009600     MOVE  "3"                        TO  共１−イベント種別.     
009610     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009620     MOVE  "0"                        TO  共１−復帰コード.       
009630     MOVE  "COMMIT"                   TO  共１−処理識別.         
009640     MOVE  "コミット実施"             TO  共１−その他メッセージ. 
009650     CALL  CLOCO001                USING  IF-CHOCO001.            
009660*                                                                 
009670 ＤＢコミット処理−ＥＸＩＴ.                                      
009680     EXIT.                                                        
009690******************************************************************
009700*    ＤＢロールバック処理                                        *
009710******************************************************************
009720 ＤＢロールバック処理                 SECTION.                    
009730 ＤＢロールバック処理−ＳＴＡＲＴ.                                
009740*                                                                 
009750     EXEC  SQL                                                    
009760        ROLLBACK WORK  RELEASE                                    
009770     END-EXEC.                                                    
009780*                                                                 
009790     INITIALIZE                       IF-CHOCO001.                
009800     MOVE  "1"                        TO  共１−イベント種別.     
009810     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009820     MOVE  "9"                        TO  共１−復帰コード.       
009830     MOVE  "ROLLBACK"                 TO  共１−処理識別.         
009840     MOVE  "ロールバック実施"         TO  共１−その他メッセージ. 
009850     CALL  CLOCO001                USING  IF-CHOCO001.            
009860*                                                                 
009870 ＤＢロールバック処理−ＥＸＩＴ.                                  
009880     EXIT.                                                        
009890******************************************************************
009900*    エラー処理                                                  *
009910******************************************************************
009920 エラー処理                           SECTION.                    
009930 エラー処理−ＳＴＡＲＴ.                                          
009940*                                                                 
009950     MOVE  "Y"                        TO Ｗ−異常終了−フラグ.    
009960     INITIALIZE                          IF-CHOCO001.             
009970*                                                                 
009980     EVALUATE  Ｗ−エラーコード                                   
009990        WHEN  -10                                                 
010000*--<       ＯＲＡＣＬＥ接続失敗 >                                 
010010           MOVE  "1"                  TO  共１−イベント種別      
010020           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010030           MOVE  "9"                  TO  共１−復帰コード        
010040           MOVE  "CONNECT"            TO  共１−処理識別          
010050           MOVE  SQLCODE              TO  共１−データ内容        
010060           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010070           CALL  CLOCO001          USING  IF-CHOCO001             
010080*                                                                 
010090        WHEN  -20                                                 
010100*--<       入力ファイル１オープン失敗 >               
010110           MOVE  "1"                  TO  共１−イベント種別      
010120           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010130           MOVE  "9"                  TO  共１−復帰コード        
010140           MOVE  "FFUIS630"           TO  共１−処理テーブルＩＤ  
010150           MOVE  "OPEN"               TO  共１−処理識別          
010160           MOVE  Ｗ−状態             TO  共１−データ内容        
010170           MOVE  "入力ファイル１オープン失敗(手形基本ファイル)"         
010180                                      TO  共１−その他メッセージ  
010190           CALL  CLOCO001          USING  IF-CHOCO001             
010200*                                                                 
010210        WHEN  -30                                                 
010220*--<       入力ファイル２ルオープン失敗 >               
010230           MOVE  "1"                  TO  共１−イベント種別      
010240           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010250           MOVE  "9"                  TO  共１−復帰コード        
010260           MOVE  "FFUIS631"           TO  共１−処理テーブルＩＤ  
010270           MOVE  "OPEN"               TO  共１−処理識別          
010280           MOVE  Ｗ−状態             TO  共１−データ内容        
010290           MOVE  "入力ファイル２オープン失敗(受取手形ファイル)"         
010300                                      TO  共１−その他メッセージ  
010310           CALL  CLOCO001          USING  IF-CHOCO001             
010320*                                                                 
010330        WHEN  -40                                                  
010340*--<       手形基本ファイル読込エラー >                           
010350           MOVE  "1"                  TO  共１−イベント種別      
010360           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010370           MOVE  "9"                  TO  共１−復帰コード        
010380           MOVE  "FFUIS630"           TO  共１−処理テーブルＩＤ  
010390           MOVE  "READ"               TO  共１−処理識別          
010400           MOVE  Ｗ−状態             TO  共１−データ内容        
010410           MOVE  "手形基本ファイル読込エラー "                    
010420                                      TO  共１−その他メッセージ  
010430           CALL  CLOCO001          USING  IF-CHOCO001             
010440*                                                                 
010450        WHEN  -50                                                  
010460*--<       受取手形ファイル読込エラー >                           
010470           MOVE  "1"                  TO  共１−イベント種別      
010480           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010490           MOVE  "9"                  TO  共１−復帰コード        
010500           MOVE  "FFUIS631"           TO  共１−処理テーブルＩＤ  
010510           MOVE  "READ"               TO  共１−処理識別          
010520           MOVE  Ｗ−状態             TO  共１−データ内容        
010530           MOVE  "受取手形ファイル読込エラー "                    
010540                                      TO  共１−その他メッセージ  
010550           CALL  CLOCO001          USING  IF-CHOCO001             
010560*                                                                 
010570        WHEN  -60                                                  
010580*--<       取引先コードと契約先コード項目抽出エラー >                           
010590           MOVE  "2"                  TO  共１−イベント種別      
010600           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010610           MOVE  "9"                  TO  共１−復帰コード        
010620           MOVE  "IKOTBL01"          TO  共１−処理テーブルＩＤ  
010630           MOVE  "SELECT"             TO  共１−処理識別          
010640           MOVE  SQLCODE              TO  共１−データ内容        
010650           MOVE  SQLERRMC  	    TO  共１−その他メッセージ  
010660           CALL  CLOCO001          USING  IF-CHOCO001             
011130           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
010670*                                                                 
010680        WHEN  -70                                                  
010690*--<       主契約区分項目抽出エラー >                           
010700           MOVE  "2"                  TO  共１−イベント種別      
010710           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010720           MOVE  "9"                  TO  共１−復帰コード        
010730           MOVE  "IKOTBL02"          TO  共１−処理テーブルＩＤ  
010740           MOVE  "SELECT"             TO  共１−処理識別          
010750           MOVE  SQLCODE              TO  共１−データ内容        
010760           MOVE  SQLERRMC  	    TO  共１−その他メッセージ  
010770           CALL  CLOCO001          USING  IF-CHOCO001             
011130           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
010780*                                                                 
010790        WHEN  -80                                                  
010800*--<       振出人取引先コードと契約先コード項目抽出エラー >                           
010810           MOVE  "2"                  TO  共１−イベント種別      
010820           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010830           MOVE  "9"                  TO  共１−復帰コード        
010840           MOVE  "IKOTBL01"          TO  共１−処理テーブルＩＤ  
010850           MOVE  "SELECT"             TO  共１−処理識別          
010860           MOVE  SQLCODE              TO  共１−データ内容        
010870           MOVE  SQLERRMC  	    TO  共１−その他メッセージ  
010880           CALL  CLOCO001          USING  IF-CHOCO001             
011130           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
010890*                                                                 
010900        WHEN  -90                                                  
010910*--<       受取手形テーブル出力(追加)失敗 >                                   
010920           MOVE  "1"                  TO  共１−イベント種別      
010930           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010940           MOVE  "9"                  TO  共１−復帰コード        
010950           MOVE  "D642UTG"            TO  共１−処理テーブルＩＤ  
010960           MOVE  "INSERT"             TO  共１−処理識別          
010970           MOVE  SQLCODE              TO  共１−データ内容        
010980           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010990           CALL  CLOCO001          USING  IF-CHOCO001             
011000*                                                                 
011010        WHEN  -100                                                  
011020*--<       受取手形展開テーブル出力(追加)失敗 >                                   
011030           MOVE  "1"                  TO  共１−イベント種別      
011040           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011050           MOVE  "9"                  TO  共１−復帰コード        
011060           MOVE  "D645UTT"            TO  共１−処理テーブルＩＤ  
011070           MOVE  "INSERT"             TO  共１−処理識別          
011080           MOVE  SQLCODE              TO  共１−データ内容        
011090           MOVE  SQLERRMC             TO  共１−その他メッセージ  
011100           CALL  CLOCO001          USING  IF-CHOCO001             
011110*                                                                 
011120        WHEN  OTHER                                               
011130           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
011140     END-EVALUATE.                                                
011150*                                                                 
011160     IF Ｗ−異常終了−フラグ  =  "Y"                              
011170        PERFORM  ＤＢロールバック処理                             
011180*                                    
011190        PERFORM  件数メッセージ出力処理                            
011200*                                                                 
011190        PERFORM  終了メッセージ出力                               
011200*                                                                 
011210*--<    プログラム異常終了のリターンコード >                      
011220        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
011230*                                                                 
011240        EXIT  PROGRAM                                             
011250     END-IF.                                                      
011260*                                                                 
011270 エラー処理−ＥＸＩＴ.                                            
011280     EXIT.                                                        
011290******************************************************************
011300*                  END OF PROGRAM                                *
011310******************************************************************