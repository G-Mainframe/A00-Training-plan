000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名    ：前受金受払残高ファイル作成           *
000040*      2. プログラムID    ：AAASED25  (抽出)                     *
000050*      3. 処理概要        ：前受情報ＤＢをメインに、             *
000060*                           マスタと表結合して読込み、           *
000070*                          前受金受払残高中間ファイルを作成する。*
000080*      4. 作成者          ：紀岩                                 *
000090*      5. 作成日          ：2005.03.25                           *
000100******************************************************************
000110*                                                                 
000120******************************************************************
000130*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000140******************************************************************
000150 IDENTIFICATION                       DIVISION.                   
000160*                                                                 
000170 PROGRAM-ID.                          AAASED25.                   
000180******************************************************************
000190*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000200******************************************************************
000210 ENVIRONMENT                          DIVISION.                   
000220******************************************************************
000230*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260 FILE-CONTROL.                                                    
000270*                                                                 
000280     SELECT         出力ファイル      ASSIGN    TO   U11          
000290     FILE STATUS    IS     Ｗ−状態                               
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*    出力ファイル                                                *
000420*----------------------------------------------------------------*
000430 FD  出力ファイル                                                 
000440     LABEL  RECORD    IS              STANDARD                    
000450     BLOCK  CONTAINS  0               RECORDS.                    
000460*                                                                 
000470 01  出力−レコード.                                              
000480     COPY   CPSCE50   REPLACING      ==()==  BY  ==出力−==.      
000490*                                                                 
000500******************************************************************
000510*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000520******************************************************************
000530  WORKING-STORAGE                     SECTION.                    
000540*----------------------------------------------------------------*
000550*    ホスト変数定義エリア                                        *
000560*----------------------------------------------------------------*
000570     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000580 01  項目名称マスタ名称.                                          
000590*--< 項目名称マスタ名称 >                                         
000600	   03  ＷＳ−名称１                 PIC  X(60).                 
000610	   03  ＷＳ−名称２                 PIC  X(60).                 
000620*                                                                 
000630 01 ＷＳ−業務管理ＩＤ                PIC X(08)  VALUE 'GYMKNRRC'.
000640 01 ＷＳ−コードＮＯ１                PIC X(12)  VALUE '038'.     
000650 01 ＷＳ−コードＮＯ２                PIC X(12)  VALUE '005'.     
000660 01 ＷＳ−レコード区分                PIC X(01)  VALUE '1'.       
000670*                                                                 
000680*--< ＯＲＡＣＬＥ共通変数 >                                       
000690     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000700*                                                                 
000710*--< 前受情報ＤＢ >                                               
000720     EXEC  SQL  INCLUDE  M40MAB.CBL            END-EXEC.          
000730*                                                                 
000740*--< 業務管理テーブル >                                           
000750     EXEC  SQL  INCLUDE  D70GYM.CBL            END-EXEC.          
000760*                                                                 
000770*--< 取引先マスタ >                                               
000780     EXEC  SQL  INCLUDE  D01TRS.CBL            END-EXEC.          
000790*                                                                 
000800*--< 請求先マスタ >                                               
000810     EXEC  SQL  INCLUDE  D02SQS.CBL            END-EXEC.          
000820*                                                                 
000830*--< 項目名称マスタ >                                             
000840     EXEC  SQL  INCLUDE  D19MSY.CBL            END-EXEC.          
000850*                                                                 
000860*--< 債権情報（一般）ＤＢ >                                       
000870     EXEC  SQL  INCLUDE  M01SAJ.CBL            END-EXEC.          
000880*                                                                 
000890*--< ＯＲＡＣＬＥ ＳＱＬ実行情報 (SQLCA) >                        
000900     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000910*                                                                 
000920     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000930*                                                                 
000940*----------------------------------------------------------------*
000950*    ＷＯＲＫエリア                                              *
000960*----------------------------------------------------------------*
000970 01  ＷＯＲＫ−エリア.                                            
000980*--< 他社分エリア >                                               
000990     03  他社分エリア.                                            
001000         05  Ｗ−当月消化額１         PIC S9(13).                 
001010         05  Ｗ−当月末残高１         PIC S9(13).                 
001020*                                                                 
001030*--< エラー判定用 >                                               
001040     03  Ｗ−エラーコード             PIC S9(04).                 
001050*                                                                 
001060*--< ファイル状態 >                                               
001070     03  Ｗ−状態エリア.                                          
001080         05  Ｗ−状態                 PIC  X(02).                 
001090*                                                                 
001100*--< フラグアリア >                                               
001110     03  フラグアリア.                                            
001120         05  Ｗ−終了−フラグ         PIC  X(01).                 
001130         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001140*                                                                 
001150*--< 件数エリア >                                                 
001160     03  件数エリア.                                              
001170         05  Ｗ−入力−件数           PIC  9(09).                 
001180         05  Ｗ−出力−件数           PIC  9(09).                 
001190*                                                                 
001200*----------------------------------------------------------------*
001210*    サブルーチン名                                              *
001220*----------------------------------------------------------------*
001230 01  CALL-AREA.                                                   
001240*--< 共通ログサブルーチン >                                       
001250     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001260     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001270*                                                                 
001280*----------------------------------------------------------------*
001290*    ＣＯＰＹ領域                                                *
001300*----------------------------------------------------------------*
001310*--< 共通ログ用パラメータ >                                       
001320 01  IF-CHOCO001.                                                 
001330     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001340*                                                                 
001350*----------------------------------------------------------------*
001360*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001370*----------------------------------------------------------------*
001380 01  PARA-AREA.                                                   
001390     COPY CPBCO001.                                               
001400******************************************************************
001410*    定数用データ定義エリア                                      *
001420******************************************************************
001430 CONSTANT                             SECTION.                    
001440 01  定数領域.                                                    
001450     03  定数−プログラムＩＤ         PIC  X(08) VALUE "AAASED25".
001460     03  定数−プログラム名           PIC  X(80)                  
001470                             VALUE  "前受金受払残高ファイル作成". 
001480     03  定数−ＳＱＬＯＫ             PIC  9(04)  VALUE  ZERO.    
001490     03  定数−ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001500     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001510     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001520******************************************************************
001530*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001540******************************************************************
001550 PROCEDURE                            DIVISION.                   
001560*                                                                 
001570     PERFORM  初期処理.                                           
001580*                                                                 
001590     PERFORM  主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".            
001600*                                                                 
001610     PERFORM  終了処理.                                           
001620*                                                                 
001630     STOP     RUN.                                                
001640*                                                                 
001650******************************************************************
001660*    初期処理                                            <1.0>   *
001670******************************************************************
001680 初期処理                             SECTION.                    
001690 初期処理−ＳＴＡＲＴ.                                            
001700*                                                                 
001710*----------------------------------------------------------------*
001720*    開始メッセージ出力処理                              <1.1>   *
001730*----------------------------------------------------------------*
001740     INITIALIZE                       IF-CHOCO001.                
001750     MOVE  "3"                        TO  共１−イベント種別.     
001760     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001770     MOVE  "0"                        TO  共１−復帰コード.       
001780     MOVE  "START"                    TO  共１−処理識別.         
001790     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001800     CALL  CLOCO001                USING  IF-CHOCO001.            
001810*                                                                 
001820*----------------------------------------------------------------*
001830*    作業領域の初期値処理                                <1.2>   *
001840*----------------------------------------------------------------*
001850     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001860     INITIALIZE                           ＷＯＲＫ−エリア.       
001870*                                                                 
001820*----------------------------------------------------------------*
001830*    ＯＲＡＣＬＥ接続                                    <1.3>   *
001840*----------------------------------------------------------------*
001890     PERFORM   ＯＲＡＣＬＥ接続.                                  
001900*                                                                 
001820*----------------------------------------------------------------*
001830*    業務管理テーブル読込                                <1.4>   *
001840*----------------------------------------------------------------*
001920     PERFORM   業務管理テーブル読込.                              
001930*                                                                 
001820*----------------------------------------------------------------*
001830*    結合テーブルカーソル宣言                            <1.5>   *
001840*----------------------------------------------------------------*
001950     PERFORM  結合テーブルカーソル宣言.                           
001960*                                                                 
001820*----------------------------------------------------------------*
001830*    ファイルオープン                                    <1.6>   *
001840*----------------------------------------------------------------*
001980     PERFORM  ファイルオープン.                                   
001990*                                                                 
001820*----------------------------------------------------------------*
001830*    結合テーブル読込                                    <1.7>   *
001840*----------------------------------------------------------------*
002010     PERFORM  結合テーブル読込.                                   
002020*                                                                 
002030 初期処理−ＥＸＩＴ.                                              
002040     EXIT.                                                        
002050******************************************************************
002060*    主処理                                                      *
002070******************************************************************
002080 主処理                               SECTION.                    
002090 主処理−ＳＴＡＲＴ.                                              
002100*                                                                 
001820*----------------------------------------------------------------*
001830*    項目名称マスタ抽出処理                              <2.1>   *
001840*----------------------------------------------------------------*
002110     PERFORM  項目名称マスタ抽出処理.                             
002120*                                                                 
001820*----------------------------------------------------------------*
001830*    債権情報ＤＢ抽出処理                                <2.2>   *
001840*----------------------------------------------------------------*
002130     PERFORM  債権情報ＤＢ抽出処理.                               
002140*                                                                 
001820*----------------------------------------------------------------*
001830*    ファイル出力判定編集出力処理                        <2.3>   *
001840*----------------------------------------------------------------*
002160     PERFORM  ファイル出力判定編集出力処理.                     
002170*                                                                 
001820*----------------------------------------------------------------*
001830*    結合テーブル読込（２件目以降）                      <2.5>   *
001840*----------------------------------------------------------------*
002190     PERFORM  結合テーブル読込.                                   
002200*                                                                 
002210                                                                  
002220 主処理−ＥＸＩＴ.                                                
002230     EXIT.                                                        
002240******************************************************************
002250*    終了処理                                                    *
002260******************************************************************
002270 終了処理                             SECTION.                    
002280 終了処理−ＳＴＡＲＴ.                                            
002290*                                                                 
002300     PERFORM  ＤＢクローズ処理.                                   
002310*                                                                 
002320*--< ファイルクローズ >                                           
002330*                                                                 
002340     CLOSE    出力ファイル.                                       
002350*                                                                 
002360     PERFORM  終了メッセージ出力.                                 
002370*                                                                 
002380*--< プログラム正常終了 >                                         
002390     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
002400*                                                                 
002410 終了処理−ＥＸＩＴ.                                              
002420     EXIT.                                                        
002430******************************************************************
002440*    ＯＲＡＣＬＥ接続                                            *
002450******************************************************************
002460 ＯＲＡＣＬＥ接続                     SECTION.                    
002470 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002480*                                                                 
002490*--< ＤＢ接続用情報を取得処理 >                                   
002500     CALL  COBCO001                USING  PARA-AREA.              
002510*                                                                 
002520     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002530     MOVE  PARA-USERNAME              TO  USERNAME.               
002540     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002550*                                                                 
002560*----------------------------------------------------------------*
002570*    開始接続                                                    *
002580*----------------------------------------------------------------*
002590     IF    DB-STRING  =  SPACE                                    
002600        EXEC SQL                                                  
002610           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002620        END-EXEC                                                  
002630     ELSE                                                         
002640        EXEC SQL                                                  
002650           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002660             USING  :DB-STRING                                    
002670        END-EXEC                                                  
002680     END-IF.                                                      
002690*                                                                 
002700*----------------------------------------------------------------*
002710*    接続確認                                                    *
002720*----------------------------------------------------------------*
002730     EVALUATE  SQLCODE                                            
002740        WHEN   定数−ＳＱＬＯＫ                                   
002750           CONTINUE                                               
002760        WHEN   OTHER                                              
002770*--<       接続エラー >                                           
002780           MOVE     -10               TO  Ｗ−エラーコード        
002790           PERFORM  エラー処理                                    
002800     END-EVALUATE.                                                
002810*                                                                 
002820 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002830     EXIT.                                                        
002840******************************************************************
002850*    業務管理テーブル読込                                <1.2>   *
002860******************************************************************
002870*                                                                 
002880 業務管理テーブル読込                         SECTION.            
002890 業務管理テーブル読込−ＳＴＡＲＴ.                                
002900*                                                                 
002910*----------------------------------------------------------------*
002920*    業務管理テーブル読込                                        *
002930*----------------------------------------------------------------*
002940     EXEC SQL                                                     
002950        SELECT  バッチ用業務年月                                  
002960          INTO :Ｄ７０−バッチ用業務年月                          
002970          FROM  D70GYM_TBL                                        
002980         WHERE  業務管理ＩＤ  =  :ＷＳ−業務管理ＩＤ              
002990     END-EXEC.                                                    
003000*----------------------------------------------------------------*
003010*    業務管理テーブル読込確認                                    *
003020*----------------------------------------------------------------*
003030     EVALUATE   SQLCODE                                           
003040        WHEN   定数−ＳＱＬＯＫ                                   
003050*--<       正常 >                                                 
003060           CONTINUE                                               
003070        WHEN   OTHER                                              
003080*--<       業務管理テーブル読込失敗、プログラムが異常終了 >       
003090           MOVE      -20              TO  Ｗ−エラーコード        
003100           PERFORM   エラー処理                                   
003110     END-EVALUATE.                                                
003120*                                                                 
003130 業務管理テーブル読込−ＥＸＩＴ.                                  
003140     EXIT.                                                        
003150******************************************************************
003160*    結合テーブルカーソル宣言                            <1.2>   *
003170******************************************************************
003180*                                                                 
003190 結合テーブルカーソル宣言                         SECTION.        
003200 結合テーブルカーソル宣言−ＳＴＡＲＴ.                            
003210*                                                                 
003220*----------------------------------------------------------------*
003230*    結合テーブルカーソル宣言                                    *
003240*----------------------------------------------------------------*
003250     EXEC  SQL                                                    
003260        DECLARE   CUR1       CURSOR  FOR                          
003270           SELECT  M40MAB_TBL.レコード区分                        
003280                  ,M40MAB_TBL.経理用主契約区分                    
003290                  ,M40MAB_TBL.顧客区分                            
003300                  ,NVL(D01TRS_TBL.名寄せコード,RPAD(' ',40,' '))  
003310                  ,M40MAB_TBL.請求先取引先コード                  
003320                  ,M40MAB_TBL.請求先コード                        
003330                  ,M40MAB_TBL.契約番号                            
003340                  ,M40MAB_TBL.契約種類                            
003350                  ,M40MAB_TBL.担当部課コード                      
003360                  ,M40MAB_TBL.再リース回数                        
003370                  ,M40MAB_TBL.充当開始年月                        
003380			,M40MAB_TBL.充当月数                            
003390			,M40MAB_TBL.前払回収方法                        
003400			,M40MAB_TBL.入金日                              
003410			,M40MAB_TBL.入金区分                            
003420                  ,NVL(D01TRS_TBL.取引先名称,RPAD(' ',80,' '))    
003430                  ,NVL(D02SQS_TBL.請求先名称,RPAD(' ',80,' '))    
003440			,M40MAB_TBL.前月末残高                          
003450			,M40MAB_TBL.当月回収額                          
003460			,M40MAB_TBL.当月消化額                          
003470			,M40MAB_TBL.当月末残高                          
003480			,M40MAB_TBL.協調区分                            
003490		        ,M40MAB_TBL.前月末残高他社                      
003500		        ,M40MAB_TBL.当月回収額他社                      
003510		        ,M40MAB_TBL.当月消化額他社                      
003520		        ,M40MAB_TBL.当月他社解約分料金                  
003530		        ,M40MAB_TBL.当月他社解約分消費税                
003540			,M40MAB_TBL.当月末残高他社                      
003550             FROM  M40MAB_TBL                                     
003560                  ,D01TRS_TBL                                     
003570			,D02SQS_TBL                                     
003580            WHERE  M40MAB_TBL.前受金受払残高表対象フラグ = '1'    
003590              AND  M40MAB_TBL.請求先取引先コード =                
003600					D01TRS_TBL.取引先コード(+)      
003610		    AND  M40MAB_TBL.請求先取引先コード =                
003620					D02SQS_TBL.取引先コード(+)      
003630		    AND  M40MAB_TBL.請求先コード =                      
003640					D02SQS_TBL.請求先コード(+)      
003650	       ORDER BY  M40MAB_TBL.レコード区分                        
003660	                ,M40MAB_TBL.契約番号                            
003670     END-EXEC.                                                    
003680*                                                                 
003690*----------------------------------------------------------------*
003700*    結合テーブルカーソルオープン                                *
003710*----------------------------------------------------------------*
003720     EXEC  SQL                                                    
003730        OPEN  CUR1                                                
003740     END-EXEC.                                                    
003750*                                                                 
003760*----------------------------------------------------------------*
003770*    結合テーブルカーソルオープンを確認                          *
003780*----------------------------------------------------------------*
003790     EVALUATE   SQLCODE                                           
003800        WHEN   定数−ＳＱＬＯＫ                                   
003810*--<       正常 >                                                 
003820           CONTINUE                                               
003830        WHEN   OTHER                                              
003840*--<       結合テーブルカーソルオープン失敗 >                     
003850           MOVE      -30              TO  Ｗ−エラーコード        
003860           PERFORM   エラー処理                                   
003870     END-EVALUATE.                                                
003880*                                                                 
003890 結合テーブルカーソル宣言−ＥＸＩＴ.                              
003900     EXIT.                                                        
003910******************************************************************
003920*    ファイルオープン                                            *
003930******************************************************************
003940 ファイルオープン                     SECTION.                    
003950 ファイルオープン−ＳＴＡＲＴ.                                    
003960*----------------------------------------------------------------*
003970*    前受金受払残高中間ファイルのオープン                        *
003980*----------------------------------------------------------------*
003990     OPEN  OUTPUT   出力ファイル.                                 
004000*                                                                 
004010*--< ファイルオープンの状態判定 >                                 
004020     EVALUATE  Ｗ−状態                                           
004030        WHEN  ZERO                                                
004040           CONTINUE                                               
004050        WHEN  OTHER                                               
004060*--<       ファイルオープンエラー >                               
004070           MOVE     -90                TO  Ｗ−エラーコード       
004080           PERFORM  エラー処理                                    
004090     END-EVALUATE.                                                
004100*                                                                 
004110 ファイルオープン−ＥＸＩＴ.                                      
004120     EXIT.                                                        
004130******************************************************************
004140*    結合テーブル読込                              <1.7 AND 2.5> *
004150******************************************************************
004160 結合テーブル読込                   SECTION.                      
004170 結合テーブル読込−ＳＴＡＲＴ.                                    
004180*                                                                 
004190     EXEC  SQL                                                    
004200        FETCH  CUR1                                               
004210           INTO                                                   
004220             :Ｍ４０−レコード区分                                
004230            ,:Ｍ４０−経理用主契約区分                            
004240            ,:Ｍ４０−顧客区分                                    
004250            ,:Ｄ０１−名寄せコード                                
004260            ,:Ｍ４０−請求先取引先コード                          
004270            ,:Ｍ４０−請求先コード                                
004280            ,:Ｍ４０−契約番号                                    
004290            ,:Ｍ４０−契約種類                                    
004300            ,:Ｍ４０−担当部課コード                              
004310		  ,:Ｍ４０−再リース回数                                
004320		  ,:Ｍ４０−充当開始年月                                
004330		  ,:Ｍ４０−充当月数                                    
004340		  ,:Ｍ４０−前払回収方法                                
004350		  ,:Ｍ４０−入金日                                      
004360		  ,:Ｍ４０−入金区分                                    
004370		  ,:Ｄ０１−取引先名称                                  
004380		  ,:Ｄ０２−請求先名称                                  
004390		  ,:Ｍ４０−前月末残高                                  
004400		  ,:Ｍ４０−当月回収額                                  
004410		  ,:Ｍ４０−当月消化額                                  
004420		  ,:Ｍ４０−当月末残高                                  
004430		  ,:Ｍ４０−協調区分                                    
004440		  ,:Ｍ４０−前月末残高他社                              
004450		  ,:Ｍ４０−当月回収額他社                              
004460		  ,:Ｍ４０−当月消化額他社                              
004470		  ,:Ｍ４０−当月他社解約分料金                          
004480		  ,:Ｍ４０−当月他社解約分消費税                        
004490		  ,:Ｍ４０−当月末残高他社                              
004500     END-EXEC.                                                    
004510*                                                                 
004520*----------------------------------------------------------------*
004530*    結合テーブル読込確認                                        *
004540*----------------------------------------------------------------*
004550     EVALUATE  SQLCODE                                            
004560        WHEN  定数−ＳＱＬＯＫ                                    
004570*--<       正常 >                                                 
004580           COMPUTE   Ｗ−入力−件数 =  Ｗ−入力−件数 +  1        
004590        WHEN  定数−ＳＱＬＥＮＤ                                  
004600*--<       読込終了 >                                             
004610           MOVE      "Y"              TO  Ｗ−終了−フラグ        
004620        WHEN  OTHER                                               
004630*--<       読込エラー >                                           
004640           MOVE      -40              TO  Ｗ−エラーコード        
004650           PERFORM   エラー処理                                   
004660     END-EVALUATE.                                                
004670*                                                                 
004680 結合テーブル読込−ＥＸＩＴ.                                      
004690     EXIT.                                                        
004700******************************************************************
004710*    項目名称マスタ抽出処理                              <2.1>  *
004720******************************************************************
004730*                                                                 
004740 項目名称マスタ抽出処理                     SECTION.              
004750 項目名称マスタ抽出処理−ＳＴＡＲＴ.                              
004760*                                                                 
004770        PERFORM   主契約区分名称の抽出処理.                       
004780*                                                                 
004790        PERFORM   顧客区分名称の抽出処理.                         
004800*                                                                 
004810 項目名称マスタ抽出処理−ＥＸＩＴ.                                
004820     EXIT.                                                        
004830                                                                  
004840******************************************************************
004850*    主契約区分名称の抽出処理                            <2.1.1> *
004860******************************************************************
004870*                                                                 
004880 主契約区分名称の抽出処理               SECTION.                  
004890 主契約区分名称の抽出処理−ＳＴＡＲＴ.                            
004900*                                                                 
004910*----------------------------------------------------------------*
004920*   主契約区分名称の抽出処理                                     *
004930*----------------------------------------------------------------*
004940     EXEC SQL                                                     
004950        SELECT  名称                                              
004960          INTO :ＷＳ−名称１                                      
004970          FROM  D19MSY_TBL                                        
004980        WHERE   コードＮＯ  =  :ＷＳ−コードＮＯ１                
004990          AND   SUBSTR(コード,1,1) =  :Ｍ４０−経理用主契約区分   
005000     END-EXEC.                                                    
005010*----------------------------------------------------------------*
005020*    主契約区分名称の抽出処理確認                                *
005030*----------------------------------------------------------------*
005040     EVALUATE   SQLCODE                                           
005050        WHEN   定数−ＳＱＬＯＫ                                   
005060*--<       正常 >                                                 
005070           CONTINUE                                               
005080        WHEN   OTHER                                              
005090*--<       主契約区分名称の抽出処理失敗>                          
005100           MOVE      SPACE            TO  ＷＳ−名称１            
005110           MOVE      -50              TO  Ｗ−エラーコード        
005120           PERFORM   エラー処理                                   
005130     END-EVALUATE.                                                
005140*                                                                 
005150 主契約区分名称の抽出処理−ＥＸＩＴ.                              
005160     EXIT.                                                        
005170******************************************************************
005180*    顧客区分名称の抽出処理                              <2.1.2> *
005190******************************************************************
005200*                                                                 
005210 顧客区分名称の抽出処理               SECTION.                    
005220 顧客区分名称の抽出処理−ＳＴＡＲＴ.                              
005230*                                                                 
005240*----------------------------------------------------------------*
005250*   顧客区分名称の抽出処理                                       *
005260*----------------------------------------------------------------*
005270     EXEC SQL                                                     
005280        SELECT  名称                                              
005290          INTO :ＷＳ−名称２                                      
005300          FROM  D19MSY_TBL                                        
005310        WHERE   コードＮＯ  =  :ＷＳ−コードＮＯ２                
005320          AND   SUBSTR(コード,1,2)  =  :Ｍ４０−顧客区分          
005330     END-EXEC.                                                    
005340*----------------------------------------------------------------*
005350*    顧客区分名称の抽出処理確認              *                    
005360*----------------------------------------------------------------*
005370     EVALUATE   SQLCODE                                           
005380        WHEN   定数−ＳＱＬＯＫ                                   
005390*--<       正常 >                                                 
005400           CONTINUE                                               
005410        WHEN   OTHER                                              
005420*--<       顧客区分名称の抽出処理失敗>                            
005430           MOVE      SPACE           TO  ＷＳ−名称２             
005440           MOVE      -60             TO  Ｗ−エラーコード         
005450           PERFORM   エラー処理                                   
005460     END-EVALUATE.                                                
005470*                                                                 
005480 顧客区分名称の抽出処理−ＥＸＩＴ.                                
005490     EXIT.                                                        
005500******************************************************************
005510*    債権情報ＤＢ抽出処理                                <2.2>   *
005520******************************************************************
005530*                                                                 
005540 債権情報ＤＢ抽出処理               SECTION.                      
005550 債権情報ＤＢ抽出処理−ＳＴＡＲＴ.                                
005560*                                                                 
005570*----------------------------------------------------------------*
005580*   債権情報ＤＢ抽出処理                                         *
005590*----------------------------------------------------------------*
005600     EXEC SQL                                                     
005610       SELECT  状態フラグ                                         
005620              ,債権契約件名                                       
005630		    ,担保区分                                           
005640        INTO   :Ｍ０１−状態フラグ                                
005650              ,:Ｍ０１−債権契約件名                              
005660		    ,:Ｍ０１−担保区分                                  
005670         FROM  M01SAJ_TBL                                         
005680       WHERE   レコード区分 = :ＷＳ−レコード区分                 
005690         AND   契約番号 = :Ｍ４０−契約番号                       
005700	       AND   再リース回数 = :Ｍ４０−再リース回数               
005710	       AND   契約種類 = :Ｍ４０−契約種類                       
005720     END-EXEC.                                                    
005730*----------------------------------------------------------------*
005740*    債権情報ＤＢ抽出処理確認                                    *
005750*----------------------------------------------------------------*
005760     EVALUATE   SQLCODE                                           
005770        WHEN   定数−ＳＱＬＯＫ                                   
005780*--<       正常 >                                                 
005790           CONTINUE                                               
005800        WHEN   OTHER                                              
005810*--<       債権情報ＤＢ抽出処理失敗>                              
005820           MOVE      ZERO             TO  Ｍ０１−状態フラグ      
005830           MOVE      SPACE            TO  Ｍ０１−債権契約件名    
005840           MOVE      ZERO             TO  Ｍ０１−担保区分        
005850           MOVE      -70              TO  Ｗ−エラーコード        
005860           PERFORM   エラー処理                                   
005870     END-EVALUATE.                                                
005880*                                                                 
005890 債権情報ＤＢ抽出処理−ＥＸＩＴ.                                  
005900     EXIT.                                                        
005910******************************************************************
005920*    ファイル出力判定編集出力処理                        <2.3>   *
005930******************************************************************
005940 ファイル出力判定編集出力処理      SECTION.                       
005950 ファイル出力判定編集出力処理−ＳＴＡＲＴ.                        
005960*                                                                 
005970	   IF Ｍ０１−担保区分 NOT = 1                                  
005980		PERFORM ファイル編集出力処理                            
005990	   END-IF.                                                      
006000*                                                                 
006010 ファイル出力判定編集出力処理−ＥＸＩＴ.                          
006020     EXIT.                                                        
006030******************************************************************
006040*     ファイル編集出力処理                               <2.4>   *
006050******************************************************************
006060 ファイル編集出力処理                         SECTION.            
006070 ファイル編集出力処理−ＳＴＡＲＴ.                                
006080*                                                                 
006090	   PERFORM  自社分ファイル編集処理.                             
006100*                                                                 
006110	   IF	 出力−前月末残高 NOT = ZERO                            
006120	     OR  出力−当月入金額 NOT = ZERO                            
006130	     OR  出力−当月消化額 NOT = ZERO                            
006140	     OR  出力−当月末残高 NOT = ZERO                            
006150	      PERFORM  ファイル出力処理                                 
006160	   END-IF.                                                      
006170*                                                                 
006180	   IF Ｍ４０−協調区分 = "2"                                    
006190	      PERFORM 他社分ファイル編集処理                            
006200	      IF    出力−前月末残高 NOT = ZERO                         
006210	        OR  出力−当月入金額 NOT = ZERO                         
006220	        OR  出力−当月消化額 NOT = ZERO                         
006230	        OR  出力−当月末残高 NOT = ZERO                         
006240	         PERFORM  ファイル出力処理                              
006250	      END-IF                                                    
006260	   END-IF.                                                      
006270*                                                                 
006280 ファイル編集出力処理−ＥＸＩＴ.                                  
006290     EXIT.                                                        
006300******************************************************************
006310*     自社分ファイル編集処理                             <2.4.1> *
006320******************************************************************
006330 自社分ファイル編集処理                         SECTION.          
006340 自社分ファイル編集処理−ＳＴＡＲＴ.                              
006350*                                                                 
006360	   PERFORM  公共の項目編集処理.                                 
006370*                                                                 
006380*--<    No.01 >                                                   
006390	   IF Ｍ０１−状態フラグ < "3"                                  
006400		MOVE   "3"                  TO 出力−自他社区分         
006410	   ELSE                                                         
006420	        MOVE   "1"                  TO 出力−自他社区分         
006430	   END-IF                                                       
006440*                                                                 
006450*--<    No.23 >                                                   
006460     MOVE  Ｍ４０−前月末残高         TO  出力−前月末残高        
006470*--<    No.24 >                                                   
006480     MOVE  Ｍ４０−当月回収額         TO  出力−当月入金額        
006490*--<    No.25 >                                                   
006500     MOVE  Ｍ４０−当月消化額         TO  出力−当月消化額        
006510*--<    No.26 >                                                   
006520     MOVE  Ｍ４０−当月末残高         TO  出力−当月末残高.       
006530*                                                                 
006540 自社分ファイル編集処理−ＥＸＩＴ.                                
006550     EXIT.                                                        
006560******************************************************************
006570*     他社分ファイル編集処理                             <2.4.3> *
006580******************************************************************
006590 他社分ファイル編集処理                         SECTION.          
006600 他社分ファイル編集処理−ＳＴＡＲＴ.                              
006610*                                                                 
006620	   PERFORM  公共の項目編集処理.                                 
006630*                                                                 
006640*--<    No.01 >                                                   
006650	   IF Ｍ０１−状態フラグ < "3"                                  
006660		MOVE   "4"                  TO 出力−自他社区分         
006670	   ELSE                                                         
006680	        MOVE   "2"                  TO 出力−自他社区分         
006690	   END-IF                                                       
006700*                                                                 
006710	   COMPUTE   Ｗ−当月消化額１ =   Ｍ４０−当月消化額他社 +      
006720	                              Ｍ４０−当月他社解約分料金 +      
006730		                      Ｍ４０−当月他社解約分消費税      
006740	   COMPUTE   Ｗ−当月末残高１ =   Ｍ４０−当月末残高他社 -      
006750	                              Ｍ４０−当月他社解約分料金 -      
006760		                      Ｍ４０−当月他社解約分消費税      
006770*                                                                 
006780*--<    No.23 >                                                   
006790     MOVE  Ｍ４０−前月末残高他社     TO  出力−前月末残高        
006800*--<    No.24 >                                                   
006810     MOVE  Ｍ４０−当月回収額他社     TO  出力−当月入金額        
006820*--<    No.25 >                                                   
006830     MOVE  Ｗ−当月消化額１           TO  出力−当月消化額        
006840*--<    No.26 >                                                   
006850     MOVE  Ｗ−当月末残高１           TO  出力−当月末残高.       
006860*                                                                 
006870 他社分ファイル編集処理−ＥＸＩＴ.                                
006880     EXIT.                                                        
006890******************************************************************
006900*    公共の項目編集処理                                          *
006910******************************************************************
006920 公共の項目編集処理                   SECTION.                    
006930 公共の項目編集処理−ＳＴＡＲＴ.                                  
006940*----------------------------------------------------------------*
006950*       初期化処理                                               *
006960*----------------------------------------------------------------*
006970        MOVE  SPACE                   TO  出力−レコード          
006980        INITIALIZE                        出力−レコード          
006990*                                                                 
007000*----------------------------------------------------------------*
007010*       公共の項目編集処理                                       *
007020*----------------------------------------------------------------*
007030*                                                                 
007040*--<    No.02 >                                                   
007050        MOVE  Ｍ４０−レコード区分    TO  出力−前受区分          
007060*                                                                 
007070*--<    No.03 >                                                   
007080        MOVE  Ｍ４０−経理用主契約区分                            
007090					    TO  出力−主契約区分        
007100                                                                  
007110*--<    No.04 >                                                   
007120        MOVE  Ｍ４０−顧客区分        TO  出力−連結区分          
007130*                                                                 
007140*--<    No.05 >                                                   
007150        MOVE  Ｄ０１−名寄せコード    TO  出力−名寄せコード      
007160*                                                                 
007170*--<    No.06 >                                                   
007180        MOVE  Ｍ４０−請求先取引先コード                          
007190                                      TO  出力−取引先コード      
007200*                                                                 
007210*--<    No.07 >                                                   
007220        MOVE  Ｍ４０−請求先コード    TO  出力−請求先コード      
007230*                                                                 
007240*--<    No.08 >                                                   
007250        MOVE  Ｍ４０−契約番号        TO  出力−契約番号          
007260*                                                                 
007270*--<    No.09 >                                                   
007280        MOVE  Ｍ４０−契約種類        TO  出力−契約種類          
007290*                                                                 
007300*--<    No.10 >                                                   
007310        MOVE  Ｄ７０−バッチ用業務年月                            
007320					    TO  出力−業務年月          
007330*                                                                 
007340*--<    No.11 >                                                   
007350        MOVE  Ｍ４０−担当部課コード  TO  出力−担当部課コード    
007360*                                                                 
007370*--<    No.12 >                                                   
007380        MOVE  Ｍ０１−債権契約件名    TO  出力−契約件名          
007390*                                                                 
007400*--<    No.13 >                                                   
007410        MOVE  Ｍ４０−再リース回数    TO  出力−再リース回数      
007420*                                                                 
007430*--<    No.14 >                                                   
007440        MOVE  Ｍ４０−充当開始年月    TO  出力−充当開始年月      
007450*                                                                 
007460*--<    No.15 >                                                   
007470        MOVE  Ｍ４０−充当月数        TO  出力−充当月数          
007480*                                                                 
007490*--<    No.16 >                                                   
007500        MOVE  Ｍ４０−前払回収方法    TO  出力−前払回収方法      
007510*                                                                 
007520*--<    No.17 >                                                   
007530        MOVE  Ｍ４０−入金日          TO  出力−入金日            
007540*                                                                 
007550*--<    No.18 >                                                   
007560        MOVE  Ｍ４０−入金区分        TO  出力−入金区分          
007570*                                                                 
007580*--<    No.19 >                                                   
007590        MOVE  Ｄ０１−取引先名称      TO  出力−取引先名称        
007600*                                                                 
007610*--<    No.20 >                                                   
007620        MOVE  Ｄ０２−請求先名称      TO  出力−請求先名称        
007630*                                                                 
007640*--<    No.21 >                                                   
007650        MOVE  ＷＳ−名称１            TO  出力−主契約区分名称    
007660*                                                                 
007670*--<    No.22 >                                                   
007680        MOVE  ＷＳ−名称２            TO  出力−連結区分名称.     
007690*                                                                 
007700 公共の項目編集処理−ＥＸＩＴ.                                    
007710     EXIT.                                                        
007720******************************************************************
007730*    ファイル出力処理                           <2.4.3 AND 2.4.4>*
007740******************************************************************
007750 ファイル出力処理                   SECTION.                      
007760 ファイル出力処理−ＳＴＡＲＴ.                                    
007770*                                                                 
007780     WRITE  出力−レコード.                                       
007790*                                                                 
007800*--< ファイル出力の状態判定 >                                     
007810     EVALUATE  Ｗ−状態                                           
007820        WHEN  ZERO                                                
007830*--<       ファイル出力件数の加算 >                               
007840           COMPUTE  Ｗ−出力−件数 =  Ｗ−出力−件数 + 1          
007850        WHEN  OTHER                                               
007860*--<       ファイル出力エラー >                                   
007870           MOVE     -80               TO  Ｗ−エラーコード        
007880           PERFORM  エラー処理                                    
007890     END-EVALUATE.                                                
007900*                                                                 
007910 ファイル出力処理−ＥＸＩＴ.                                      
007920     EXIT.                                                        
007930******************************************************************
007940*    終了メッセージ出力                             <3.3 AND 3.4>*
007950******************************************************************
007960 終了メッセージ出力                   SECTION.                    
007970 終了メッセージ出力−ＳＴＡＲＴ.                                  
007980*                                                                 
007990*----------------------------------------------------------------*
008000*    件数メッセージ出力処理                                      *
008010*----------------------------------------------------------------*
008020     INITIALIZE                       IF-CHOCO001.                
008030     MOVE  "3"                        TO  共１−イベント種別.     
008040     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008050     MOVE  "0"                        TO  共１−復帰コード.       
008060     MOVE  "M40MAB"                   TO  共１−処理テーブルＩＤ. 
008070     MOVE  "COUNT"                    TO  共１−処理識別.         
008080     MOVE  Ｗ−入力−件数             TO  共１−データ内容.       
008090     MOVE  "前受情報テーブル入力件数"                             
008100					    TO  共１−その他メッセージ. 
008110     CALL  CLOCO001                   USING  IF-CHOCO001.         
008120*                                                                 
008130     INITIALIZE                       IF-CHOCO001.                
008140     MOVE  "3"                        TO  共１−イベント種別.     
008150     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008160     MOVE  "0"                        TO  共１−復帰コード.       
008170     MOVE  "SFHSED25"                 TO  共１−処理テーブルＩＤ. 
008180     MOVE  "COUNT"                    TO  共１−処理識別.         
008190     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
008200     MOVE  "前受金受払残高ファイル出力件数"                       
008210					    TO  共１−その他メッセージ. 
008220     CALL  CLOCO001                   USING  IF-CHOCO001.         
008230*                                                                 
008240*----------------------------------------------------------------*
008250*    終了メッセージ出力                                          *
008260*----------------------------------------------------------------*
008270     INITIALIZE                       IF-CHOCO001.                
008280     MOVE  "3"                        TO  共１−イベント種別.     
008290     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008300     MOVE  "0"                        TO  共１−復帰コード.       
008310     MOVE  "END"                      TO  共１−処理識別.         
008320     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
008330     CALL  CLOCO001                   USING  IF-CHOCO001.         
008340*                                                                 
008350 終了メッセージ出力−ＥＸＩＴ.                                    
008360     EXIT.                                                        
008370******************************************************************
008380*    ＤＢクローズ                                        <3.1>   *
008390******************************************************************
008400 ＤＢクローズ処理                     SECTION.                    
008410 ＤＢクローズ処理−ＳＴＡＲＴ.                                    
008420*                                                                 
008430*--< カーソル クローズ >                                          
008440     EXEC SQL                                                     
008450        CLOSE  CUR1                                               
008460     END-EXEC.                                                    
008470*                                                                 
008480 ＤＢクローズ処理−ＥＸＩＴ.                                      
008490     EXIT.                                                        
008500******************************************************************
008510*    エラー処理                                                  *
008520******************************************************************
008530 エラー処理                       SECTION.                        
008540 エラー処理−ＳＴＡＲＴ.                                          
008550*                                                                 
008560     MOVE  "Y"                        TO Ｗ−異常終了−フラグ.    
008570     INITIALIZE                           IF-CHOCO001.            
008580*                                                                 
008590     EVALUATE  Ｗ−エラーコード                                   
008600        WHEN  -10                                                 
008610*--<       ＯＲＡＣＬＥ接続失敗 >                                 
008620           MOVE  "1"                  TO  共１−イベント種別      
008630           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008640           MOVE  "9"                  TO  共１−復帰コード        
008650           MOVE  "CONNECT"            TO  共１−処理識別          
008660           MOVE  SQLCODE              TO  共１−データ内容        
008670           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008680           CALL  CLOCO001          USING  IF-CHOCO001             
008690*                                                                 
008700        WHEN  -20                                                 
008710*--<       業務管理テーブル読込失敗 >                             
008720           MOVE  "1"                  TO  共１−イベント種別      
008730           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008740           MOVE  "9"                  TO  共１−復帰コード        
008750           MOVE  "D70GYM"             TO  共１−処理テーブルＩＤ  
008760           MOVE  "SELECT"             TO  共１−処理識別          
008770           MOVE  SQLCODE              TO  共１−データ内容        
008780           MOVE  SQLERRMC		    TO  共１−その他メッセージ  
008790           CALL  CLOCO001          USING  IF-CHOCO001             
008800*                                                                 
008810        WHEN  -30                                                 
008820*--<       結合テーブルカーソルオープン失敗 >                     
008830           MOVE  "1"                  TO  共１−イベント種別      
008840           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008850           MOVE  "9"                  TO  共１−復帰コード        
008860           MOVE  "M40MAB"             TO  共１−処理テーブルＩＤ  
008870           MOVE  "OPEN"               TO  共１−処理識別          
008880           MOVE  SQLCODE              TO  共１−データ内容        
008890           MOVE  SQLERRMC		    TO  共１−その他メッセージ  
008900           CALL  CLOCO001          USING  IF-CHOCO001             
008910*                                                                 
008920        WHEN  -40                                                 
008930*--<       結合テーブル読込失敗 >                                 
008940           MOVE  "1"                  TO  共１−イベント種別      
008950           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008960           MOVE  "9"                  TO  共１−復帰コード        
008970           MOVE  "M40MAB"             TO  共１−処理テーブルＩＤ  
008980           MOVE  "FETCH"              TO  共１−処理識別          
008990           MOVE  SQLCODE              TO  共１−データ内容        
009000           MOVE  SQLERRMC		    TO  共１−その他メッセージ  
009010           CALL  CLOCO001          USING  IF-CHOCO001             
009020*                                                                 
009030        WHEN  -50                                                 
009040*--<       主契約区分名称の抽出処理失敗 >                         
009050           MOVE  "2"                  TO  共１−イベント種別      
009060           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009070           MOVE  "9"                  TO  共１−復帰コード        
009080           MOVE  "D19MSY"             TO  共１−処理テーブルＩＤ  
009090           MOVE  "SELECT"             TO  共１−処理識別          
009100           MOVE  SQLCODE              TO  共１−データ内容        
009110           MOVE  SQLERRMC  	    TO  共１−その他メッセージ  
009120           CALL  CLOCO001          USING  IF-CHOCO001             
009130           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
009140*                                                                 
009150        WHEN  -60                                                 
009160*--<       顧客区分名称の抽出処理失敗 >                           
009170           MOVE  "2"                  TO  共１−イベント種別      
009180           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009190           MOVE  "9"                  TO  共１−復帰コード        
009200           MOVE  "D19MSY"             TO  共１−処理テーブルＩＤ  
009210           MOVE  "SELECT"             TO  共１−処理識別          
009220           MOVE  SQLCODE              TO  共１−データ内容        
009230           MOVE  SQLERRMC		    TO  共１−その他メッセージ  
009240           CALL  CLOCO001          USING  IF-CHOCO001             
009250           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
009260*                                                                 
009270        WHEN  -70                                                 
009280*--<       債権情報ＤＢ抽出処理失敗 >                             
009290           MOVE  "2"                  TO  共１−イベント種別      
009300           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009310           MOVE  "9"                  TO  共１−復帰コード        
009320           MOVE  "M01SAJ"             TO  共１−処理テーブルＩＤ  
009330           MOVE  "SELECT"             TO  共１−処理識別          
009340           MOVE  SQLCODE              TO  共１−データ内容        
009350           MOVE  SQLERRMC		    TO  共１−その他メッセージ  
009360           CALL  CLOCO001          USING  IF-CHOCO001             
009370           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
009380*                                                                 
009390        WHEN  -80                                                 
009400*--<       ファイル出力失敗 >                                     
009410           MOVE  "1"                  TO  共１−イベント種別      
009420           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009430           MOVE  "9"                  TO  共１−復帰コード        
009440           MOVE  "SFHSED25"           TO  共１−処理テーブルＩＤ  
009450           MOVE  "WRITE"              TO  共１−処理識別          
009460           MOVE  Ｗ−状態             TO  共１−データ内容        
009470           MOVE  "ファイル出力失敗"                               
009480					    TO  共１−その他メッセージ  
009490           CALL  CLOCO001          USING  IF-CHOCO001             
009500*                                                                 
009510        WHEN  -90                                                 
009520*--<       ファイルオープン失敗 >                                 
009530           MOVE  "1"                  TO  共１−イベント種別      
009540           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009550           MOVE  "9"                  TO  共１−復帰コード        
009560           MOVE  "SFHSED25"           TO  共１−処理テーブルＩＤ  
009570           MOVE  "OPEN"               TO  共１−処理識別          
009580           MOVE  Ｗ−状態             TO  共１−データ内容        
009590           MOVE  "ファイルオープン失敗"                           
009600                                      TO  共１−その他メッセージ  
009610           CALL  CLOCO001          USING  IF-CHOCO001             
009620*                                                                 
009630        WHEN  OTHER                                               
009640           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
009650     END-EVALUATE.                                                
009660*                                                                 
009670     IF Ｗ−異常終了−フラグ  =  "Y"                              
009680*                                                                 
009690        PERFORM  終了メッセージ出力                               
009700*                                                                 
009710*--<    プログラムリターンコード >                                
009720        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
009730*                                                                 
009740        EXIT  PROGRAM                                             
009750     END-IF.                                                      
009760*                                                                 
009770 エラー処理−ＥＸＩＴ.                                            
009780     EXIT.                                                        
009790******************************************************************
009800*                  END OF PROGRAM                                *
009810******************************************************************
