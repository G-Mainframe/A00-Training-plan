000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名  : 契約内容ファクタリング項目抽出         *
000040*      2. プログラムID  : COBIS321                               *
000050*      3. 処理概要      : ファクタリング基本のレコード１件より契 *
000060*                         約内容個別情報ファイルを１件出力する。 *
000070*                        ファクタリング基本とファクタリング手形  *
000080*                         売掛債権を契約番号でマッチングし、ファ *
000090*                         クタリング手形売掛債権より付加情報を編 *
000100*                         集する。（付加情報については項目対比参 *
000110*                         照のこと）                             *
000120*                         ﾌｧｸﾀﾘﾝｸﾞ基本があり、ﾌｧｸﾀﾘﾝｸﾞ手形債権が *
000130*                         ない場合マッチングエラーとして右記メッ *
000140*                         セージを出力する。                     *
000150*                                                                *
000160*      4. 作成者        : 白陽                                   *
000170*      5. 作成日        : 2005.04.05                             *
000180******************************************************************
000190*                                                                 
000200******************************************************************
000210*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ     ＤＩＶＩＳＩＯＮ           *
000220******************************************************************
000230 IDENTIFICATION                       DIVISION.                   
000240*                                                                 
000250 PROGRAM-ID.                          COBIS321.                   
000260******************************************************************
000270*    ＥＮＶＩＲＯＮＭＥＮＴ           ＤＩＶＩＳＩＯＮ           *
000280******************************************************************
000290 ENVIRONMENT                          DIVISION.                   
000300******************************************************************
000310*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000320******************************************************************
000330 INPUT-OUTPUT                         SECTION.                    
000340*                                                                 
000350 FILE-CONTROL.                                                    
000360     SELECT    入力ファイル１         ASSIGN    TO     U01        
000370     FILE      STATUS     IS          Ｗ−状態                    
000380     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000390*                                                                 
000400     SELECT    入力ファイル２         ASSIGN    TO     U02        
000410     FILE      STATUS     IS          Ｗ−状態                    
000420     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000430*                                                                 
000440     SELECT    出力ファイル           ASSIGN    TO     U11        
000450     FILE      STATUS     IS          Ｗ−状態                    
000460     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000470*                                                                 
000480******************************************************************
000490*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000500******************************************************************
000510 DATA                                 DIVISION.                   
000520******************************************************************
000530*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000540******************************************************************
000550 FILE                                 SECTION.                    
000560*----------------------------------------------------------------*
000570*    入力ファイル                                                *
000580*----------------------------------------------------------------*
000590 FD  入力ファイル１                                               
000600     LABEL     RECORD     IS          STANDARD                    
000610     BLOCK     CONTAINS   0           RECORDS.                    
000620*                                                                 
000630 01  入力１−レコード.                                            
000640     COPY  CPBIS027  REPLACING  ==()==  BY  ==入力１−==.         
000650*                                                                 
000660 FD  入力ファイル２                                               
000670     LABEL     RECORD     IS          STANDARD                    
000680     BLOCK     CONTAINS   0           RECORDS.                    
000690*                                                                 
000700 01  入力２−レコード.                                            
000710     COPY  CPBIS028  REPLACING  ==()==  BY  ==入力２−==.         
000720*                                                                 
000730*----------------------------------------------------------------*
000740*    出力ファイル                                                *
000750*----------------------------------------------------------------*
000760 FD  出力ファイル                                                 
000770     LABEL     RECORD     IS          STANDARD                    
000780     BLOCK     CONTAINS   0           RECORDS.                    
000790*                                                                 
000800 01  出力−レコード.                                              
000810     COPY  CISUF320  REPLACING  ==()==  BY  ==出力−==.           
000820*                                                                 
000830******************************************************************
000840*    ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ   ＳＥＣＴＩＯＮ             *
000850******************************************************************
000860 WORKING-STORAGE                      SECTION.                    
000870*                                                                 
000880*----------------------------------------------------------------*
000890*   作業領域定義                                                 *
000900*----------------------------------------------------------------*
000910 01  ワークエリア.                                                
000920*                                                                 
000930*--< 件数エリア >                                                 
000940     03  Ｗ−件数エリア.                                          
000950          05  Ｗ−入力−件数１        PIC  9(09).                 
000960          05  Ｗ−入力−件数２        PIC  9(09).                 
000970          05  Ｗ−出力−件数          PIC  9(09).                 
000980*                                                                 
000990*--< ファイル状態 >                                               
001000     03  Ｗ−状態エリア.                                          
001010          05  Ｗ−状態                PIC  X(02).                 
001020*                                                                 
001030*--< エラーコード >                                               
001040     03  Ｗ−エラーコード             PIC S9(04).                 
001050*                                                                 
001060*--< フラグエリア >                                               
001070     03  Ｗ−フラッグエリア.                                      
001080         05  Ｗ−終了−フラグ１       PIC  X(01).                 
001090         05  Ｗ−終了−フラグ２       PIC  X(01).                 
001100         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001110*                                                                 
001120*--< キーエリア >                                                 
001130     03  Ｗ−キーエリア.                                          
001140         05  Ｗ−ＫＥＹ−契約番号１   PIC  X(09).                 
001150         05  Ｗ−ＫＥＹ−契約番号２   PIC  X(09).                 
001160*                                                                 
001170*--< 共通情報 >                                                   
001180 01  Ｗ−共通情報.                                                
001190     03  Ｗ−システム日付.                                        
001200         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001210         05  Ｗ−年月日               PIC  X(06).                 
001220     03  Ｗ−システム時刻             PIC  X(08).                 
001230     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001240 01  Ｗ−利息期日                     PIC  X(07).                 
001250 01  Ｗ−利息日西暦                   PIC  X(08).                 
001260*                                                                 
001270*----------------------------------------------------------------*
001280*    サブルーチン名                                              *
001290*----------------------------------------------------------------*
001300 01  CALL-AREA.                                                   
001310*--< 共通ログサブルーチン >                                       
001320     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001330     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001340*                                                                 
001350*----------------------------------------------------------------*
001360*    ＣＯＰＹ領域                                                *
001370*----------------------------------------------------------------*
001380*--< 共通ログ用 >                                                 
001390 01  IF-CHOCO001.                                                 
001400     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001410******************************************************************
001420*    定数用データ定義                                            *
001430******************************************************************
001440 CONSTANT                             SECTION.                    
001450*                                                                 
001460 01  定数領域.                                                    
001470     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS321".
001480     03  定数−プログラム名           PIC  X(80)                  
001490                           VALUE "契約内容ファクタリング項目抽出".
001500     03  定数−正常状態               PIC  9(04) VALUE  ZERO.     
001510     03  定数−異常状態               PIC  9(04) VALUE  0009.     
001520*                                                                 
001530******************************************************************
001540*    ＰＲＯＣＥＤＵＲＥ               ＤＩＶＩＳＩＯＮ           *
001550******************************************************************
001560 PROCEDURE                            DIVISION.                   
001570*                                                                 
001580     PERFORM   初期処理.                                          
001590*                                                                 
001600     PERFORM   主処理     UNTIL  (Ｗ−終了−フラグ１ = "Y")       
001610                          AND    (Ｗ−終了−フラグ２ = "Y").      
001620*                                                                 
001630     PERFORM   終了処理.                                          
001640*                                                                 
001650     STOP RUN.                                                    
001660*                                                                 
001670******************************************************************
001680*    初期処理                                                    *
001690******************************************************************
001700 初期処理                             SECTION.                    
001710 初期処理−ＳＴＡＲＴ.                                            
001720*                                                                 
001730*----------------------------------------------------------------*
001740*    開始メッセージ出力                                          *
001750*----------------------------------------------------------------*
001760     INITIALIZE                       IF-CHOCO001.                
001770     MOVE  "3"                        TO  共１−イベント種別.     
001780     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001790     MOVE  "0"                        TO  共１−復帰コード.       
001800     MOVE  "START"                    TO  共１−処理識別.         
001810     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001820     CALL  CLOCO001                USING  IF-CHOCO001.            
001830*----------------------------------------------------------------*
001840*    作業領域の初期値処理                                        *
001850*----------------------------------------------------------------*
001860     MOVE  SPACE                      TO  ワークエリア.           
001870     INITIALIZE                           ワークエリア.           
001880*                                                                 
001890*--< ＣＰＵ日付を取得 >                                           
001900     ACCEPT  Ｗ−年月日               FROM  DATE.                 
001910*                                                                 
001920*--< ＣＰＵ時刻を取得 >                                           
001930     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
001940*                                                                 
001950*--<  ファイルオープン >                                          
001960     PERFORM  ファイルオープン.                                   
001970*                                                                 
001980*--< 基本ファイル読込処理（１件目） >                             
001990     PERFORM  基本ファイル読込処理.                               
002000*                                                                 
002010*--< 手形売掛債権ファイル読込処理（１件目） >                     
002020     PERFORM  手形売掛債権ファイル読込処理.                       
002030*                                                                 
002040 初期処理−ＥＸＩＴ.                                              
002050     EXIT.                                                        
002060******************************************************************
002070*    主処理                                                       
002080******************************************************************
002090 主処理                               SECTION.                    
002100 主処理−ＳＴＡＲＴ.                                              
002110*                                                                 
002120     EVALUATE  TRUE                                               
002130*--<    手形売掛債権ファイルの場合 >                              
002140        WHEN  Ｗ−ＫＥＹ−契約番号１ > Ｗ−ＫＥＹ−契約番号２     
002150           PERFORM  手形売掛債権ファイル読込処理                  
002160*                                                                 
002170*--<    契約内容個別情報編集処理の場合 >                          
002180        WHEN  Ｗ−ＫＥＹ−契約番号１ = Ｗ−ＫＥＹ−契約番号２     
002190           IF  入力１−業務区分 = "1"                             
002200            OR  入力１−業務区分 = "2"                            
002210              PERFORM  契約内容個別情報編集処理                   
002220           END-IF                                                 
002230*                                                                 
002240           PERFORM  基本ファイル読込処理                          
002250*                                                                 
002260           PERFORM  手形売掛債権ファイル読込処理                  
002270*                                                                 
002280*--<    基本ファイルの場合 >                                      
002290        WHEN  Ｗ−ＫＥＹ−契約番号１ < Ｗ−ＫＥＹ−契約番号２     
002300*                                                                 
002310           PERFORM  基本ファイル読込処理                          
002320*                                                                 
002330     END-EVALUATE.                                                
002340*                                                                 
002350 主処理−ＥＸＩＴ.                                                
002360     EXIT.                                                        
002370******************************************************************
002380*    ファイルオープン                                            *
002390******************************************************************
002400 ファイルオープン                     SECTION.                    
002410 ファイルオープン−ＳＴＡＲＴ.                                    
002420*                                                                 
002430*----------------------------------------------------------------*
002440*    基本ファイルのオープン                                      *
002450*----------------------------------------------------------------*
002460     OPEN  INPUT   入力ファイル１.                                
002470*                                                                 
002480*--< ファイルオープンの状態判定 >                                 
002490     EVALUATE  Ｗ−状態                                           
002500        WHEN  ZERO                                                
002510           CONTINUE                                               
002520        WHEN  OTHER                                               
002530*--< ファイルオープンエラー >                                     
002540           MOVE     -10                TO  Ｗ−エラーコード       
002550           PERFORM  エラー処理                                    
002560     END-EVALUATE.                                                
002570*                                                                 
002580*----------------------------------------------------------------*
002590*    手形売掛債権ファイルのオープン                              *
002600*----------------------------------------------------------------*
002610     OPEN  INPUT   入力ファイル２.                                
002620*                                                                 
002630*--< ファイルオープンの状態判定 >                                 
002640     EVALUATE  Ｗ−状態                                           
002650        WHEN  ZERO                                                
002660           CONTINUE                                               
002670        WHEN  OTHER                                               
002680*--< ファイルオープンエラー >                                     
002690           MOVE     -20                TO  Ｗ−エラーコード       
002700           PERFORM  エラー処理                                    
002710     END-EVALUATE.                                                
002720*                                                                 
002730*----------------------------------------------------------------*
002740*   契約内容個別情報ファイルのオープン                           *
002750*----------------------------------------------------------------*
002760     OPEN  OUTPUT   出力ファイル.                                 
002770*                                                                 
002780*--< 契約内容個別情報ファイルの状態判定 >                         
002790     EVALUATE  Ｗ−状態                                           
002800        WHEN  ZERO                                                
002810           CONTINUE                                               
002820        WHEN  OTHER                                               
002830*--< 契約内容個別情報ファイルオープンエラー >                     
002840           MOVE     -30                TO  Ｗ−エラーコード       
002850           PERFORM  エラー処理                                    
002860     END-EVALUATE.                                                
002870*                                                                 
002880 ファイルオープン−ＥＸＩＴ.                                      
002890     EXIT.                                                        
002900******************************************************************
002910*    ファクタリング基本読込処理                                  *
002920******************************************************************
002930 基本ファイル読込処理                 SECTION.                    
002940 基本ファイル読込処理−ＳＴＡＲＴ.                                
002950*                                                                 
002960     READ  入力ファイル１                                         
002970        AT END                                                    
002980           MOVE  "Y"                  TO  Ｗ−終了−フラグ１      
002990           MOVE  HIGH-VALUE           TO  Ｗ−ＫＥＹ−契約番号１  
003000           GO    TO   基本ファイル読込処理−ＥＸＩＴ              
003010     END-READ.                                                    
003020*                                                                 
003030*--< ファイル読込状態判定 >                                       
003040     EVALUATE  Ｗ−状態                                           
003050        WHEN  ZERO                                                
003060*--<       基本ファイルキーのセット >                             
003070           MOVE   入力１−契約番号    TO  Ｗ−ＫＥＹ−契約番号１  
003080*                                                                 
003090*--< 基本ファイル入力件数のカウント >                             
003100           COMPUTE   Ｗ−入力−件数１  =  Ｗ−入力−件数１ + 1    
003110        WHEN  OTHER                                               
003120*--< 基本ファイル読込エラー >                                     
003130           MOVE     -40               TO  Ｗ−エラーコード        
003140           PERFORM  エラー処理                                    
003150     END-EVALUATE.                                                
003160*                                                                 
003170 基本ファイル読込処理−ＥＸＩＴ.                                  
003180     EXIT.                                                        
003190******************************************************************
003200*    ファクタリング手形売掛債権読込処理                          *
003210******************************************************************
003220 手形売掛債権ファイル読込処理         SECTION.                    
003230 手形売掛債権ファイル読込処理−ＳＴＡＲＴ.                        
003240*                                                                 
003250     READ  入力ファイル２                                         
003260        AT END                                                    
003270           MOVE  "Y"                  TO  Ｗ−終了−フラグ２      
003280           MOVE  HIGH-VALUE           TO  Ｗ−ＫＥＹ−契約番号２  
003290           GO    TO   手形売掛債権ファイル読込処理−ＥＸＩＴ      
003300     END-READ.                                                    
003310*                                                                 
003320*--< ファイル読込状態判定 >                                       
003330     EVALUATE  Ｗ−状態                                           
003340        WHEN  ZERO                                                
003350*--<       手形売掛債権ファイルルキーのセット >                   
003360           MOVE   入力２−契約番号    TO  Ｗ−ＫＥＹ−契約番号２  
003370*                                                                 
003380*--< 手形売掛債権ファイル入力件数の加算 >                         
003390           COMPUTE   Ｗ−入力−件数２                             
003400                                = Ｗ−入力−件数２ + 1            
003410        WHEN  OTHER                                               
003420*--< 手形売掛債権ファイル読込エラー >                             
003430           MOVE     -50               TO  Ｗ−エラーコード        
003440           PERFORM  エラー処理                                    
003450     END-EVALUATE.                                                
003460*                                                                 
003470 手形売掛債権ファイル読込処理−ＥＸＩＴ.                          
003480     EXIT.                                                        
003490*                                                                 
003500******************************************************************
003510*    契約内容個別情報編集処理                                    *
003520******************************************************************
003530 契約内容個別情報編集処理            SECTION.                     
003540 契約内容個別情報編集処理−ＳＴＡＲＴ.                            
003550*                                                                 
003560*--< 出力レコードの初期化処理 >                                   
003570     MOVE  SPACE                      TO  出力−レコード.         
003580     INITIALIZE                           出力−レコード.         
003590*                                                                 
003600*--< NO.1 >                                                       
003610     MOVE  入力１−契約番号           TO  出力−契約番号.         
003620*--< No.2 >                                                       
003630     MOVE  ZERO                       TO  出力−再リース回数.     
003640*--< No.3 >                                                       
003650     IF   入力１−業務区分 = "1"                                  
003660          MOVE   "00"                 TO  出力−対抗要件          
003670     ELSE IF 入力１−業務区分 = "2"                               
003680          MOVE  "01"                  TO  出力−対抗要件          
003690     END-IF.                                                      
003700*--< NO.4 >                                                       
003710     MOVE  入力２−割引料             TO  出力−割引料.           
003720*--< NO.5 >                                                       
003730     MOVE  入力２−受取手数料         TO  出力−受取手数料.       
003740*--< NO.6 >                                                       
003750     MOVE  入力２−受取手数料消費税等額                           
003760                                      TO  出力−受取手数料消費税. 
003770*--< NO.7 >                                                       
003780     MOVE  ZERO                       TO  出力−取立手数料.       
003790*--< NO.8 >                                                       
003800     MOVE  ZERO                       TO  出力−取立手数料消費税. 
003810*--< NO.9 >                                                       
003820     MOVE  入力１−利率基数コード     TO  出力−利率基数区分.     
003830*--< NO.10 >                                                      
003840     MOVE  入力１−利息端数処理コード TO  出力−利息端数区分.     
003850*--< NO.11 >                                                      
003860     MOVE  入力１−片端両端区分       TO  出力−片端両端区分.     
003870*--< NO.12 >                                                      
003880     MOVE  入力１−休日対応区分       TO  出力−休日対応区分.     
003890*--< NO.13 >                                                      
003900     MOVE  入力１−前取後取区分       TO  出力−利息計算区分.     
003910*--< NO.14 >                                                      
003920     MOVE  ZERO                       TO  出力−初回利息区分.     
003930*--< NO.15 >                                                      
003940     MOVE  入力１−月利複利率         TO  出力−実質年率.         
003950*--< No.16 >                                                      
003960     MOVE  入力１−スプレッド         TO  出力−スプレッド.       
003970*--< No.17 >                                                      
003980     PERFORM  利息日西暦変換.                                     
003990     MOVE  Ｗ−利息日西暦             TO  出力−初回元本回収日.   
004000*--< No.18 >                                                      
004010     MOVE  "1"                        TO  出力−元本サイクル.     
004020*--< No.19 >                                                      
004030     MOVE  "1"                        TO  出力−元本回数.         
004040*--< No.20 >                                                      
004050     PERFORM  利息日西暦変換.                                     
004060     MOVE  Ｗ−利息日西暦              TO  出力−初回利息回収日.  
004070*--< No.21 >                                                      
004080     MOVE  "1"                        TO  出力−利息サイクル.     
004090*--< NO.22 >                                                      
004100     MOVE  "1"                        TO  出力−利息回数.         
004110*--< No.23 >                                                      
004120     MOVE  "0"                        TO  出力−見直しサイクル.   
004130*--< NO.24 >                                                      
004140     PERFORM  利息日西暦変換.                                     
004150     MOVE  Ｗ−利息日西暦             TO  出力−利率確定期限.     
004160*--< NO.25 >                                                      
004170     MOVE  ZERO                       TO  出力−第１回返済日.     
004180*--< NO.26 >                                                      
004190     MOVE  ZERO                       TO  出力−第２回返済日.     
004200*--< NO.27 >                                                      
004210     MOVE  SPACE                      TO  出力−裏付取引.         
004220*--< NO.28 >                                                      
004230     MOVE  SPACE                      TO  出力−担保コメント.     
004240*--< NO.29 >                                                      
004250     MOVE  SPACE                      TO  出力−確認コメント.     
004260*--< NO.30 >                                                      
004270     IF   入力１−業務区分 = "1"                                  
004280          MOVE   入力２−手形裏書方法 TO  出力−手形裏書方法      
004290     ELSE                                                         
004300          MOVE   ZERO                 TO  出力−手形裏書方法      
004310     END-IF.                                                      
004320*--< NO.31 >                                                      
004330     MOVE  Ｗ−システム日付           TO  出力−登録年月日.       
004340*--< NO.32 >                                                      
004350     MOVE  Ｗ−システム時刻           TO  出力−登録時間.         
004360*--< NO.33 >                                                      
004370     MOVE  Ｗ−担当者                 TO  出力−登録担当者.       
004380*--< NO.34 >                                                      
004390     MOVE  Ｗ−システム日付           TO  出力−更新年月日.       
004400*--< NO.35 >                                                      
004410     MOVE  Ｗ−システム時刻           TO  出力−更新時間.         
004420*--< NO.36 >                                                      
004430     MOVE  Ｗ−担当者                 TO  出力−更新者.           
004440*--< NO.37 >                                                      
004450     MOVE  Ｗ−担当者                 TO  出力−入力担当者コード. 
004460*--< NO.38 >                                                      
004470     MOVE  ZERO                       TO  出力−新規書替区分.     
004480*--< NO.39 >                                                      
004490     MOVE  ZERO                       TO  出力−書替先契約番号.   
004500*                                                                 
004510     PERFORM   契約内容個別情報ファイル出力処理.                  
004520*                                                                 
004530  契約内容個別情報編集処理−ＥＸＩＴ.                             
004540     EXIT.                                                        
004550******************************************************************
004560*    利息日を西暦変換                                            *
004570******************************************************************
004580 利息日西暦変換                       SECTION.                    
004590 利息日西暦変換−ＳＴＡＲＴ.                                      
004600*                                                                 
004610     EVALUATE  Ｗ−利息期日 (1:1)                                 
004620        WHEN  "0"                                                 
004630             MOVE  "19"              TO  Ｗ−利息日西暦(1:2)      
004640        WHEN  "1"                                                 
004650             MOVE  "20"              TO  Ｗ−利息日西暦(1:2)      
004660     END-EVALUATE.                                                
004670        MOVE  Ｗ−利息期日 (2:6)     TO  Ｗ−利息日西暦(3:6).     
004680*                                                                 
004690 利息日西暦変換−ＥＸＩＴ.                                        
004700     EXIT.                                                        
004710*                                                                 
004720******************************************************************
004730*    契約内容個別情報ファイル出力処理                            *
004740******************************************************************
004750 契約内容個別情報ファイル出力処理    SECTION.                     
004760 契約内容個別情報ファイル出力処理−ＳＴＡＲＴ.                    
004770*                                                                 
004780     WRITE  出力−レコード.                                       
004790*                                                                 
004800*--< 契約内容個別情報ファイル出力件数の状態判定 >                 
004810     EVALUATE  Ｗ−状態                                           
004820        WHEN  ZERO                                                
004830*--< 契約内容個別情報ファイル出力件数ファイル出力件数の加算 >     
004840           COMPUTE  Ｗ−出力−件数 =  Ｗ−出力−件数 + 1          
004850        WHEN  OTHER                                               
004860*--<  契約内容個別情報ファイル出力エラー >                        
004870           MOVE     -60                TO  Ｗ−エラーコード       
004880           PERFORM  エラー処理                                    
004890     END-EVALUATE.                                                
004900*                                                                 
004910 契約内容個別情報ファイル出力処理−ＥＸＩＴ.                      
004920     EXIT.                                                        
004930******************************************************************
004940*    終了処理                                                    *
004950******************************************************************
004960 終了処理                             SECTION.                    
004970 終了処理−ＳＴＡＲＴ.                                            
004980*                                                                 
004990*----------------------------------------------------------------*
005000*    ファイルクローズ                                            *
005010*----------------------------------------------------------------*
005020     CLOSE  入力ファイル１.                                       
005030     CLOSE  入力ファイル２.                                       
005040     CLOSE  出力ファイル.                                         
005050*                                                                 
005060*--< 終了メッセージ出力処理                                       
005070     PERFORM  終了メッセージ出力.                                 
005080*                                                                 
005090*--< プログラム正常終了 >                                         
005100     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
005110*                                                                 
005120 終了処理−ＥＸＩＴ.                                              
005130     EXIT.                                                        
005140*                                                                 
005150******************************************************************
005160*    終了メッセージ出力                                          *
005170******************************************************************
005180  終了メッセージ出力                  SECTION.                    
005190  終了メッセージ出力−ＳＴＡＲＴ.                                 
005200*----------------------------------------------------------------*
005210*    ファクタリング基本ファイル入力件数                          *
005220*----------------------------------------------------------------*
005230     INITIALIZE                       IF-CHOCO001.                
005240     MOVE  "3"                        TO  共１−イベント種別.     
005250     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005260     MOVE  "0"                        TO  共１−復帰コード.       
005270     MOVE  "FFUIS326"                 TO  共１−処理テーブルＩＤ. 
005280     MOVE  "COUNT"                    TO  共１−処理識別.         
005290     MOVE  Ｗ−入力−件数１           TO  共１−データ内容.       
005300     MOVE  "ファクタリング基本読込件数"                           
005310                                      TO  共１−その他メッセージ. 
005320     CALL  CLOCO001                USING  IF-CHOCO001.            
005330*                                                                 
005340*----------------------------------------------------------------*
005350*    ファクタリング手形売掛債権入力件数                          *
005360*----------------------------------------------------------------*
005370     INITIALIZE                       IF-CHOCO001.                
005380     MOVE  "3"                        TO  共１−イベント種別.     
005390     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005400     MOVE  "0"                        TO  共１−復帰コード.       
005410     MOVE  "FFUIS329"                 TO  共１−処理テーブルＩＤ. 
005420     MOVE  "COUNT"                    TO  共１−処理識別.         
005430     MOVE   Ｗ−入力−件数２          TO  共１−データ内容.       
005440     MOVE  "ファクタリング手形売掛債権読込件数"                   
005450                                      TO  共１−その他メッセージ. 
005460     CALL  CLOCO001                USING  IF-CHOCO001.            
005470*                                                                 
005480*----------------------------------------------------------------*
005490*    契約内容個別情報ファイル１出力件数                          *
005500*----------------------------------------------------------------*
005510     INITIALIZE                       IF-CHOCO001.                
005520     MOVE  "3"                        TO  共１−イベント種別.     
005530     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005540     MOVE  "0"                        TO  共１−復帰コード.       
005550     MOVE  "FFUIS32A"                 TO  共１−処理テーブルＩＤ. 
005560     MOVE  "COUNT"                    TO  共１−処理識別.         
005570     MOVE   Ｗ−出力−件数            TO  共１−データ内容.       
005580     MOVE  " 契約内容個別情報ファイル１出力件数"                  
005590                                      TO  共１−その他メッセージ.  
005600     CALL  CLOCO001                USING  IF-CHOCO001.            
005610*                                                                 
005620*----------------------------------------------------------------*
005630*    終了メッセージ 出力                                         *
005640*----------------------------------------------------------------*
005650     INITIALIZE                       IF-CHOCO001.                
005660     MOVE  "3"                        TO  共１−イベント種別.     
005670     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
005680     MOVE  "0"                        TO  共１−復帰コード.       
005690     MOVE  "END"                      TO  共１−処理識別.         
005700     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
005710     CALL  CLOCO001                USING  IF-CHOCO001.            
005720*                                                                 
005730 終了メッセージ出力−ＥＸＩＴ.                                    
005740     EXIT.                                                        
005750*                                                                 
005760******************************************************************
005770*    エラー処理                                                  *
005780******************************************************************
005790 エラー処理                           SECTION.                    
005800 エラー処理−ＳＴＡＲＴ.                                          
005810*                                                                 
005820     MOVE  "Y"                        TO  Ｗ−異常終了−フラグ.   
005830     INITIALIZE                           IF-CHOCO001.            
005840*                                                                 
005850     EVALUATE  Ｗ−エラーコード                                   
005860        WHEN  -10                                                 
005870*--< 基本ファイループンエラー  >                                  
005880           MOVE  "1"                  TO  共１−イベント種別      
005890           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
005900           MOVE  "9"                  TO  共１−復帰コード        
005910           MOVE  "FFUIS326"           TO  共１−処理テーブルＩＤ  
005920           MOVE  "OPEN"               TO  共１−処理識別          
005930           MOVE  Ｗ−状態             TO  共１−データ内容        
005940           MOVE  "基本ファイループンエラー "                      
005950                                      TO  共１−その他メッセージ  
005960           CALL  CLOCO001          USING  IF-CHOCO001             
005970*                                                                 
005980        WHEN  -20                                                 
005990*--< 手形売掛債権ファイループンエラー >                           
006000           MOVE  "1"                  TO  共１−イベント種別      
006010           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006020           MOVE  "9"                  TO  共１−復帰コード        
006030           MOVE  "FFUIS329"           TO  共１−処理テーブルＩＤ  
006040           MOVE  "OPEN"               TO  共１−処理識別          
006050           MOVE  Ｗ−状態             TO  共１−データ内容        
006060           MOVE  "手形売掛債権ファイループンエラー "              
006070                                      TO  共１−その他メッセージ  
006080           CALL  CLOCO001          USING  IF-CHOCO001             
006090*                                                                 
006100        WHEN  -30                                                 
006110*--< 契約内容個別情報ファイルオープンエラー >                     
006120           MOVE  "1"                  TO  共１−イベント種別      
006130           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006140           MOVE  "9"                  TO  共１−復帰コード        
006150           MOVE  "FFUIS32A"           TO  共１−処理テーブルＩＤ  
006160           MOVE  "OPEN"               TO  共１−処理識別          
006170           MOVE  Ｗ−状態             TO  共１−データ内容        
006180           MOVE  "契約内容個別情報ファイルオープンエラー "        
006190                                      TO  共１−その他メッセージ  
006200           CALL  CLOCO001          USING  IF-CHOCO001             
006210*                                                                 
006220        WHEN  -40                                                 
006230*--<  基本ファイル読込エラー  >                                   
006240           MOVE  "1"                  TO  共１−イベント種別      
006250           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006260           MOVE  "9"                  TO  共１−復帰コード        
006270           MOVE  "FFUIS326"           TO  共１−処理テーブルＩＤ  
006280           MOVE  "READ"               TO  共１−処理識別          
006290           MOVE  Ｗ−状態             TO  共１−データ内容        
006300           MOVE  "ファクタリング基本読込エラー "                  
006310                                      TO  共１−その他メッセージ  
006320           CALL  CLOCO001          USING  IF-CHOCO001             
006330*                                                                 
006340        WHEN  -50                                                 
006350*--<  手形売掛債権ファイル読込エラー >                            
006360           MOVE  "1"                  TO  共１−イベント種別      
006370           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006380           MOVE  "9"                  TO  共１−復帰コード        
006390           MOVE  "FFUIS329"           TO  共１−処理テーブルＩＤ  
006400           MOVE  "READ"               TO  共１−処理識別          
006410           MOVE  Ｗ−状態             TO  共１−データ内容        
006420           MOVE  "ファクタリング手形売掛債権読込エラー "          
006430                                      TO  共１−その他メッセージ  
006440           CALL  CLOCO001          USING  IF-CHOCO001             
006450*                                                                 
006460        WHEN  -60                                                 
006470*--<  契約内容個別情報ファイル出力エラー  >                       
006480           MOVE  "1"                  TO  共１−イベント種別      
006490           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
006500           MOVE  "9"                  TO  共１−復帰コード        
006510           MOVE  "FFUIS32A"           TO  共１−処理テーブルＩＤ  
006520           MOVE  "WRITE"              TO  共１−処理識別          
006530           MOVE  Ｗ−状態             TO  共１−データ内容        
006540           MOVE  " 契約内容個別情報ファイル出力エラー "           
006550                                      TO  共１−その他メッセージ  
006560           CALL  CLOCO001          USING  IF-CHOCO001             
006570*                                                                 
006580        WHEN  OTHER                                               
006590           MOVE  "N"                  TO  Ｗ−異常終了−フラグ    
006600*                                                                 
006610     END-EVALUATE.                                                
006620*                                                                 
006630     IF  Ｗ−異常終了−フラグ  =  "Y"                             
006640        PERFORM  終了メッセージ出力                               
006650*                                                                 
006660*--<    プログラム異常終了のリターンコード >                      
006670        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
006680*                                                                 
006690        EXIT  PROGRAM                                             
006700     END-IF.                                                      
006710*                                                                 
006720 エラー処理−ＥＸＩＴ.                                            
006730      EXIT.                                                       
006740******************************************************************
006750*                  END OF PROGRAM                                *
006760******************************************************************
