000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名  : 受取手形移行処理                       *
000040*      2. プログラムID  : COBIS630                               *
000050*      3. 処理概要      : ＜受取手形テーブル＞受取手形の情報を代 *
000060*                         表契約番号、束数位で管理したもの       *
000070*                         ＜受取手形展開テーブル＞受取手形の情報 *
000080*                         を代表契約番号、束数、連番（代表契約番 *
000090*                         号、束数単位)単位で管理したもの        *
000100*      4. 作成者        : COBIS630                               *
000110*      5. 作成日        : 2005.04.00                             *
000120******************************************************************
000130*                                                                 
000140******************************************************************
000150*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000160******************************************************************
000170 IDENTIFICATION                       DIVISION.                   
000180*                                                                 
000190 PROGRAM-ID.                          COBIS630.                   
000200******************************************************************
000210*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000220******************************************************************
000230 ENVIRONMENT                          DIVISION.                   
000240******************************************************************
000250*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000260******************************************************************
000270 INPUT-OUTPUT                         SECTION.                    
000280*                                                                 
000290 FILE-CONTROL.                                                    
000300     SELECT    入力ファイル１         ASSIGN    TO     U01        
000310     FILE      STATUS     IS          Ｗ−状態                    
000320     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000330*                                                                 
000340     SELECT    入力ファイル２         ASSIGN    TO     U02        
000350     FILE      STATUS     IS          Ｗ−状態                    
000360     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000370*                                                                 
000380******************************************************************
000390*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000400******************************************************************
000410 DATA                                 DIVISION.                   
000420******************************************************************
000430*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000440******************************************************************
000450 FILE                                 SECTION.                    
000460*----------------------------------------------------------------*
000470*    入力ファイル                                                *
000480*----------------------------------------------------------------*
000490 FD  入力ファイル１                                               
000500     LABEL     RECORD     IS          STANDARD                    
000510     BLOCK     CONTAINS   0           RECORDS.                    
000520*                                                                 
000530 01  入力−レコード１.                                            
000540     COPY  CPBIS061  REPLACING  ==()==  BY  ==入力１−==.         
000550*                                                                 
000560 FD  入力ファイル２                                               
000570     LABEL     RECORD     IS          STANDARD                    
000580     BLOCK     CONTAINS   0           RECORDS.                    
000590*                                                                 
000600 01  出力−レコード２.                                            
000610     COPY  CPBIS062  REPLACING  ==()==  BY  ==入力２−==.         
000620*                                                                 
000630******************************************************************
000640*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000650******************************************************************
000660  WORKING-STORAGE                     SECTION.                    
000670*----------------------------------------------------------------*
000680*    ホスト変数定義エリア                                        *
000690*----------------------------------------------------------------*
000700     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000710*                                                                 
000720 01  ＷＳ−取引先コード               PIC  X(08).                 
000730 01  ＷＳ−目的ＣＤ                   PIC  9(01) VALUE  2.      
000740 01  ＷＳ−入力１契約ＮＯ             PIC  X(09).                 
000750 01  ＷＳ−入力２支払人コード         PIC  X(08).                 
000760*--< ＯＲＡＣＬＥ共通変数 >                                       
000770     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000780*                                                                 
000790*--< ＯＲＡＣＬＥ  ＳＱＬ実行情報 >                               
000800     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000810*                                                                 
000820*--< 受取手形テーブル >                                           
000830     EXEC  SQL  INCLUDE  D642UTG.CBL           END-EXEC.          
000840*                                                                 
000850*--< 受取手形展開テーブル >                                       
000860     EXEC  SQL  INCLUDE  D645UTT.CBL           END-EXEC.          
000870*                                                                 
000880*--< 変換テーブル >                                               
000890     EXEC  SQL  INCLUDE  IKOTBL001.CBL         END-EXEC.          
000900*                                                                 
000910*--< 契約種類等変換テーブル >                                     
000920     EXEC  SQL  INCLUDE  IKOTBL002.CBL         END-EXEC.          
000930*                                                                 
000940     EXEC  SQL  END  DECLARE          SECTION  END-EXEC.          
000950*                                                                 
000960*----------------------------------------------------------------*
000970*    ＷＯＲＫエリア                                              *
000980*----------------------------------------------------------------*
000990 01  ＷＯＲＫ−エリア.                                            
001000*--< エラー判定用 >                                               
001010     03  Ｗ−エラーコード             PIC S9(04).                 
001020*                                                                 
001030*--< フラグアリア >                                               
001040     03  フラグアリア.                                            
001050         05  Ｗ−終了−フラグ１       PIC  X(01).                 
001060         05  Ｗ−終了−フラグ２       PIC  X(01).                 
001070         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001080*                                                                 
001090*--< 件数エリア >                                                 
001100     03  件数エリア.                                              
001110         05  Ｗ−入力−件数１         PIC  9(09).                 
001120         05  Ｗ−入力−件数２         PIC  9(09).                 
001130         05  Ｗ−出力−件数１         PIC  9(09).                 
001140         05  Ｗ−出力−件数２         PIC  9(09).                 
001150*                                                                 
001160*--< 連番エリア >                                                       
001170     03  連番エリア.                                                    
001180         05  ＷＩ−契約ＮＯ１         PIC  X(10).                 
001190         05  ＷＯ−契約ＮＯ１         PIC  X(10).                 
001200         05  ＷＩ−束数               PIC S9(03).                 
001210         05  ＷＯ−束数               PIC S9(03).                 
001220         05  Ｗ−連番                 PIC S9(03).                 
001230*                                                                 
001240*--< ファイル状態 >                                               
001250     03  Ｗ−状態エリア.                                          
001260         05  Ｗ−状態                 PIC  X(02).                 
001270*--< 共通情報 >                                                   
001280 01  Ｗ−共通情報.                                                
001290     03  Ｗ−システム日付.                                        
001300         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001310         05  Ｗ−年月日               PIC  X(06).                 
001320     03  Ｗ−システム時刻             PIC  X(08).                 
001330     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001340*                                                                 
001350*----------------------------------------------------------------*
001360*    サブルーチン名                                              *
001370*----------------------------------------------------------------*
001380 01  CALL-AREA.                                                   
001390*--< 共通ログサブルーチン >                                       
001400     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001410     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001420*                                                                 
001430*----------------------------------------------------------------*
001440*    ＣＯＰＹ領域                                                *
001450*----------------------------------------------------------------*
001460*--< 共通ログ用パラメータ >                                       
001470 01  IF-CHOCO001.                                                 
001480     COPY  CHOCO001  REPLACING  ==()==  BY  ==共通−==.           
001490*                                                                 
001500*----------------------------------------------------------------*
001510*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001520*----------------------------------------------------------------*
001530 01  PARA-AREA.                                                   
001540     COPY CPBCO001.                                               
001550*                                                                 
001560*----------------------------------------------------------------*
001570*    レコード初期化領域                                          *
001580*----------------------------------------------------------------*
001590 01  初期化レコード.                                              
001600     COPY  CISUF470  REPLACING  ==()==  BY  ==初期化−==.         
001610*                                                                 
001620******************************************************************
001630*    定数用データ定義エリア                                      *
001640******************************************************************
001650 CONSTANT                             SECTION.                    
001660 01  定数領域.                                                    
001670     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS630".
001680     03  定数−プログラム名           PIC  X(80)                  
001690                                      VALUE  "受取手形移行処理".  
001700     03  定数−ＳＱＬＯＫ             PIC S9(04)  VALUE  ZERO.    
001710     03  定数−ＳＱＬＥＮＤ           PIC S9(04)  VALUE  0100.    
001720     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001730     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001740******************************************************************
001750*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001760******************************************************************
001770 PROCEDURE                            DIVISION.                   
001780*                                                                 
001790     PERFORM  初期処理.                                           
001800*                                                                 
001810     PERFORM  主処理  UNTIL  (Ｗ−終了−フラグ１  =  "Y"          
001820                        AND   Ｗ−終了−フラグ２  =  "Y").          
001830*                                                                 
001840     PERFORM  終了処理.                                           
001850*                                                                 
001860     STOP     RUN.                                                
001870*                                                                 
001880******************************************************************
001890*    初期処理                                                    *
001900******************************************************************
001910 初期処理                             SECTION.                    
001920 初期処理−ＳＴＡＲＴ.                                            
001930*                                                                 
001940*----------------------------------------------------------------*
001950*    開始メッセージ出力処理                                      *
001960*----------------------------------------------------------------*
001970     INITIALIZE                       IF-CHOCO001.                
001980     MOVE  "3"                        TO  共通−イベント種別.     
001990     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
002000     MOVE  "0"                        TO  共通−復帰コード.       
002010     MOVE  "START"                    TO  共通−処理識別.         
002020     MOVE  定数−プログラム名         TO  共通−その他メッセージ. 
002030     CALL  CLOCO001                USING  IF-CHOCO001.            
002040*                                                                 
002050*----------------------------------------------------------------*
002060*    作業領域の初期値処理                                        *
002070*----------------------------------------------------------------*
002080     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
002090     INITIALIZE                           ＷＯＲＫ−エリア.       
002100*                                                                 
002110
002120*                                                                 
002130*--< ＣＰＵ日付を取得 >                                           
002140     ACCEPT  Ｗ−年月日               FROM  DATE.                 
002150*                                                                 
002160*--< ＣＰＵ時刻を取得 >                                           
002170     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
002180*                                                                 
002190     PERFORM  手形基本ファイルオープン.                           
002200*                                                                 
002210     PERFORM  受取手形ファイルオープン.                           
002220*                                                                 
002230     PERFORM  ＯＲＡＣＬＥ接続.                                   
002240*                                                                 
002250*--< 手形基本ファイル読込処理(１件目) >                           
002260     PERFORM  手形基本ファイル読込処理.                           
002270*                                                                 
002280*--< 結合テーブルカーソル読込(１件目) >                           
002290     PERFORM  受取手形ファイル読込処理.                           
002300*                                                                 
002310 初期処理−ＥＸＩＴ.                                              
002320     EXIT.                                                        
002330******************************************************************
002340*    ＯＲＡＣＬＥ接続                                            *
002350******************************************************************
002360 ＯＲＡＣＬＥ接続                     SECTION.                    
002370 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002380*                                                                 
002390*--< ＤＢ接続用情報を取得処理 >                                   
002400     CALL  COBCO001                USING  PARA-AREA.              
002410*                                                                 
002420     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002430     MOVE  PARA-USERNAME              TO  USERNAME.               
002440     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002450*                                                                 
002460*----------------------------------------------------------------*
002470*    開始接続                                                    *
002480*----------------------------------------------------------------*
002490     IF    DB-STRING  =  SPACE                                    
002500        EXEC SQL                                                  
002510           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002520        END-EXEC                                                  
002530     ELSE                                                         
002540        EXEC SQL                                                  
002550           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002560             USING  :DB-STRING                                    
002570        END-EXEC                                                  
002580     END-IF.                                                      
002590*                                                                 
002600*----------------------------------------------------------------*
002610*    接続確認                                                    *
002620*----------------------------------------------------------------*
002630     EVALUATE  SQLCODE                                            
002640        WHEN   定数−ＳＱＬＯＫ                                   
002650           CONTINUE                                               
002660        WHEN   OTHER                                              
002670*--<       接続エラー >                                           
002680           MOVE     -10               TO  Ｗ−エラーコード        
002690           PERFORM  エラー判定処理                                
002700     END-EVALUATE.                                                
002710*                                                                 
002720 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002730     EXIT.                                                        
002740******************************************************************
002750*    手形基本、受取手形ファイルオープン                          *
002760******************************************************************
002770*                                                                 
002780*----------------------------------------------------------------*
002790*    手形基本ファイルのオープン                                  *
002800*----------------------------------------------------------------*
002810 手形基本ファイルオープン             SECTION.                    
002820 手形基本ファイルオープン−ＳＴＡＲＴ.                            
002830*                                                                 
002840     OPEN  INPUT   入力ファイル１.                                
002850*                                                                 
002860*--< ファイルオープンの状態判定 >                                 
002870     EVALUATE  Ｗ−状態                                           
002880        WHEN  ZERO                                                
002890           CONTINUE                                               
002900        WHEN  OTHER                                               
002910*--<       ファイルオープンエラー >                               
002920           MOVE     -1                TO  Ｗ−エラーコード        
002930           PERFORM  エラー判定処理                                
002940     END-EVALUATE.                                                
002950*                                                                 
002960 手形基本ファイルオープン−ＥＸＩＴ.                              
002970     EXIT.                                                        
002980*----------------------------------------------------------------*
002990*    受取手形ファイルのオープン                                  *
003000*----------------------------------------------------------------*
003010 受取手形ファイルオープン             SECTION.                    
003020 受取手形ファイルオープン−ＳＴＡＲＴ.                            
003030*                                                                 
003040     OPEN  INPUT    入力ファイル２.                               
003050*                                                                 
003060*--< ファイルオープンの状態判定 >                                 
003070     EVALUATE  Ｗ−状態                                           
003080        WHEN  ZERO                                                
003090           CONTINUE                                               
003100        WHEN  OTHER                                               
003110*--<       ファイルオープンエラー >                               
003120           MOVE     -2                TO  Ｗ−エラーコード        
003130           PERFORM  エラー判定処理                                
003140     END-EVALUATE.                                                
003150*                                                                 
003160 受取手形ファイルオープン−ＥＸＩＴ.                              
003170     EXIT.                                                        
003180******************************************************************
003190*    手形基本、受取手形ファイル読込処理                          *
003200******************************************************************
003210*                                                                 
003220*----------------------------------------------------------------*
003230*    手形基本ファイル読込処理                                    *
003240*----------------------------------------------------------------*
003250 手形基本ファイル読込処理             SECTION.                    
003260 手形基本ファイル読込処理−ＳＴＡＲＴ.                            
003270*                                                                 
003280     READ  入力ファイル１                                         
003290        AT END                                                    
003300           MOVE  "Y"                  TO  Ｗ−終了−フラグ１      
003310           MOVE  HIGH-VALUE           TO  入力１−契約ＮＯ        
003320           GO    TO   手形基本ファイル読込処理−ＥＸＩＴ.          
003330                                                                 
003340*--< 手形基本ファイル読込状態判定 >                               
003350     EVALUATE  Ｗ−状態                                           
003360        WHEN  ZERO                                                
003370*--<       手形基本ファイル入力件数のカウント >                   
003380           COMPUTE  Ｗ−入力−件数１  =  Ｗ−入力−件数１ + 1     
003390        WHEN  OTHER                                               
003400*--<       手形基本ファイル読込エラー >                           
003410           MOVE     -3                TO  Ｗ−エラーコード        
003420           PERFORM  エラー判定処理                                
003430     END-EVALUATE.                                                
003440*                                                                 
003450 手形基本ファイル読込処理−ＥＸＩＴ.                              
003460     EXIT.                                                        
003470*----------------------------------------------------------------*
003480*    受取手形ファイル読込処理                                    *
003490*----------------------------------------------------------------*
003500 受取手形ファイル読込処理             SECTION.                    
003510 受取手形ファイル読込処理−ＳＴＡＲＴ.                            
003520*                                                                 
003530     READ  入力ファイル２                                         
003540        AT END                                                    
003550           MOVE  "Y"                  TO  Ｗ−終了−フラグ２      
003560           MOVE  HIGH-VALUE           TO  入力２−契約ＮＯ        
003570           GO    TO   受取手形ファイル読込処理−ＥＸＩＴ.         
003580                                                                      
003590*--< 受取手形ファイル読込状態判定 >                               
003600     EVALUATE  Ｗ−状態                                           
003610        WHEN  ZERO                                                
003620*--<       受取手形ファイル入力件数のカウント >                   
003630           COMPUTE  Ｗ−入力−件数２  =  Ｗ−入力−件数２ + 1     
003640        WHEN  OTHER                                               
003650*--<       受取手形ファイル読込エラー >                           
003660           MOVE     -4                TO  Ｗ−エラーコード        
003670           PERFORM  エラー判定処理                                
003680     END-EVALUATE.                                                
003690*                                                                 
003700 受取手形ファイル読込処理−ＥＸＩＴ.                              
003710     EXIT.                                                        
003720*                                                                 
003730******************************************************************
003740*    主処理                                                      *
003750******************************************************************
003760 主処理                               SECTION.                    
003770 主処理−ＳＴＡＲＴ.                                              
003780*                                                                 
003790     EVALUATE  TRUE                                               
003800*--<    持分ファイルのみの場合 >                                  
003810        WHEN  入力１−契約ＮＯ > 入力２−契約ＮＯ                 
003820           PERFORM  受取手形ファイル読込処理                      
003830*                                                                 
003840*--<    マッチングの場合 >                                        
003850        WHEN  入力１−契約ＮＯ = 入力２−契約ＮＯ                 
003860           PERFORM  編集出力処理                                  
003870*                                                                 
003880           PERFORM  受取手形ファイル読込処理                      
003890*                                                                 
003900*--<    持分以外ファイルのみの場合 >                              
003910        WHEN  入力１−契約ＮＯ < 入力２−契約ＮＯ                 
003920           PERFORM  手形基本ファイル読込処理                      
003930*                                                                 
003940     END-EVALUATE.                                                
003950*                                                                 
003960 主処理−ＥＸＩＴ.                                                
003970     EXIT.                                                        
003980******************************************************************
003990*     手形基本、受取手形編集出力処理                             *
004000******************************************************************
004010 編集出力処理                         SECTION.                    
004020 編集出力処理−ＳＴＡＲＴ.                                        
004030*                                                                 
004040     PERFORM  手形基本編集処理.                                   
004050*                                                                 
004060     PERFORM  手形基本出力処理.                                   
004070*                                                                 
004080     PERFORM  受取手形編集処理.                                   
004090*                                                                 
004100     PERFORM  受取手形出力処理.                                   
004110*                                                                 
004120 編集出力処理−ＥＸＩＴ.                                          
004130     EXIT.                                                        
004140*                                                                 
004150******************************************************************
004160*    手形基本、受取手形編集処理                                  *
004170******************************************************************
004180 手形基本編集処理                     SECTION.                    
004190 手形基本編集処理−ＳＴＡＲＴ.                                    
004200*                                                                 
004210     MOVE  入力１−取引先コード       TO  ＷＳ−取引先コード.     
004220     MOVE  入力１−契約ＮＯ           TO  ＷＳ−入力１契約ＮＯ.   
004230     MOVE  入力２−支払人コード       TO  ＷＳ−入力２支払人コード.
004240
004250*                                                                 
004260*--< No.01 >                                                      
004270     MOVE  入力１−契約ＮＯ           TO  Ｄ６４２−代表契約番号. 
004280*--< No.02 >                                                      
004290     MOVE  入力２−束数               TO  Ｄ６４２−束数.         
004300*--< No.03 >                                                      
004310     EXEC  SQL                                                    
004320        SELECT  取引先コード                                      
004330               ,目的ＣＤ                                          
004340          INTO :ＩＫＯ００１−取引先コード                        
004350              ,:ＩＫＯ００１−目的ＣＤ                            
004360          FROM  IKOTBL001                                          
004370         WHERE  取引先コード  =  :ＷＳ−取引先コード              
004380           AND  目的ＣＤ      =  :ＷＳ−目的ＣＤ                  
004390     END-EXEC.                                                    
004400*                                                                 
004410     EVALUATE  SQLCODE                                            
004420        WHEN   定数−ＳＱＬＯＫ                                   
004430*--<       正常 >                                                 
004440           CONTINUE                                               
004450        WHEN   OTHER                                              
004460*--<       プログラムが異常終了 >                                 
004470           MOVE      -20              TO  Ｗ−エラーコード        
004480           PERFORM   エラー判定処理                               
004490     END-EVALUATE.                                                
004500     MOVE  ＩＫＯ００１−新取引先コード                           
004510                                      TO  Ｄ６４２−取引先コード. 
004520*--< No.04 >                                                      
004530     MOVE  ＩＫＯ００１−枝番         TO  Ｄ６４２−契約先コード. 
004540*--< No.05 >                                                      
004550     MOVE  入力１−名称漢字           TO  Ｄ６４２−契約先名称.   
004560*--< No.06 >                                                      
004570     MOVE  入力１−名称カナ          TO  Ｄ６４２−契約先名称カナ.
004580*--< No.07 >                                                      
004590     MOVE  入力１−事業所コード       TO  Ｄ６４２−部店コード.   
004600*--< No.08 >                                                      
004610     MOVE  入力１−契約ＮＯ           TO  ＷＳ−入力１契約ＮＯ.   
004620     EXEC  SQL                                                    
004630        SELECT  契約ＮＯ                                          
004640          INTO :ＩＫＯ００２−契約ＮＯ                            
004650          FROM  IKOTBL002                                         
004660         WHERE  契約ＮＯ  =  :ＷＳ−入力１契約ＮＯ                
004670     END-EXEC.                                                    
004680*                                                                 
004690     EVALUATE  SQLCODE                                            
004700        WHEN   定数−ＳＱＬＯＫ                                   
004710*--<       正常 >                                                 
004720           CONTINUE                                               
004730        WHEN   OTHER                                              
004740*--<       異常終了 >                                             
004750           MOVE      -30              TO  Ｗ−エラーコード        
004760           PERFORM   エラー判定処理                               
004770     END-EVALUATE.                                                
004780     MOVE  ＩＫＯ００２−主契約区分   TO  Ｄ６４２−主契約区分.   
004790*--< No.09 >                                                      
004800     MOVE  ZERO                       TO  Ｄ６４２−手形状態.     
004810*--< No.10 >                                                      
004820     MOVE  入力２−取引日             TO  Ｄ６４２−取引日.       
004830*--< No.11>                                                       
004840     MOVE  入力２−伝票発行日         TO  Ｄ６４２−伝票発行日.   
004850*--< No.12 >                                                      
004860     MOVE  入力２−手形種類           TO  Ｄ６４２−手形種類.     
004870*--< No.13 >                                                      
004880     MOVE  入力２−期日基準日         TO  Ｄ６４２−期日基準日.   
004890*--< No.14 >                                                      
004900     MOVE  入力２−期日サイクル       TO  Ｄ６４２−期日サイクル. 
004910*--< No.15 >                                                      
004920     MOVE  入力２−束合計金額         TO  Ｄ６４２−束合計金額.   
004930*--< No.16 >                                                      
004940     MOVE  入力２−手形枚数           TO  Ｄ６４２−手形枚数.     
004950*--< No.17 >                                                      
004960     MOVE  入力２−取立依頼銀行コード TO  Ｄ６４２−取立銀行コード.
004970*--< No.18 >                                                      
004980     MOVE  入力２−支払人コード      TO  Ｄ６４２−支払銀行コード.
004990*--< No.19 >                                                      
005000     MOVE  入力１−契約ＮＯ１         TO  Ｄ６４２−契約番号１.   
005010*--< No.20 >                                                      
005020     MOVE  入力１−契約ＮＯ２         TO  Ｄ６４２−契約番号２.   
005030*--< No.21 >                                                      
005040     MOVE  入力１−契約ＮＯ３         TO  Ｄ６４２−契約番号３.   
005050*--< No.22 >                                                      
005060     MOVE  入力１−契約ＮＯ４         TO  Ｄ６４２−契約番号４.   
005070*--< No.23 >                                                      
005080     MOVE  入力１−契約ＮＯ５         TO  Ｄ６４２−契約番号５.   
005090*--< No.24 >                                                      
005100     MOVE  入力１−契約ＮＯ６         TO  Ｄ６４２−契約番号６.   
005110*--< No.25 >                                                      
005120     MOVE  入力１−契約ＮＯ７         TO  Ｄ６４２−契約番号７.   
005130*--< No.26 >                                                      
005140     MOVE  入力１−契約ＮＯ８         TO  Ｄ６４２−契約番号８.   
005150*--< No.27 >                                                      
005160     MOVE  入力１−契約ＮＯ９         TO  Ｄ６４２−契約番号９.   
005170*--< No.28 >                                                      
005180     MOVE  入力１−契約ＮＯ１０       TO  Ｄ６４２−契約番号１０. 
005190*--< No.29 >                                                      
005200     MOVE  入力２−備考欄             TO  Ｄ６４２−備考欄.       
005210*--< No.30 >                                                      
005220     MOVE  ZERO                       TO  Ｄ６４２−手形内容種別. 
005230*--< No.31 >                                                      
005240     MOVE  Ｗ−システム日付           TO  Ｄ６４２−登録年月日.   
005250*--< No.32 >                                                      
005260     MOVE  Ｗ−システム時刻           TO  Ｄ６４２−登録時間.     
005270*--< No.33 >                                                      
005280     MOVE  Ｗ−担当者                 TO  Ｄ６４２−登録担当者.   
005290*--< No.34 >                                                      
005300     MOVE  Ｗ−システム日付           TO  Ｄ６４２−更新年月日.   
005310*--< No.35 >                                                      
005320     MOVE  Ｗ−システム時刻           TO  Ｄ６４２−更新時間.     
005330*--< No.36 >                                                      
005340     MOVE  Ｗ−担当者                 TO  Ｄ６４２−更新者.       
005350*--< No.37 >                                                      
005360     MOVE  Ｗ−担当者              TO  Ｄ６４２−入力担当者コード.
005370*--< No.38 >                                                      
005380     MOVE  ZERO                       TO  Ｄ６４２−売却代金区分. 
005390*--< No.39 >                                                      
005400     MOVE  入力２−支払人コード      TO  ＷＳ−入力２支払人コード.
005410     EXEC  SQL                                                    
005420        SELECT  取引先コード                                      
005430               ,目的ＣＤ                                          
005440          INTO :ＩＫＯ００１−取引先コード                        
005450              ,:ＩＫＯ００１−目的ＣＤ                            
005460          FROM  IKOTBL001                                          
005470         WHERE  取引先コード  =  :ＷＳ−入力２支払人コード        
005480           AND  目的ＣＤ      =  :ＷＳ−目的ＣＤ                  
005490     END-EXEC.                                                    
005500*                                                                 
005510     EVALUATE  SQLCODE                                            
005520        WHEN   定数−ＳＱＬＯＫ                                   
005530*--<       正常 >                                                 
005540           CONTINUE                                               
005550        WHEN   OTHER                                              
005560*--<       プログラムが異常終了 >                                 
005570           MOVE      -40              TO  Ｗ−エラーコード        
005580           PERFORM   エラー判定処理                               
005590     END-EVALUATE.                                                
005600     MOVE  ＩＫＯ００１−新取引先コード                           
005610                                 TO  Ｄ６４２−振出人取引先コード.
005620*--< No.40 >                                                      
005630     MOVE  ＩＫＯ００１−枝番    TO  Ｄ６４２−振出人契約先コード.
005640*--< No.41 >                                                      
005650     MOVE  入力２−名称漢字           TO  Ｄ６４２−振出人名称.   
005660*--< No.42 >                                                      
005670     MOVE  入力２−名称カナ          TO  Ｄ６４２−振出人名称カナ.
005680 手形基本編集処理−ＥＸＩＴ.                                      
005690     EXIT.                                                        
005700*----------------------------------------------------------------*
005710 受取手形編集処理                     SECTION.                    
005720 受取手形編集処理−ＳＴＡＲＴ.                                    
005730*                                                                 
005740     MOVE  Ｄ６４５−代表契約番号     TO  ＷＩ−契約ＮＯ１.         
005750     MOVE  入力１−契約ＮＯ           TO  ＷＯ−契約ＮＯ１.         
005760     MOVE  Ｄ６４５−束数             TO  ＷＩ−束数.               
005770     MOVE  入力２−束数               TO  ＷＯ−束数.               
005780*                                                                 
005790*--< No.01 >                                                      
005800     MOVE  入力１−契約ＮＯ           TO  Ｄ６４５−代表契約番号. 
005810*--< No.02 >                                                      
005820     MOVE  入力２−束数               TO  Ｄ６４５−束数.         
005830*--< No.03 >                                                      
005840     IF     (ＷＩ−契約ＮＯ１  =  ＷＯ−契約ＮＯ１                    
005850        AND  ＷＩ−束数        =  ＷＯ−束数)                          
005860             Ｗ−連番  =  Ｗ−連番 + 1                      
005870     ELSE                                                         
005880             Ｗ−連番  =  1                                 
005890     END-IF.                                                      
005900     MOVE  Ｗ−連番                   TO  Ｄ６４５−連番.         
005910*--< No.04 >                                                      
005920     MOVE  入力２−手形ＮＯ           TO  Ｄ６４５−手形番号.     
005930*--< No.05 >                                                      
005940     MOVE  入力２−期日               TO  Ｄ６４５−期日.         
005950*--< No.06 >                                                      
005960     MOVE  入力２−金額               TO  Ｄ６４５−金額.         
005970*--< No.07 >                                                      
005980     MOVE  ＩＫＯ００１−新取引先コード                           
005990                                 TO  Ｄ６４５−振出人取引先コード.
006000*--< No.08 >                                                      
006010     MOVE  ＩＫＯ００１−枝番    TO  Ｄ６４５−振出人契約先コード.
006020*--< No.09 >                                                      
006030     MOVE  入力２−名称漢字           TO  Ｄ６４５−振出人名称.   
006040*--< No.10 >                                                      
006050     MOVE  入力２−名称カナ          TO  Ｄ６４５−振出人名称カナ.
006060*--< No.11 >                                                      
006070     MOVE  Ｗ−システム日付           TO  Ｄ６４５−登録年月日.   
006080*--< No.12 >                                                      
006090     MOVE  Ｗ−システム時刻           TO  Ｄ６４５−登録時間.     
006100*--< No.13 >                                                      
006110     MOVE  Ｗ−担当者                 TO  Ｄ６４５−登録担当者.   
006120*--< No.14 >                                                      
006130     MOVE  Ｗ−システム日付           TO  Ｄ６４５−更新年月日.   
006140*--< No.15 >                                                      
006150     MOVE  Ｗ−システム時刻           TO  Ｄ６４５−更新時間.     
006160*--< No.16 >                                                      
006170     MOVE  Ｗ−担当者                 TO  Ｄ６４５−更新者.       
006180*--< No.17 >                                                      
006190     MOVE  Ｗ−担当者              TO  Ｄ６４５−入力担当者コード.
006200*--< No.18 >                                                      
006210     MOVE  入力２−手形区分           TO  Ｄ６４５−手形状態.     
006220 受取手形編集処理−ＥＸＩＴ.                                      
006230     EXIT.                                                        
006240******************************************************************
006250*    出力処理                                                    *
006260******************************************************************
006270 手形基本出力処理                     SECTION.                    
006280 手形基本出力処理−ＳＴＡＲＴ.                                    
006290*                                                                 
006300     EXEC  SQL                                                    
006310        INSERT  INTO  D642UTG_TBL                                 
006320           ( 代表契約番号                                         
006330            ,束数                                                 
006340            ,取引先コード                                         
006350            ,契約先コード                                         
006360            ,契約先名称                                           
006370            ,契約先名称カナ                                       
006380            ,部店コード                                           
006390            ,主契約区分                                           
006400            ,手形状態                                             
006410            ,取引日                                               
006420            ,伝票発行日                                           
006430            ,手形種類                                             
006440            ,期日基準日                                           
006450            ,期日サイクル                                         
006460            ,束合計金額                                           
006470            ,手形枚数                                             
006480            ,取立銀行コード                                       
006490            ,支払銀行コード                                       
006500            ,契約番号１                                           
006510            ,契約番号２                                           
006520            ,契約番号３                                           
006530            ,契約番号４                                           
006540            ,契約番号５                                           
006550            ,契約番号６                                           
006560            ,契約番号７                                           
006570            ,契約番号８                                           
006580            ,契約番号９                                           
006590            ,契約番号１０                                         
006600            ,備考欄                                               
006610            ,手形内容種別                                         
006620            ,登録年月日                                           
006630            ,登録時間                                             
006640            ,登録担当者                                           
006650            ,更新年月日                                           
006660            ,更新時間                                             
006670            ,更新者                                               
006680            ,入力担当者コード                                     
006690            ,売却代金区分                                         
006700            ,振出人取引先コード                                   
006710            ,振出人契約先コード                                   
006720            ,振出人名称                                           
006730            ,振出人名称カナ)                                      
006740        VALUES                                                    
006750           ( :Ｄ６４２−代表契約番号                              
006760            ,:Ｄ６４２−束数                                      
006770            ,:Ｄ６４２−取引先コード                              
006780            ,:Ｄ６４２−契約先コード                              
006790            ,:Ｄ６４２−契約先名称                                
006800            ,:Ｄ６４２−契約先名称カナ                            
006810            ,:Ｄ６４２−部店コード                                
006820            ,:Ｄ６４２−主契約区分                                
006830            ,:Ｄ６４２−手形状態                                  
006840            ,:Ｄ６４２−取引日                                    
006850            ,:Ｄ６４２−伝票発行日                                
006860            ,:Ｄ６４２−手形種類                                  
006870            ,:Ｄ６４２−期日基準日                                
006880            ,:Ｄ６４２−期日サイクル                              
006890            ,:Ｄ６４２−束合計金額                                
006900            ,:Ｄ６４２−手形枚数                                  
006910            ,:Ｄ６４２−取立銀行コード                            
006920            ,:Ｄ６４２−支払銀行コード                            
006930            ,:Ｄ６４２−契約番号１                                
006940            ,:Ｄ６４２−契約番号２                                
006950            ,:Ｄ６４２−契約番号３                                
006960            ,:Ｄ６４２−契約番号４                                
006970            ,:Ｄ６４２−契約番号５                                
006980            ,:Ｄ６４２−契約番号６                                
006990            ,:Ｄ６４２−契約番号７                                
007000            ,:Ｄ６４２−契約番号８                                
007010            ,:Ｄ６４２−契約番号９                                
007020            ,:Ｄ６４２−契約番号１０                              
007030            ,:Ｄ６４２−備考欄                                    
007031            ,:Ｄ６４２−手形内容種別                              
007040            ,:Ｄ６４２−登録年月日                                
007050            ,:Ｄ６４２−登録時間                                  
007060            ,:Ｄ６４２−登録担当者                                
007070            ,:Ｄ６４２−更新年月日                                
007080            ,:Ｄ６４２−更新時間                                  
007090            ,:Ｄ６４２−更新者                                    
007100            ,:Ｄ６４２−入力担当者コード                          
007110            ,:Ｄ６４２−売却代金区分                              
007120            ,:Ｄ６４２−振出人取引先コード                        
007130            ,:Ｄ６４２−振出人契約先コード                        
007140            ,:Ｄ６４２−振出人名称                                
007150            ,:Ｄ６４２−振出人名称カナ)                           
007160     END-EXEC.                                                    
007170*                                                                 
007180     EVALUATE  SQLCODE                                            
007190        WHEN   定数−ＳＱＬＯＫ                                   
007200*--<       追加成功 >                                             
007210           COMPUTE  Ｗ−出力−件数１  =  Ｗ−出力−件数１  +  1   
007220        WHEN   OTHER                                              
007230*--<       追加処理エラー >                                       
007240           MOVE     -5                TO  Ｗ−エラーコード        
007250           PERFORM  エラー判定処理                                
007260     END-EVALUATE.                                                
007270*                                                                 
007280 手形基本出力処理−ＥＸＩＴ.                                      
007290     EXIT.                                                        
007300*----------------------------------------------------------------*
007310 受取手形出力処理                     SECTION.                    
007320 受取手形出力処理−ＳＴＡＲＴ.                                    
007330*                                                                 
007340     EXEC  SQL                                                    
007350        INSERT  INTO  D645UTT_TBL                                 
007360           ( 代表契約番号                                         
007370            ,束数                                                 
007380            ,連番                                                 
007390            ,手形番号                                             
007400            ,期日                                                 
007410            ,金額                                                 
007420            ,振出人取引先コード                                   
007430            ,振出人契約先コード                                   
007440            ,振出人名称                                           
007450            ,振出人名称カナ                                       
007460            ,登録年月日                                           
007470            ,登録時間                                             
007480            ,登録担当者                                           
007490            ,更新年月日                                           
007500            ,更新時間                                             
007510            ,更新者                                               
007520            ,入力担当者コード                                     
007530            ,手形状態)                                            
007540        VALUES                                                    
007550           ( :Ｄ６４５−代表契約番号                              
007560            ,:Ｄ６４５−束数                                      
007570            ,:Ｄ６４５−連番                                      
007580            ,:Ｄ６４５−手形番号                                  
007590            ,:Ｄ６４５−期日                                      
007600            ,:Ｄ６４５−金額                                      
007610            ,:Ｄ６４５−振出人取引先コード                        
007620            ,:Ｄ６４５−振出人契約先コード                        
007630            ,:Ｄ６４５−振出人名称                                
007640            ,:Ｄ６４５−振出人名称カナ                            
007650            ,:Ｄ６４５−登録年月日                                
007660            ,:Ｄ６４５−登録時間                                  
007670            ,:Ｄ６４５−登録担当者                                
007680            ,:Ｄ６４５−更新年月日                                
007690            ,:Ｄ６４５−更新時間                                  
007700            ,:Ｄ６４５−更新者                                    
007710            ,:Ｄ６４５−入力担当者コード                          
007720            ,:Ｄ６４５−手形状態)                                 
007730     END-EXEC.                                                    
007740*                                                                 
007750     EVALUATE  SQLCODE                                            
007760        WHEN   定数−ＳＱＬＯＫ                                   
007770*--<       追加成功 >                                             
007780           COMPUTE  Ｗ−出力−件数２  =  Ｗ−出力−件数２  +  1   
007790        WHEN   OTHER                                              
007800*--<       追加処理エラー >                                       
007810           MOVE     -6                TO  Ｗ−エラーコード        
007820           PERFORM  エラー判定処理                                
007830     END-EVALUATE.                                                
007840 受取手形出力処理−ＥＸＩＴ.                                      
007850     EXIT.                                                        
007860******************************************************************
007870*    終了処理                                                    *
007880******************************************************************
007890 終了処理                             SECTION.                    
007900 終了処理−ＳＴＡＲＴ.                                            
007910*                                                                 
007920     PERFORM  ファイルクローズ処理.                               
007930*                                                                 
007940     PERFORM  ＤＢコミット処理.                                   
007950*                                                                 
007960     PERFORM  終了メッセージ出力.                                 
007970*                                                                 
007980*--< プログラム正常終了 >                                         
007990     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
008000*                                                                 
008010 終了処理−ＥＸＩＴ.                                              
008020     EXIT.                                                        
008030******************************************************************
008040*    ファイルクローズ処理                                        *
008050******************************************************************
008060 ファイルクローズ処理                 SECTION.                    
008070 ファイルクローズ処理−ＳＴＡＲＴ.                                
008080*                                                                 
008090     CLOSE  入力ファイル１.                                       
008100     CLOSE  入力ファイル２.                                       
008110*                                                                 
008120 ファイルクローズ処理−ＥＸＩＴ.                                  
008130     EXIT.                                                        
008140******************************************************************
008150*    終了メッセージ出力                                          *
008160******************************************************************
008170 終了メッセージ出力                   SECTION.                    
008180 終了メッセージ出力−ＳＴＡＲＴ.                                  
008190*                                                                 
008200*----------------------------------------------------------------*
008210*    件数メッセージ出力処理                                      *
008220*----------------------------------------------------------------*
008230     INITIALIZE                       IF-CHOCO001.                
008240     MOVE  "3"                        TO  共通−イベント種別.     
008250     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
008260     MOVE  "0"                        TO  共通−復帰コード.       
008270     MOVE  "D411STK"                  TO  共通−処理テーブルＩＤ. 
008280     MOVE  "COUNT"                    TO  共通−処理識別.         
008290     MOVE  Ｗ−入力−件数１           TO  共通−データ内容.       
008300     MOVE  "手形基本ファイル読込件数" TO  共通−その他メッセージ. 
008310     CALL  CLOCO001                USING  IF-CHOCO001.            
008320*                                                                 
008330     INITIALIZE                       IF-CHOCO001.                
008340     MOVE  "3"                        TO  共通−イベント種別.     
008350     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
008360     MOVE  "0"                        TO  共通−復帰コード.       
008370     MOVE  "D411STK"                  TO  共通−処理テーブルＩＤ. 
008380     MOVE  "COUNT"                    TO  共通−処理識別.         
008390     MOVE  Ｗ−入力−件数２           TO  共通−データ内容.       
008400     MOVE  "受取手形ファイル読込件数" TO  共通−その他メッセージ. 
008410     CALL  CLOCO001                USING  IF-CHOCO001.            
008420*                                                                 
008430     INITIALIZE                       IF-CHOCO001.                
008440     MOVE  "3"                        TO  共通−イベント種別.     
008450     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
008460     MOVE  "0"                        TO  共通−復帰コード.       
008470     MOVE  "D34HNS"                   TO  共通−処理テーブルＩＤ. 
008480     MOVE  "COUNT"                    TO  共通−処理識別.         
008490     MOVE  Ｗ−出力−件数１           TO  共通−データ内容.       
008500     MOVE  "受取手形ファイル出力件数" TO  共通−その他メッセージ. 
008510     CALL  CLOCO001                USING  IF-CHOCO001.            
008520*                                                                 
008530     INITIALIZE                       IF-CHOCO001.                
008540     MOVE  "3"                        TO  共通−イベント種別.     
008550     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
008560     MOVE  "0"                        TO  共通−復帰コード.       
008570     MOVE  "D34HNS"                   TO  共通−処理テーブルＩＤ. 
008580     MOVE  "COUNT"                    TO  共通−処理識別.         
008590     MOVE  Ｗ−出力−件数１           TO  共通−データ内容.       
008600     MOVE  "受取手形展開テーブル出力件数"                         
008610                                      TO  共通−その他メッセージ. 
008620     CALL  CLOCO001                USING  IF-CHOCO001.            
008630*                                                                 
008640*----------------------------------------------------------------*
008650*    終了メッセージ出力                                          *
008660*----------------------------------------------------------------*
008670     INITIALIZE                       IF-CHOCO001.                
008680     MOVE  "3"                        TO  共通−イベント種別.     
008690     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
008700     MOVE  "0"                        TO  共通−復帰コード.       
008710     MOVE  "END"                      TO  共通−処理識別.         
008720     MOVE  定数−プログラム名         TO  共通−その他メッセージ. 
008730     CALL  CLOCO001                USING  IF-CHOCO001.            
008740*                                                                 
008750 終了メッセージ出力−ＥＸＩＴ.                                    
008760     EXIT.                                                        
008770******************************************************************
008780*    ＤＢコミット処理                                            *
008790******************************************************************
008800 ＤＢコミット処理                     SECTION.                    
008810 ＤＢコミット処理−ＳＴＡＲＴ.                                    
008820*                                                                 
008830     EXEC  SQL                                                    
008840        COMMIT  WORK  RELEASE                                     
008850     END-EXEC.                                                    
008860*                                                                 
008870     INITIALIZE                       IF-CHOCO001.                
008880     MOVE  "3"                        TO  共通−イベント種別.     
008890     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
008900     MOVE  "0"                        TO  共通−復帰コード.       
008910     MOVE  "COMMIT"                   TO  共通−処理識別.         
008920     MOVE  "コミット実施"             TO  共通−その他メッセージ. 
008930     CALL  CLOCO001                USING  IF-CHOCO001.            
008940*                                                                 
008950 ＤＢコミット処理−ＥＸＩＴ.                                      
008960     EXIT.                                                        
008970******************************************************************
008980*    ＤＢロールバック処理                                        *
008990******************************************************************
009000 ＤＢロールバック処理                 SECTION.                    
009010 ＤＢロールバック処理−ＳＴＡＲＴ.                                
009020*                                                                 
009030     EXEC  SQL                                                    
009040        ROLLBACK WORK  RELEASE                                    
009050     END-EXEC.                                                    
009060*                                                                 
009070     INITIALIZE                       IF-CHOCO001.                
009080     MOVE  "1"                        TO  共通−イベント種別.     
009090     MOVE  定数−プログラムＩＤ       TO  共通−ソースＩＤ.       
009100     MOVE  "9"                        TO  共通−復帰コード.       
009110     MOVE  "ROLLBACK"                 TO  共通−処理識別.         
009120     MOVE  "ロールバック実施"         TO  共通−その他メッセージ. 
009130     CALL  CLOCO001                USING  IF-CHOCO001.            
009140*                                                                 
009150 ＤＢロールバック処理−ＥＸＩＴ.                                  
009160     EXIT.                                                        
009170******************************************************************
009180*    エラー処理                                                  *
009190******************************************************************
009200 エラー判定処理                       SECTION.                    
009210 エラー判定処理−ＳＴＡＲＴ.                                      
009220*                                                                 
009230     MOVE  "Y"                        TO Ｗ−異常終了−フラグ.    
009240     INITIALIZE                           IF-CHOCO001.            
009250*                                                                 
009260     EVALUATE  Ｗ−エラーコード                                   
009270        WHEN  -1                                                  
009280*--<       手形基本ファイルオープンエラー >                       
009290           MOVE  "1"                  TO  共通−イベント種別      
009300           MOVE  定数−プログラムＩＤ TO  共通−ソースＩＤ        
009310           MOVE  "9"                  TO  共通−復帰コード        
009320           MOVE  "FFUIS630"           TO  共通−処理テーブルＩＤ  
009330           MOVE  "OPEN"               TO  共通−処理識別          
009340           MOVE  Ｗ−状態             TO  共通−データ内容        
009350           MOVE  "手形基本ファイルオープンエラー "                
009360                                      TO  共通−その他メッセージ  
009370           CALL  CLOCO001          USING  IF-CHOCO001             
009380*                                                                 
009390        WHEN  -2                                                  
009400*--<       受取手形ファイルオープンエラー >                       
009410           MOVE  "1"                  TO  共通−イベント種別      
009420           MOVE  定数−プログラムＩＤ TO  共通−ソースＩＤ        
009430           MOVE  "9"                  TO  共通−復帰コード        
009440           MOVE  "FFUIS631"           TO  共通−処理テーブルＩＤ  
009450           MOVE  "OPEN"               TO  共通−処理識別          
009460           MOVE  Ｗ−状態             TO  共通−データ内容        
009470           MOVE  "受取手形ファイルオープンエラー "                
009480                                      TO  共通−その他メッセージ  
009490           CALL  CLOCO001          USING  IF-CHOCO001             
009500*                                                                 
009510        WHEN  -3                                                  
009520*--<       手形基本ファイル読込エラー >                           
009530           MOVE  "1"                  TO  共通−イベント種別      
009540           MOVE  定数−プログラムＩＤ TO  共通−ソースＩＤ        
009550           MOVE  "9"                  TO  共通−復帰コード        
009560           MOVE  "FFUIS630"           TO  共通−処理テーブルＩＤ  
009570           MOVE  "READ"               TO  共通−処理識別          
009580           MOVE  Ｗ−状態             TO  共通−データ内容        
009590           MOVE  "持分以外ファイル読込エラー "                    
009600                                      TO  共通−その他メッセージ  
009610           CALL  CLOCO001          USING  IF-CHOCO001             
009620*                                                                 
009630        WHEN  -4                                                  
009640*--<       受取手形ファイル読込エラー >                           
009650           MOVE  "1"                  TO  共通−イベント種別      
009660           MOVE  定数−プログラムＩＤ TO  共通−ソースＩＤ        
009670           MOVE  "9"                  TO  共通−復帰コード        
009680           MOVE  "FFUIS631"           TO  共通−処理テーブルＩＤ  
009690           MOVE  "READ"               TO  共通−処理識別          
009700           MOVE  Ｗ−状態             TO  共通−データ内容        
009710           MOVE  "持分ファイル読込エラー "                        
009720                                      TO  共通−その他メッセージ  
009730           CALL  CLOCO001          USING  IF-CHOCO001             
009740*                                                                 
009750        WHEN  -5                                                  
009760*--<       受取手形テーブル追加失敗 >                             
009770           MOVE  "1"                  TO  共１−イベント種別      
009780           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009790           MOVE  "9"                  TO  共１−復帰コード        
009800           MOVE  "D642UTG"            TO  共１−処理テーブルＩＤ  
009810           MOVE  "SELECT"             TO  共１−処理識別          
009820           MOVE  SQLCODE              TO  共１−データ内容        
009830           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009840           CALL  CLOCO001          USING  IF-CHOCO001             
009850*                                                                 
009860        WHEN  -6                                                  
009870*--<       受取手形展開テーブル追加失敗 >                         
009880           MOVE  "1"                  TO  共１−イベント種別      
009890           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009900           MOVE  "9"                  TO  共１−復帰コード        
009910           MOVE  "D645UTT"            TO  共１−処理テーブルＩＤ  
009920           MOVE  "SELECT"             TO  共１−処理識別          
009930           MOVE  SQLCODE              TO  共１−データ内容        
009940           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009950           CALL  CLOCO001          USING  IF-CHOCO001             
009960*                                                                 
009970        WHEN  -10                                                 
009980*--<       ＯＲＡＣＬＥ接続失敗 >                                 
009990           MOVE  "1"                  TO  共通−イベント種別      
010000           MOVE  定数−プログラムＩＤ TO  共通−ソースＩＤ        
010010           MOVE  "9"                  TO  共通−復帰コード        
010020           MOVE  "CONNECT"            TO  共通−処理識別          
010030           MOVE  SQLCODE              TO  共通−データ内容        
010040           MOVE  SQLERRMC             TO  共通−その他メッセージ  
010050           CALL  CLOCO001          USING  IF-CHOCO001             
010060*                                                                 
010070        WHEN  -20                                                 
010080*--<       失敗 >                                                 
010090           MOVE  "1"                  TO  共１−イベント種別      
010100           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010110           MOVE  "9"                  TO  共１−復帰コード        
010120           MOVE  "IKOTL001"           TO  共１−処理テーブルＩＤ  
010130           MOVE  "SELECT"             TO  共１−処理識別          
010140           MOVE  SQLCODE              TO  共１−データ内容        
010150           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010160           CALL  CLOCO001          USING  IF-CHOCO001             
010170*                                                                 
010180        WHEN  -30                                                 
010190*--<       失敗 >                                                 
010200           MOVE  "1"                  TO  共１−イベント種別      
010210           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010220           MOVE  "9"                  TO  共１−復帰コード        
010230           MOVE  "IKOTL002"           TO  共１−処理テーブルＩＤ  
010240           MOVE  "SELECT"             TO  共１−処理識別          
010250           MOVE  SQLCODE              TO  共１−データ内容        
010260           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010270           CALL  CLOCO001          USING  IF-CHOCO001             
010280*                                                                 
010290        WHEN  -40                                                 
010300*--<       失敗 >                                                 
010310           MOVE  "1"                  TO  共１−イベント種別      
010320           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010330           MOVE  "9"                  TO  共１−復帰コード        
010340           MOVE  "IKOTL001"           TO  共１−処理テーブルＩＤ  
010350           MOVE  "SELECT"             TO  共１−処理識別          
010360           MOVE  SQLCODE              TO  共１−データ内容        
010370           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010380           CALL  CLOCO001          USING  IF-CHOCO001             
010390*                                                                 
010400        WHEN  OTHER                                               
010410           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
010420     END-EVALUATE.                                                
010430*                                                                 
010440*                                                                 
010450     IF  Ｗ−異常終了−フラグ  =  "Y"                             
010460        PERFORM  ＤＢロールバック処理                             
010470*                                                                 
010480        PERFORM  終了メッセージ出力                               
010490*                                                                 
010500*--<    プログラム異常終了のリターンコード >                      
010510        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
010520*                                                                 
010530        EXIT  PROGRAM                                             
010540     END-IF.                                                      
010550*                                                                 
010560 エラー判定処理−ＥＸＩＴ.                                        
010570     EXIT.                                                        
010580******************************************************************
010590*                  END OF PROGRAM                                *
010600******************************************************************
010610
