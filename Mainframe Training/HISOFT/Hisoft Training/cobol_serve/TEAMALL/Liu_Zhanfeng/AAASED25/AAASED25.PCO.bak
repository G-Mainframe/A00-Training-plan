000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名    ：前受金受払残高ファイル作成           *
000040*      2. プログラムID    ：AAASED25                             *
000050*      3. 処理概要        ：経理締処理（帳票作成）               *
000060*                                        リース前受関連帳票抽出  *
000070*                                                                *
000080*      4. 作成者          ：柳占鋒                               *
000090*      5. 作成日          ：2005.03.XX                           *
000100******************************************************************
000110*                                                                 
000120******************************************************************
000130*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000140******************************************************************
000150 IDENTIFICATION                       DIVISION.                   
000160*                                                                 
000170 PROGRAM-ID.                          AAASED25.                   
000180******************************************************************
000190*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000200******************************************************************
000210 ENVIRONMENT                          DIVISION.                   
000220******************************************************************
000230*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260 FILE-CONTROL.                                                    
000270*                                                                 
000280     SELECT         出力ファイル      ASSIGN    TO   U11          
000290     FILE STATUS    IS     Ｗ−状態                               
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*    出力ファイル                                                *
000420*----------------------------------------------------------------*
000430 FD  出力ファイル                                                 
000440                                                                  
000450     LABEL  RECORD    IS              STANDARD                    
000460     BLOCK  CONTAINS  0               RECORDS.                    
000470*                                                                 
000480 01  出力−レコード.                                              
000490     COPY   CPSCE50   REPLACING      ==()==  BY  ==出力−==.      
000500*                                                                 
000510******************************************************************
000520*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000530******************************************************************
000540 WORKING-STORAGE                      SECTION.                    
000550*----------------------------------------------------------------*
000560*    ホスト変数定義エリア                                        *
000570*----------------------------------------------------------------*
000580     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000590*                                                                 
000600 01  ＷＳ−名称１                     PIC  X(060).                
000610 01  ＷＳ−名称２                     PIC  X(060).                
000620 01  ＷＳ−業務管理ＩＤ               PIC  X(08) VALUE 'GYMKNRRC'.
000630 01  ＷＳ−コードＮＯ０３８           PIC  X(012) VALUE '038'.    
000640 01  ＷＳ−コードＮＯ００５           PIC  X(012) VALUE '005'.    
000650*                                                                 
000660*--< ＯＲＡＣＬＥ共通変数 >                                       
000670                                                                  
000680     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000690*                                                                 
000700*--< 前受情報ＤＢ >                                               
000710                                                                  
000720     EXEC  SQL  INCLUDE  M40MAB.CBL            END-EXEC.          
000730*                                                                 
000740*--< 業務管理テーブル >                                           
000750     EXEC  SQL  INCLUDE  D70GYM.CBL            END-EXEC.          
000760*                                                                 
000770*--< 取引先マスタ >                                               
000780     EXEC  SQL  INCLUDE  D01TRS.CBL            END-EXEC.          
000790*                                                                 
000800*--< 請求先マスタ >                                               
000810     EXEC  SQL  INCLUDE  D02SQS.CBL            END-EXEC.          
000820*                                                                 
000830*--< 項目名称マスタ >                                             
000840                                                                  
000850     EXEC  SQL  INCLUDE  D19MSY.CBL            END-EXEC.          
000860*                                                                 
000870*--< 債権情報（一般）ＤＢ >                                       
000880     EXEC  SQL  INCLUDE  M01SAJ.CBL            END-EXEC.          
000890                                                                  
000900*--< ＯＲＡＣＬＥ ＳＱＬ実行情報 (SQLCA) >                        
000910                                                                  
000920     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC           
000930*                                                                 
000940     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000950*----------------------------------------------------------------*
000960*   作業領域定義                                                  
000970*----------------------------------------------------------------*
000980 01  ＷＯＲＫ−エリア.                                            
000990                                                                  
001000*--< エラーコード >                                               
001010                                                                  
001020     03  Ｗ−エラーコード             PIC S9(02).                 
001030*     03  バッチ用業務年月             PIC  X(06).                 
001040*                                                                 
001050*--< Ｗ−状態 >                                                   
001060     03  Ｗ−状態                     PIC  X(02).                 
001070*                                                                 
001080*--< 件数エリア >                                                 
001090     03  件数エリア.                                              
001100         05  Ｗ−入力−件数           PIC  9(09).                 
001110         05  Ｗ−出力−件数           PIC  9(09).                 
001120*                                                                 
001130*--< フラグアリア >                                               
001140     03  フラグ−エリア.                                          
001150         05  Ｗ−終了−フラグ         PIC  X(01).                                  
001160         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001170*                                                                 
001180*--< Ｗ−状態 >                                                   
001190     03  Ｗ−適用日                   PIC  X(08).                 
001200*                                                                 
001210*----------------------------------------------------------------*
001220*   処理時間定義                                                 *
001230*----------------------------------------------------------------*
001240*--< 共通情報 >                                                   
001250 01  Ｗ−共通情報.                                                
001260     03  Ｗ−システム日付.                                        
001270         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001280         05  Ｗ−年月日               PIC  X(06).                 
001290     03  Ｗ−システム時刻             PIC  X(08).                 
001300     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001310*----------------------------------------------------------------*
001320*    サブルーチン名                                              *
001330*----------------------------------------------------------------*
001340 01  CALL-AREA.                                                   
001350*--< 共通ログサブルーチン >                                       
001360     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001370     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001380*----------------------------------------------------------------*
001390*    ＣＯＰＹ領域                                                *
001400*----------------------------------------------------------------*
001410*--< 共通ログ用パラメータ >                                       
001420 01  IF-CHOCO001.                                                 
001430     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001440*                                                                 
001450*----------------------------------------------------------------*
001460*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001470*----------------------------------------------------------------*
001480 01  PARA-AREA.                                                   
001490     COPY CPBCO001.                                               
001500******************************************************************
001510*    定数用データ定義エリア                                      *
001520******************************************************************
001530 CONSTANT                             SECTION.                    
001540 01  定数領域.                                                    
001550     03  定数−プログラムＩＤ         PIC  X(08) VALUE "AAASED25".
001560     03  定数−プログラム名           PIC  X(80)                  
001570                              VALUE  "前受金受払残高ファイル作成".
001580     03  定数−ＳＱＬＯＫ             PIC  9(04)  VALUE  0000.    
001590     03  定数−ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001600     03  定数−正常状態               PIC  9(04)  VALUE  ZERO.    
001610     03  定数−異常状態               PIC  9(04)  VALUE  0009.    
001620******************************************************************
001630*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001640******************************************************************
001650 PROCEDURE                            DIVISION.                   
001660*                                                                 
001670     PERFORM   初期処理.                                          
001680*                                                                 
001690     PERFORM   主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".           
001700*                                                                 
001710     PERFORM   終了処理.                                          
001720*                                                                 
001730     STOP RUN.                                                    
001740*                                                                 
001750******************************************************************
001760*    初期処理                                            <1.0>   *
001770******************************************************************
001780 初期処理                             SECTION.                    
001790 初期処理−ＳＴＡＲＴ.                                            
001800*                                                                 
001810*----------------------------------------------------------------*
001820*    開始メッセージ出力                                  <1.1>   *
001830*----------------------------------------------------------------*
001840     INITIALIZE                       IF-CHOCO001.                
001850     MOVE  "3"                        TO  共１−イベント種別.     
001860     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001870     MOVE  "0"                        TO  共１−復帰コード.       
001880     MOVE  "START"                    TO  共１−処理識別.         
001890     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001900     CALL  CLOCO001                USING  IF-CHOCO001.            
001910*                                                                 
001920*----------------------------------------------------------------*
001930*    作業領域の初期値設定                                <1.2>   *
001940*----------------------------------------------------------------*
001950     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001960     INITIALIZE                           ＷＯＲＫ−エリア.       
001970*                                                                 
001980*--< ＣＰＵ日付を取得 >                                           
001990     ACCEPT  Ｗ−年月日               FROM  DATE.                 
002000*                                                                 
002010*--< ＣＰＵ時刻を取得 >                                           
002020     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
002030*----------------------------------------------------------------*
002040*    ＯＲＡＣＬＥ接続                                    <1.3>   *
002050*----------------------------------------------------------------*
002060     PERFORM  ＯＲＡＣＬＥ接続.                                   
002070*                                                                 
002080*----------------------------------------------------------------*
002090*    業務管理テーブル読込                                <1.4>   *
002100*----------------------------------------------------------------*
002110     PERFORM   業務管理テーブル読込.                              
002120*                                                                 
002130*----------------------------------------------------------------*
002140*    結合テーブルカーソル宣言                            <1.5>   *
002150*----------------------------------------------------------------*
002160     PERFORM   結合テーブルカーソル宣言.                          
002170*                                                                 
002180*----------------------------------------------------------------*
002190*    ファイルオープン                                    <1.6>   *
002200*----------------------------------------------------------------*
002210     PERFORM  ファイルオープン.                                   
002220*                                                                 
002230*----------------------------------------------------------------*
002240*    結合テーブル読込（１件目）                          <1.7>   *
002250*----------------------------------------------------------------*
002260     PERFORM   結合読込件目.                                      
002270                                                                  
002280 初期処理−ＥＸＩＴ.                                              
002290     EXIT.                                                        
002300******************************************************************
002310*    主処理                                              <2.0>   *
002320******************************************************************
002330 主処理                               SECTION.                    
002340 主処理−ＳＴＡＲＴ.                                              
002350*                                                                 
002360*----------------------------------------------------------------*
002370*    項目名称マスタより項目の抽出処理                    <2.1>   *
002380*----------------------------------------------------------------*
002390     PERFORM  名称抽出処理.                                       
002400*                                                                 
002410*----------------------------------------------------------------*
002420*    債権情報（一般）ＤＢより項目の抽出処理              <2.2>   *
002430*----------------------------------------------------------------*
002440     PERFORM  債権抽出処理.                                       
002450*                                                                 
002460*----------------------------------------------------------------*
002470*    前受金受払残高中間ファイル出力判定処理              <2.3>   *
002480*----------------------------------------------------------------*
002490     PERFORM  残高判定処理                                        
002500*                                                                 
002510*----------------------------------------------------------------*
002520*    前受金受払残高中間ファイル項目編集、出力処理        <2.4>   *
002530*----------------------------------------------------------------*
002540     PERFORM   編集処理.                                          
002550*                                                                 
002560*----------------------------------------------------------------*
002570*    結合テーブル読込（２件目以降）                      <2.5>   *
002580*----------------------------------------------------------------*
002590     PERFORM   結合読込件目.                                      
002600*                                                                 
002610 主処理−ＥＸＩＴ.                                                
002620     EXIT.                                                        
002630******************************************************************
002640*    終了処理                                            <3.0>   *
002650******************************************************************
002660 終了処理                             SECTION.                    
002670 終了処理−ＳＴＡＲＴ.                                            
002680*                                                                 
002690*----------------------------------------------------------------*
002700*    ＤＢクローズ                                        <3.1>   *
002710*----------------------------------------------------------------*
002720     PERFORM  ＤＢクローズ.                                      
002730*                                                                 
002740*----------------------------------------------------------------*
002750*    ファイルクローズ                                    <3.2>   *
002760*----------------------------------------------------------------*
002770     PERFORM ファイルクローズ.                                    
002780*                                                                 
002790*----------------------------------------------------------------*
002800*    件数メッセージ出力                                  <3.3>   *
002810*----------------------------------------------------------------*
002820*     PERFORM   件数出力.                                         
002830*                                                                 
002840*----------------------------------------------------------------*
002850*    終了メッセージ出力                                  <3.4>   *
002860*----------------------------------------------------------------*
002870     PERFORM  終了メッセージ出力 .                                                                                                
002910*                                                                 
002920 終了処理−ＥＸＩＴ.                                              
002930     EXIT.                                                        
002970******************************************************************
002980*    ＯＲＡＣＬＥ接続                                    <1.3>   *
002990******************************************************************
003000 ＯＲＡＣＬＥ接続                     SECTION.                    
003010 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
003020*                                                                 
003030*--< ＩＮＩファイル読込サブルーチン呼び出し >                     
003040     CALL  COBCO001                USING  PARA-AREA.              
003050*                                                                 
003060     MOVE  PARA-DBSTRING              TO  DB-STRING.              
003070     MOVE  PARA-USERNAME              TO  USERNAME.               
003080     MOVE  PARA-PASSWORD              TO  PASSWD.                 
003090*                                                                 
003100*----------------------------------------------------------------*
003110*    開始接続                                                    *
003120*----------------------------------------------------------------*
003130     IF  DB-STRING  =  SPACE                                      
003140        EXEC  SQL                                                 
003150           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
003160        END-EXEC                                                  
003170     ELSE                                                         
003180        EXEC  SQL                                                 
003190           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
003200             USING  :DB-STRING                                    
003210        END-EXEC                                                  
003220     END-IF.                                                      
003230*                                                                 
003240*----------------------------------------------------------------*
003250*    接続状態判定                                                *
003260*----------------------------------------------------------------*
003270     EVALUATE  SQLCODE                                            
003280        WHEN  定数−ＳＱＬＯＫ                                    
003290*--<       接続正常 >                                             
003300           CONTINUE                                               
003310        WHEN  OTHER                                               
003320*--<       接続失敗 >                                             
003330           MOVE     -10               TO  Ｗ−エラーコード        
003340           PERFORM  エラー処理                                    
003350     END-EVALUATE.                                                
003360*                                                                 
003370 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
003380     EXIT.                                                        
003390******************************************************************
003400*    業務管理テーブル読込                                <1.4>   *
003410******************************************************************
003420 業務管理テーブル読込                         SECTION.            
003430 業務管理テーブル読込−ＳＴＡＲＴ.                                
003440*                                                                 
003450*----------------------------------------------------------------*
003460*    業務管理テーブル読込                                        *
003470*----------------------------------------------------------------*
003480                                                                  
003490     EXEC SQL                                                     
003500        SELECT  バッチ用業務年月                                  
003510          INTO :Ｄ７０−バッチ用業務年月                          
003520          FROM  D70GYM_TBL                                        
003530         WHERE  業務管理ＩＤ = :ＷＳ−業務管理ＩＤ                
003540     END-EXEC.                                                    
003550*----------------------------------------------------------------*
003560*    業務管理テーブル読込確認                                    *
003570*----------------------------------------------------------------*
003580     EVALUATE   SQLCODE                                           
003590        WHEN   定数−ＳＱＬＯＫ                                   
003600*--<       正常 >                                                 
003610           CONTINUE                                               
003620        WHEN   OTHER                                              
003630*--<       業務管理テーブル読込失敗、プログラムが異常終了 >       
003640                                                                  
003650           MOVE      -20              TO  Ｗ−エラーコード        
003660           PERFORM   エラー処理                                   
003670     END-EVALUATE.                                                
003680*                                                                 
003690 業務管理テーブル読込−ＥＸＩＴ.                                  
003700                                                                  
003710     EXIT.                                                        
003720******************************************************************
003730*    結合テーブルカーソル宣言                            <1.5>   *
003740******************************************************************
003750 結合テーブルカーソル宣言                         SECTION.        
003760 結合テーブルカーソル宣言−ＳＴＡＲＴ.                            
003770*                                                                 
003780*----------------------------------------------------------------*
003790*    結合テーブルカーソル宣言                                    *
003800*----------------------------------------------------------------*
003810     EXEC  SQL                                                    
003820        DECLARE  CUR1  CURSOR  FOR                                
003830           SELECT  M40MAB_TBL.レコード区分                        
003840                  ,M40MAB_TBL.経理用主契約区分                    
003850                  ,M40MAB_TBL.顧客区分                            
003860                  ,M40MAB_TBL.請求先取引先コード                  
003870                  ,M40MAB_TBL.請求先コード                        
003880                  ,M40MAB_TBL.契約番号                            
003890                  ,M40MAB_TBL.契約種類                            
003900                  ,M40MAB_TBL.担当部課コード                      
003910                  ,M40MAB_TBL.再リース回数                        
003920                  ,M40MAB_TBL.充当開始年月                        
003930                  ,M40MAB_TBL.充当月数                            
003940                  ,M40MAB_TBL.前払回収方法                        
003950                  ,M40MAB_TBL.入金日                              
003960                  ,M40MAB_TBL.入金区分                            
003970                  ,M40MAB_TBL.前月末残高                          
003980                  ,M40MAB_TBL.当月回収額                          
003990                  ,M40MAB_TBL.当月消化額                          
004000                  ,M40MAB_TBL.当月末残高                          
004010                  ,NVL(D01TRS_TBL.名寄せコード,RPAD(' ',40,' '))  
004020                  ,NVL(D01TRS_TBL.取引先名称,RPAD(' ',80,' '))    
004030                  ,NVL(D02SQS_TBL.請求先名称,RPAD(' ',80,' '))    
004040                  ,M40MAB_TBL.協調区分                            
004050                  ,M40MAB_TBL.前月末残高他社                      
004060                  ,M40MAB_TBL.当月回収額他社                      
004070                  ,M40MAB_TBL.当月消化額他社                      
004080                  ,M40MAB_TBL.当月他社解約分料金                  
004090                  ,M40MAB_TBL.当月他社解約分消費税                
004100                  ,M40MAB_TBL.当月末残高他社                      
004110             FROM  M40MAB_TBL                                     
004120                  ,D01TRS_TBL                                     
004130                  ,D02SQS_TBL                                     
004140            WHERE  M40MAB_TBL.前受金受払残高表対象フラグ = '1'    
004150              AND  M40MAB_TBL.請求先取引先コード =                
004160                                     D01TRS_TBL.取引先コード ( + )
004170              AND  M40MAB_TBL.請求先取引先コード =                
004180                                     D02SQS_TBL.取引先コード ( + )
004190              AND  M40MAB_TBL.請求先コード =                      
004200                                     D02SQS_TBL.請求先コード ( + )
004210         ORDER BY  M40MAB_TBL.レコード区分                        
004220                  ,M40MAB_TBL.契約番号                            
004230     END-EXEC.                                                    
004240*                                                                 
004250*----------------------------------------------------------------*
004260*    結合テーブルカーソル宣言オープン                            *
004270*----------------------------------------------------------------*
004280     EXEC  SQL                                                    
004290        OPEN  CUR1                                                
004300     END-EXEC.                                                    
004310*                                                                 
004320*----------------------------------------------------------------*
004330*    結合テーブルカーソル宣言オープンを確認                      *
004340*----------------------------------------------------------------*
004350     EVALUATE   SQLCODE                                           
004360        WHEN   定数−ＳＱＬＯＫ                                   
004370*--<       正常 >                                                 
004380           CONTINUE                                               
004390        WHEN   OTHER                                              
004400*--<       結合テーブルカーソルオープン失敗、プログラムが異常終了>
004410           MOVE     -30              TO  Ｗ−エラーコード         
004420           PERFORM   エラー処理                                   
004430     END-EVALUATE.                                                
004440*                                                                 
004450 結合テーブルカーソル宣言−ＥＸＩＴ.                              
004460     EXIT.                                                        
004470******************************************************************
004480*    ファイルオープン処理                                <1.6>   *
004490******************************************************************
004500 ファイルオープン                              SECTION.           
004510 ファイルオープン−ＳＴＡＲＴ.                                    
004520                                                                  
004530     OPEN             OUTPUT          出力ファイル.               
004540                                                                  
004550*----------------------------------------------------------------*
004580*    ファイルオープン確認                                        *
004590*----------------------------------------------------------------*
004600     EVALUATE  Ｗ−状態                                           
004610        WHEN  ZERO                                                
004620*--<       正常 >                                                 
004630           CONTINUE                                               
004640        WHEN  OTHER                                               
004650*--<       ファイルＯＰＥＮエラー >                               
004660           MOVE -40                   TO  Ｗ−エラーコード        
004670           PERFORM  エラー処理                                    
004680     END-EVALUATE.                                                
004690 ファイルオープン−ＥＸＩＴ.                                      
004700     EXIT.                                                        
004710*                                                                 
004720******************************************************************
004730*    項目名称マスタより項目の抽出処理                    <2.1>   *
004740******************************************************************
004750 名称抽出処理                         SECTION.                    
004760 名称抽出処理−ＳＴＡＲＴ.                                        
004770*                                                                 
004780*--< 出力レコードを初期化 >                                       
004790*                                                                 
004800*----------------------------------------------------------------*
004810*    項目名称マスタより主契約区分名称の抽出処理          <2.1.1> *
004820*----------------------------------------------------------------*
004830     EXEC SQL                                                     
004840          SELECT 名称                                             
004850          INTO :ＷＳ−名称１                                      
004860          FROM  D19MSY_TBL                                        
004870          WHERE コードＮＯ = :ＷＳ−コードＮＯ０３８              
004880            AND SUBSTR(コード,1,1) = :Ｍ４０−経理用主契約区分    
004890     END-EXEC.                                                    
004900*----------------------------------------------------------------*
004910*    項目名称マスタより主契約区分名称の抽出処理を確認            *
004920*----------------------------------------------------------------*
004930     EVALUATE   SQLCODE                                           
004940        WHEN   定数−ＳＱＬＯＫ                                   
004950*--<       正常 >                                                 
004960           CONTINUE                                               
004970        WHEN   OTHER                                              
004980*--<       結合テーブルカーソルオープン失敗、プログラムが異常終了>
004990           MOVE      -60              TO  Ｗ−エラーコード        
005000           PERFORM   エラー処理                                   
005010           MOVE      SPACE            TO  ＷＳ−名称１            
005020     END-EVALUATE.                                                
005030*----------------------------------------------------------------*
005040*    項目名称マスタより顧客区分名称の抽出処理            <2.1.2> *
005050*----------------------------------------------------------------*
005060     EXEC SQL                                                     
005070          SELECT 名称                                             
005080          INTO :ＷＳ−名称２                                      
005090          FROM  D19MSY_TBL                                        
005100          WHERE コードＮＯ = :ＷＳ−コードＮＯ００５              
005110           AND SUBSTR(コード,1,2) = :Ｍ４０−顧客区分             
005120     END-EXEC.                                                    
005130*----------------------------------------------------------------*
005140*    項目名称マスタより顧客区分名称の抽出処理を確認              *
005150*----------------------------------------------------------------*
005160     EVALUATE   SQLCODE                                           
005170        WHEN   定数−ＳＱＬＯＫ                                   
005180*--<       正常 >                                                 
005190           CONTINUE                                               
005200        WHEN   OTHER                                              
005210*--<       結合テーブルカーソルオープン失敗、プログラムが異常終了>
005220           MOVE      -60              TO  Ｗ−エラーコード        
005230           PERFORM   エラー処理                                   
005240           MOVE      SPACE            TO  ＷＳ−名称２            
005250     END-EVALUATE.                                                
005260 名称抽出処理−ＥＸＩＴ.                                          
005270     EXIT.                                                        
005280*                                                                 
005290******************************************************************
005300*    債権情報（一般）ＤＢより項目の抽出処理              <2.2>   *
005310******************************************************************
005320 債権抽出処理               SECTION.                              
005330 債権抽出処理−ＳＴＡＲＴ.                                        
005340*----------------------------------------------------------------*
005350     EXEC SQL                                                     
005360          SELECT M01SAJ_TBL.契約番号                              
005370                ,M01SAJ_TBL.再リース回数                          
005380	              ,M01SAJ_TBL.契約種類                              
005390                ,M01SAJ_TBL.レコード区分                          
005400            INTO :Ｍ０１−契約番号                                
005410                ,:Ｍ０１−再リース回数                            
005420                ,:Ｍ０１−契約種類                                
005430                ,:Ｍ０１−レコード区分                            
005440	         FROM  M01SAJ_TBL                                       
005450           WHERE M01SAJ_TBL.レコード区分 = '1'                    
005460             AND M01SAJ_TBL.契約番号                              
005470                                   = :Ｍ４０−契約番号            
005480             AND M01SAJ_TBL.再リース回数                          
005490                                   = :Ｍ４０−再リース回数        
005500             AND M01SAJ_TBL.契約種類                              
005510                                   = :Ｍ４０−契約種類            
005520     END-EXEC.                                                    
005530*----------------------------------------------------------------*
005540*    債権情報（一般）ＤＢより項目の抽出処理を確認                *
005550*----------------------------------------------------------------*
005560     EVALUATE   SQLCODE                                           
005570        WHEN   定数−ＳＱＬＯＫ                                   
005580*--<       正常 >                                                 
005590           CONTINUE                                               
005600        WHEN   OTHER                                              
005610*--<       結合テーブルカーソルオープン失敗、プログラムが異常終了>
005620           MOVE     SPACE             TO  Ｍ０１−状態フラグ      
005630           MOVE     SPACE             TO  Ｍ０１−債権契約件名    
005640           MOVE     SPACE             TO  Ｍ０１−担保区分        
005650           MOVE      -70              TO  Ｗ−エラーコード        
005660           PERFORM   エラー処理                                   
005670     END-EVALUATE.                                                
005680 債権抽出処理−ＥＸＩＴ.                                          
005690*                                                                 
005700******************************************************************
005710*    前受金受払残高中間ファイル出力判定処理              <2.3>   *
005720******************************************************************
005730 残高判定処理                         SECTION.                    
005740 残高判定処理−ＳＴＡＲＴ.                                        
005750*                                                                 
005760     IF  Ｍ０１−担保区分          NOT =  '1'                     
005770           PERFORM  編集処理                                      
005780*     ELSE                                                        
005790        END-IF.                                                   
005800                                                                  
005810 残高判定処理−ＥＸＩＴ.                                          
005820     EXIT.                                                        
005830*                                                                 
005840******************************************************************
005850*    前受金受払残高中間ファイル項目編集、出力処理        <2.4>   *
005860******************************************************************
005870 編集処理                             SECTION.                    
005880 編集処理−ＳＴＡＲＴ.                                            
005890*                                                                 
005900*----------------------------------------------------------------*
005910*        出力−レコード 初期化処理                               *
005920*----------------------------------------------------------------*
005930        MOVE  SPACE                TO  出力−レコード.            
005940        INITIALIZE                     出力−レコード.            
005950*                                                                 
005960*----------------------------------------------------------------*
005970*        自社分個別の編集                                        *
005980*----------------------------------------------------------------*
005990*--< 自社分個別の編集 >                                           
006000        PERFORM  自社分編集.                                      
006010*----------------------------------------------------------------*
006020*       自社分出力判定                                           *
006030*----------------------------------------------------------------*
006040*--< 自社分出力判定 >                                             
006050        IF      出力−前月末残高      NOT  =  0                   
006060           AND  出力−当月入金額      NOT  =  0                   
006070           AND  出力−当月消化額      NOT  =  0                   
006080           AND  出力−当月末残高      NOT  =  0                   
006090           PERFORM  出力処理.                                     
006100*----------------------------------------------------------------*
006110*       自社分出力処理確認                                       *
006120      EVALUATE  SQLCODE                                           
006130         WHEN   定数−ＳＱＬＯＫ                                  
006140*--<       追加成功 >                                            
006150            COMPUTE  Ｗ−出力−件数  =  Ｗ−出力−件数  +  1      
006160         WHEN   OTHER                                             
006170*--<       追加処理エラー >                                      
006180            MOVE     -80               TO  Ｗ−エラーコード       
006190            PERFORM  エラー処理                                   
006200            MOVE SPACE TO  ＷＳ−名称２                           
006210      END-EVALUATE.                                               
006220                                                                  
006230******************************************************************
006240*      自社分編集                                                *
006250******************************************************************
006260 自社分編集                   SECTION.                            
006270 自社分編集−ＳＴＡＲＴ.                                          
006280        IF  Ｍ０１−契約番号 < 3                                  
006290              MOVE   3                TO  出力−自他社区分        
006300        ELSE                                                      
006310              MOVE   1                TO  出力−自他社区分        
006320        END-IF.                                                   
006330*                                                                 
006340        MOVE  Ｍ４０−レコード区分    TO  出力−前受区分.         
006350*                                                                 
006360        MOVE  Ｍ４０−経理用主契約区分                            
006370                                      TO  出力−主契約区分.       
006380*                                                                 
006390        MOVE  Ｍ４０−顧客区分        TO  出力−連結区分.         
006400*                                                                 
006410        MOVE  Ｄ０１−名寄せコード    TO  出力−名寄せコード.     
006420*                                                                 
006430        MOVE  Ｍ４０−請求先取引先コード                          
006440                                      TO  出力−取引先コード.     
006450*                                                                 
006460        MOVE  Ｍ４０−請求先コード    TO  出力−請求先コード.     
006470*                                                                 
006480        MOVE  Ｍ４０−契約番号        TO  出力−契約番号.         
006490*                                                                 
006500        MOVE  Ｍ４０−契約種類        TO  出力−契約種類.         
006510*                                                                 
006520        MOVE  Ｄ７０−バッチ用業務年月                            
006530                                      TO  出力−業務年月.         
006540*                                                                 
006550        MOVE  Ｍ４０−担当部課コード  TO  出力−担当部課コード.   
006560*                                                                 
006570        MOVE  Ｍ０１−債権契約件名    TO  出力−契約件名.         
006580*                                                                 
006590        MOVE  Ｍ４０−再リース回数    TO  出力−再リース回数.     
006600*                                                                 
006610        MOVE  Ｍ４０−充当開始年月    TO  出力−充当開始年月.     
006620*                                                                 
006630        MOVE  Ｍ４０−充当月数        TO  出力−充当月数.         
006640*                                                                 
006650        MOVE  Ｍ４０−前払回収方法    TO  出力−前払回収方法.     
006660*                                                                 
006670        MOVE  Ｍ４０−入金日          TO  出力−入金日.           
006680*                                                                 
006690        MOVE  Ｍ４０−入金区分        TO  出力−入金区分.         
006700*                                                                 
006710        MOVE  Ｄ０１−取引先名称      TO  出力−取引先名称.       
006720*                                                                 
006730        MOVE  Ｄ０２−請求先名称      TO  出力−請求先名称.       
006740*                                                                 
006750        MOVE  ＷＳ−名称１              TO  出力−主契約区分名称. 
006760*                                                                 
006770        MOVE  ＷＳ−名称２              TO  出力−連結区分名称.   
006780*                                                                 
006790        MOVE  Ｍ４０−前月末残高      TO  出力−前月末残高.       
006800*                                                                 
006810        MOVE  Ｍ４０−前月末残高      TO  出力−前月末残高.       
006820*                                                                 
006830        MOVE  Ｍ４０−当月消化額      TO  出力−当月消化額.       
006840*                                                                 
006850                                                                  
006860        MOVE  Ｍ４０−当月末残高      TO  出力−当月末残高.       
006870                                                                  
006880 編集処理−ＥＸＩＴ.                                              
006890     EXIT.                                                        
006900******************************************************************
006910*    他社分個別部分の編集出力                                    *
006920******************************************************************
006930 他社分編集出力                              SECTION.             
006940 他社分編集出力−ＳＴＡＲＴ.                                      
006950*                                                                 
006960        IF   Ｍ０１−契約番号 < 3                                 
006970            MOVE  4                   TO  出力−自他社区分        
006980        ELSE                                                      
006990            MOVE  2                   TO  出力−自他社区分        
007000        END-IF.                                                   
007010*                                                                 
007020        MOVE  Ｍ４０−前月末残高他社  TO  出力−前月末残高.       
007030*                                                                 
007040        MOVE  Ｍ４０−当月回収額他社  TO  出力−当月入金額.       
007050*                                                                 
007060        COMPUTE  出力−当月消化額  =  Ｍ４０−当月消化額他社      
007070                                   +  Ｍ４０−当月他社解約分料金  
007080                                   +  Ｍ４０−当月他社解約分消費税.
007090*                                                                 
007100        COMPUTE  出力−当月末残高  =  Ｍ４０−当月末残高他社      
007110                                   -  Ｍ４０−当月他社解約分料金  
007120                                   -  Ｍ４０−当月他社解約分消費税.
007130*--< 他社分出力判定 >                                             
007140        IF      出力−前月末残高      NOT  =  0                   
007150            AND 出力−当月入金額      NOT  =  0                   
007160            AND 出力−当月消化額      NOT  =  0                   
007170            AND 出力−当月末残高      NOT  =  0                   
007180        PERFORM  出力処理                                         
007190        END-IF.                                                   
007200*                                                                 
007210 他社分編集出力−ＥＸＩＴ.                                        
007220          EXIT.                                                   
007230******************************************************************
007240*    前受金受払残高中間ファイル出力処理                          *
007250******************************************************************
007260 出力処理                        SECTION.                         
007270 出力処理−ＳＴＡＲＴ.                                            
007281     WRITE                       出力−レコード.                  
007290*                                                                 
007292*----------------------------------------------------------------*
007300*    追加処理を確認                                              *
007310*----------------------------------------------------------------*
007320     EVALUATE  SQLCODE                                            
007330        WHEN   定数−ＳＱＬＯＫ                                   
007340*--<       追加成功 >                                             
007350           COMPUTE  Ｗ−出力−件数  =  Ｗ−出力−件数  +  1       
007360        WHEN   OTHER                                              
007370*--<       追加処理エラー >                                       
007380           MOVE     -90               TO  Ｗ−エラーコード        
007390           PERFORM  エラー処理                                    
007400     END-EVALUATE.                                                
007410*                                                                 
007420 出力処理−ＥＸＩＴ.                                              
007430     EXIT.                                                        
007440*                                                                 
007450******************************************************************
007460*    結合テーブル読込                             <1.7>AND<2.5>  *
007470******************************************************************
007480 結合読込件目                   SECTION.                          
007490 結合読込件目−ＳＴＡＲＴ.                                        
007500*                                                                 
007510     EXEC SQL                                                     
007520         FETCH  CUR1                                              
007530          INTO  :Ｍ４０−レコード区分                             
007540               ,:Ｍ４０−経理用主契約区分                         
007550               ,:Ｍ４０−顧客区分                                 
007560               ,:Ｍ４０−請求先取引先コード                       
007570               ,:Ｍ４０−請求先コード                             
007580               ,:Ｍ４０−契約番号                                 
007590               ,:Ｍ４０−契約種類                                 
007600               ,:Ｍ４０−担当部課コード                           
007610               ,:Ｍ４０−再リース回数                             
007620               ,:Ｍ４０−充当開始年月                             
007630               ,:Ｍ４０−充当月数                                 
007640               ,:Ｍ４０−前払回収方法                             
007650               ,:Ｍ４０−入金日                                   
007660               ,:Ｍ４０−入金区分                                 
007670               ,:Ｍ４０−前月末残高                               
007680               ,:Ｍ４０−当月回収額                               
007690               ,:Ｍ４０−当月消化額                               
007700               ,:Ｍ４０−当月末残高                               
007710               ,:Ｄ０１−名寄せコード                             
007720               ,:Ｄ０１−取引先名称                               
007730               ,:Ｄ０２−請求先名称                               
007740               ,:Ｍ４０−協調区分                                 
007750               ,:Ｍ４０−前月末残高他社                           
007760               ,:Ｍ４０−当月回収額他社                           
007770               ,:Ｍ４０−当月消化額他社                           
007780               ,:Ｍ４０−当月他社解約分料金                       
007790               ,:Ｍ４０−当月他社解約分消費税                     
007800               ,:Ｍ４０−当月末残高他社                           
007810     END-EXEC.                                                    
007820*----------------------------------------------------------------*
007830*    結合テーブル読込を確認                                      *
007840*----------------------------------------------------------------*
007850     EVALUATE   SQLCODE                                           
007860        WHEN   定数−ＳＱＬＯＫ                                   
007870*--<       正常 >                                                 
007880*                                                                 
007890           COMPUTE  Ｗ−入力−件数  =  Ｗ−入力−件数  +  1       
007900        WHEN   定数−ＳＱＬＥＮＤ                                 
007910*--<       読込終了 >                                             
007920           MOVE  "Y"                  TO  Ｗ−終了−フラグ        
007930        WHEN   OTHER                                              
007940*--<       読込失敗 >                                             
007950           MOVE     -50               TO  Ｗ−エラーコード        
007960           PERFORM  エラー処理                                    
007970     END-EVALUATE.                                                
007980*                                                                 
007990 結合読込件目−ＥＸＩＴ.                                          
008000     EXIT.                                                        
008010*                                                                 
008020
008030******************************************************************
008040*    ＤＢクローズ                                         <3.1>  *
008050******************************************************************
008060 ＤＢクローズ                     SECTION.                    
008070 ＤＢクローズ−ＳＴＡＲＴ.                                    
008080*                                                                 
008090*--< カーソル クローズ >                                          
008100     EXEC SQL                                                     
008110        CLOSE  CUR1                                               
008120     END-EXEC.                                                    
008130*                                                                 
008140 ＤＢクローズ−ＥＸＩＴ.                                          
008150     EXIT.                                                        
008160******************************************************************
008170*       ファイルクローズ処理.                            <3.2>   *
008180******************************************************************
008190 ファイルクローズ                     SECTION.                    
008200 ファイルクローズ−ＳＴＡＲＴ.                                    
008210      CLOSE  出力ファイル.                                        
008220 ファイルクローズ−ＥＸＩＴ.                                      
008230       EXIT.                                                      
008240******************************************************************
008250*    終了メッセージ出力                                  <3.3>   *
008260******************************************************************
008270 終了メッセージ出力                   SECTION.                    
008280 終了メッセージ出力−ＳＴＡＲＴ.                                  
008290*                                                                 
008300*----------------------------------------------------------------*
008301*    入力件数                                                    *
008302*----------------------------------------------------------------*
008303     INITIALIZE                       IF-CHOCO001.                
008310     MOVE  "3"                        TO  共１−イベント種別.     
008320     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008330     MOVE  "0"                        TO  共１−復帰コード.       
008340     MOVE  "M40MAB"                   TO  共１−処理テーブルＩＤ. 
008350     MOVE  "COUNT"                    TO  共１−処理識別.         
008360     MOVE  Ｗ−入力−件数             TO  共１−データ内容.       
008370     MOVE  "入力件数"                 TO  共１−その他メッセージ. 
008380     CALL  CLOCO001                USING  IF-CHOCO001.            
008390                                                                  
008391*----------------------------------------------------------------*
008392*    基準適用日ファイル入力件数                                  *
008393*----------------------------------------------------------------*
008400     INITIALIZE                       IF-CHOCO001.                
008410     MOVE  "3"                        TO  共１−イベント種別.     
008420     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008430     MOVE  "0"                        TO  共１−復帰コード.       
008440     MOVE  "SFHSED25"                 TO  共１−処理テーブルＩＤ. 
008450     MOVE  "COUNT"                    TO  共１−処理識別.         
008460     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
008470     MOVE  "出力件数"                 TO  共１−その他メッセージ. 
008480     CALL  CLOCO001                USING  IF-CHOCO001.            
008570*----------------------------------------------------------------*
008571*    終了メッセージ 出力                                         *
008572*----------------------------------------------------------------*
008574     INITIALIZE                       IF-CHOCO001.                
008580     MOVE  "3"                        TO  共１−イベント種別.     
008590     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008600     MOVE  "0"                        TO  共１−復帰コード.       
008610     MOVE  "END"                      TO  共１−処理識別.         
008620     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
008630     CALL  CLOCO001                USING  IF-CHOCO001.            
008640*                                                                 
008650 終了メッセージ出力−ＥＸＩＴ.                                              
008660     EXIT.                                                        
008670******************************************************************
008680*    ＤＢロールバック処理                                        *
008690******************************************************************
008700 ＤＢロールバック処理                 SECTION.                    
008710 ＤＢロールバック処理−ＳＴＡＲＴ.                                
008720*                                                                 
008730     EXEC  SQL                                                    
008740        ROLLBACK WORK  RELEASE                                    
008750     END-EXEC.                                                    
008760*                                                                 
008770     INITIALIZE                       IF-CHOCO001.                
008780     MOVE  "1"                        TO  共１−イベント種別.     
008790     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008800     MOVE  "9"                        TO  共１−復帰コード.       
008810     MOVE  "ROLLBACK"                 TO  共１−処理識別.         
008820     MOVE  "ロールバック実施"         TO  共１−その他メッセージ. 
008830     CALL  CLOCO001                USING  IF-CHOCO001.            
008840*                                                                 
008850 ＤＢロールバック処理−ＥＸＩＴ.                                  
008860     EXIT.                                                        
008870*                                                                 
008880******************************************************************
008890*    エラー処理                                          <4.0>   *
008900******************************************************************
008910 エラー処理                           SECTION.                    
008920 エラー処理−ＳＴＡＲＴ.                                          
008930*                                                                 
008940     MOVE  "Y"                        TO  Ｗ−異常終了−フラグ.       
008950     INITIALIZE                       IF-CHOCO001.                
008960*                                                                 
008970*                                                                 
008980     EVALUATE  Ｗ−エラーコード                                   
008990        WHEN  -10                                                 
009000*--<       ＯＲＡＣＬＥ接続失敗 >                                 
009010           MOVE  "1"                  TO  共１−イベント種別      
009020           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009030           MOVE  "9"                  TO  共１−復帰コード        
009040           MOVE  "CONNECT"            TO  共１−処理識別          
009050           MOVE  SQLCODE              TO  共１−データ内容        
009060           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009070           CALL  CLOCO001          USING  IF-CHOCO001             
009080*                                                                 
009090        WHEN  -20                                                 
009100*--<       バッチ用業務年月失敗 >                                 
009110           MOVE  "1"                  TO  共１−イベント種別      
009120           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009130           MOVE  "9"                  TO  共１−復帰コード        
009140           MOVE  "D70GYM"             TO  共１−処理テーブルＩＤ  
009150           MOVE  "OPEN"               TO  共１−処理識別          
009160           MOVE  SQLCODE              TO  共１−データ内容        
009170           MOVE  "バッチ用業務年月失敗"                           
009180                                      TO  共１−その他メッセージ  
009190           CALL  CLOCO001          USING  IF-CHOCO001             
009200*                                                                 
009210        WHEN  -30                                                 
009220*--<       結合テーブルカーソル宣言失敗>                          
009230           MOVE  "1"                  TO  共１−イベント種別      
009240           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009250           MOVE  "9"                  TO  共１−復帰コード        
009260           MOVE  "CURSOR"             TO  共１−処理テーブルＩＤ  
009270           MOVE  "OPEN"               TO  共１−処理識別          
009280           MOVE  SQLCODE              TO  共１−データ内容        
009290           MOVE  "カーソルＯＰＥＮ失敗"                           
009300                                      TO  共１−その他メッセージ  
009310           CALL  CLOCO001          USING  IF-CHOCO001             
009320*                                                                 
009330        WHEN  -40                                                 
009340*--<       ファイルオープン失敗 >                                 
009350           MOVE  "1"                  TO  共１−イベント種別      
009360           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009370           MOVE  "9"                  TO  共１−復帰コード        
009380           MOVE  "SFHSED25"           TO  共１−処理テーブルＩＤ  
009390           MOVE  "OPEN"               TO  共１−処理識別          
009400           MOVE  SQLCODE              TO  共１−データ内容        
009410           MOVE  "ファイルオープン失敗"                           
009420                                      TO  共１−その他メッセージ  
009430           CALL  CLOCO001          USING  IF-CHOCO001             
009440*                                                                 
009450        WHEN  -50                                                 
009460*--<       結合テーブル読込失敗 >                                 
009470           MOVE  "1"                  TO  共１−イベント種別      
009480           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009490           MOVE  "9"                  TO  共１−復帰コード        
009500           MOVE  "M40MAB"             TO  共１−処理テーブルＩＤ  
009510           MOVE  "FETCH"              TO  共１−処理識別          
009520           MOVE  SQLCODE              TO  共１−データ内容        
009530           MOVE  "結合テーブル読込失敗"                           
009540                                      TO  共１−その他メッセージ  
009550           CALL  CLOCO001          USING  IF-CHOCO001             
009560*                                                                 
009570        WHEN  -60                                                 
009580*--<       項目名称マスタより主契約(顧客)区分名称の抽出失敗 >     
009590           MOVE  "1"                  TO  共１−イベント種別      
009600           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009610           MOVE  "9"                  TO  共１−復帰コード        
009620           MOVE  "D19MSY"             TO  共１−処理テーブルＩＤ  
009630           MOVE  "SELECT"             TO  共１−処理識別          
009640           MOVE  SQLCODE              TO  共１−データ内容        
009650           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009660           CALL  CLOCO001          USING  IF-CHOCO001             
009670           MOVE  "N"                  TO  Ｗ−異常終了−フラグ     
009680*                                                                 
009690        WHEN  -70                                                 
009700*--<       債権情報（一般）ＤＢより項目の抽出失敗 >               
009710           MOVE  "1"                  TO  共１−イベント種別      
009720           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009730           MOVE  "9"                  TO  共１−復帰コード        
009740           MOVE  "M01SAJ"             TO  共１−処理テーブルＩＤ  
009750           MOVE  "SELECT"             TO  共１−処理識別          
009760           MOVE  SQLCODE              TO  共１−データ内容        
009770           MOVE  "項目の抽出失敗"                                 
009780                                      TO  共１−その他メッセージ  
009790           CALL  CLOCO001          USING  IF-CHOCO001             
009800           MOVE  "N"                  TO  Ｗ−異常終了−フラグ     
009810                                                                  
009820*                                                                 
009830        WHEN  -80                                                 
009840*--<       前受金受払残高中間ファイル出力処理（自社分)失敗 >      
009850           MOVE  "1"                  TO  共１−イベント種別      
009860           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009870           MOVE  "9"                  TO  共１−復帰コード        
009880           MOVE  "SFHSED25"           TO  共１−処理テーブルＩＤ  
009890           MOVE  "WRITE"              TO  共１−処理識別          
009900           MOVE  SQLCODE              TO  共１−データ内容        
009910           MOVE  "残高出力処理（自社分)失敗"                      
009920                                      TO  共１−その他メッセージ  
009930           CALL  CLOCO001          USING  IF-CHOCO001             
009940           MOVE  "N"                  TO  Ｗ−異常終了−フラグ     
009950*                                                                 
009960         WHEN  -90                                                
009970*--<       出力失敗 >                                             
009980           MOVE  "1"                  TO  共１−イベント種別      
009990           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010000           MOVE  "9"                  TO  共１−復帰コード        
010010           MOVE  "SFHSED25"           TO  共１−処理テーブルＩＤ  
010020           MOVE  "WRITE"              TO  共１−処理識別          
010030           MOVE  Ｗ−状態             TO  共１−データ内容        
010040           MOVE  "出力失敗 "          TO  共１−その他メッセージ  
010050           CALL  CLOCO001          USING  IF-CHOCO001             
010060*                                                                 
010070        WHEN  OTHER                                               
010080           MOVE  "N"                  TO  Ｗ−異常終了−フラグ     
010090     END-EVALUATE.                                                
010100*                                                                 
010110     IF  Ｗ−異常終了−フラグ  =  "Y"                              
010120         PERFORM  ＤＢロールバック処理                             
010130*                                                                 
010140         PERFORM  終了メッセージ出力                               
010150*                                                                 
010160*--<    プログラム異常終了のリターンコード >                      
010170         MOVE  定数−異常状態          TO  PROGRAM-STATUS          
010180*                                                                 
010190     END-IF.                                             
010200     EXIT  PROGRAM .                                                      
010210
010220 エラー処理−ＥＸＩＴ.    
010230        EXIT.                                                        
010240******************************************************************
010250*                  END OF PROGRAM                                *
010260******************************************************************
