000010******************************************************************
000020*         CP(A)                                     *
000030*      1. vO  : ėpe[u@@@                 *
000040*      2. vOID  : COBIS460                               *
000050*      3. Tv      : SUMMIT.׏SɂāA      *
000060*                                                                *
000070*      4. 쐬        : щF                                 *
000080*      5. 쐬        : 2004.10.10                             *
000090******************************************************************
000100*                                                                 
000110******************************************************************
000120*    hcdmshehb`shnm  chuhrhnm              *
000130******************************************************************
000140 IDENTIFICATION                       DIVISION.                   
000150*                                                                 
000160 PROGRAM-ID.                          COBIS460.                   
000170******************************************************************
000180*    dmuhqnmldms        chuhrhnm              *
000190******************************************************************
000200 ENVIRONMENT                          DIVISION.                   
000210******************************************************************
000220*    c`s`                      chuhrhnm              *
000230******************************************************************
000240 DATA                                 DIVISION.                   
000250******************************************************************
000260*  vnqjhmf|rsnq`fd  rdbshnm                *
000270******************************************************************
000280  WORKING-STORAGE                     SECTION.                    
000290*----------------------------------------------------------------*
000300*    zXgϐ`GA                                        *
000310*----------------------------------------------------------------*
000320     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.
000330*                                                                 
000340*--< nq`bkdʕϐ >                                       
000350     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000360*                                                                 
000370*--< nq`bkd  rpks >                               
000380     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000390*                                                                 
000400*--< SUMMIT >                                            
000410     EXEC  SQL  INCLUDE @LTRSKM.CBL           END-EXEC.          
000420*                                                                 
000430*--<ڍs__e>                                                
000440     EXEC  SQL  INCLUDE  D31KYK.CBL            END-EXEC.          
000450*                                                                 
000460*--< ڍs_}X^>                                                  
000470     EXEC  SQL  INCLUDE  D05GKO.CBL            END-EXEC.          
000480*
000490*--< ėpca>                                                  
000500     EXEC  SQL  INCLUDE  D40HSQ.CBL            END-EXEC.          
000510*
000520*--< >                                                  
000530     EXEC  SQL  INCLUDE  IKOTBL001.CBL         END-EXEC.          
000540*
000550*--< >                                                  
000560     EXEC  SQL  INCLUDE  IKOTBL002.CBL         END-EXEC.
000570*
000580*--< >                                                  
000590     EXEC  SQL  INCLUDE  IKOTBL005.CBL         END-EXEC.
000600
000610*          
000620     EXEC  SQL  END  DECLARE          SECTION  END-EXEC.          
000630*                                                                 
000640*----------------------------------------------------------------*
000650*    vnqjGA                                              *
000660*----------------------------------------------------------------*
000670 01  vnqj|GA.
000680   03  vr|A                       PIC S9(006) .
000690   03  vr|N.                              
000700     05  vr|s|I         PIC  X(02).                
000710     05  vr|s|N       PIC  X(06).                                      
000720   03  vr|z                   PIC S9(013).
000730   03  vr|N                 PIC  X(008).
000740   03  vr|ʔ
000750     05 vr|                 PIC  X(002). 
000760     05 vr|A1              PIC  X(04).
000770     05 vr|A1                   PIC  X(005).      
000780   03  vr|z                   PIC S9(013).
000790   03  vr|                 PIC S9(013).
000800   03  vr|z                 PIC S9(013).
000810   03  nkc|R[h
000820                         PIC  X(009).
000830   03  nkc|R[h
000840                         PIC  X(005).
000850   03  vr|bc  PIC S9(007).
000860                                            
000870*--< G[p >                                               
000880     03  v|G[R[h             PIC S9(04).                 
000890*                                                                 
000900*--< tOAA >                                               
000910     03  tOAA.                                            
000920         05  v|I|tO         PIC  X(01).                 
000930         05  v|ُI|tO     PIC  X(01).                 
000940*                                                                 
000950*--< GA >                                                 
000960     03  GA.                                              
000970         05  v|́|           PIC  9(09).                 
000980         05  v|ó|           PIC  9(09).                 
000990*                                                                 
001000*--< L[GA >                                                 
001010     03  jdx|GA.
001020        05  mdvL[.                                          
001030          07  mdvL[1.                                           
001040             09 m|_ԍ           PIC X(009).                 
001050             09 m|ă[XR[h     PIC S9(001).
001060             09 m|菈R[h PIC S9(002).
001070          07  mdvL[2.
001080             09 m|_ԍ           PIC X(009).
001090             09 m|ă[X       PIC S9(002).
001100          07  mdvL[3.
001110             09 m|sbc PIC S9(007).
001120        05 nkcL[.       
001130          07  nkcL[1.                                           
001140             09 n|_ԍ           PIC  X(009).                 
001150             09 n|ă[XR[h     PIC S9(001).
001160             09 n|菈R[h PIC S9(002). 
001170          07  nkcL[2.
001180             09 n|_ԍ           PIC X(009).
001190             09 n|ă[X       PIC S9(002). 
001200          07  nkcL[3.
001210             09 n|sbc PIC S9(007).              
001220*                                                                 
001230*--< ʏ >                                                   
001240 01  v|ʏ.                                                
001250     03  v|VXet.                                        
001260         05  v|I                 PIC  X(02) VALUE  "20".     
001270         05  v|N               PIC  X(06).                 
001280     03  v|VXe             PIC  X(08).                 
001290     03  v|S                   PIC  X(08) VALUE "IKOPG   ".
001300*                                                                 
001310*----------------------------------------------------------------*
001320*    Tu[`                                              *
001330*----------------------------------------------------------------*
001340 01  CALL-AREA.                                                   
001350*--< ʃOTu[` >                                       
001360     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001370     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001380*                                                                 
001390*----------------------------------------------------------------*
001400*    bnoẍ                                                *
001410*----------------------------------------------------------------*
001420*--< ʃOpp[^ >                                       
001430 01  IF-CHOCO001.                                                 
001440     COPY  CHOCO001  REPLACING  ==()==  BY  ==P|==.           
001450*                                                                 
001460*----------------------------------------------------------------*
001470*    hmht@CǍTu[`pp^̈                *
001480*----------------------------------------------------------------*
001490 01  PARA-AREA.                                                   
001500     COPY CPBCO001.                                               
001510******************************************************************
001520*    萔pf[^`GA                                      *
001530******************************************************************
001540 CONSTANT                             SECTION.                    
001550 01  萔̈.                                                    
001560     03  萔|vOhc         PIC  X(08) VALUE "COBIS430".
001570     03  萔|vO           PIC  X(80)                  
001580                                      VALUE  "ėpe[u".        
001590     03  萔|rpknj             PIC S9(04)  VALUE  ZERO.    
001600     03  萔|rpkdmc           PIC S9(04)  VALUE  0100.    
001610     03  萔|               PIC S9(04)  VALUE  ZERO.    
001620     03  萔|ُ               PIC S9(04)  VALUE  0009.    
001630******************************************************************
001640*    oqnbdctqd            chuhrhnm              *
001650******************************************************************
001660 PROCEDURE                            DIVISION.                   
001670*                                                                 
001680     PERFORM  .                                           
001690*                                                                 
001700     PERFORM  又  UNTIL  v|I|tO  =  "Y".            
001710*                                                                 
001720     PERFORM  I.                                           
001730*                                                                 
001740     STOP     RUN.                                                
001750*                                                                 
001760******************************************************************
001770*                                                        *
001780******************************************************************
001790                              SECTION.                    
001800 |rs`qs.                                            
001810*                                                                 
001820*----------------------------------------------------------------*
001830*    JnbZ[Wo͏                                      *
001840*----------------------------------------------------------------*
001850     INITIALIZE                       IF-CHOCO001.                
001860     MOVE  "3"                        TO  P|Cxg.     
001870     MOVE  萔|vOhc       TO  P|\[Xhc.       
001880     MOVE  "0"                        TO  P|AR[h.       
001890     MOVE  "START"                    TO  P|.         
001900     MOVE  萔|vO         TO  P|̑bZ[W. 
001910     CALL  CLOCO001                USING  IF-CHOCO001.            
001920*                                                                 
001930*----------------------------------------------------------------*
001940*    Ɨ̈̏l                                        *
001950*----------------------------------------------------------------*
001960     MOVE  SPACE                      TO  vnqj|GA.       
001970     INITIALIZE                           vnqj|GA.       
001980*                                                                 
001990     MOVE  LOW-VALUE                  TO  nkcL[.             
002000*                                                                 
002010*--< bott擾 >                                           
002020     ACCEPT  v|N               FROM  DATE.                 
002030*                                                                 
002040*--< bot擾 >                                           
002050     ACCEPT  v|VXe         FROM  TIME.                 
002060*                                                                 
002070*--< nq`bkdڑ >                                           
002080     PERFORM   nq`bkdڑ.                                  
002090*                                                                 
002100*--< e[uJ[\` >                                   
002110     PERFORM  e[uJ[\`.                           
002120*                                                                 
002130*--< e[uJ[\Ǎ(P) >                           
002140     PERFORM  e[uJ[\Ǎ.                           
002150*                                                                 
002160 |dwhs.                                              
002170     EXIT.                                                        
002180******************************************************************
002190*    nq`bkdڑ                                            *
002200******************************************************************
002210 nq`bkdڑ                     SECTION.                    
002220 nq`bkdڑ|rs`qs.                                    
002230*                                                                 
002240*--< hmht@CǍTu[`Ăяo >                     
002250     CALL  COBCO001                USING  PARA-AREA.              
002260*                                                                 
002270     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002280     MOVE  PARA-USERNAME              TO  USERNAME.               
002290     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002300*                                                                 
002310*----------------------------------------------------------------*
002320*    Jnڑ                                                    *
002330*----------------------------------------------------------------*
002340     IF  DB-STRING  =  SPACE                                      
002350        EXEC  SQL                                                 
002360           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
002370        END-EXEC                                                  
002380     ELSE                                                         
002390        EXEC  SQL                                                 
002400           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
002410             USING  :DB-STRING                                    
002420        END-EXEC                                                  
002430     END-IF.                                                      
002440*                                                                 
002450*----------------------------------------------------------------*
002460*    ڑԔ                                                *
002470*----------------------------------------------------------------*
002480     EVALUATE  SQLCODE                                            
002490        WHEN  萔|rpknj                                    
002500*--<       ڑ >                                             
002510           CONTINUE                                               
002520        WHEN  OTHER                                               
002530*--<       ڑG[ >                                           
002540           MOVE     -1                TO  v|G[R[h        
002550           PERFORM  G[                                    
002560     END-EVALUATE.                                                
002570*                                                                 
002580 nq`bkdڑ|dwhs.                                      
002590     EXIT.                                                        
002600******************************************************************
002610*        e[uJ[\`                                *
002620******************************************************************
002630 e[uJ[\`             SECTION.                    
002640 e[uJ[\`|rs`qs. 
002650*
002660     EXEC SQL                                                     
002670        DECLARE CUR1  CURSOR FOR                                  
002680           SELECT  LTRSKM.jdxڐR[h                             
002690                  ,LTRSKM._ԍ                         
002700                  ,LTRSKM.ă[XR[h  
002710                  ,LTRSKM.菈R[h                         
002720                  ,LTRSKM.[
002730                  ,LTRSKM._ԍ                      
002740                  ,NVL(D31KYK_TBL._ԍ, RPAD(' ',10,' '))
002750                  ,NVL(D31KYK_TBL.ă[X, RPAD(' ',2,' '))
002760                  ,NVL(D31KYK_TBL.ă[XԊu, 
002770                                             RPAD(' ',2,' '))       
002780                  ,LTRSKM.    
002790                  ,LTRSKM.sQN     
002800                  ,LTRSKM.z     
002810                  ,LTRSKM.ŁQz
002820                  ,LTRSKM.QI 
002830                  ,LTRSKM.QN
002840                  ,LTRSKM.ă[X    
002850                  ,LTRSKM.ʔ     
002860                  ,LTRSKM.\    
002870                  ,LTRSKM.z   
002880                  ,LTRSKM.z     
002890                  ,LTRSKM.R[h    
002900                  ,LTRSKM.ƏR[h    
002910                  ,LTRSKM.Z敪    
002920                  ,LTRSKM.sbc
002930                  ,NVL(D05GKO_TBL.sR[h, RPAD(' ',4,' '))
002940                  ,NVL(D05GKO_TBL.xXR[h, RPAD(' ',3,' '))
002950                  ,LTRSKM.ŁQŃR[h    
002960                  ,LTRSKM.ŁQ敪   
002970                  ,LTRSKM.x
002980                  ,LTRSKM.ʏ
002990             FROM  LTRSKM
003000                  ,D31KYK_TBL                    
003010                  ,D05GKO
003020            WHERE  LTRSKM.敪       =  2                 
003030              AND  LTRSKM.ʔ = ZERO                          
003040         ORDER BY                           
003050     END-EXEC.
003060*                                                                 
003070*----------------------------------------------------------------*
003080*    J[\nodm                                        *
003090*----------------------------------------------------------------*
003100     EXEC  SQL                                                    
003110        OPEN  CUR1                                                
003120     END-EXEC.                                                    
003130*                                                                 
003140*----------------------------------------------------------------*
003150*    J[\nodmmF                                        *
003160*----------------------------------------------------------------*
003170     EVALUATE  SQLCODE                                            
003180        WHEN  萔|rpknj                                    
003190*--<        >                                                 
003200           CONTINUE                                               
003210        WHEN  OTHER                                               
003220*--<       J[\nodmG[ >                               
003230           MOVE -20                   TO  v|G[R[h        
003240           PERFORM  G[菈                                
003250     END-EVALUATE.                                                
003260*                                                                 
003270 e[uJ[\`|dwhs.                              
003280     EXIT.                                                        
003290******************************************************************
003300*    e[uJ[\Ǎ                                    *
003310******************************************************************
003320 e[uJ[\Ǎ             SECTION.                    
003330 e[uJ[\Ǎ|rs`qs.                            
003340*                                                                 
003350*--< e[uJ[\Ǎ >                                   
003360     EXEC SQL                                                     
003370         FETCH  CUR1                                              
003380          INTO    ksqrjl|jdxڐR[h              
003390                  ,:ksqrjl|_ԍ                         
003400                  ,:ksqrjl|ă[XR[h  
003410                  ,:ksqrjl|菈R[h                         
003420                  ,:ksqrjl|[
003430                  ,:ksqrjl|_ԍ                      
003450                  ,:cRP|_ԍ
003460                  ,:cRP|ă[X
003470                  ,:cRP| ă[XԊu
003490                  ,:ksqrjl|    
003500                  ,:ksqrjl|sQN     
003510                  ,:ksqrjl|z     
003520                  ,:ksqrjl|ŁQz
003530                  ,:ksqrjl|QI 
003540                  ,:ksqrjl|QN
003550                  ,:ksqrjl|ă[X    
003560                  ,:ksqrjl|ʔ     
003570                  ,:ksqrjl|\    
003580                  ,:ksqrjl|z   
003590                  ,:ksqrjl|z     
003600                  ,:ksqrjl|R[h    
003610                  ,:ksqrjl|ƏR[h    
003620                  ,:ksqrjl|Z敪    
003630                  ,:ksqrjl|sbc
003640                  ,:cOT|sR[h
003650                  ,:cOT|xXR[h
003660                  ,:ksqrjl|ŁQŃR[h    
003670                  ,:ksqrjl|ŁQ敪   
003680                  ,:ksqrjl|x
003690                  ,:ksqrjl|ʏ
003700           END-EXEC.                                                    
003710*                                                                 
003720*----------------------------------------------------------------*
003730*    e[uJ[\ǍmF                              *
003740*----------------------------------------------------------------*
003750*
003760     EVALUATE   SQLCODE                                           
003770        WHEN   萔|rpknj                                   
003780*--<        > 
003790           MOVE  ksqrjl|_ԍ   
003800                                      TO  m|_ԍ            
003810           MOVE  ksqrjl|ă[XR[h                           
003820                                      TO  m|ă[XR[h        
003830           MOVE  ksqrjl|菈R[h   
003840                                      TO  m|菈R[h           
003850           MOVE  ksqrjl|sbc            
003860                                      TO   m|sbc                               
003870*                                                                  
003880           COMPUTE  v|́|  =  v|́|  +  1       
003890        WHEN   萔|rpkdmc                                 
003900*--<       ǍI >                                             
003910           MOVE  "Y"                  TO  v|I|tO        
003920        WHEN   OTHER                                              
003930*--<       ǍG[ >                                           
003940           MOVE     -30               TO  v|G[R[h        
003950           PERFORM  G[菈                                
003960     END-EVALUATE.                                                
003970*                                                                 
003980 e[uJ[\Ǎ|dwhs.                              
003990     EXIT.                                                        
004000******************************************************************
004010*    又                                                      *
004020******************************************************************
004030 又                               SECTION.                    
004040 又|rs`qs.                                              
004050*                                                                 
004060     PERFORM  ҏWo͏.                                       
004070*                                                                 
004080*--< e[uJ[\ǍiQڈȍ~j >                     
004090     PERFORM  e[uJ[\Ǎ.                           
004100*                                                                 
004110     IF  v|I|tO  =  "Y"                                 
004120*--<    ̓f[^I鎞Ōo͏ >                          
004130        PERFORM  o͏                                         
004140     END-IF.                                                      
004150*                                                                 
004160 又|dwhs.                                                
004170     EXIT.                                                        
004180******************************************************************
004190*     ҏWo͏                                               *
004200******************************************************************
004210 ҏWo͏                         SECTION.                    
004220 ҏWo͏|rs`qs.
004230*                                                                 
004240     IF  mdvL[  =  nkcL[                                
004250*--<    No.05 >                                                   
004260        MOVE  hjnOOQ|ă[X      
004270                                      TO  cSO|ă[X        
004280*                                                                
004290*--<    No.06 >                                                   
004300        MOVE  hjnOOQ|_          
004310                                      TO  cSO|_        
004320*                                                          
004330*--<    No.08 >                                                   
004340        MOVE  cRP|ă[XԊu          
004350                                      TO  cSO|Ԋu            
004360*                                                          
004370*--<    No.24 >                                                   
004380        MOVE  cOT|sZkR[h  TO  cSO|sZkR[h  
004390*
004400*--<    No.27 >                                                   
004410        MOVE  ksqrjl|菈R[h              
004420                                      TO  cSO|菈R[h   
004430*       
004440     ELSE                                                         
004450        IF  v|́|  >  1                                  
004460*--<       Qڈȍ~AL[ς鎞Ao͂ >               
004470           PERFORM  o͏                                      
004480        END-IF                                                    
004490*                                                                     
004500*----------------------------------------------------------------*
004510*       ڕҏW                                             *
004520*----------------------------------------------------------------*
004530*--<    No.01 >
004540        PERFORM ϊP                                       
004550        MOVE  ksqrjl|jdxڐR[h 
004560                                      TO  cSO|R[h        
004570*                                                                 
004580*--<    No.02 >
004590        PERFORM ϊ2                                           
004600        MOVE  ksqrjl|jdxڐR[h  
004610                                      TO  cSO|R[h    
004620                                                                  
004630*--<    No.03 >
004640        PERFORM Aԏ                                                   
004650        MOVE vr|A               TO  cSO|A  
004660*                                                                
004670*--<    No.04 >                                                   
004680        MOVE  ksqrjl|_ԍ  TO  cSO|_ԍ          
004690*                                                                 
004700*--<    No.05 >
004710        PERFORM             ă[X񐔌_ޏ                                                   
004720        MOVE  hjnOOQ|ă[X    
004730                                      TO  cSO|ă[X                                                 
004740*                                                                 
004750*--<    No.06 >
004760        PERFORM             ă[X񐔌_ޏ                                                   
004770        MOVE  hjnOOQ|_          
004780                                      TO  cSO|_        
004790*                                                                 
004800*--<    No.07 >                                                   
004810        MOVE  ksqrjl|[  TO  cSO|        
004820*                                                                 
004830*--<    No.08 > 
004840        PERFORM  Ԋu                                                  
004850        MOVE  cRP|ă[XԊu          
004860                                      TO  cSO|Ԋu            
004870*                                                                 
004880*--<    No.09 >
004890        PERFORM  @                                                  
004900        MOVE  ksqrjl|  TO  cSO|@           
004910*                                                                 
004920*--<    No.10 >
004930        PERFORM  N                                                  
004940        MOVE  vr|N        TO  cSO|N      
004950*                                                                 
004960*--<    No.11 >
004970        PERFORM  z                                                   
004980        MOVE  vr|z          TO  cSO|z       
004990*                                                                 
005000*--<    No.12 >
005010        PERFORM ŏ                                                   
005020        MOVE  ksqrjl|Ł|z           
005030                                      TO  cSO|           
005040*                                                                 
005050*--<    No.13 >                                                   
005060        MOVE   vr|N       TO  cSO|N
005070*                                                                 
005080*--<    No.14 >
005090        PERFORM  ʔԏ                                                  
005100        MOVE  vr|ʔ          TO  cSO|ʔ       
005110*                                                                 
005120*--<    No.15 >                                                   
005130        MOVE  ksqrjl|\
005140                                      TO  cSO|\         
005150*                                                                 
005160*--<    No.16 >                                                   
005170        MOVE  vr|N        TO  cSO|N      
005180*
005190*--<    No.17 >
005200        PERFORM z                                                  
005210        MOVE  vr|z          TO  cSO|z    
005220*
005230*--<    No.18 >
005240        PERFORM ŏ                                                   
005250        MOVE  vr|        TO  cSO|     
005260                                           
005270*
005280*--<    No.19 >
005290        PERFORM z                                                    
005300        MOVE  vr|z        TO  cSO|z      
005310*
005320*--<    No.20 >                                                   
005330        MOVE  vr|            TO  cSO|      
005340*
005350*--<    No.21 >
005360        PERFORM R[h                                                   
005370        MOVE  ksqrjl|R[h              
005380                                      TO  cSO|R[h  
005390*
005400*--<    No.22 >                                                   
005410        MOVE  ksqrjl|ƏR[h              
005420                                      TO cSO|ۃR[h  
005430*
005440*--<    No.23 >                                                   
005450        MOVE  ksqrjl|Z敪  TO cSO|Z敪     
005460*
005470*--<    No.24 >
005480        PERFORM sZkR[h                                                    
005490        MOVE  cOT|sZkR[h    TO  cSO|sZkR[h  
005500*
005510*--<    No.25 >                                                   
005520        MOVE  ksqrjl|Ł|ŃR[h             
005530                                      TO  cSO|ŃR[h
005540*
005550*--<    No.26 >                                                   
005560        MOVE  ksqrjl|Ł|敪             
005570                                      TO  cSO|Œ敪      
005580*
005590*--<    No.27 >
005600        PERFORM   ă[X񐔌_ޏ                                                   
005610        MOVE  ksqrjl|菈R[h              
005620                                      TO  cSO|菈R[h   
005630*
005640*--<    No.28 >                                                   
005650        MOVE  ksqrjl|x             
005660                                      TO  cSO|   
005670*
005680*--<    No.29 >                                                   
005690        MOVE  v|VXet        TO  cSO|o^N      
005700*
005710*--<    No.30 >                                                   
005720        MOVE  v|VXe        TO  cSO|o^      
005730*
005740*--<    No.31 >                                                   
005750        MOVE  v|S              TO  cSO|o^S     
005760*
005770*--<    No.32 >                                                   
005780        MOVE  v|VXet        TO  cSO|XVN      
005790*
005800*--<    No.33 >                                                   
005810        MOVE  v|VXe        TO  cSO|XV     
005820*
005830*--<    No.34 >                                                   
005840        MOVE  v|S              TO  cSO|XV     
005850*
005860*--<    No.35 >                                                   
005870        MOVE  v|S              TO  cSO|͒S҃R[h      
005880*                                                                 
005890     END-IF.                                                     
005900*                                                                 
005910     MOVE mdvL[                  TO  nkcL[.             
005920*                                                                                                                  
005930**                                                                 
005940  ҏWo͏|dwhs.                                          
005950     EXIT.
005960******************************************************************
005970*                 ϊ1                                           *
005980******************************************************************
005990 ϊP                           SECTION.                    
006000 ϊP|rs`qs.                                          
006010*                                                                 
006020     EXEC  SQL                                                    
006030           SELECT  VR[h                                 
006040             INTO :hjnOOP|VR[h                   
006050             FROM  IKOTBL001
006060                   LTRSKM                                     
006070            WHERE  IKOTBL001.VR[h                          
006080                            =                           
006090                            :LTRSKM.jdxڐR[h 
006100              AND  IKOTBL001.ړIbc = '3'                       
006110     END-EXEC.                                                    
006120*                                                                 
006130*----------------------------------------------------------------*
006140*    ϊPmF                                              *
006150*----------------------------------------------------------------*
006160     EVALUATE  SQLCODE                                            
006170        WHEN  萔|rpknj                                    
006180*--<        >                                                 
006190           CONTINUE                                               
006200        WHEN  OTHER                                               
006210*--<       ϊPG[ >                                     
006220           MOVE     SPACE             TO                          
006230                                     hjnOOP|VR[h
006240     END-EVALUATE.                                                
006250*                                                                 
006260  ϊP|dwhs.                                           
006270     EXIT.
006280******************************************************************
006290*                 ϊ2                                           *
006300******************************************************************
006310 ϊP                           SECTION.                    
006320 ϊP|rs`qs.                                          
006330*                                                                 
006340     EXEC  SQL                                                    
006350           SELECT  }                                 
006360             INTO :hjnOOP|}                   
006370             FROM  IKOTBL001                                      
006380            WHERE  IKOTBL001.}                          
006390                            =                           
006400                            :LTRSKM_TBL.jdxڐR[h 
006410              AND  IKOTBL001.ړIbc = '3'                       
006420     END-EXEC.                                                    
006430*                                                                 
006440*----------------------------------------------------------------*
006450*    ϊPmF                                              *
006460*----------------------------------------------------------------*
006470     EVALUATE  SQLCODE                                            
006480        WHEN  萔|rpknj                                    
006490*--<        >                                                 
006500           CONTINUE                                               
006510        WHEN  OTHER                                               
006520*--<       ϊPG[ >                                     
006530           MOVE     SPACE             TO                          
006540                                      hjnOOP|VR[h
006550     END-EVALUATE.                                                
006560*                                                                 
006570  ϊ2|dwhs.                                           
006580     EXIT.
006590******************************************************************
006600*                  Aԏ                                      *
006610******************************************************************
006620 Aԏ                           SECTION.                    
006630 Aԏ|rs`qs.
006640         MOVE  SPACE                   TO  nkc|R[h                
006650         INITIALIZE                        nkc|R[h
006660         MOVE  SPACE                   TO  nkc|R[h 
006670         INITIALIZE                        nkc|R[h         
006680         IF cSO|R[h   NOT  =  nkc|R[h
006690            OR  cSO|R[h  
006700                                   NOT  =   nkc|R[h
006710            MOVE  '1'                  TO   cSO|A
006720          ELSE 
006730             cSO|A = cSO|A + 1 
006740             MOVE cSO|R[h TO  nkc|R[h
006750             MOVE cSO|R[h TO  nkc|R[h
006760         END-IF.
006770Aԏ|dwhs.                                           
006780       EXIT.
006790
006800******************************************************************
006810*                  ă[X񐔌_ޏ                      *
006820******************************************************************
006830 ă[X񐔌_ޏ                        SECTION.                    
006840 ă[X񐔌_ޏ|rs`qs.
006850        IF  IKOTBL002._mn = LTRSKM._ԍ
006860        ADD IKOTBL002.ă[XR[h = LTRSKM.ă[XR[h
006870        ADD IKOTBL002.菈R[h
006880                                   = LTRSKM.菈R[h
006890        ADD IKOTBL002.菈R[h
006900                                   = LTRSKM.菈R[h                                                                  
006910        MOVE  vr|ă[X      TO  m|ă[X
006920        END-IF.
006930        MOVE mdvL[1                  TO  nkcL[1.             
006940*                                                                 
006950 ă[X񐔌_ޏ|dwhs.                                          
006960        EXIT.                                                  
006970******************************************************************
006980*                 Ԋu                                 *
006990******************************************************************
007000 Ԋu                          SECTION.                    
007010 Ԋu|rs`qs.
007020        EXEC SQL
007030           SELECT _ԍ
007040                 ,ă[X
007050           INTO :cRP|_ԍ
007060               ,:cRP|ă[X
007070            FROM D31KYK
007080       WHERE cRP|_ԍ              = :cSO|_ԍ
007090         AND cRP|ă[X          = :cSO|ă[X
007100       END-EXEC.
007110*
007120*----------------------------------------------------------------*
007130* mF *
007140*----------------------------------------------------------------*
007150          EVALUATE SQLCODE
007160          WHEN 萔|rpknj
007170*--< ̎ >
007180          CONTINUE
007190          WHEN OTHER
007200*--< 擾ȂAlZbg >
007210          MOVE ZERO TO  vr|Ԋu
007220          END-EVALUATE.
007230          MOVE mdvL[2                  TO  nkcL[2.             
007240*                                                                 
007250 Ԋu|dwhs.                                          
007260          EXIT.                                                  
007270******************************************************************
007280*                  @                                      *
007290******************************************************************
007300 @                          SECTION.                    
007310 @|rs`qs.
007320        IF ksqrjl| = '1'
007330           MOVE ZERO TO  cSO|@
007340        IF ksqrjl| = '2'
007350           MOVE '5' TO  cSO|@ 
007360        IF  ksqrjl| = '3'
007370           MOVE '3' TO cSO|@
007380        IF ksqrjl| = '4'
007390           MOVE '4' TO  cSO|@
007400        END-IF.                     
007410*
007420 @|dwhs.                                           
007430     EXIT.
007440
007450******************************************************************
007460*                  N                                *
007470******************************************************************
007480 N                         SECTION.                    
007490 N|rs`qs.
007500        IF  ksqrjl|s|N  = ZERO     
007510           MOVE  ZERO                 TO  v|N                       
007520        ELSE                                                         
007530           IF ksqrjl|s|I = 0   
007540              MOVE  "19"                 TO  v|s|I        
007550           ELSE                                                      
007560              MOVE  "20"                 TO  v|s|I        
007570              MOVE  ksqrjl|s|N  
007580                                         TO  v|s|N
007590        END-IF.
007600*
007610 N|dwhs.                                           
007620     EXIT.
007630
007640******************************************************************
007650*                  z                                  *
007660******************************************************************
007670 z                         SECTION.                    
007680 z|rs`qs.
007690   
007700     COMPUTE   vr|z
007710               ksqrjl|z -
007720                                 ksqrjl|Ł|z.
007730*
007740 z|dwhs.                                           
007750     EXIT.
007760
007770******************************************************************
007780*                  ʔԏ                                  *
007790******************************************************************
007800 ʔԏ                         SECTION.                    
007810 ʔԏ|rs`qs.
007820      vr|  = SUBSTR(ksqrjl||N,1,5)
007830                                               
007840      vr|A1 = SUBSTR(ksqrjl|ʔ,1,4)
007850       vr|A1    = SUBSTR(vr|A,1[,5]).
007860*
007870 ʔԏ|dwhs.                                           
007880     EXIT.      
007890******************************************************************
007900*                 z                                   *
007910******************************************************************
007920 z                         SECTION.                    
007930 z|rs`qs.
007940        IF ksqrjl|z >  ZERO
007950           COMPUTE vr|z     =   ksqrjl|z
007960                                      -   
007970                                      ksqrjl|Ł|z
007980        ELSE MOVE ZERO                TO  vr|z
007990        END-IF.
008000*
008010 z|dwhs.                                           
008020     EXIT.      
008030
008040******************************************************************
008050*           ŏ                                       *
008060******************************************************************
008070 ŏ                             SECTION.                    
008080 ŏ|rs`qs.
008090*
008100         IF ksqrjl|z >  ZERO
008110            MOVE  ksqrjl|Ł|z           
008120                                      TO  vr|
008130         ELSE 
008140            MOVE ZERO                 TO vr|
008150         END-IF.
008160*
008170 ŏ|dwhs.                                           
008180     EXIT.      
008190
008200******************************************************************
008210*   z                                               *
008220******************************************************************
008230 z                             SECTION.                    
008240 z|rs`qs.                                            
008250*
008260         COMPUTE  vr|z    =  vr|z
008270                                      +  vr|z
008280                                      -  vr|z
008290                                      -  vr|.
008300*
008310 z|dwhs.                                           
008320     EXIT.      
008330   
008340******************************************************************
008350*    R[h                                          *
008360******************************************************************
008370 R[h                             SECTION.                    
008380 R[h|rs`qs.                      
008390*                                                                 
008400     EXEC  SQL                                                    
008410           SELECT  R[h
008420                   ANZX敪                                   
008430             INTO :hjnOOT|R[h
008440                 ,:hjnOOT|ANZX敪                   
008450             FROM  IKOTBL005
008460                   LTRSKM                                     
008470            WHERE  IKOTBL005.ANZX敪                          
008480                                      = A                                            
008490              AND  hjnOOT|R[h
008500                                      =
008510                                     ksqrjl|R[h                       
008520     END-EXEC.
008530*
008540 R[h|dwhs.                                           
008550     EXIT.      
008560
008570******************************************************************
008580*                 sZkR[h                             *
008590******************************************************************
008600 sZkR[h                          SECTION.                    
008610 sZkR[h|rs`qs.
008620        EXEC SQL
008630           SELECT sR[h
008640                 ,xXR[h
008650                 ,sZkR[h
008660           INTO :cOT|sR[h
008670               ,:cOT|xXR[h
008680               ,:cOT|sZkR[h
008690            FROM D05GKO_TBL
008700           WHERE  ksqrjl|sbc
008710                                   =  sR[h 
008720                                   +  xXR[h
008730     END-EXEC.
008740*
008750*----------------------------------------------------------------*
008760* mF *
008770*----------------------------------------------------------------*
008780          EVALUATE SQLCODE
008790          WHEN 萔|rpknj
008800*--< ̎ >
008810          CONTINUE
008820          WHEN OTHER
008830*--< 擾ȂAlZbg >
008840          MOVE ZERO TO  cOT|sZkR[h
008850          END-EVALUATE.
008860          MOVE mdvL[3                  TO  nkcL[3.             
008870*                                                                 
008880 sZkR[h|dwhs.                                          
008890          EXIT.                                                                                                                                                                      
008900******************************************************************
008910*    o͏                                                    *
008920******************************************************************
008930 o͏                             SECTION.                    
008940 o͏|rs`qs.                                            
008950*                                                                 
008960       EXEC  SQL                                                  
008970        INSERT  INTO  D40HSQ_TBL                                  
008980           ( R[h                                             
008990            ,R[h                                         
009000            ,A                                             
009010            ,_ԍ                                               
009020            ,ă[X                                             
009030            ,_                                              
009040            ,                                             
009050            ,Ԋu                                                 
009060            ,@                                               
009070            ,N                                          
009080            ,z                                              
009090            ,                                   
009100            ,N                                          
009110            ,ʔ                                             
009120            ,\
009130            ,N
009140            ,z
009150            ,
009160            ,z
009170            ,
009180            ,R[h
009190            ,ۃR[h
009200            ,Z敪
009210            ,sZkR[h
009220            ,ŃR[h
009230            ,Œ敪
009240            ,菈R[h
009250            ,
009260            ,o^N
009270            ,o^
009280            ,o^S
009290            ,XVN
009300            ,XV
009310            ,XV
009320            ,͒S҃R[h)                                       
009330       VALUES                                                     
009340             ( :R[h                                             
009350            ,:cSO|R[h                                         
009360            ,:cSO|A                                             
009370            ,:cSO|_ԍ                                               
009380            ,:cSO|ă[X                                             
009390            ,:cSO|_                                              
009400            ,:cSO|                                             
009410            ,:cSO|Ԋu                                                 
009420            ,:cSO|@                                               
009430            ,:cSO|N                                          
009440            ,:cSO|z                                              
009450            ,:cSO|                                   
009460            ,:cSO|N                                          
009470            ,:cSO|ʔ                                             
009480            ,:cSO|\
009490            ,:cSO|N
009500            ,:cSO|z
009510            ,:cSO|
009520            ,:cSO|z
009530            ,:cSO|
009540            ,:cSO|R[h
009550            ,:cSO|ۃR[h
009560            ,:cSO|Z敪
009570            ,:cSO|sZkR[h
009580            ,:cSO|ŃR[h
009590            ,:cSO|Œ敪
009600            ,:cSO|菈R[h
009610            ,:cSO|
009620            ,:cSO|o^N
009630            ,:cSO|o^
009640            ,:cSO|o^S
009650            ,:cSO|XVN
009660            ,:cSO|XV
009670            ,:cSO|XV
009680            ,:cSO|͒S҃R[h)                           
009690     END-EXEC.                                                    
009700*                                                                 
009710*----------------------------------------------------------------*
009720*    ǉmF                                              *
009730*----------------------------------------------------------------*
009740     EVALUATE  SQLCODE                                            
009750        WHEN   萔|rpknj                                   
009760*--<       ǉ >                                             
009770           COMPUTE  v|ó|  =  v|ó|  +  1       
009780        WHEN   OTHER                                              
009790*--<       ǉG[ >                                       
009800           MOVE     -40               TO  v|G[R[h        
009810           PERFORM  G[菈                                
009820     END-EVALUATE.                                                
009830*                                                                 
009840 o͏|dwhs.                                              
009850     EXIT.                                                        
009860******************************************************************
009870*    I                                                    *
009880******************************************************************
009890 I                             SECTION.                    
009900 I|rs`qs.                                            
009910*                                                                 
009920     PERFORM  caN[Y.                                   
009930*                                                                 
009940     PERFORM  caR~bg.                                   
009950*                                                                 
009960     PERFORM  IbZ[Wo.                                 
009970*                                                                 
009980*--< vOI >                                         
009990     MOVE  萔|             TO  PROGRAM-STATUS.         
010000*                                                                 
010010 I|dwhs.                                              
010020     EXIT.                                                        
010030******************************************************************
010040*    IbZ[Wo                                          *
010050******************************************************************
010060 IbZ[Wo                   SECTION.                    
010070 IbZ[Wó|rs`qs.                                  
010080*                                                                 
010090*----------------------------------------------------------------*
010100*    bZ[Wo͏                                      *
010110*----------------------------------------------------------------*
010120     INITIALIZE                       IF-CHOCO001.                
010130     MOVE  "3"                        TO  P|Cxg.     
010140     MOVE  萔|vOhc       TO  P|\[Xhc.       
010150     MOVE  "0"                        TO  P|AR[h.       
010160     MOVE  "LTRSKM"                  TO  P|e[uhc. 
010170     MOVE  "COUNT"                    TO  P|.         
010180     MOVE  v|́|             TO  P|f[^e.       
010190     MOVE  "SUMMITד͌"                         
010200                                      TO  P|̑bZ[W. 
010210     CALL  CLOCO001                USING  IF-CHOCO001.            
010220*                                                                 
010230     INITIALIZE                       IF-CHOCO001.                
010240     MOVE  "3"                        TO  P|Cxg.     
010250     MOVE  萔|vOhc       TO  P|\[Xhc.       
010260     MOVE  "0"                        TO  P|AR[h.       
010270     MOVE  "D40HSQ"                   TO  P|e[uhc. 
010280     MOVE  "COUNT"                    TO  P|.         
010290     MOVE  v|ó|             TO  P|f[^e.       
010300     MOVE  "ėpDBo͌"       TO  P|̑bZ[W. 
010310     CALL  CLOCO001                USING  IF-CHOCO001.            
010320*                                                                 
010330*----------------------------------------------------------------*
010340*    IbZ[Wo                                          *
010350*----------------------------------------------------------------*
010360     INITIALIZE                       IF-CHOCO001.                
010370     MOVE  "3"                        TO  P|Cxg.     
010380     MOVE  萔|vOhc       TO  P|\[Xhc.       
010390     MOVE  "0"                        TO  P|AR[h.       
010400     MOVE  "END"                      TO  P|.         
010410     MOVE  萔|vO         TO  P|̑bZ[W. 
010420     CALL  CLOCO001                USING  IF-CHOCO001.            
010430*                                                                 
010440 IbZ[Wó|dwhs.                                    
010450     EXIT.                                                        
010460******************************************************************
010470*    caN[Y                                                *
010480******************************************************************
010490 caN[Y                     SECTION.                    
010500 caN[Y|rs`qs.                                    
010510*                                                                 
010520*--< J[\ N[Y >                                          
010530     EXEC SQL                                                     
010540        CLOSE  CUR1                                               
010550     END-EXEC.                                                    
010560*                                                                 
010570 caN[Y|dwhs.                                      
010580     EXIT.                                                        
010590******************************************************************
010600*    caR~bg                                            *
010610******************************************************************
010620 caR~bg                     SECTION.                    
010630 caR~bg|rs`qs.                                    
010640*                                                                 
010650     EXEC  SQL                                                    
010660        COMMIT  WORK  RELEASE                                     
010670     END-EXEC.                                                    
010680*                                                                 
010690     INITIALIZE                       IF-CHOCO001.                
010700     MOVE  "3"                        TO  P|Cxg.     
010710     MOVE  萔|vOhc       TO  P|\[Xhc.       
010720     MOVE  "0"                        TO  P|AR[h.       
010730     MOVE  "COMMIT"                   TO  P|.         
010740     MOVE  "R~bg{"             TO  P|̑bZ[W. 
010750     CALL  CLOCO001                USING  IF-CHOCO001.            
010760*                                                                 
010770 caR~bg|dwhs.                                      
010780     EXIT.                                                        
010790******************************************************************
010800*    ca[obN                                        *
010810******************************************************************
010820 ca[obN                 SECTION.                    
010830 ca[obN|rs`qs.                                
010840*                                                                 
010850     EXEC  SQL                                                    
010860        ROLLBACK WORK  RELEASE                                    
010870     END-EXEC.                                                    
010880*                                                                 
010890     INITIALIZE                       IF-CHOCO001.                
010900     MOVE  "1"                        TO  P|Cxg.     
010910     MOVE  萔|vOhc       TO  P|\[Xhc.       
010920     MOVE  "9"                        TO  P|AR[h.       
010930     MOVE  "ROLLBACK"                 TO  P|.         
010940     MOVE  "[obN{"         TO  P|̑bZ[W. 
010950     CALL  CLOCO001                USING  IF-CHOCO001.            
010960*                                                                 
010970 ca[obN|dwhs.                                  
010980     EXIT.                                                        
010990******************************************************************
011000*    G[                                                  *
011010******************************************************************
011020 G[菈                       SECTION.                    
011030 G[菈|rs`qs.                                      
011040*                                                                 
011050     MOVE  "Y"                        TO v|ُI|tO.    
011060     INITIALIZE                           IF-CHOCO001.            
011070*                                                                 
011080     EVALUATE  v|G[R[h                                   
011090        WHEN  -10                                                 
011100*--<       nq`bkdڑs >                                 
011110           MOVE  "1"                  TO  P|Cxg      
011120           MOVE  萔|vOhc TO  P|\[Xhc        
011130           MOVE  "9"                  TO  P|AR[h        
011140           MOVE  "CONNECT"            TO  P|          
011150           MOVE  SQLCODE              TO  P|f[^e        
011160           MOVE  SQLERRMC             TO  P|̑bZ[W  
011170           CALL  CLOCO001          USING  IF-CHOCO001             
011180*                                                                 
011190        WHEN  -20                                                 
011200*--<       e[uJ[\I[vs >                     
011210           MOVE  "1"                  TO  P|Cxg      
011220           MOVE  萔|vOhc TO  P|\[Xhc        
011230           MOVE  "9"                  TO  P|AR[h        
011240           MOVE  "LTRSKY"             TO  P|e[uhc  
011250           MOVE  "OPEN"               TO  P|          
011260           MOVE  SQLCODE              TO  P|f[^e        
011270           MOVE  SQLERRMC             TO  P|̑bZ[W  
011280           CALL  CLOCO001          USING  IF-CHOCO001             
011290*                                                                 
011300        WHEN  -30                                                 
011310*--<       e[uǍs >                                 
011320           MOVE  "1"                  TO  P|Cxg      
011330           MOVE  萔|vOhc TO  P|\[Xhc        
011340           MOVE  "9"                  TO  P|AR[h        
011350           MOVE  "LTRSKM"             TO  P|e[uhc  
011360           MOVE  "FETCH"              TO  P|          
011370           MOVE  SQLCODE              TO  P|f[^e        
011380           MOVE  SQLERRMC             TO  P|̑bZ[W  
011390           CALL  CLOCO001          USING  IF-CHOCO001             
011400*                                                                 
011410        WHEN  -40                                                 
011420*--<       ϑcaǉs >                                   
011430           MOVE  "1"                  TO  P|Cxg      
011440           MOVE  萔|vOhc TO  P|\[Xhc        
011450           MOVE  "9"                  TO  P|AR[h        
011460           MOVE  "D40HNS"             TO  P|e[uhc  
011470           MOVE  "INSERT"             TO  P|          
011480           MOVE  SQLCODE              TO  P|f[^e        
011490           MOVE  SQLERRMC             TO  P|̑bZ[W  
011500           CALL  CLOCO001          USING  IF-CHOCO001             
011510*                                                                 
011520        WHEN  OTHER                                               
011530           MOVE  "N"                  TO v|ُI|tO     
011540     END-EVALUATE.                                                
011550*                                                                 
011560     IF v|ُI|tO  =  "Y"                              
011570        PERFORM  ca[obN                             
011580*                                                                 
011590        PERFORM  IbZ[Wo                               
011600*                                                                 
011610*--<    vOُĨ^[R[h >                      
011620        MOVE  萔|ُ          TO  PROGRAM-STATUS          
011630*                                                                 
011640        EXIT  PROGRAM                                             
011650     END-IF.                                                      
011660*                                                                 
011670 G[|dwhs.                                            
011680     EXIT.                                                        
011690******************************************************************
011700*                  END OF PROGRAM                                *
011710******************************************************************
