000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名  : 協調転物件代金売却テーブル　　　       *
000040*      　　　　　　　　　（D346KTB_TBL)                          *
000050*      2. プログラムID  : COBIS420                               *
000060*      3. 処理概要      : ・債務DB.債務基本、債務DB.債務明細は   *
000070*                          、債権契約ＮＯ・再リースコード        *
000080*                            をKEYとし、JOINで指                 *
000090*                           請求DB.請求明細情報の検索条件は      *
000100*                           移行項目対比表の移行元説明欄を参照   *
000110*      4. 作成者        : 王宏傑                                 *
000120*      5. 作成日        : 2005.03.25                             *
000130******************************************************************
000140*                                                                 
000150******************************************************************
000160*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000170******************************************************************
000180 IDENTIFICATION                       DIVISION.                   
000190*                                                                 
000200 PROGRAM-ID.                          AAASED25.                   
000210******************************************************************
000220*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000230******************************************************************
000240 ENVIRONMENT                          DIVISION.                   
000250******************************************************************
000260*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000270******************************************************************
000280 INPUT-OUTPUT                         SECTION.                    
000281 FILE-CONTROL.                                                    
000290     SELECT         入力ファイル      ASSIGN    TO      U01       
000300     FILE STATUS    　　　IS          Ｒ−状態                 　 
000310     ORGANIZATION   　　　IS     LINE       SEQUENTIAL.           
000320*                                                                 
000330     SELECT         出力ファイル      ASSIGN    TO     U11        
000340     FILE      STATUS     IS          Ｗ−状態                    
000350     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000360******************************************************************
000370*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000380******************************************************************
000390 DATA                                 DIVISION.                   
000400******************************************************************
000410*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000420******************************************************************
000430 FILE                                 SECTION.                    
000440*----------------------------------------------------------------*
000450*    入力ファイル 基準適用日ファイル                             *
000460*----------------------------------------------------------------*
000470 FD  入力ファイル                                                 
000480     LABEL  RECORD    IS              STANDARD                    
000490     BLOCK  CONTAINS  0               RECORDS.                    
000500*                                                                 
000510 01  入力−レコード.                                              
000520     COPY   CISPF001   REPLACING      ==()==  BY  ==入力−==.     
000530*----------------------------------------------------------------*
000540*    出力ファイル  協調転物件代金売却ファイル                     
000550*----------------------------------------------------------------*
000560 FD  出力ファイル                                                 
000570     LABEL     RECORD     IS          STANDARD                    
000580     BLOCK     CONTAINS   0           RECORDS.                    
000590*                                                                 
000600 01  出力−レコード.                                              
000610     COPY  CISUF421    REPLACING      ==()==  BY  ==出力−==.     
000620******************************************************************
000630*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000640******************************************************************
000650 WORKING-STORAGE                      SECTION.                    
000660*----------------------------------------------------------------*
000670*    ホスト変数定義エリア                                        *
000680*----------------------------------------------------------------*
000690     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.              
000691 01 ＷＳ−債務協調コード１            PIC  X(02) VALUE "1".       
000700 01 ＷＳ−債務協調コード２            PIC  X(02) VALUE "46".      
000710 01 ＷＳ−債務協調コード３            PIC  X(02) VALUE "56".      
000720 01 ＷＳ−債務契約ＮＯ                PIC  X(10).                 
000730 01 ＷＳ−連番                        PIC  X(03) VALUE "1".       
000740 01 ＷＳ−物件代金回収日−年          PIC  9(04).                 
000750 01 ＷＳ−物件代金回収日−月          PIC  9(02).                 
000760 01 ＷＳ−物件代金回収日−日          PIC  9(02).                 
000770 01 ＷＳ−物件代金回収日−年月        PIC  9(06).                 
000780 01 ＷＳ−物件代金回収日              PIC  9(08).                 
000790 01 ＷＳ−リース開始日−年            PIC  9(04).                 
000800 01 ＷＳ−リース開始日−月            PIC  9(02).                 
000810 01 ＷＳ−月数                        PIC  9(02).                 
000820 01 ＷＳ−基準日−年月                PIC  9(06).                 
000830*--< 回収方式コード >                                             
000840 01 ＷＳ−振込                        PIC  9(01) VALUE 0.         
000850 01 ＷＳ−回収方法振込                PIC  X(01) VALUE "1".       
000860 01 ＷＳ−手形                        PIC  9(01) VALUE 2.         
000870 01 ＷＳ−約束手形                    PIC  X(01) VALUE "5".       
000880 01 ＷＳ−自動引落                    PIC  9(01) VALUE 3.         
000890 01 ＷＳ−回収方法自動引落            PIC  X(01) VALUE "3".       
000900 01 ＷＳ−ＭＦＳ代理回収              PIC  9(01) VALUE 4.         
000910 01 ＷＳ−代理回収                    PIC  X(01) VALUE "4".       
000920*--< 契約種類(No.3)の上1桁  >                                     
000930 01 ＷＳ−契約種類                    PIC  X(01) VALUE "6".       
000940 01 ＷＳ−契約種類１桁                PIC  X(01).                 
000950*--<元回収予定日１  >                                             
000960 01 ＷＳ−元回収予定日１世紀          PIC  X(02).                 
000970 01 ＷＳ−出力請求内訳コード          PIC  X(03).                 
000980*--< ＯＲＡＣＬＥ共通変数 >                                       
000990     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
001000*                        M40MAB.CBL                               
001010*--< ＯＲＡＣＬＥ  ＳＱＬ実行情報 >                               
001020     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
001030*                                                                 
001040*--< 債務基本 テーブル >                                          
001050     EXEC  SQL  INCLUDE  LTRSMK.CBL            END-EXEC.          
001060*                                                                 
001070*--< 債務明細 テーブル >                                          
001080     EXEC  SQL  INCLUDE  LTRSMM.CBL            END-EXEC.          
001090*                                                                 
001100*--< 請求明細情報 テーブル>                                       
001110     EXEC  SQL  INCLUDE  LTRSKM.CBL            END-EXEC.          
001120*                                                                 
001130*--< 変換テーブル>                                                
001140     EXEC  SQL  INCLUDE  IKOTBL001.CBL         END-EXEC.          
001150*                                                                 
001160*--< 契約種類等変換テーブル>                                      
001170     EXEC  SQL  INCLUDE  IKOTBL002.CBL         END-EXEC.          
001180*                                                                 
001190*--< 請求内訳コード変換テーブル>                                  
001200     EXEC  SQL  INCLUDE  IKOTBL005.CBL         END-EXEC.          
001210*                                                                 
001220     EXEC  SQL  END  DECLARE          SECTION  END-EXEC.          
001230*                                                                 
001240*----------------------------------------------------------------*
001250*    ＷＯＲＫエリア                                              *
001260*----------------------------------------------------------------*
001270 01  ＷＯＲＫ−エリア.                                            
001280*--< エラー判定用 >                                               
001290     03  Ｗ−エラーコード             PIC S9(04).                 
001300*                                                                 
001310*--< フラグアリア >                                               
001320     03  フラグアリア.                                            
001330         05  Ｗ−終了−フラグ         PIC  X(01).                 
001340         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001350*--< ファイル状態 >                                               
001360     03  Ｗ−状態エリア.                                          
001370         05  Ｗ−状態                 PIC  X(02).                 
001380         05  Ｒ−状態                 PIC  X(02).                 
001390*                                                                 
001400*--< 件数エリア >                                                 
001410     03  件数エリア.                                              
001420         05  Ｗ−入力−件数           PIC  9(09).                 
001430         05  Ｗ−入力−件数２         PIC  9(09).                 
001440         05  Ｗ−入力−更新件数       PIC  9(09).                 
001450         05  Ｗ−出力−件数           PIC  9(09).                 
001460*--< キーエリア >                                                 
001470     03  ＫＥＹ−エリア.                                          
001480        05  ＮＥＷキー.                                           
001490            07 Ｎ−契約番号           PIC  X(10).                 
001500            07 Ｎ−再リース回数       PIC  9(02).                 
001510            07 Ｎ−契約種類           PIC  X(03).                 
001520        05  ＯＬＤキー.                                           
001530            07 Ｏ−契約番号           PIC  X(10).                 
001540            07 Ｏ−再リース回数       PIC  9(02).                 
001550            07 Ｏ−契約種類           PIC  X(03).                 
001560*----------------------------------------------------------------*
001570*   処理時間定義                                                 *
001580*----------------------------------------------------------------*
001590*--< 共通情報 >                                                   
001600 01  Ｗ−共通情報.                                                
001610     03  Ｗ−システム日付.                                        
001620         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001630         05  Ｗ−年月日               PIC  X(06).                 
001640     03  Ｗ−システム時刻             PIC  X(08).                 
001650     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001660*----------------------------------------------------------------*
001670*    サブルーチン名                                              *
001680*----------------------------------------------------------------*
001690 01  CALL-AREA.                                                   
001700*--< 共通ログサブルーチン >                                       
001710     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001720     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001730*                                                                 
001740*----------------------------------------------------------------*
001750*    ＣＯＰＹ領域                                                *
001760*----------------------------------------------------------------*
001770*--< 共通ログ用パラメータ >                                       
001780 01  IF-CHOCO001.                                                 
001790     COPY  CHOCO001  REPLACING ==()== BY  ==共１−==.             
001800*                                                                 
001810*----------------------------------------------------------------*
001820*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001830*----------------------------------------------------------------*
001840 01  PARA-AREA.                                                   
001850     COPY CPBCO001.                                               
001860******************************************************************
001870*    定数用データ定義エリア                                      *
001880******************************************************************
001890 CONSTANT                             SECTION.                    
001900 01  定数領域.                                                    
001910     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS420".
001920     03  定数−プログラム名           PIC  X(80)                  
001930                               VALUE "協調転物件代金売却移行処理".
001940     03  定数−ＳＱＬＯＫ             PIC S9(04)  VALUE  ZERO.    
001950     03  定数−ＳＱＬＥＮＤ           PIC S9(04)  VALUE  0100.    
001960     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001970     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001980******************************************************************
001990*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
002000******************************************************************
002010 PROCEDURE                            DIVISION.                   
002020*                                                                 
002030     PERFORM  初期処理.                                           
002040*                                                                 
002050     PERFORM  主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".            
002060*                                                                 
002070     PERFORM  終了処理.                                           
002080*                                                                 
002090     STOP     RUN.                                                
002100*                                                                 
002110******************************************************************
002120*    初期処理                                                    *
002130******************************************************************
002140 初期処理                             SECTION.                    
002150 初期処理−ＳＴＡＲＴ.                                            
002160*                                                                 
002170*----------------------------------------------------------------*
002180*    開始メッセージ出力処理                                      *
002190*----------------------------------------------------------------*
002200     INITIALIZE                       IF-CHOCO001.                
002210     MOVE  "3"                        TO  共１−イベント種別.     
002220     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
002230     MOVE  "0"                        TO  共１−復帰コード.       
002240     MOVE  "START"                    TO  共１−処理識別.         
002250     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
002260     CALL  CLOCO001                USING  IF-CHOCO001.            
002270*                                                                 
002280*----------------------------------------------------------------*
002290*    作業領域の初期値処理                                        *
002300*----------------------------------------------------------------*
002310     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
002320     INITIALIZE                           ＷＯＲＫ−エリア.       
002330*--< ＣＰＵ日付を取得 >                                           
002340     ACCEPT  Ｗ−年月日               FROM  DATE.                 
002350*                                                                 
002360*--< ＣＰＵ時刻を取得 >                                           
002370     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
002380*                                                                 
002390*--< ＯＲＡＣＬＥ接続 >                                           
002400     PERFORM   ＯＲＡＣＬＥ接続.                                  
002410*                                                                 
002420*--< 結合テーブルカーソル宣言 >                                   
002430     PERFORM  結合テーブルカーソル定義.                           
002440*                                                                 
002450*--< ファイルオープン >                                           
002460     PERFORM  ファイルオープン.                                   
002470*                                                                 
002480*--< 結合テーブルカーソル読込(１件目) >                           
002490     PERFORM  結合テーブルカーソル読込.                           
002500*                                                                 
002510*--< 基準適用日読込処理(１件目) >                                 
002520     PERFORM   基準適用日読込処理.                                
002530 初期処理−ＥＸＩＴ.                                              
002540     EXIT.                                                        
002550******************************************************************
002560*    ＯＲＡＣＬＥ接続                                            *
002570******************************************************************
002580 ＯＲＡＣＬＥ接続                     SECTION.                    
002590 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002600*                                                                 
002610*--< ＤＢ接続用情報を取得処理 >                                   
002620     CALL  COBCO001                USING  PARA-AREA.              
002630*                                                                 
002640     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002650     MOVE  PARA-USERNAME              TO  USERNAME.               
002660     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002670*                                                                 
002680*----------------------------------------------------------------*
002690*    開始接続                                                    *
002700*----------------------------------------------------------------*
002710     IF    DB-STRING  =  SPACE                                    
002720        EXEC SQL                                                  
002730           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002740        END-EXEC                                                  
002750     ELSE                                                         
002760        EXEC SQL                                                  
002770           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002780             USING  :DB-STRING                                    
002790        END-EXEC                                                  
002800     END-IF.                                                      
002810*                                                                 
002820*----------------------------------------------------------------*
002830*    接続確認                                                    *
002840*----------------------------------------------------------------*
002850     EVALUATE  SQLCODE                                            
002860        WHEN   定数−ＳＱＬＯＫ                                   
002870           CONTINUE                                               
002880        WHEN   OTHER                                              
002890*--<       接続エラー >                                           
002900           MOVE     -10               TO  Ｗ−エラーコード        
002910           PERFORM  エラー判定処理                                
002920     END-EVALUATE.                                                
002930*                                                                 
002940 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002950     EXIT.                                                        
002960******************************************************************
002970 結合テーブルカーソル定義             SECTION.                    
002980 結合テーブルカーソル定義−ＳＴＡＲＴ.                            
002990*                                                                 
003000*----------------------------------------------------------------*
003010*    カーソル定義処理                                            *
003020*----------------------------------------------------------------*
003030     EXEC SQL                                                     
003040        DECLARE CUR1  CURSOR FOR                                  
003050           SELECT  LTRSMK.債務契約ＮＯ                            
003060                  ,LTRSMK.再リースコード                          
003070                  ,LTRSMK.債務勘定処理コード                      
003080*                 ,NVL(LTRSMM.債務取引コード,RPAD(' ',8,' '))     
003090                  ,LTRSMM.債務取引コード                          
003100                  ,LTRSMM.物件代金回収日＿世紀                    
003110                  ,LTRSMM.物件代金回収日＿年月日                  
003120                  ,LTRSMM.リース開始日＿世紀                      
003130                  ,LTRSMM.リース開始日＿年月日                    
003140                  ,LTRSMM.回収物件金額                            
003150                  ,LTRSMM.売上消費税                              
003160                  ,LTRSMM.債務契約ＮＯ                            
003170                  ,LTRSMM.請求データ作成日＿年月日                
003180                  ,LTRSMM.回収方式コード                          
003190                  ,LTRSMM.再リースコード                          
003200                  ,LTRSMM.債務勘定処理コード                      
003210                  ,LTRSMM.債務協調コード                          
003220                  ,LTRSMM.売上消費税                              
003230           FROM  LTRSMK                                           
003240                ,LTRSMM                                           
003250           WHERE LTRSMM.債務契約ＮＯ   = LTRSMK.債務契約ＮＯ      
003270           AND   LTRSMM.再リースコード = LTRSMK.再リースコード    
003280           AND   ( SUBSTR (LTRSMM.債務協調コード,1,1) =           
003281                                           :ＷＳ−債務協調コード１
003282                   OR SUBSTR (LTRSMM.債務協調コード,1,1) =        
003283                                           :ＷＳ−債務協調コード２
003284                   OR SUBSTR (LTRSMM.債務協調コード,1,1) =        
003285                                           :ＷＳ−債務協調コード３
003286                  )                                               
003292           AND   LTRSMM.回収物件金額 <> 0                         
003340     END-EXEC.                                                    
003350*----------------------------------------------------------------*
003360*    カーソルＯＰＥＮ処理                                        *
003370*----------------------------------------------------------------*
003380     EXEC  SQL                                                    
003390        OPEN  CUR1                                                
003400     END-EXEC.                                                    
003410*                                                                 
003420*----------------------------------------------------------------*
003430*    カーソルＯＰＥＮ確認                                        *
003440*----------------------------------------------------------------*
003450     EVALUATE  SQLCODE                                            
003460        WHEN  定数−ＳＱＬＯＫ                                    
003470*--<       正常 >                                                 
003480           CONTINUE                                               
003490        WHEN  OTHER                                               
003500*--<       カーソルＯＰＥＮエラー >                               
003510           MOVE -20                   TO  Ｗ−エラーコード        
003520           PERFORM  エラー判定処理                                
003530     END-EVALUATE.                                                
003540*                                                                 
003550 結合テーブルカーソル定義−ＥＸＩＴ.                              
003560     EXIT.                                                        
003570*                                                                 
003580******************************************************************
003590*    ファイルオープン                                            *
003600******************************************************************
003610 ファイルオープン                     SECTION.                    
003620 ファイルオープン−ＳＴＡＲＴ.                                    
003630*----------------------------------------------------------------*
003640*    ファイルオープン ＯＰＥＮ                                   *
003650*----------------------------------------------------------------*
003660*--< 入力ファイルオープン >                                       
003670     OPEN  INPUT  入力ファイル.                                   
003680*                                                                 
003690*----------------------------------------------------------------*
003700*    ファイルオープン状態判定                                    *
003710*----------------------------------------------------------------*
003720     EVALUATE  Ｒ−状態                                           
003730        WHEN  ZERO                                                
003740           CONTINUE                                               
003750        WHEN  OTHER                                               
003760*--<       ファイルオープンエラー >                               
003770           MOVE     -30               TO  Ｗ−エラーコード        
003780           PERFORM  エラー処理                                    
003790     END-EVALUATE.                                                
003800*                                                                 
003810*--< 出力ファイルオープン >                                       
003820     OPEN  OUTPUT   出力ファイル.                                 
003830*----------------------------------------------------------------*
003840*    ファイルオープン状態判定                                    *
003850*----------------------------------------------------------------*
003860     EVALUATE  Ｗ−状態                                           
003870        WHEN  ZERO                                                
003880*--<       ファイルオープン正常 >                                 
003890           CONTINUE                                               
003900        WHEN  OTHER                                               
003910*--<       ファイルオープンエラー >                               
003920           MOVE     -40               TO  Ｗ−エラーコード        
003930           PERFORM  エラー判定処理                                
003940     END-EVALUATE.                                                
003950 *                                                                
003960 ファイルオープン−ＥＸＩＴ.                                      
003970     EXIT.                                                        
003980*                                                                 
003990******************************************************************
004000*    結合テーブルカーソル読込                                    *
004010******************************************************************
004020 結合テーブルカーソル読込             SECTION.                    
004030 結合テーブルカーソル読込−ＳＴＡＲＴ.                            
004040*                                                                 
004050*--< 結合テーブルカーソル読込 >                                   
004060     EXEC SQL                                                     
004070         FETCH  CUR1                                              
004080          INTO  :ＬＴＲＳＭＫ−債務契約ＮＯ                       
004090		     ,:ＬＴＲＳＭＫ−再リースコード                     
004100               ,:ＬＴＲＳＭＫ−債務勘定処理コード                 
004110               ,:ＬＴＲＳＭＭ−債務取引コード                     
004120               ,:ＬＴＲＳＭＭ−物件代金回収日−世紀               
004130		     ,:ＬＴＲＳＭＭ−物件代金回収日−年月日             
004140		     ,:ＬＴＲＳＭＭ−リース開始日−世紀                 
004150		     ,:ＬＴＲＳＭＭ−リース開始日−年月日               
004160		     ,:ＬＴＲＳＭＭ−回収物件金額                       
004170		     ,:ＬＴＲＳＭＭ−売上消費税                         
004180		     ,:ＬＴＲＳＭＭ−債務契約ＮＯ                       
004190		     ,:ＬＴＲＳＭＭ−請求データ作成日−年月日           
004200		     ,:ＬＴＲＳＭＭ−回収方式コード                     
004210		     ,:ＬＴＲＳＭＭ−再リースコード                     
004220		     ,:ＬＴＲＳＭＭ−債務勘定処理コード                 
004230		     ,:ＬＴＲＳＭＭ−債務協調コード                     
004240		     ,:ＬＴＲＳＭＭ−売上消費税                         
004250*                                                                 
004260     END-EXEC.                                                    
004270*                                                                 
004280*------------------------------------------------------------- --*
004290*    結合テーブルカーソル読込を確認                              *
004300*----------------------------------------------------------------*
004310     EVALUATE   SQLCODE                                           
004320        WHEN   定数−ＳＱＬＯＫ                                   
004330*--<       正常 >                                                 
004340         COMPUTE  Ｗ−入力−件数   =  Ｗ−入力−件数   +  1       
004350         COMPUTE  Ｗ−入力−件数２ =  Ｗ−入力−件数２ +  1       
004360        WHEN   定数−ＳＱＬＥＮＤ                                 
004370*--<       読込終了 >                                             
004380           MOVE  "Y"                  TO  Ｗ−終了−フラグ        
004390        WHEN   OTHER                                              
004400*--<       読込エラー >                                           
004410           MOVE     -50               TO  Ｗ−エラーコード        
004420           PERFORM  エラー判定処理                                
004430     END-EVALUATE.                                                
004440*                                                                 
004450 結合テーブルカーソル読込−ＥＸＩＴ.                              
004460     EXIT.                                                        
004470******************************************************************
004480*    基準適用日読込処理(１件目)                                  *
004490******************************************************************
004500 基準適用日読込処理                   SECTION.                    
004510 基準適用日読込処理−ＳＴＡＲＴ.                                  
004520*--<    基準適用日読込 >                                          
004530        READ  入力ファイル                                        
004540           AT  END                                                
004550*--<          読込終了 >                                          
004560              GO  TO  基準適用日読込処理−ＥＸＩＴ                
004570        END-READ.                                                 
004580*                                                                 
004590*----------------------------------------------------------------*
004600*    ファイルオープン状態判定                                    *
004610*----------------------------------------------------------------*
004620     EVALUATE  ファイル状態                                       
004630        WHEN  ZERO                                                
004640           MOVE  入力−基準日(1:6)    TO  ＷＳ−基準日−年月      
004650        WHEN  OTHER                                               
004660*--<       読み込みエラー >                                       
004670           MOVE     -60               TO  Ｗ−エラーコード        
004680           PERFORM  エラー判定処理                                
004690     END-EVALUATE.                                                
004700*                                                                 
004710 基準適用日読込処理−ＥＸＩＴ.                                    
004720     EXIT.                                                        
004730******************************************************************
004740*    主処理                                                      *
004750******************************************************************
004760 主処理                               SECTION.                    
004770 主処理−ＳＴＡＲＴ.                                              
004780*--< 協調転物件代金売却ファイル >                                 
004790     PERFORM  協調転物件代金売却項目編集.                         
004800*                                                                 
004810*                                                                 
004820*--< 協調転物件代金売却ファイル出力処理 >                         
004830	   PERFORM  協調転物件代金売却出力処理.                         
004840*                                                                 
004850*--< 結合テーブルカーソル読込（２件目以降） >                     
004860     PERFORM  結合テーブルカーソル読込.                           
004870*                                                                 
004880*                                                                 
004890 主処理−ＥＸＩＴ.                                                
004900     EXIT.                                                        
004910******************************************************************
004920*     協調転物件代金売却項目編集処理                             *
004930******************************************************************
004940 協調転物件代金売却項目編集.          SECTION.                    
004950 協調転物件代金売項目編集−ＳＴＡＲＴ.                            
004960*                                                                 
004970*----------------------------------------------------------------*
004980*    協調転物件代金売却項目編集移行処理                          *
004990*----------------------------------------------------------------*
005000*--< No.01 契約番号 >                                             
005010     MOVE ＬＴＲＳＭＫ−債務契約ＮＯ(2:9)  TO   出力−契約番号    
005020                                                ＷＳ−債務契約ＮＯ
005030                                                Ｎ−契約番号.     
005040*--< No.02 再リース回数 >                                         
005050     PERFORM  再リース回数移行処理.                               
005060     MOVE ＩＫＯ００２−再リース回数  TO   出力−再リース回数     
005070                                           Ｎ−再リース回数.      
005080*--< No.03 契約種類 >                                             
005090     PERFORM  契約種類移行処理.                                   
005100     MOVE ＩＫＯ００２−契約種類      TO   出力−契約種類         
005110                                           Ｎ−契約種類.          
005120*--< No.04 連番 >                                                 
005130     IF ＮＥＷキー NOT   =  ＯＬＤキー                            
005140     MOVE    1                        TO   ＷＳ−連番             
005150     MOVE   ＮＥＷキー                TO   ＯＬＤキー             
005160     ELSE                                                         
005170     COMPUTE ＷＳ−連番  =  ＷＳ−連番 + 1                        
005180     END-IF.                                                      
005190*--< No.05 取引先コード >                                         
005200     PERFORM  取引先コード移行処理.                               
005210     MOVE ＩＫＯ００１−新取引先コード TO  出力−取引先コード.    
005220*--< No.06 請求先コード >                                         
005230     PERFORM  請求先コード移行処理.                               
005240     MOVE ＩＫＯ００１−枝番          TO  出力−請求先コード.     
005250*--< No.07 回収サイト >                                           
005260     PERFORM  回収サイト移行処理.                                 
005270     MOVE  ＷＳ−月数                 TO  出力−回収サイト.       
005280*--< No.08 回収日 >                                               
005290     PERFORM  回収日移行処理.                                     
005300     MOVE  ＷＳ−物件代金回収日−日   TO  出力−回収日            
005310*--< No.09 回収予定日 >                                           
005320     PERFORM  回収予定日移行処理.                                 
005330     MOVE  ＷＳ−物件代金回収日       TO  出力−回収予定日        
005340*--< No.10 売却代金 >                                             
005350     MOVE  ＬＴＲＳＭＭ−回収物件金額 TO  出力−売却代金          
005360*--< No.11 売却代金消費税 >                                       
005370     MOVE  ＬＴＲＳＭＭ−売上消費税   TO  出力−売却代金消費税    
005380*--< No.12 売却代手数料 >                                         
005390     MOVE  ZERO                       TO  出力−売却代手数料      
005400*--< No.13 売却代総額 >                                           
005410     MOVE  出力−売却代金             TO  出力−売却代総額        
005420*--< No.14 売却代総額消費税 >                                     
005430     MOVE  出力−売却代金消費税       TO  出力−売却代総額消費税  
005440*--< No.32 請求内訳コード >                                       
005450     PERFORM  請求内訳コード移行処理.                             
005460*--< No.15回収額,No.16回収額消費税,No.17回収年月日,               
005470*    No.33 消込通番, No.35 消込年月日   >                         
005480     PERFORM  請求明細共通移行処理.                               
005490*--< No.18 未回収額 >                                             
005500     COMPUTE  出力−未回収額 =  出力−売却代総額       +          
005510                                出力−売却代総額消費税 -          
005520                                出力−回収額           -          
005530                                出力−回収額消費税.               
005540*--< No.19 請求書発行済フラグ >                                   
005550     IF  ＬＴＲＳＭＭ−請求データ作成日−年月日 <  入力−基準日   
005560        MOVE   "1"                    TO  出力−請求書発行済フラグ
005570     ELSE                                                         
005580        MOVE   "0"                    TO  出力−請求書発行済フラグ
005590     END-IF.                                                      
005600*--< No.20 取消請求書発行済フラグ >                               
005610     MOVE   ZERO                 TO  出力−取消請求書発行済フラグ.
005620*--< No.21 請求書番号 >                                           
005630     MOVE   ZERO                      TO  出力−請求書番号.       
005640*--< No.22 更新年月日 >                                           
005650     MOVE   Ｗ−年月日                TO  出力−更新年月日.       
005660*--< No.23 更新時間 >                                             
005670     MOVE   Ｗ−システム時刻          TO  出力−更新時間.         
005680*--< No.24 更新者 >                                               
005690     MOVE   Ｗ−担当者                TO  出力−更新者.           
005700*--< No.25 入力担当者コード >                                     
005710     MOVE   Ｗ−担当者                TO  出力−入力担当者コード. 
005720*--< No.26 回収方法>                                              
005730     PERFORM  回収方法移行処理.                                   
005740*--< No.27 ソフト売却代金>                                        
005750     MOVE   出力−契約種類(1:1)       TO  ＷＳ−契約種類１桁      
005760     IF     ＷＳ−契約種類１桁  =   ＷＳ−契約種類                
005770       MOVE   出力−売却代金          TO  出力−ソフト売却代金    
005780     ELSE                                                         
005790       MOVE   ZERO                    TO  出力−ソフト売却代金    
005800     END-IF.                                                      
005810*--< No.28 ソフト売却代金消費税>                                  
005820     MOVE   出力−契約種類(1:1)       TO  ＷＳ−契約種類１桁      
005830     IF     ＷＳ−契約種類１桁  =   ＷＳ−契約種類                
005840       MOVE   出力−売却代金消費税  TO  出力−ソフト売却代金消費税
005850     ELSE                                                         
005860       MOVE   ZERO                  TO  出力−ソフト売却代金消費税
005870     END-IF.                                                      
005880*--< No.29 登録年月日 >                                           
005890     MOVE   Ｗ−年月日                TO  出力−登録年月日.       
005900*--< No.30 登録時間 >                                             
005910     MOVE   Ｗ−システム時刻          TO  出力−登録時間.         
005920*--< No.31 登録担当者 >                                           
005930     MOVE   Ｗ−担当者                TO  出力−登録担当者.       
005940*--< No.34 初回入金日 >                                           
005950     MOVE   出力−回収年月日          TO  出力−初回入金日.       
005960*--< No.36 消費税率 >                                             
005970     IF    ＬＴＲＳＭＭ−売上消費税 NOT =  ZERO                   
005980     MOVE  0.05                       TO  出力−消費税率          
005990     ELSE                                                         
006000     MOVE  ZERO                       TO  出力−消費税率          
006010     END-IF.                                                      
006020*--< No.37 消費税率区分 >                                         
006030     IF    出力−消費税率  =  ZERO                                
006040     MOVE  "00"                       TO  出力−消費税率区分      
006050     ELSE                                                         
006060     MOVE  "12"                       TO  出力−消費税率区分      
006070     END-IF.                                                      
006080*--< No.38 元再リースコード１ >                                   
006090     MOVE  ＬＴＲＳＭＭ−再リースコード TO                        
006100                                     出力−元再リースコード１.    
006110*--< No.39 元請求内訳コード１ >                                   
006120     PERFORM  元請求内訳コード１移行処理.                         
006130                                                                  
006140*--< No.40 元回収予定日１ >                                       
006150     MOVE  出力−回収予定日(1:2)    TO  ＷＳ−元回収予定日１世紀. 
006160     IF  ＷＳ−元回収予定日１世紀  =  "20"                        
006170     MOVE  "1"                      TO  出力−元回収予定日１(1:1) 
006180     ELSE                                                         
006190     MOVE  "2"                      TO  出力−元回収予定日１(1:1) 
006200     END-IF.                                                      
006210     MOVE  出力−回収予定日(3:6)    TO  出力−元回収予定日１(2:6).
006220 協調転物件代金売項目編集−ＥＸＩＴ.                              
006230     EXIT.                                                        
006240******************************************************************
006250*     項目の移行 編集処理                                        *
006260******************************************************************
006270*----------------------------------------------------------------*
006280*   NO2 再リース回数移行処理                                     *
006290*----------------------------------------------------------------*
006300 再リース回数移行処理                 SECTION.                    
006310 再リース回数移行処理−ＳＴＡＲＴ.                                
006320*                                                                 
006330      EXEC SQL                                                    
006340           SELECT  再リース回数                                   
006350             INTO  :ＩＫＯ００２−再リース回数                    
006360             FROM  IKOTBL002                                      
006370            WHERE  契約ＮＯ        = :ＷＳ−債務契約ＮＯ          
006380              AND  再リースコード  = :ＬＴＲＳＭＫ−再リースコード
006390	            AND  債務勘定処理コード =                           
006400                                 :ＬＴＲＳＭＫ−債務勘定処理コード
006410	    END-EXEC.                                                   
006420*----------------------------------------------------------------*
006430*     再リース回数移行処理確認                                   *
006440*----------------------------------------------------------------*
006450      EVALUATE  SQLCODE                                           
006460        WHEN  定数−ＳＱＬＯＫ                                    
006470*--<       正常 >                                                 
006480           CONTINUE                                               
006490        WHEN  OTHER                                               
006500*--<       取得エラー >                                           
006510           MOVE  "0"                  TO                          
006520                                       ＩＫＯ００２−再リース回数 
006530           MOVE -70                   TO  Ｗ−エラーコード        
006540           PERFORM  エラー判定処理                                
006550                                                                  
006560      END-EVALUATE.                                               
006570 再リース回数移行処理−ＥＸＩＴ.                                  
006580     EXIT.                                                        
006590*                                                                 
006600*----------------------------------------------------------------*
006610*   NO3 契約種類移行処理                                         *
006620*----------------------------------------------------------------*
006630 契約種類移行処理                 SECTION.                        
006640 契約種類移行処理−ＳＴＡＲＴ.                                    
006650*                                                                 
006660      EXEC SQL                                                    
006670           SELECT  契約種類                                       
006680                  ,主契約区分                                     
006690             INTO  :ＩＫＯ００２−契約種類                        
006700                  ,:ＩＫＯ００２−主契約区分                      
006710             FROM  IKOTBL002                                      
006720            WHERE  契約ＮＯ        = :ＷＳ−債務契約ＮＯ          
006730              AND  再リースコード  = :ＬＴＲＳＭＫ−再リースコード
006740              AND  債務勘定処理コード =                           
006750                                 :ＬＴＲＳＭＫ−債務勘定処理コード
006760      END-EXEC.                                                   
006770*----------------------------------------------------------------*
006780*     契約種類移行処理確認                                       *
006790*----------------------------------------------------------------*
006800      EVALUATE  SQLCODE                                           
006810        WHEN  定数−ＳＱＬＯＫ                                    
006820*--<       正常 >                                                 
006830           CONTINUE                                               
006840        WHEN  OTHER                                               
006850*--<       取得エラー >                                           
006860           MOVE  SPACE                TO    ＩＫＯ００２−契約種類
006870           INITIALIZE                       ＩＫＯ００２−契約種類
006880           MOVE -80                   TO  Ｗ−エラーコード        
006890           PERFORM  エラー判定処理                                
006900     END-EVALUATE.                                                
006910 契約種類移行処理−ＥＸＩＴ.                                      
006920     EXIT.                                                        
006930*                                                                 
006940*----------------------------------------------------------------*
006950*  NO5  取引先コード移行処理.                                    *
006960*----------------------------------------------------------------*
006970 取引先コード移行処理                 SECTION.                    
006980 取引先コード移行処理−ＳＴＡＲＴ.                                
006990*                                                                 
007000      EXEC SQL                                                    
007010           SELECT  新取引先コード                                 
007020             INTO  :ＩＫＯ００１−新取引先コード                  
007030             FROM  IKOTBL001                                      
007040            WHERE  取引先コード    = :ＬＴＲＳＭＭ−債務取引コード
007050      END-EXEC.                                                   
007060*----------------------------------------------------------------*
007070*     取引先コード移行処理確認                                   *
007080*----------------------------------------------------------------*
007090      EVALUATE  SQLCODE                                           
007100        WHEN  定数−ＳＱＬＯＫ                                    
007110*--<       正常 >                                                 
007120           CONTINUE                                               
007130        WHEN  OTHER                                               
007140*--<       取得エラー >                                           
007150           MOVE  SPACE             TO ＩＫＯ００１−新取引先コード
007160           INITIALIZE                 ＩＫＯ００１−新取引先コード
007170           MOVE -90                   TO  Ｗ−エラーコード        
007180           PERFORM  エラー判定処理                                
007190      END-EVALUATE.                                               
007200 取引先コード移行処理−ＥＸＩＴ.                                  
007210     EXIT.                                                        
007220*                                                                 
007230*----------------------------------------------------------------*
007240*  NO6  請求先コード移行処理.                                     
007250*----------------------------------------------------------------*
007260 請求先コード移行処理                 SECTION.                    
007270 請求先コード移行処理−ＳＴＡＲＴ.                                
007280*                                                                 
007290      EXEC SQL                                                    
007300           SELECT  枝番                                           
007310             INTO  :ＩＫＯ００１−枝番                            
007320             FROM  IKOTBL001                                      
007330            WHERE  取引先コード    = :ＬＴＲＳＭＭ−債務取引コード
007340      END-EXEC.                                                   
007350*----------------------------------------------------------------*
007360*     請求先コード移行処理確認                                   *
007370*----------------------------------------------------------------*
007380      EVALUATE  SQLCODE                                           
007390        WHEN  定数−ＳＱＬＯＫ                                    
007400*--<       正常 >                                                 
007410           CONTINUE                                               
007420        WHEN  OTHER                                               
007430*--<       取得エラー >                                           
007440           MOVE  SPACE                TO        ＩＫＯ００１−枝番
007450           INITIALIZE                           ＩＫＯ００１−枝番
007460           MOVE -100                   TO  Ｗ−エラーコード       
007470           PERFORM  エラー判定処理                                
007480      END-EVALUATE.                                               
007490 請求先コード移行処理−ＥＸＩＴ.                                  
007500     EXIT.                                                        
007510*                                                                 
007520*----------------------------------------------------------------*
007530*  NO7  回収サイト移行処理.                                       
007540*----------------------------------------------------------------*
007550 回収サイト移行処理                   SECTION.                    
007560 回収サイト移行処理−ＳＴＡＲＴ.                                  
007570*--< 物件代金回収日−世紀処理 >                                   
007580     IF ＬＴＲＳＭＭ−物件代金回収日−世紀 = 1                    
007590        MOVE  "20"               TO  ＷＳ−物件代金回収日−年(1:2)
007600     ELSE                                                         
007610        MOVE  "19"               TO  ＷＳ−物件代金回収日−年(1:2)
007620     END-IF.                                                      
007630*--< 物件代金回収日−世紀処理 >                                   
007640     MOVE ＬＴＲＳＭＭ−物件代金回収日−年月日(1:2)  TO           
007650                                    ＷＳ−物件代金回収日−年(3:2).
007660     MOVE ＬＴＲＳＭＭ−物件代金回収日−年月日(3:2)  TO           
007670                                    ＷＳ−物件代金回収日−月.     
007680*--< リース開始日＿世紀処理 >                                     
007690     IF ＬＴＲＳＭＭ−リース開始日−世紀 = 1                      
007700        MOVE  "20"               TO  ＷＳ−リース開始日−年(1:2)  
007710     ELSE                                                         
007720        MOVE  "19"               TO  ＷＳ−リース開始日−年(1:2)  
007730     END-IF.                                                      
007740*                                                                 
007750     MOVE ＬＴＲＳＭＭ−リース開始日−年月日(1:2)    TO           
007760                                    ＷＳ−リース開始日−年(3:2).  
007770     MOVE ＬＴＲＳＭＭ−リース開始日−年月日(3:2)    TO           
007780                                    ＷＳ−リース開始日−月.       
007790*--< 計算月数 >                                                 　
007800     COMPUTE ＷＳ−月数  = (ＷＳ−物件代金回収日−年     -        
007810                                     ＷＳ−リース開始日−年) * 12 
007820                            +  ＷＳ−物件代金回収日−月  -        
007830                               ＷＳ−リース開始日−月.            
007840*----------------------------------------------------------------*
007850*     回収サイト処理確認                                         *
007860*----------------------------------------------------------------*
007870*     IF  ＷＳ−月数  <  0                                         
007880*     ..............
007890*--< 
007900*--<     
007910 回収サイト移行処理−ＥＸＩＴ.                                    
007920     EXIT.                                                        
007930*                                                                 
007940*                                                                 
007950*----------------------------------------------------------------*
007960*  NO8  回収日移行処理.                                          *
007970*----------------------------------------------------------------*
007980 回収日移行処理                       SECTION.                    
007990 回収日移行処理−ＳＴＡＲＴ.                                      
008000*--< 回収日移行処理 >                                             
008010      MOVE ＬＴＲＳＭＭ−物件代金回収日＿年月日(5:2)  TO          
008020                                     ＷＳ−物件代金回収日−日.    
008030 回収日移行処理−ＥＸＩＴ.                                        
008040     EXIT.                                                        
008050*                                                                 
008060*----------------------------------------------------------------*
008070*  NO9  回収予定日移行処理.                                      *
008080*----------------------------------------------------------------*
008090 回収予定日移行処理                       SECTION.                
008100 回収予定日移行処理−ＳＴＡＲＴ.                                  
008110*--< 回収予定日移行処理 >                                         
008120      MOVE ＷＳ−物件代金回収日−年 TO  ＷＳ−物件代金回収日(1:4).
008130      MOVE ＷＳ−物件代金回収日−月 TO  ＷＳ−物件代金回収日(5:2).
008140      MOVE ＷＳ−物件代金回収日−日 TO  ＷＳ−物件代金回収日(7:2).
008150 回収予定日移行処理−ＥＸＩＴ.                                    
008160     EXIT.                                                        
008170*                                                                 
008180*----------------------------------------------------------------*
008190*   N15回収額,N16回収額消費税,N17回収年月日 N033 N034 移行処理   *
008200*----------------------------------------------------------------*
008210 請求明細共通移行処理                 SECTION.                    
008220 請求明細共通移行処理−ＳＴＡＲＴ.                                
008230*                                                                 
008240      MOVE ＬＴＲＳＭＭ−債務契約ＮＯ(2:9) TO  ＷＳ−債務契約ＮＯ 
008250      EXEC SQL                                                    
008260           SELECT  消込金額                                       
008270                  ,消込日＿世紀                                   
008280                  ,消込日＿年月日                                 
008290                  ,消込通番                                       
008300             INTO  :ＬＴＲＳＫＭ−消込金額                        
008310                  ,:ＬＴＲＳＫＭ−消込日−世紀                    
008320                  ,:ＬＴＲＳＫＭ−消込日−年月日                  
008330                  ,:ＬＴＲＳＫＭ−消込通番                        
008340            FROM  LTRSKM                                          
008350            WHERE  契約番号 = :ＷＳ−債務契約ＮＯ                 
008360              AND  再リースコード  = :ＬＴＲＳＭＭ−再リースコード
008370              AND  請求内訳コード   =  :ＷＳ−出力請求内訳コード  
008380*              AND  突合済フラグ       = SPACE                    
008390      END-EXEC.                                                   
008400*----------------------------------------------------------------*
008410*     請求明細共通移行処理確認                                   *
008420*----------------------------------------------------------------*
008430      EVALUATE  SQLCODE                                           
008440*--< 請求明細情報に該当データが存在する場合>                      
008450        WHEN  定数−ＳＱＬＯＫ                                    
008460*--< N033 消込通番移行処理 >                                      
008470          MOVE  ＬＴＲＳＫＭ−消込通番      TO   出力−消込通番   
008480*--< N034 初回入金日移行処理 >                                    
008490          IF ＬＴＲＳＫＭ−消込日−世紀 = 1                       
008500           MOVE  "20"                 TO  出力−初回入金日(1:2)   
008510          ELSE                                                    
008520           MOVE  "19"                 TO  出力−初回入金日(1:2)   
008530          END-IF                                                  
008540          MOVE  ＬＴＲＳＫＭ−消込日−年月日 TO                   
008550                                        出力−初回入金日(3:6)     
008560*                                                                 
008570          IF ＬＴＲＳＫＭ−消込金額   >  ZERO                     
008580*--< N015回収額移行処理 >                                         
008590            MOVE  出力−売却代金      TO   出力−回収額           
008600*--< N016回収額消費税移行処理 >                                   
008610            MOVE  出力−売却代金消費税 TO  出力−回収額消費税     
008620*--< N017回収年月日移行処理 >                                     
008630*                                                                 
008640*--< 消込日−世紀処理 >                                           
008650            IF ＬＴＲＳＫＭ−消込日−世紀 = 1                     
008660            MOVE  "20"                TO  出力−回収年月日(1:2)   
008670            ELSE                                                  
008680            MOVE  "19"                TO  出力−回収年月日(1:2)   
008690            END-IF                                                
008700            MOVE  ＬＴＲＳＫＭ−消込日−年月日 TO                 
008710                                            出力−回収年月日(3:6) 
008720          ELSE                                                    
008730            MOVE  ZERO                TO   出力−回収額           
008740            MOVE  ZERO                TO   出力−回収額消費税     
008750            MOVE  ZERO                TO   出力−回収年月日       
008760          END-IF                                                  
008770*                                                                 
008780*--<請求明細情報に該当データが存在しない場合  >                   
008790        WHEN  OTHER                                               
008800*--< N033 消込通番移行処理 >                                      
008810          MOVE  ZERO                  TO   出力−消込通番         
008820*--< N034 初回入金日移行処理 >                                    
008830          MOVE  ZERO                  TO   出力−初回入金日       
008840*--< N015回収額移行処理 >                                         
008850          MOVE ＷＳ−物件代金回収日−年 TO                        
008860                                  ＷＳ−物件代金回収日−年月(1:4) 
008870          MOVE ＷＳ−物件代金回収日−月 TO                        
008880                                  ＷＳ−物件代金回収日−年月(5:2) 
008890*                                                                 
008900          IF ＷＳ−基準日−年月 > ＷＳ−物件代金回収日−年月      
008910            MOVE  出力−売却代金      TO   出力−回収額           
008920*--< N016回収額消費税移行処理 >                                   
008930            MOVE  出力−売却代金消費税 TO   出力−回収額消費税    
008940*--< N017回収年月日移行処理 >                                     
008950            MOVE  出力−回収予定日    TO   出力−回収年月日       
008960          ELSE                                                    
008970            MOVE  ZERO                TO   出力−回収額           
008980            MOVE  ZERO                TO   出力−回収額消費税     
008990            MOVE  ZERO                TO   出力−回収年月日       
009000          END-IF                                                  
009010*--<       読み込みエラー >                                       
009020          MOVE -110                   TO  Ｗ−エラーコード        
009030          PERFORM  エラー判定処理                                 
009040      END-EVALUATE.                                               
009050 請求明細共通移行処理−ＥＸＩＴ.                                  
009060     EXIT.                                                        
009070*                                                                 
009080*----------------------------------------------------------------*
009090*  N26  回収方法移行処.                                          *
009100*----------------------------------------------------------------*
009110 回収方法移行処理                     SECTION.                    
009120 回収方法移行処理−ＳＴＡＲＴ.                                    
009130*                                                                 
009140      EVALUATE  ＬＴＲＳＭＭ−回収方式コード                      
009150        WHEN  ＷＳ−振込                                          
009160           MOVE  ＷＳ−回収方法振込   TO   出力−回収方法         
009170        WHEN  ＷＳ−手形                                          
009180           MOVE  ＷＳ−約束手形       TO   出力−回収方法         
009190        WHEN  ＷＳ−自動引落                                      
009200           MOVE  ＷＳ−回収方法自動引落  TO   出力−回収方法      
009210        WHEN  ＷＳ−ＭＦＳ代理回収                                
009220           MOVE  ＷＳ−代理回収       TO   出力−回収方法         
009230      END-EVALUATE.                                               
009240 取引先コード移行処理−ＥＸＩＴ.                                  
009250     EXIT.                                                        
009260*                                                                 
009270*----------------------------------------------------------------*
009280*   N32 請求内訳コード移行処理                                   *
009290*----------------------------------------------------------------*
009300 請求内訳コード移行処理               SECTION.                    
009310 請求内訳コード移行処理−ＳＴＡＲＴ.                              
009320*                                                                 
009330     IF  ＬＴＲＳＭＭ−債務勘定処理コード   = 89                  
009340       MOVE    "U00"                  TO  出力−請求内訳コード    
009350     ELSE IF (ＬＴＲＳＭＭ−債務勘定処理コード  = 52   OR         
009360              ＬＴＲＳＭＭ−債務勘定処理コード  = 62)  AND        
009370              ＬＴＲＳＭＭ−債務協調コード      = "56" AND        
009380              ＩＫＯ００２−主契約区分    =  "5"       AND        
009390              ＷＳ−契約種類１桁     NOT  =  "6"                  
009400       MOVE    "W01"                  TO  出力−請求内訳コード    
009410     ELSE IF (ＬＴＲＳＭＭ−債務勘定処理コード  = 52   OR         
009420              ＬＴＲＳＭＭ−債務勘定処理コード  = 62)  AND        
009430              ＬＴＲＳＭＭ−債務協調コード      = "56" AND        
009440              ＩＫＯ００２−主契約区分    =  "5"       AND        
009450              ＷＳ−契約種類１桁          =  "6"                  
009460       MOVE    "W02"                  TO  出力−請求内訳コード    
009470     ELSE IF (ＬＴＲＳＭＭ−債務勘定処理コード  = 52   OR         
009480              ＬＴＲＳＭＭ−債務勘定処理コード  = 62)  AND        
009490              ＬＴＲＳＭＭ−債務協調コード      = "56" AND        
009500              ＩＫＯ００２−主契約区分    =  "0"                  
009510       MOVE    "W51"                  TO  出力−請求内訳コード    
009520     ELSE IF (ＬＴＲＳＭＭ−債務勘定処理コード  = 51   OR         
009530              ＬＴＲＳＭＭ−債務勘定処理コード  = 61)  AND        
009540              ＬＴＲＳＭＭ−債務協調コード      = "56" AND        
009550              ＩＫＯ００２−主契約区分    =  "0"                  
009560       MOVE    "W52"                  TO  出力−請求内訳コード    
009570     ELSE IF (ＬＴＲＳＭＭ−債務勘定処理コード  = 39   AND        
009580              ＬＴＲＳＭＭ−債務協調コード      = "46" AND        
009590              ＩＫＯ００２−主契約区分    =  "5"       AND        
009600              ＷＳ−契約種類１桁         NOT =  "6"               
009610       MOVE    "V01"                  TO  出力−請求内訳コード    
009620     ELSE IF (ＬＴＲＳＭＭ−債務勘定処理コード  = 39   AND        
009630              ＬＴＲＳＭＭ−債務協調コード      = "46" AND        
009640              ＩＫＯ００２−主契約区分    =  "5"       AND        
009650              ＷＳ−契約種類１桁          =  "6"                  
009660       MOVE    "V02"                  TO  出力−請求内訳コード    
009670*     ELSE                                                        
009680*...................                                              
009690     END-IF.                                                      
009700     MOVE     出力−請求内訳コード  TO  ＷＳ− 出力請求内訳コード.
009701 請求内訳コード移行処理−ＥＸＩＴ.                                
009702     EXIT.                                                        
009710*                                                                 
009720*----------------------------------------------------------------*
009730*   N39 元請求内訳コード１移行処理                               *
009740*----------------------------------------------------------------*
009750 元請求内訳コード１移行処理           SECTION.                    
009760 元請求内訳コード１移行処理−ＳＴＡＲＴ.                          
009770*                                                                 
009780      EXEC SQL                                                    
009790           SELECT  現請求内訳コード                               
009800             INTO  :ＩＫＯ００５−現請求内訳コード                
009810             FROM  IKOTBL005                                      
009820            WHERE  新請求内訳コード  = :ＷＳ−出力請求内訳コード  
009830      END-EXEC.                                                   
009840*----------------------------------------------------------------*
009850*     元請求内訳コード１移行処理 確認                            *
009860*----------------------------------------------------------------*
009870      EVALUATE  SQLCODE                                           
009880        WHEN  定数−ＳＱＬＯＫ                                    
009890*--<       正常 >                                                 
009900           MOVE  ＩＫＯ００５−現請求内訳コード TO                
009910                                             出力−元回収予定日１ 
009920        WHEN  OTHER                                               
009930*--<       取得エラー >                                           
009940           MOVE  ZERO                 TO   出力−元回収予定日１   
009950*                                                                 
009960      END-EVALUATE.                                               
009970 元請求内訳コード１移行処理−ＥＸＩＴ.                            
009980      EXIT.                                                       
009990*                                                                 
010000******************************************************************
010010*   協調転物件代金売ファイル出力処理                             *
010020******************************************************************
010030 協調転物件代金売却出力処理           SECTION.                    
010040 協調転物件代金売却出力処理−ＳＴＡＲＴ.                          
010050*--< 協調転物件代金売ファイル出力 >                               
010060         WRITE  出力−レコード                                    
010070*                                                                 
010080*--< 協調転物件代金売出力の状態判定 >                             
010090     EVALUATE  Ｗ−状態                                           
010100        WHEN  ZERO                                                
010110*--<      共通出力件数の加算 >                                    
010120           COMPUTE  Ｗ−出力−件数 =  Ｗ−出力−件数 + 1          
010130        WHEN  OTHER                                               
010140*--<       ファイル出力エラー >                                   
010150           MOVE     -120               TO  Ｗ−エラーコード       
010160           PERFORM  エラー判定処理                                
010170     END-EVALUATE                                                 
010180     END-IF.                                                      
010190*                                                                 
010200 協調転物件代金売却出力処理−ＥＸＩＴ.                            
010210     EXIT.                                                        
010220******************************************************************
010230*    終了処理                                                    *
010240******************************************************************
010250 終了処理                             SECTION.                    
010260 終了処理−ＳＴＡＲＴ.                                            
010270*                                                                 
010280     PERFORM  ＤＢクローズ処理.                                   
010290*                                                                 
010300     PERFORM  ファイルクローズ処理.                               
010310*                                                                 
010320     PERFORM  件数メッセージ出力.                                 
010330*                                                                 
010340     PERFORM  終了メッセージ出力.                                 
010350*                                                                 
010360*--< プログラム正常終了 >                                         
010370     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
010380*                                                                 
010390 終了処理−ＥＸＩＴ.                                              
010400     EXIT.                                                        
010410******************************************************************
010420*    ＤＢクローズ                                                *
010430******************************************************************
010440 ＤＢクローズ処理                     SECTION.                    
010450 ＤＢクローズ処理−ＳＴＡＲＴ.                                    
010460*                                                                 
010470*--< カーソル クローズ >                                          
010480     EXEC SQL                                                     
010490        CLOSE  CUR1                                               
010500     END-EXEC.                                                    
010510*                                                                 
010520 ＤＢクローズ処理−ＥＸＩＴ.                                      
010530     EXIT.                                                        
010540******************************************************************
010550*    ファイルクローズ                                            *
010560******************************************************************
010570 ファイルクローズ処理                 SECTION.                    
010580 ファイルクローズ処理−ＳＴＡＲＴ.                                
010590*                                                                 
010600     CLOSE  入力ファイル.                                         
010610     CLOSE  出力ファイル.                                         
010620*                                                                 
010630 ファイルクローズ処理−ＥＸＩＴ.                                  
010640     EXIT.                                                        
010650*                                                                 
010660******************************************************************
010670*     件数メッセージ出力処理                                     *
010680******************************************************************
010690 件数メッセージ出力                   SECTION.                    
010700 件数メッセージ出力−ＳＴＡＲＴ.                                  
010710*----------------------------------------------------------------*
010720*    件数メッセージ出力処理                                      *
010730*----------------------------------------------------------------*
010740     INITIALIZE                       IF-CHOCO001.                
010750     MOVE  "3"                        TO  共１−イベント種別.     
010760     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
010770     MOVE  "0"                        TO  共１−復帰コード.       
010780     MOVE  "LTRSMK"                   TO  共１−処理テーブルＩＤ. 
010790     MOVE  "COUNT"                    TO  共１−処理識別.         
010800     MOVE  Ｗ−入力−件数             TO  共１−データ内容.       
010810     MOVE  " 債務基本読込件数"        TO  共１−その他メッセージ. 
010820     CALL  CLOCO001                   USING  IF-CHOCO001.         
010830*                                                                 
010840     INITIALIZE                       IF-CHOCO001.                
010850     MOVE  "3"                        TO  共１−イベント種別.     
010860     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
010870     MOVE  "0"                        TO  共１−復帰コード.       
010880     MOVE  "LTRSMM"                   TO  共１−処理テーブルＩＤ. 
010890     MOVE  "COUNT"                    TO  共１−処理識別.         
010900     MOVE  Ｗ−入力−件数２           TO  共１−データ内容.       
010910     MOVE  "債務明細読込件数"         TO  共１−その他メッセージ. 
010920     CALL  CLOCO001                   USING  IF-CHOCO001.         
010930*                                                                 
010940     INITIALIZE                       IF-CHOCO001.                
010950     MOVE  "3"                        TO  共１−イベント種別.     
010960     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
010970     MOVE  "0"                        TO  共１−復帰コード.       
010980     MOVE  "FFUIS420.TMP"             TO  共１−処理テーブルＩＤ. 
010990     MOVE  "COUNT"                    TO  共１−処理識別.         
011000     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
011010     MOVE  "協調転物件代金売却出力件数"  TO                       
011020                                     共１−その他メッセージ.      
011030     CALL  CLOCO001                   USING  IF-CHOCO001.         
011040 件数メッセージ出力−ＥＸＩＴ.                                    
011050     EXIT.                                                        
011060*                                                                 
011070******************************************************************
011080*    終了メッセージ出力                                          *
011090******************************************************************
011100 終了メッセージ出力                   SECTION.                    
011110 終了メッセージ出力−ＳＴＡＲＴ.                                  
011120*                                                                 
011130*                                                                 
011140*----------------------------------------------------------------*
011150*    終了メッセージ出力                                          *
011160*----------------------------------------------------------------*
011170     INITIALIZE                       IF-CHOCO001.                
011180     MOVE  "3"                        TO  共１−イベント種別.     
011190     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
011200     MOVE  "0"                        TO  共１−復帰コード.       
011210     MOVE  "END"                      TO  共１−処理識別.         
011220     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
011230     CALL  CLOCO001                   USING  IF-CHOCO001.         
011240*                                                                 
011250 終了メッセージ出力−ＥＸＩＴ.                                    
011260     EXIT.                                                        
011270******************************************************************
011280*    エラー処理                                                  *
011290******************************************************************
011300 エラー判定処理                       SECTION.                    
011310 エラー判定処理−ＳＴＡＲＴ.                                      
011320*                                                                 
011330     MOVE  "Y"                        TO  Ｗ−異常終了−フラグ.   
011340     INITIALIZE                           IF-CHOCO001.            
011350*                                                                 
011360     EVALUATE  Ｗ−エラーコード                                   
011370        WHEN  -10                                                 
011380*--<       ＯＲＡＣＬＥ接続失敗 >                                 
011390           MOVE  "1"                  TO  共１−イベント種別      
011400           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011410           MOVE  "9"                  TO  共１−復帰コード        
011420           MOVE  "CONNECT"            TO  共１−処理識別          
011430           MOVE  SQLCODE              TO  共１−データ内容        
011440           MOVE  SQLERRMC             TO  共１−その他メッセージ  
011450           CALL  CLOCO001             USING  IF-CHOCO001          
011460*                                                                 
011470        WHEN  -20                                                 
011480*--<      結合テーブルカーソル定義処理失敗 >                      
011490           MOVE  "1"                  TO  共１−イベント種別      
011500           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011510           MOVE  "9"                  TO  共１−復帰コード        
011520           MOVE  "LTRSMM"             TO  共１−処理テーブルＩ    
011530           MOVE  "SELECT"             TO  共１−処理識別          
011540           MOVE  SQLCODE              TO  共１−データ内容        
011550           MOVE  SQLERRMC             TO  共１−その他メッセージ  
011560           CALL  CLOCO001             USING  IF-CHOCO001          
011570                                                                  
011580         WHEN  -30                                                
011590*--<       ファイルオープン失敗 >                                 
011600           MOVE  "1"                  TO  共１−イベント種別      
011610           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011620           MOVE  "9"                  TO  共１−復帰コード        
011630           MOVE  "FFUISA01"           TO  共１−処理テーブルＩＤ  
011640           MOVE  "OPEN"               TO  共１−処理識別          
011650           MOVE  Ｗ−状態             TO  共１−データ内容        
011660           CALL  CLOCO001             USING  IF-CHOCO001          
011670*                                                                 
011680        WHEN  -40                                                 
011690*--<       ファイルオープン失敗 >                                 
011700           MOVE  "1"                  TO  共１−イベント種別      
011710           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011720           MOVE  "9"                  TO  共１−復帰コード        
011730           MOVE  "FFUIS420.TMP"       TO  共１−処理テーブルＩＤ  
011740           MOVE  "OPEN"               TO  共１−処理識別          
011750           MOVE  Ｗ−状態             TO  共１−データ内容        
011760           CALL  CLOCO001             USING  IF-CHOCO001          
011770*                                                                 
011780           WHEN  -50                                              
011790*--<       結合テーブルカーソル読込失敗 >                         
011800           MOVE  "1"                  TO  共１−イベント種別      
011810           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011820           MOVE  "9"                  TO  共１−復帰コード        
011830           MOVE  "LTRSMM"             TO  共１−処理テーブルＩＤ  
011840           MOVE  "FETCH"              TO  共１−処理識別          
011850           MOVE  SQLCODE              TO  共１−データ内容        
011860           MOVE  SQLERRMC             TO  共１−その他メッセージ  
011870           CALL  CLOCO001             USING  IF-CHOCO001          
011880*                                                                 
011890           WHEN  -60                                              
011900*--< 基準適用日読込処理の抽出確認失敗>                            
011910             MOVE  "1"                  TO  共１−イベント種別    
011920             MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ      
011930             MOVE  "9"                  TO  共１−復帰コード      
011940             MOVE  "FFUISA01"           TO  共１−処理テーブルＩＤ
011950             MOVE  "READ"               TO  共１−処理識別        
011960             MOVE  Ｗ−状態             TO  共１−データ内容      
011970             CALL  CLOCO001             USING  IF-CHOCO001        
011980*                                                                 
011990           WHEN  -70                                              
012000*--<      再リース回数移行処理の抽出失敗 >                        
012010           MOVE  "2"                  TO  共１−イベント種別      
012020           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
012030           MOVE  "9"                  TO  共１−復帰コード        
012040           MOVE  "IKOTBL002"          TO  共１−処理テーブルＩＤ  
012050           MOVE  "SELECT"             TO  共１−処理識別          
012060           MOVE  SQLCODE              TO  共１−データ内容        
012070           MOVE  SQLERRMC             TO  共１−その他メッセージ  
012080           CALL  CLOCO001             USING  IF-CHOCO001          
012090           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
012100*                                                                 
012110           WHEN  -80                                              
012120*--<      契約種類移行の抽出失敗 >                                
012130           MOVE  "2"                  TO  共１−イベント種別      
012140           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
012150           MOVE  "9"                  TO  共１−復帰コード        
012160           MOVE  "IKOTBL002"          TO  共１−処理テーブルＩＤ  
012170           MOVE  "SELECT"             TO  共１−処理識別          
012180           MOVE  SQLCODE              TO  共１−データ内容        
012190           MOVE  SQLERRMC             TO  共１−その他メッセージ  
012200           CALL  CLOCO001             USING  IF-CHOCO001          
012210           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
012220*                                                                 
012230           WHEN  -90                                              
012240*--<      取引先コード移行の抽出確認 失敗 >                       
012250           MOVE  "2"                  TO  共１−イベント種別      
012260           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
012270           MOVE  "9"                  TO  共１−復帰コード        
012280           MOVE  "IKOTBL001 "         TO  共１−処理テーブルＩＤ  
012290           MOVE  "SELECT"             TO  共１−処理識別          
012300           MOVE  SQLCODE              TO  共１−データ内容        
012310           MOVE  SQLERRMC             TO  共１−その他メッセージ  
012320           CALL  CLOCO001             USING  IF-CHOCO001          
012330           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
012340*                                                                 
012350           WHEN  -100                                             
012360*--<      請求先コード移行処理の抽出確認 失敗 >                   
012370           MOVE  "2"                  TO  共１−イベント種別      
012380           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
012390           MOVE  "9"                  TO  共１−復帰コード        
012400           MOVE  "IKOTBL001 "         TO  共１−処理テーブルＩＤ  
012410           MOVE  "SELECT"             TO  共１−処理識別          
012420           MOVE  SQLCODE              TO  共１−データ内容        
012430           MOVE  SQLERRMC             TO  共１−その他メッセージ  
012440           CALL  CLOCO001             USING  IF-CHOCO001          
012450           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
012460                                                                  
012470           WHEN  -110                                             
012480*--<      請求明細共通移行処理の抽出確認 失敗 >                   
012490           MOVE  "2"                  TO  共１−イベント種別      
012500           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
012510           MOVE  "9"                  TO  共１−復帰コード        
012520           MOVE  "LTRSKM "            TO  共１−処理テーブルＩＤ  
012530           MOVE  "SELECT"             TO  共１−処理識別          
012540           MOVE  SQLCODE              TO  共１−データ内容        
012550           MOVE  SQLERRMC             TO  共１−その他メッセージ  
012560           CALL  CLOCO001             USING  IF-CHOCO001          
012570           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
012700*                                                                 
012710           WHEN  -120                                             
012720*--<      協調転物件代金売ファイル出力処理失敗 >                  
012730           MOVE  "1"                  TO  共１−イベント種別      
012740           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
012750           MOVE  "9"                  TO  共１−復帰コード        
012760           MOVE  "FFUIS420.TMP"       TO  共１−処理テーブルＩＤ  
012770           MOVE  "WRITE"              TO  共１−処理識別          
012780           MOVE  SQLCODE              TO  共１−データ内容        
012790           MOVE  SQLERRMC             TO  共１−その他メッセージ  
012800           CALL  CLOCO001             USING  IF-CHOCO001          
012810           WHEN  OTHER                                            
012820*                                                                 
012830           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
012840     END-EVALUATE.                                                
012850*                                                                 
012860     IF Ｗ−異常終了−フラグ  =  "Y"                              
012870*                                                                 
012880*--<    件数メッセージ出力処理 >                                  
012890        PERFORM  件数メッセージ出力                               
012900*--<    終了メッセージ出力処理 >                                  
012910        PERFORM  終了メッセージ出力                               
012920*                                                                 
012930*--<    プログラム異常終了のリターンコード >                      
012940        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
012950*                                                                 
012960        EXIT  PROGRAM                                             
012970     END-IF.                                                      
012980*                                                                 
012990 エラー処理−ＥＸＩＴ.                                            
013000     EXIT.                                                        
013010******************************************************************
013020*                  END OF PROGRAM                                *
013030******************************************************************
