000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名  : ファクタリング分作成                   *
000040*      2. プログラムID  : COBIS631                               *
000050*      3. 処理概要      : 契約番号をKEYとし、ファクタリング      *
000060*                         (基本情報)とファクタリング(手形債権)   *
000070*                         で結合処理を行う。                     *
000080*                                                                *
000090*      4. 作成者        : 高守軍                                 *
000100*      5. 作成日        : 2005.4.5                     　        *
000110******************************************************************
000120*                                                                 
000130******************************************************************
000140*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000150******************************************************************
000160 IDENTIFICATION                       DIVISION.                   
000170*                                                                 
000180 PROGRAM-ID.                          COBIS631.                   
000190******************************************************************
000200*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000210******************************************************************
000220 ENVIRONMENT                          DIVISION.                   
000230******************************************************************
000240*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000250******************************************************************
000260 INPUT-OUTPUT                         SECTION.                    
000270 FILE-CONTROL.                                                    
000280*                                                                 
000290     SELECT         入力ファイル    ASSIGN    TO   U05            
000300     FILE STATUS    IS     Ｗ−状態                               
000310     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000320*                                                                 
000330******************************************************************
000340*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000350******************************************************************
000360 DATA                                 DIVISION.                   
000370******************************************************************
000380*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000390******************************************************************
000400 FILE                                 SECTION.                    
000410*----------------------------------------------------------------*
000420*    入力ファイル                                                *
000430*----------------------------------------------------------------*
000440 FD  入力ファイル                                                 
000450     LABEL  RECORD    IS              STANDARD                    
000460     BLOCK  CONTAINS  0               RECORDS.                    
000470*                                                                 
000480 01  入力レコード.                                                
000490     COPY   CISPF001   REPLACING      ==()==  BY  ==入力−==.     
000500*                                                                 
000510******************************************************************
000520*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000530******************************************************************
000540  WORKING-STORAGE                     SECTION.                    
000550*----------------------------------------------------------------*
000560*    ホスト変数定義エリア                                        *
000570*----------------------------------------------------------------*
000580     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000590*                                                                 
000600*--< ＯＲＡＣＬＥ共通変数 >                                       
000610     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000620*                                                                 
000630*--< ＯＲＡＣＬＥ  ＳＱＬ実行情報 >                               
000640     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000650*                                                                 
000660*--< ファクタリング(基本情報)テーブル >                           
000670     EXEC  SQL  INCLUDE  LTRFCK.CBL            END-EXEC.          
000680*                                                                 
000690*--< ファクタリング(手形債権)テーブル >                           
000700     EXEC  SQL  INCLUDE  LTRFCT.CBL            END-EXEC.          
000710*                                                                 
000720*--< 取引先（取引先）マスタ>                                      
000730     EXEC  SQL  INCLUDE  LTRTRI.CBL            END-EXEC.          
000740                                                                  
000750*--< 受取手形テーブル>                                            
000760     EXEC  SQL  INCLUDE  D642UTG.CBL           END-EXEC.          
000770                                                                  
000780*--< 受取手形展開テーブル>                                        
000790     EXEC  SQL  INCLUDE  D645UTT.CBL           END-EXEC.          
000800                                                                  
000810*--< 変換テーブル(IKOTBL001)>                                     
000820     EXEC  SQL  INCLUDE  IKOTBL001.CBL         END-EXEC.          
000830                                                                  
000840*--< 基準適用日ファイル(CISPF001) >                               
000850 01   ＷＳ−基準日                    PIC  X(05).                 
000860                                                                  
000870 01   ＷＳ−目的ＣＤ                  PIC  X(01)   VALUE '2'.     
000880                                                                  
000890*--< 変換テーブル(IKOTBL001)>                                     
000900                                                                  
000910 01   ＷＳ−新取引先コード            PIC  X(09).                 
000920 01   ＷＳ−枝番                      PIC  X(05).                 
000930 01   ＷＳ−振出人取引先コード	    PIC  X(09).                 
000940 01   ＷＳ−振出人契約先コード	    PIC  X(05).                 
000950                                                                  
000960     EXEC  SQL  END  DECLARE          SECTION  END-EXEC.          
000970*                                                                 
000980*----------------------------------------------------------------*
000990*    ＷＯＲＫエリア                                              *
001000*----------------------------------------------------------------*
001010 01  ＷＯＲＫ−エリア.                                            
001020*--< エラー判定用 >                                               
001030     03  Ｗ−エラーコード             PIC S9(04).                 
001040*                                                                 
001050*--< ファイル状態 >                                               
001060     03  Ｗ−状態                     PIC  X(02).                 
001070                                                                  
001080*--< フラグアリア >                                               
001090     03  フラグアリア.                                            
001100         05  Ｗ−終了−フラグ         PIC  X(01).                 
001110         05  Ｗ−終了−フラグ１       PIC  X(01).                 
001120         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001130*                                                                 
001140*--< 件数エリア >                                                 
001150     03  件数エリア.                                              
001160         05  Ｗ−入力−件数１         PIC  9(09).                 
001170         05  Ｗ−入力−件数２         PIC  9(09).                 
001180         05  Ｗ−出力−件数１         PIC  9(09).                 
001190         05  Ｗ−出力−件数２         PIC  9(09).                 
001200*                                                                 
001210*--< 共通情報 >                                                   
001220 01  Ｗ−共通情報.                                                
001230     03  Ｗ−システム日付.                                        
001240         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001250         05  Ｗ−年月日               PIC  X(06).                 
001260     03  Ｗ−システム時刻             PIC  X(08).                 
001270     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001280*                                                                 
001290*----------------------------------------------------------------*
001300*    サブルーチン名                                              *
001310*----------------------------------------------------------------*
001320 01  CALL-AREA.                                                   
001330*--< 共通ログサブルーチン >                                       
001340     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001350     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001360*                                                                 
001370*----------------------------------------------------------------*
001380*    ＣＯＰＹ領域                                                *
001390*----------------------------------------------------------------*
001400*--< 共通ログ用パラメータ >                                       
001410 01  IF-CHOCO001.                                                 
001420     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001430                                                                  
001440*----------------------------------------------------------------*
001450*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001460*----------------------------------------------------------------*
001470 01  PARA-AREA.                                                   
001480     COPY CPBCO001.                                               
001490******************************************************************
001500*    定数用データ定義エリア                                      *
001510******************************************************************
001520 CONSTANT                             SECTION.                    
001530 01  定数領域.                                                    
001540     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS631".
001550     03  定数−プログラム名           PIC  X(80)                  
001560                                    VALUE  "ファクタリング分作成".
001570     03  定数−ＳＱＬＯＫ             PIC S9(04)  VALUE  ZERO.    
001580     03  定数−ＳＱＬＥＮＤ           PIC S9(04)  VALUE  0100.    
001590     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001600     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001610******************************************************************
001620*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001630******************************************************************
001640 PROCEDURE                            DIVISION.                   
001650*                                                                 
001660     PERFORM  初期処理.                                           
001670*                                                                 
001680     PERFORM  主処理  UNTIL  (Ｗ−終了−フラグ  =  "Y")           
001690                      AND    (Ｗ−終了−フラグ１ = "Y").          
001700*                                                                 
001710     PERFORM  終了処理.                                           
001720*                                                                 
001730     STOP     RUN.                                                
001740*                                                                 
001750******************************************************************
001760*    初期処理                                                    *
001770******************************************************************
001780 初期処理                             SECTION.                    
001790 初期処理−ＳＴＡＲＴ.                                            
001800*                                                                 
001810*----------------------------------------------------------------*
001820*    開始メッセージ出力処理                                      *
001830*----------------------------------------------------------------*
001840     INITIALIZE                       IF-CHOCO001.                
001850     MOVE  "3"                        TO  共１−イベント種別.     
001860     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001870     MOVE  "0"                        TO  共１−復帰コード.       
001880     MOVE  "START"                    TO  共１−処理識別.         
001890     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001900     CALL  CLOCO001                USING  IF-CHOCO001.            
001910*                                                                 
001920*----------------------------------------------------------------*
001930*    作業領域の初期値処理                                        *
001940*----------------------------------------------------------------*
001950     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001960     INITIALIZE                           ＷＯＲＫ−エリア.       
001970*                                                                 
001980*                                                                 
001990*--< ＣＰＵ日付を取得 >                                           
002000     ACCEPT  Ｗ−年月日               FROM  DATE.                 
002010*                                                                 
002020*--< ＣＰＵ時刻を取得 >                                           
002030     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
002040*                                                                 
002050*--< ＯＲＡＣＬＥ接続 >                                           
002060     PERFORM   ＯＲＡＣＬＥ接続.                                  
002070*                                                                 
002080*--< ファイルオープン >                                           
002090     OPEN  INPUT  入力ファイル.                                   
002100*                                                                 
002110*----------------------------------------------------------------*
002120*    ファイルオープン状態判定                                    *
002130*----------------------------------------------------------------*
002140     EVALUATE  Ｗ−状態                                           
002150        WHEN  ZERO                                                
002160           CONTINUE                                               
002170        WHEN  OTHER                                               
002180*--<       ファイルオープンエラー >                               
002190           MOVE     -70               TO  Ｗ−エラーコード        
002200           PERFORM  エラー判定処理                                
002210     END-EVALUATE.                                                
002220                                                                  
002230*----------------------------------------------------------------*
002240*    基準適用日読込処理(１件目)                                  *
002250*----------------------------------------------------------------*
002260     PERFORM   基準日読込処理.                                    
002270                                                                  
002280*--< 結合テーブルカーソル定義 >                                   
002290     PERFORM  結合テーブルカーソル定義.                           
002300*                                                                 
002310*--< 結合テーブルカーソル読込(１件目) >                           
002320     PERFORM  結合テーブルカーソル読込.                           
002330*                                                                 
002340 初期処理−ＥＸＩＴ.                                              
002350     EXIT.                                                        
002360******************************************************************
002370*    ＯＲＡＣＬＥ接続                                            *
002380******************************************************************
002390 ＯＲＡＣＬＥ接続                     SECTION.                    
002400 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002410*                                                                 
002420*--< ＤＢ接続用情報を取得処理 >                                   
002430     CALL  COBCO001                USING  PARA-AREA.              
002440*                                                                 
002450     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002460     MOVE  PARA-USERNAME              TO  USERNAME.               
002470     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002480*                                                                 
002490*----------------------------------------------------------------*
002500*    開始接続                                                    *
002510*----------------------------------------------------------------*
002520     IF    DB-STRING  =  SPACE                                    
002530        EXEC SQL                                                  
002540           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002550        END-EXEC                                                  
002560     ELSE                                                         
002570        EXEC SQL                                                  
002580           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002590             USING  :DB-STRING                                    
002600        END-EXEC                                                  
002610     END-IF.                                                      
002620*                                                                 
002630*----------------------------------------------------------------*
002640*    接続確認                                                    *
002650*----------------------------------------------------------------*
002660     EVALUATE  SQLCODE                                            
002670        WHEN   定数−ＳＱＬＯＫ                                   
002680           CONTINUE                                               
002690        WHEN   OTHER                                              
002700*--<       接続エラー >                                           
002710           MOVE     -10               TO  Ｗ−エラーコード        
002720           PERFORM  エラー判定処理                                
002730     END-EVALUATE.                                                
002740*                                                                 
002750 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002760     EXIT.                                                        
002770******************************************************************
002780*        結合テーブルカーソル定義                                *
002790******************************************************************
002800 結合テーブルカーソル定義             SECTION.                    
002810 結合テーブルカーソル定義−ＳＴＡＲＴ.                            
002820*                                                                 
002830*----------------------------------------------------------------*
002840*    カーソルＯＰＥＮ処理                                        *
002850*----------------------------------------------------------------*
002860     EXEC SQL                                                     
002870        DECLARE CUR1  CURSOR FOR                                  
002880          SELECT   LTRFCK.契約番号                                
002890                  ,LTRFCK.ユーザーコード                          
002900                  ,NVL(LTRTRI.取引先正式名称取引先名称漢字        
002910                                              ,RPAD(' ',1,' '))   
002920                  ,NVL(LTRTRI.取引先正式名称取引先名称カナ        
002930                                              ,RPAD(' ',1,' '))   
002940                  ,LTRFCK.事業所コード                            
002950                  ,LTRFCK.実行日                                  
002960                  ,NVL(LTRFCT.手形種類,0)                       
002970                  ,NVL(LTRFCT.利息期日,RPAD('0',7,'0'))           
002980                  ,LTRFCK.額面金額                                
002990                  ,LTRFCK.銀行コード                              
003000                  ,NVL(LTRFCT.取引銀行コード,RPAD('0',7,'0'))     
003010                  ,LTRFCK.原債務者コード                          
003020                  ,NVL(LTRFCT.支払人名,RPAD(' ',60,' '))          
003030                  ,NVL(LTRFCT.手形番号,RPAD('0',10,'0'))          
003040                  ,LTRFCK.期日                                    
003050                                                                  
003060                                                                  
003070            FROM  LTRFCK                                          
003080                 ,LTRFCT                                          
003090                 ,LTRTRI                                          
003100           WHERE  LTRFCK.契約番号       =   LTRFCT.契約番号  (+)  
003110             AND  LTRFCK.ユーザーコード =   LTRTRI.取引先コード(+)
003120        ORDER BY  LTRFCK.契約番号                                 
003130     END-EXEC.                                                    
003140                                                                  
003150*----------------------------------------------------------------*
003160*    カーソルＯＰＥＮ処理                                        *
003170*----------------------------------------------------------------*
003180     EXEC  SQL                                                    
003190        OPEN  CUR1                                                
003200     END-EXEC.                                                    
003210*                                                                 
003220*----------------------------------------------------------------*
003230*    カーソルＯＰＥＮ確認                                        *
003240*----------------------------------------------------------------*
003250     EVALUATE  SQLCODE                                            
003260        WHEN  定数−ＳＱＬＯＫ                                    
003270*--<       正常 >                                                 
003280           CONTINUE                                               
003290        WHEN  OTHER                                               
003300*--<       カーソルＯＰＥＮエラー >                               
003310           MOVE -20                   TO  Ｗ−エラーコード        
003320           PERFORM  エラー判定処理                                
003330     END-EVALUATE.                                                
003340*                                                                 
003350 結合テーブルカーソル定義−ＥＸＩＴ.                              
003360     EXIT.                                                        
003370******************************************************************
003380*    結合テーブルカーソル読込                                    *
003390******************************************************************
003400 結合テーブルカーソル読込             SECTION.                    
003410 結合テーブルカーソル読込−ＳＴＡＲＴ.                            
003420*                                                                 
003430*--< 結合テーブルカーソル読込 >                                   
003440     EXEC SQL                                                     
003450         FETCH  CUR1                                              
003460          INTO  :ＬＴＲＦＣＫ−契約番号                           
003470               ,:ＬＴＲＦＣＫ−ユーザーコード                     
003480               ,:ＬＴＲＴＲＩ−取引先正式名称取引先名称漢字       
003490               ,:ＬＴＲＴＲＩ−取引先正式名称取引先名称カナ       
003500               ,:ＬＴＲＦＣＫ−事業所コード                       
003510               ,:ＬＴＲＦＣＫ−実行日                             
003520               ,:ＬＴＲＦＣＴ−手形種類                           
003530               ,:ＬＴＲＦＣＴ−利息期日                           
003540               ,:ＬＴＲＦＣＫ−額面金額                           
003550               ,:ＬＴＲＦＣＫ−銀行コード                         
003560               ,:ＬＴＲＦＣＴ−取引銀行コード                     
003570               ,:ＬＴＲＦＣＫ−原債務者コード                     
003580               ,:ＬＴＲＦＣＴ−支払人名                           
003590               ,:ＬＴＲＦＣＴ−手形番号                           
003600                                                                  
003610               ,:ＬＴＲＦＣＫ−期日                               
003620                                                                  
003630                                                                  
003640     END-EXEC.                                                    
003650*                                                                 
003660*----------------------------------------------------------------*
003670*    結合テーブルカーソル読込を確認                              *
003680*----------------------------------------------------------------*
003690     EVALUATE   SQLCODE                                           
003700        WHEN   定数−ＳＱＬＯＫ                                   
003710*--<       正常 >                                                 
003720*                                                                 
003730           COMPUTE  Ｗ−入力−件数１  =  Ｗ−入力−件数１  +  1   
003740        WHEN   定数−ＳＱＬＥＮＤ                                 
003750*--<       読込終了 >                                             
003760           MOVE  "Y"                  TO  Ｗ−終了−フラグ        
003770        WHEN   OTHER                                              
003780*--<       読込エラー >                                           
003790           MOVE     -30               TO  Ｗ−エラーコード        
003800           PERFORM  エラー判定処理                                
003810     END-EVALUATE.                                                
003820*                                                                 
003830 結合テーブルカーソル読込−ＥＸＩＴ.                              
003840     EXIT.                                                        
003850                                                                  
003860******************************************************************
003870*    基準適用日読込処理        (CISPF001)                        *
003880******************************************************************
003890 基準日読込処理                   SECTION.                        
003900 基準日読込処理−ＳＴＡＲＴ.                                      
003910*--<    基準日読込 >                                              
003920        READ  入力ファイル                                        
003930           AT  END                                                
003940*--<          読込終了 >                                          
003950              MOVE  "Y"               TO  Ｗ−終了−フラグ１      
003960              GO  TO  基準日読込処理−ＥＸＩＴ                    
003970                                                                  
003980        END-READ.                                                 
003990*                                                                 
004000*----------------------------------------------------------------*
004010*    ファイルオープン状態判定                                    *
004020*----------------------------------------------------------------*
004030     EVALUATE  Ｗ−状態                                           
004040       WHEN  ZERO                                                 
004050             PERFORM  入力基準日処理                              
004060                                                                  
004070             MOVE  入力−基準日(3:4)   TO  ＷＳ−基準日(2:4)      
004080                                                                  
004090             COMPUTE  Ｗ−入力−件数２  =  Ｗ−入力−件数２ + 1   
004100       WHEN  OTHER                                                
004110*--<       読み込みエラー >                                       
004120           MOVE     ZERO               TO  ＷＳ−基準日           
004130           MOVE     -80                TO  Ｗ−エラーコード       
004140           PERFORM  エラー判定処理                                
004150     END-EVALUATE.                                                
004160*                                                                 
004170 基準日読込処理−ＥＸＩＴ.                                        
004180     EXIT.                                                        
004190                                                                  
004200*----------------------------------------------------------------*
004210*    入力基準日処理                                              *
004220*----------------------------------------------------------------*
004230 入力基準日処理                        SECTION.                   
004240 入力基準日処理−ＳＴＡＲＴ.                                      
004250                                                                  
004260     EVALUATE  入力−基準日 (1:2)                                 
004270             WHEN  "19"                                           
004280                 MOVE  "0"            TO  ＷＳ−基準日(1:1)       
004290             WHEN  "20"                                           
004300                 MOVE  "1"            TO  ＷＳ−基準日(1:1)       
004310             WHEN ZERO                                            
004320                 MOVE  ZERO           TO  ＷＳ−基準日(1:1)       
004330     END-EVALUATE.                                                
004340                                                                  
004350 入力基準日処理−ＥＸＩＴ.                                        
004360     EXIT.                                                        
004370******************************************************************
004380*    主処理                                                      *
004390******************************************************************
004400 主処理                               SECTION.                    
004410 主処理−ＳＴＡＲＴ.                                              
004420*                                                                 
004430     PERFORM  利息期日処理.                                       
004440*                                                                 
004450     PERFORM  編集出力処理.                                       
004460*                                                                 
004470     PERFORM  出力処理.                                           
004480                                                                  
004490*--< 結合テーブルカーソル読込（２件目以降） >                     
004500     PERFORM  結合テーブルカーソル読込.                           
004510*                                                                 
004520*                                                                 
004530 主処理−ＥＸＩＴ.                                                
004540     EXIT.                                                        
004550*----------------------------------------------------------------*
004560*    利息期日処理                                                *
004570*----------------------------------------------------------------*
004580 利息期日処理                         SECTION.                    
004590 利息期日処理−ＳＴＡＲＴ.                                        
004600      IF     ＬＴＲＦＣＴ−利息期日(1:5)  NOT < ＷＳ−基準日      
004610             CONTINUE                                             
004620      ELSE                                                        
004630                                                                  
004640      MOVE   ZERO                TO  ＬＴＲＦＣＴ−手形種類       
004650      MOVE   ZERO                TO  ＬＴＲＦＣＴ−利息期日       
004660      MOVE   ZERO                TO  ＬＴＲＦＣＴ−取引銀行コード 
004670      MOVE   SPACE               TO  ＬＴＲＦＣＴ−支払人名       
004680 	    MOVE   ZERO                TO  ＬＴＲＦＣＴ−手形番号       
004690                                                                  
004700      END-IF.                                                     
004710                                                                  
004720 利息期日処理−ＥＸＩＴ.                                          
004730		EXIT.                                                   
004740                                                           
004750*---------------------------------------------------------------* 
004760*     編集出力処理                                              * 
004770*---------------------------------------------------------------* 
004780 編集出力処理                         SECTION.                    
004790 編集出力処理−ＳＴＡＲＴ.                                        
004800*                                                                 
004810     PERFORM  項目抽出処理.                                       
004820*                                                                 
004830*----------------------------------------------------------------*
004840*       項目編集処理  受取手形(D642UTG_TBL)                      *
004850*----------------------------------------------------------------*
004860*--<    No.01 >                                                   
004870        MOVE  ＬＴＲＦＣＫ−契約番号                              
004880                                TO  Ｄ６４２−代表契約番号.       
004890*--<    No.02 >                                                   
004900        MOVE  '1'               TO  Ｄ６４２−束数.               
004910*--<    No.03 >                                                   
004920        MOVE  ＷＳ−新取引先コード                                
004930                                TO  Ｄ６４２−取引先コード.       
004940*--<    No.04 >                                                   
004950        MOVE  ＷＳ−枝番                                          
004960                                TO  Ｄ６４２−契約先コード.       
004970*--<    No.05 >                                                   
004980        MOVE  ＬＴＲＴＲＩ−取引先正式名称取引先名称漢字          
004990                                TO  Ｄ６４２−契約先名称.         
005000*--<    No.06 >                                                   
005010        MOVE  ＬＴＲＴＲＩ−取引先正式名称取引先名称カナ          
005020                                TO  Ｄ６４２−契約先名称カナ.     
005030*--<    No.07 >                                                   
005040        MOVE  ＬＴＲＦＣＫ−事業所コード                          
005050                                TO  Ｄ６４２−部店コード.         
005060*--<    No.8 >  	                                                
005070        MOVE  '8'               TO  Ｄ６４２−主契約区分.         
005080*--<    No.9 >                                                    
005090        MOVE  '0'               TO  Ｄ６４２−手形状態.           
005100*--<    No.10 >                                                   
005110        MOVE  ＬＴＲＦＣＫ−実行日                                
005120                                TO  Ｄ６４２−取引日.             
005130*--<    No.11 >                                                   
005140        MOVE  ＬＴＲＦＣＫ−実行日                                
005150                                TO  Ｄ６４２−伝票発行日.         
005160*--<    No.12 >                                                   
005170        MOVE  ＬＴＲＦＣＴ−手形種類                              
005180                                TO  Ｄ６４２−手形種類.           
005190*--<    No.13 >                                                   
005200        MOVE  ＬＴＲＦＣＴ−利息期日                              
005210                                TO  Ｄ６４２−期日基準日.         
005220*--<    No.14 >                                                   
005230        MOVE  '1'               TO  Ｄ６４２−期日サイクル.       
005240                                                                  
005250*--<    No.15 >                                                   
005260        MOVE  ＬＴＲＦＣＫ−額面金額                              
005270                                TO  Ｄ６４２−束合計金額.         
005280*--<    No.16 >                                                   
005290        MOVE  '1'               TO  Ｄ６４２−手形枚数.           
005300                                                                  
005310*--<    No.17 >                                                   
005320        MOVE  ＬＴＲＦＣＫ−銀行コード                            
005330                                TO  Ｄ６４２−取立銀行コード.     
005340*--<    No.18 >                                                   
005350        MOVE  ＬＴＲＦＣＴ−取引銀行コード                        
005360                                TO  Ｄ６４２−支払銀行コード.     
005370*--<    No.19 >                                                   
005380        MOVE  ＬＴＲＦＣＫ−契約番号                              
005390                                TO  Ｄ６４２−契約番号１.         
005400*--<    No.20 >                                                   
005410        MOVE  ZERO              TO  Ｄ６４２−契約番号２.         
005420*--<    No.21 >                                                   
005430        MOVE  ZERO              TO  Ｄ６４２−契約番号３.         
005440*--<    No.22 >                                                   
005450        MOVE  ZERO              TO  Ｄ６４２−契約番号４.         
005460*--<    No.23 >                                                   
005470        MOVE  ZERO              TO  Ｄ６４２−契約番号５.         
005480*--<    No.24 >                                                   
005490        MOVE  ZERO              TO  Ｄ６４２−契約番号６.         
005500*--<    No.25 >                                                   
005510        MOVE  ZERO              TO  Ｄ６４２−契約番号７.         
005520*--<    No.26 >                                                   
005530        MOVE  ZERO              TO  Ｄ６４２−契約番号８.         
005540*--<    No.27 >                                                   
005550        MOVE  ZERO              TO  Ｄ６４２−契約番号９.         
005560*--<    No.28 >                                                   
005570        MOVE  ZERO              TO  Ｄ６４２−契約番号１０.       
005580*--<    No.29 >                                                   
005590        MOVE  SPACE             TO  Ｄ６４２−備考欄.             
005600*--<    No.30 >                                                   
005610        MOVE  ZERO              TO  Ｄ６４２−手形内容種別.       
005620*--<    No.31 >                                                   
005630        MOVE  Ｗ−システム日付  TO  Ｄ６４２−登録年月日.         
005640*--<    No.92 >                                                   
005650        MOVE  Ｗ−システム時刻  TO  Ｄ６４２−登録時間.           
005660*--<    No.33 >                                                   
005670        MOVE  Ｗ−担当者        TO  Ｄ６４２−登録担当者.         
005680*--<    No.34 >                                                   
005690        MOVE  Ｗ−システム日付  TO  Ｄ６４２−更新年月日.         
005700*--<    No.35 >                                                   
005710        MOVE  Ｗ−システム時刻  TO  Ｄ６４２−更新時間.           
005720*--<    No.36 >                                                   
005730        MOVE  Ｗ−担当者        TO  Ｄ６４２−更新者.             
005740*--<    No.37 >                                                   
005750        MOVE  Ｗ−担当者        TO  Ｄ６４２−入力担当者コード.   
005760*--<    No.38>                                                    
005770        MOVE  ZERO              TO  Ｄ６４２−売却代金区分.       
005780*--<    No.39 >                                                   
005790        MOVE  ＷＳ−振出人取引先コード                            
005800                                TO  Ｄ６４２−振出人取引先コード. 
005810*--<    No.40 >                                                   
005820        MOVE  ＷＳ−振出人契約先コード                            
005830                                TO  Ｄ６４２−振出人契約先コード. 
005840*--<    No.41 >                                                   
005850        MOVE  ＬＴＲＦＣＴ−支払人名                              
005860                                TO  Ｄ６４２−振出人名称.         
005870*--<    No.42 >                                                   
005880        MOVE  SPACE             TO  Ｄ６４２−振出人名称カナ.     
005890                                                                  
005900                                                                  
005910*----------------------------------------------------------------*
005920*       項目編集処理  受取手形展開(D645UTT_TBL)                  *
005930*----------------------------------------------------------------*
005940*--<    No.01 >                                                   
005950        MOVE   ＬＴＲＦＣＫ−契約番号                             
005960                                TO   Ｄ６４５−代表契約番号.      
005970*--<    No.02 >                                                   
005980        MOVE   '1'              TO   Ｄ６４５−束数.              
005990*--<    No.03 >                                                   
006000        MOVE   '1'              TO   Ｄ６４５−連番.              
006010*--<    No.04 >                                                   
006020        MOVE   ＬＴＲＦＣＴ−手形番号                             
006030                                TO   Ｄ６４５−手形番号.          
006040*--<    No.05 >                                                   
006050        MOVE   ＬＴＲＦＣＫ−期日                                 
006060                                TO   Ｄ６４５−期日.              
006070*--<    No.06 >                                                   
006080        MOVE   ＬＴＲＦＣＫ−額面金額                             
006090                                TO   Ｄ６４５−金額.              
006100*--<    No.07 >                                                   
006110        MOVE   ＷＳ−振出人取引先コード                           
006120                                TO   Ｄ６４５−振出人取引先コード.
006130*--<    No.08 >                                                   
006140        MOVE   ＷＳ−振出人契約先コード                           
006150                                TO   Ｄ６４５−振出人契約先コード.
006160*--<    No.09 >                                                   
006170        MOVE   ＬＴＲＦＣＴ−支払人名                             
006180                                TO   Ｄ６４５−振出人名称.        
006190*--<    No.10 >                                                   
006200        MOVE   SPACE            TO   Ｄ６４５−振出人名称カナ.    
006210*--<    No.11 >                                                   
006220        MOVE   Ｗ−システム日付 TO   Ｄ６４５−登録年月日.        
006230*--<    No.12 >                                                   
006240        MOVE   Ｗ−システム時刻 TO   Ｄ６４５−登録時間.          
006250*--<    No.13 >                                                   
006260        MOVE   Ｗ−担当者       TO   Ｄ６４５−登録担当者.        
006270*--<    No.14 >                                                   
006280        MOVE   Ｗ−システム日付 TO   Ｄ６４５−更新年月日.        
006290*--<    No.15 >                                                   
006300        MOVE   Ｗ−システム時刻 TO   Ｄ６４５−更新時間.          
006310*--<    No.16 >                                                   
006320        MOVE   Ｗ−担当者       TO   Ｄ６４５−更新者.            
006330*--<    No.17 >                                                   
006340        MOVE   Ｗ−担当者       TO   Ｄ６４５−入力担当者コード.  
006350*--<    No.18 >                                                   
006360        MOVE   ZERO             TO   Ｄ６４５−手形状態.          
006370*                                                                 
006380 編集出力処理−ＥＸＩＴ.                                          
006390     EXIT.                                                        
006400*----------------------------------------------------------------*
006410*    項目抽出処理                                                *
006420*----------------------------------------------------------------*
006430 項目抽出処理                         SECTION.                    
006440 項目抽出処理−ＳＴＡＲＴ.                                        
006450                                                                  
006460*--< 新取引先コード和枝番抽出処理 >                               
006470     PERFORM  新取引先コード和枝番抽出処理.                       
006480                                                                  
006490*--< 振出人取引先コード和振出人契約先コード >                     
006500     PERFORM  振出人取引先コード和振出人契約先コード.             
006510                                                                  
006520 項目抽出処理−ＥＸＩＴ.                                          
006530     EXIT.                                                        
006540*----------------------------------------------------------------*
006550*     新取引先コード和枝番抽出処理                               *
006560*----------------------------------------------------------------*
006570                                                                  
006580 新取引先コード和枝番抽出処理       SECTION.                      
006590 新取引先コード和枝番抽出処理−ＳＴＡＲＴ.                        
006600*                                                                 
006610                                                                  
006620*--< 新取引先コード和枝番抽出処理 >                               
006630     EXEC SQL                                                     
006640           SELECT  NVL(IKOTBL001.新取引先コード,RPAD('0',7,'0'))  
006650                  ,NVL(IKOTBL001.枝番,RPAD('0',3,'0'))            
006660             INTO  :ＷＳ−新取引先コード                          
006670                  ,:ＷＳ−枝番                                    
006680             FROM  IKOTBL001                                      
006690            WHERE  IKOTBL001.取引先コード(+)                      
006700                                 =  :ＬＴＲＦＣＫ−ユーザーコード 
006710              AND  IKOTBL001.目的ＣＤ                             
006720                              =  :ＷＳ−目的ＣＤ                  
006730     END-EXEC.                                                    
006740                                                                  
006750*--<       SQLCODE判定処理 >                                      
006760     EVALUATE  SQLCODE                                            
006770        WHEN  定数−ＳＱＬＯＫ                                    
006780*--<       正常 >                                                 
006790           CONTINUE                                               
006800        WHEN  OTHER                                               
006810*--<        エラー >                                              
006820           MOVE -50                   TO  Ｗ−エラーコード        
006830           PERFORM  エラー判定処理                                
006840     END-EVALUATE.                                                
006850                                                                  
006860 新取引先コード和枝番抽出処理−ＥＸＩＴ.                          
006870     EXIT.                                                        
006880                                                                  
006890*----------------------------------------------------------------*
006900*   変換テーブル(IKOTBL001)振出人取引先コード和振出人契約先コード*
006910*----------------------------------------------------------------*
006920                                                                  
006930 振出人取引先コード和振出人契約先コード        SECTION.           
006940 振出人取引先コード和振出人契約先コード−ＳＴＡＲＴ.              
006950*                                                                 
006960*--< 振出人契約先コード和振出人契約先コード抽出処理 >             
006970     EXEC SQL                                                     
006980           SELECT  NVL(IKOTBL001.新取引先コード,RPAD('0',7,'0'))  
006990                  ,NVL(IKOTBL001.枝番,RPAD('0',3,'0'))            
007000             INTO  :ＷＳ−振出人取引先コード                      
007010                  ,:ＷＳ−振出人契約先コード                      
007020             FROM  IKOTBL001                                      
007030            WHERE  IKOTBL001.取引先コード(+)                      
007040                                 =  :ＬＴＲＦＣＫ−原債務者コード 
007050              AND  IKOTBL001.目的ＣＤ                             
007060                                 =  :ＷＳ−目的ＣＤ               
007070     END-EXEC.                                                    
007080                                                                  
007090*--<       SQLCODE判定処理 >                                      
007100     EVALUATE  SQLCODE                                            
007110        WHEN  定数−ＳＱＬＯＫ                                    
007120*--<       正常 >                                                 
007130           CONTINUE                                               
007140        WHEN  OTHER                                               
007150*--<       エラー >                                               
007160           MOVE -60                   TO  Ｗ−エラーコード        
007170           PERFORM  エラー判定処理                                
007180     END-EVALUATE.                                                
007190                                                                  
007200 振出人取引先コード和振出人契約先コード−ＥＸＩＴ.                
007210     EXIT.                                                        
007220                                                                  
007230******************************************************************
007240*    出力処理                                                    *
007250******************************************************************
007260 出力処理                             SECTION.                    
007270 出力処理−ＳＴＡＲＴ.                                            
007280*                                                                 
007290*----------------------------------------------------------------*
007300*       項目処理  受取手形(D642UTG_TBL)                          *
007310*----------------------------------------------------------------*
007320       EXEC  SQL                                                  
007330        INSERT  INTO  D642UTG_TBL                                 
007340           (  代表契約番号                                        
007350             ,束数                                                
007360             ,取引先コード                                        
007370             ,契約先コード                                        
007380             ,契約先名称                                          
007390             ,契約先名称カナ                                      
007400             ,部店コード                                          
007410             ,主契約区分                                          
007420             ,手形状態                                            
007430             ,取引日                                              
007440             ,伝票発行日                                          
007450             ,手形種類                                            
007460             ,期日基準日                                          
007470             ,期日サイクル                                        
007480             ,束合計金額                                          
007490             ,手形枚数                                            
007500             ,取立銀行コード                                      
007510             ,支払銀行コード                                      
007520             ,契約番号１                                          
007530             ,契約番号２                                          
007540             ,契約番号３                                          
007550             ,契約番号４                                          
007560             ,契約番号５                                          
007570             ,契約番号６                                          
007580             ,契約番号７                                          
007590             ,契約番号８                                          
007600             ,契約番号９                                          
007610             ,契約番号１０                                        
007620             ,備考欄                                              
007630             ,手形内容種別                                        
007640             ,登録年月日                                          
007650             ,登録時間                                            
007660             ,登録担当者                                          
007670             ,更新年月日                                          
007680             ,更新時間                                            
007690             ,更新者                                              
007700             ,入力担当者コード                                    
007710             ,売却代金区分                                        
007720             ,振出人取引先コード                                  
007730             ,振出人契約先コード                                  
007740             ,振出人名称                                          
007750             ,振出人名称カナ)                                     
007760       VALUES                                                     
007770           (  :Ｄ６４２−代表契約番号                             
007780             ,:Ｄ６４２−束数                                     
007790             ,:Ｄ６４２−取引先コード                             
007800             ,:Ｄ６４２−契約先コード                             
007810             ,:Ｄ６４２−契約先名称                               
007820             ,:Ｄ６４２−契約先名称カナ                           
007830             ,:Ｄ６４２−部店コード                               
007840             ,:Ｄ６４２−主契約区分                               
007850             ,:Ｄ６４２−手形状態                                 
007860             ,:Ｄ６４２−取引日                                   
007870             ,:Ｄ６４２−伝票発行日                               
007880             ,:Ｄ６４２−手形種類                                 
007890             ,:Ｄ６４２−期日基準日                               
007900             ,:Ｄ６４２−期日サイクル                             
007910             ,:Ｄ６４２−束合計金額                               
007920             ,:Ｄ６４２−手形枚数                                 
007930             ,:Ｄ６４２−取立銀行コード                           
007940             ,:Ｄ６４２−支払銀行コード                           
007950             ,:Ｄ６４２−契約番号１                               
007960             ,:Ｄ６４２−契約番号２                               
007970             ,:Ｄ６４２−契約番号３                               
007980             ,:Ｄ６４２−契約番号４                               
007990             ,:Ｄ６４２−契約番号５                               
008000             ,:Ｄ６４２−契約番号６                               
008010             ,:Ｄ６４２−契約番号７                               
008020             ,:Ｄ６４２−契約番号８                               
008030             ,:Ｄ６４２−契約番号９                               
008040             ,:Ｄ６４２−契約番号１０                             
008050             ,:Ｄ６４２−備考欄                                   
008060             ,:Ｄ６４２−手形内容種別                             
008070             ,:Ｄ６４２−登録年月日                               
008080             ,:Ｄ６４２−登録時間                                 
008090             ,:Ｄ６４２−登録担当者                               
008100             ,:Ｄ６４２−更新年月日                               
008110             ,:Ｄ６４２−更新時間                                 
008120             ,:Ｄ６４２−更新者                                   
008130             ,:Ｄ６４２−入力担当者コード                         
008140             ,:Ｄ６４２−売却代金区分                             
008150             ,:Ｄ６４２−振出人取引先コード                       
008160             ,:Ｄ６４２−振出人契約先コード                       
008170             ,:Ｄ６４２−振出人名称                               
008180             ,:Ｄ６４２−振出人名称カナ)                          
008190     END-EXEC.                                                    
008200*----------------------------------------------------------------*
008210*    追加処理を確認受取手形(D642UTG_TBL)                         *
008220*----------------------------------------------------------------*
008230     EVALUATE  SQLCODE                                            
008240        WHEN   定数−ＳＱＬＯＫ                                   
008250*--<       追加成功 >                                             
008260            COMPUTE  Ｗ−出力−件数１  =  Ｗ−出力−件数１  +  1  
008270        WHEN   OTHER                                              
008280*--<       追加処理エラー >                                       
008290           MOVE     -40               TO  Ｗ−エラーコード        
008300           PERFORM  エラー判定処理                                
008310     END-EVALUATE.                                                
008320*----------------------------------------------------------------*
008330*       項目処理  受取手形展開(D645UTT_TBL)                      *
008340*----------------------------------------------------------------*
008350*                                                                 
008360       EXEC  SQL                                                  
008370        INSERT  INTO  D645UTT_TBL                                 
008380           (  代表契約番号                                        
008390             ,束数                                                
008400             ,連番                                                
008410             ,手形番号                                            
008420             ,期日                                                
008430             ,金額                                                
008440             ,振出人取引先コード                                  
008450             ,振出人契約先コード                                  
008460             ,振出人名称                                          
008470             ,振出人名称カナ                                      
008480             ,登録年月日                                          
008490             ,登録時間                                            
008500             ,登録担当者                                          
008510             ,更新年月日                                          
008520             ,更新時間                                            
008530             ,更新者                                              
008540             ,入力担当者コード                                    
008550             ,手形状態)                                           
008560       VALUES                                                     
008570           (  :Ｄ６４５−代表契約番号                             
008580             ,:Ｄ６４５−束数                                     
008590             ,:Ｄ６４５−連番                                     
008600             ,:Ｄ６４５−手形番号                                 
008610             ,:Ｄ６４５−期日                                     
008620             ,:Ｄ６４５−金額                                     
008630             ,:Ｄ６４５−振出人取引先コード                       
008640             ,:Ｄ６４５−振出人契約先コード                       
008650             ,:Ｄ６４５−振出人名称                               
008660             ,:Ｄ６４５−振出人名称カナ                           
008670             ,:Ｄ６４５−登録年月日                               
008680             ,:Ｄ６４５−登録時間                                 
008690             ,:Ｄ６４５−登録担当者                               
008700             ,:Ｄ６４５−更新年月日                               
008710             ,:Ｄ６４５−更新時間                                 
008720             ,:Ｄ６４５−更新者                                   
008730             ,:Ｄ６４５−入力担当者コード                         
008740             ,:Ｄ６４５−手形状態)                                
008750     END-EXEC.                                                    
008760*                                                                 
008770*----------------------------------------------------------------*
008780*    追加処理を確認  受取手形展開(D645UTT_TBL)                   *
008790*----------------------------------------------------------------*
008800     EVALUATE  SQLCODE                                            
008810        WHEN   定数−ＳＱＬＯＫ                                   
008820*--<       追加成功 >                                             
008830           COMPUTE  Ｗ−出力−件数２  =  Ｗ−出力−件数２  +  1   
008840        WHEN   OTHER                                              
008850*--<       追加処理エラー >                                       
008860           MOVE     -45               TO  Ｗ−エラーコード        
008870           PERFORM  エラー判定処理                                
008880     END-EVALUATE.                                                
008890*                                                                 
008900 出力処理−ＥＸＩＴ.                                              
008910     EXIT.                                                        
008920******************************************************************
008930*    終了処理                                                    *
008940******************************************************************
008950 終了処理                             SECTION.                    
008960 終了処理−ＳＴＡＲＴ.                                            
008970                                                                  
008980     CLOSE    入力ファイル.                                       
008990*                                                                 
009000     PERFORM  ＤＢクローズ処理.                                   
009010*                                                                 
009020     PERFORM  ＤＢコミット処理.                                   
009030*                                                                 
009040     PERFORM  終了メッセージ出力.                                 
009050*                                                                 
009060*--< プログラム正常終了 >                                         
009070     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
009080*                                                                 
009090 終了処理−ＥＸＩＴ.                                              
009100     EXIT.                                                        
009110******************************************************************
009120*    終了メッセージ出力                                          *
009130******************************************************************
009140 終了メッセージ出力                   SECTION.                    
009150 終了メッセージ出力−ＳＴＡＲＴ.                                  
009160*                                                                 
009170*----------------------------------------------------------------*
009180*    ファクタリング基本読込件数メッセージ出力処理                 
009190*----------------------------------------------------------------*
009200     INITIALIZE                       IF-CHOCO001.                
009210     MOVE  "3"                        TO  共１−イベント種別.     
009220     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009230     MOVE  "0"                        TO  共１−復帰コード.       
009240     MOVE  "LTRFCK"                   TO  共１−処理テーブルＩＤ. 
009250     MOVE  "COUNT"                    TO  共１−処理識別.         
009260     MOVE  Ｗ−入力−件数１           TO  共１−データ内容.       
009270     MOVE  "ファクタリング基本読込件数"                           
009280                                      TO  共１−その他メッセージ. 
009290     CALL  CLOCO001                USING  IF-CHOCO001.            
009300*----------------------------------------------------------------*
009310*    基準適用日読込件数メッセージ出力処理                         
009320*----------------------------------------------------------------*
009330     INITIALIZE                       IF-CHOCO001.                
009340     MOVE  "3"                        TO  共１−イベント種別.     
009350     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009360     MOVE  "0"                        TO  共１−復帰コード.       
009370     MOVE  "FFUISA01"                 TO  共１−処理テーブルＩＤ. 
009380     MOVE  "COUNT"                    TO  共１−処理識別.         
009390     MOVE  Ｗ−入力−件数２           TO  共１−データ内容.       
009400     MOVE  "基準適用日読込件数"       TO  共１−その他メッセージ. 
009410     CALL  CLOCO001                USING  IF-CHOCO001.            
009420*----------------------------------------------------------------*
009430*    受取手形出力件数メッセージ出力                               
009440*----------------------------------------------------------------*
009450     INITIALIZE                       IF-CHOCO001.                
009460     MOVE  "3"                        TO  共１−イベント種別.     
009470     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009480     MOVE  "0"                        TO  共１−復帰コード.       
009490     MOVE  "D642UTG"                  TO  共１−処理テーブルＩＤ. 
009500     MOVE  "COUNT"                    TO  共１−処理識別.         
009510     MOVE  Ｗ−出力−件数１            TO  共１−データ内容.      
009520     MOVE  "受取手形出力件数"         TO  共１−その他メッセージ. 
009530     CALL  CLOCO001                USING  IF-CHOCO001.            
009540*----------------------------------------------------------------*
009550*    受取手形展開出力件数メッセージ出力                           
009560*----------------------------------------------------------------*
009570     INITIALIZE                       IF-CHOCO001.                
009580     MOVE  "3"                        TO  共１−イベント種別.     
009590     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009600     MOVE  "0"                        TO  共１−復帰コード.       
009610     MOVE  "D645UTT"                  TO  共１−処理テーブルＩＤ. 
009620     MOVE  "COUNT"                    TO  共１−処理識別.         
009630     MOVE  Ｗ−出力−件数２            TO  共１−データ内容.      
009640     MOVE  "受取手形展開出力件数"     TO  共１−その他メッセージ. 
009650     CALL  CLOCO001                USING  IF-CHOCO001.            
009660*                                                                 
009670*----------------------------------------------------------------*
009680*    プログラム処理終了メッセージ                                 
009690*----------------------------------------------------------------*
009700     INITIALIZE                       IF-CHOCO001.                
009710     MOVE  "3"                        TO  共１−イベント種別.     
009720     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
009730     MOVE  "0"                        TO  共１−復帰コード.       
009740     MOVE  "END"                      TO  共１−処理識別.         
009750     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
009760     CALL  CLOCO001                USING  IF-CHOCO001.            
009770*                                                                 
009780 終了メッセージ出力−ＥＸＩＴ.                                    
009790     EXIT.                                                        
009800******************************************************************
009810*    ＤＢクローズ                                                *
009820******************************************************************
009830 ＤＢクローズ処理                     SECTION.                    
009840 ＤＢクローズ処理−ＳＴＡＲＴ.                                    
009850*                                                                 
009860*--< カーソル クローズ >                                          
009870     EXEC SQL                                                     
009880        CLOSE  CUR1                                               
009890     END-EXEC.                                                    
009900*                                                                 
009910 ＤＢクローズ処理−ＥＸＩＴ.                                      
009920     EXIT.                                                        
009930******************************************************************
009940*    ＤＢコミット処理                                            *
009950******************************************************************
009960 ＤＢコミット処理                     SECTION.                    
009970 ＤＢコミット処理−ＳＴＡＲＴ.                                    
009980*                                                                 
009990     EXEC  SQL                                                    
010000        COMMIT  WORK  RELEASE                                     
010010     END-EXEC.                                                    
010020*                                                                 
010030     INITIALIZE                       IF-CHOCO001.                
010040     MOVE  "3"                        TO  共１−イベント種別.     
010050     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
010060     MOVE  "0"                        TO  共１−復帰コード.       
010070     MOVE  "COMMIT"                   TO  共１−処理識別.         
010080     MOVE  "コミット実施"             TO  共１−その他メッセージ. 
010090     CALL  CLOCO001                USING  IF-CHOCO001.            
010100*                                                                 
010110 ＤＢコミット処理−ＥＸＩＴ.                                      
010120     EXIT.                                                        
010130******************************************************************
010140*    ＤＢロールバック処理                                        *
010150******************************************************************
010160 ＤＢロールバック処理                 SECTION.                    
010170 ＤＢロールバック処理−ＳＴＡＲＴ.                                
010180*                                                                 
010190     EXEC  SQL                                                    
010200        ROLLBACK WORK  RELEASE                                    
010210     END-EXEC.                                                    
010220*                                                                 
010230     INITIALIZE                       IF-CHOCO001.                
010240     MOVE  "1"                        TO  共１−イベント種別.     
010250     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
010260     MOVE  "9"                        TO  共１−復帰コード.       
010270     MOVE  "ROLLBACK"                 TO  共１−処理識別.         
010280     MOVE  "ロールバック実施"         TO  共１−その他メッセージ. 
010290     CALL  CLOCO001                USING  IF-CHOCO001.            
010300*                                                                 
010310 ＤＢロールバック処理−ＥＸＩＴ.                                  
010320     EXIT.                                                        
010330******************************************************************
010340*    エラー処理                                                  *
010350******************************************************************
010360 エラー判定処理                       SECTION.                    
010370 エラー判定処理−ＳＴＡＲＴ.                                      
010380*                                                                 
010390     MOVE  "Y"                        TO Ｗ−異常終了−フラグ.    
010400     INITIALIZE                           IF-CHOCO001.            
010410*                                                                 
010420     EVALUATE  Ｗ−エラーコード                                   
010430                                                                  
010440        WHEN  -10                                                 
010450*--<       ＯＲＡＣＬＥ接続失敗 >                                 
010460           MOVE  "1"                  TO  共１−イベント種別      
010470           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010480           MOVE  "9"                  TO  共１−復帰コード        
010490           MOVE  "CONNECT"            TO  共１−処理識別          
010500           MOVE  SQLCODE              TO  共１−データ内容        
010510           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010520           CALL  CLOCO001          USING  IF-CHOCO001             
010530*                                                                 
010540        WHEN  -20                                                 
010550*--<       結合テーブルカーソルオープン失敗 >                     
010560           MOVE  "1"                  TO  共１−イベント種別      
010570           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010580           MOVE  "9"                  TO  共１−復帰コード        
010590           MOVE  "LTRFCK"             TO  共１−処理テーブルＩＤ  
010600           MOVE  "OPEN"               TO  共１−処理識別          
010610           MOVE  SQLCODE              TO  共１−データ内容        
010620           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010630           CALL  CLOCO001          USING  IF-CHOCO001             
010640*                                                                 
010650        WHEN  -30                                                 
010660*--<       結合テーブル読込失敗 >                                 
010670           MOVE  "1"                  TO  共１−イベント種別      
010680           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010690           MOVE  "9"                  TO  共１−復帰コード        
010700           MOVE  "LTRFCK"             TO  共１−処理テーブルＩＤ  
010710           MOVE  "FETCH"              TO  共１−処理識別          
010720           MOVE  SQLCODE              TO  共１−データ内容        
010730           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010740           CALL  CLOCO001          USING  IF-CHOCO001             
010750*                                                                 
010760        WHEN  -40                                                 
010770*--<       受取手形(D642UTG_TBL)追加失敗 >                        
010780           MOVE  "1"                  TO  共１−イベント種別      
010790           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010800                                                                  
010810           MOVE  "9"                  TO  共１−復帰コード        
010820           MOVE  "D642UTG"            TO  共１−処理テーブルＩＤ  
010830           MOVE  "INSERT"             TO  共１−処理識別          
010840           MOVE  SQLCODE              TO  共１−データ内容        
010850           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010860           CALL  CLOCO001          USING  IF-CHOCO001             
010870                                                                  
010880        WHEN  -45                                                 
010890                                                                  
010900*--<    受取手形展開(D645UTT_TBL)追加失敗 >                       
010910                                                                  
010920           MOVE  "1"                  TO  共１−イベント種別      
010930           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
010940           MOVE  "9"                  TO  共１−復帰コード        
010950           MOVE  "D645UTG"            TO  共１−処理テーブルＩＤ  
010960           MOVE  "INSERT"             TO  共１−処理識別          
010970           MOVE  SQLCODE              TO  共１−データ内容        
010980           MOVE  SQLERRMC             TO  共１−その他メッセージ  
010990           CALL  CLOCO001          USING  IF-CHOCO001             
011000                                                                  
011010        WHEN  -50                                                 
011020*--<       新取引先コード和枝番抽出処理 >                         
011030           MOVE  "2"                  TO  共１−イベント種別      
011040           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011050           MOVE  "9"                  TO  共１−復帰コード        
011060           MOVE  "IKO001"             TO  共１−処理テーブルＩＤ  
011070           MOVE  "SELECT"             TO  共１−処理識別          
011080           MOVE  SQLCODE              TO  共１−データ内容        
011090           MOVE  SQLERRMC             TO  共１−その他メッセージ  
011100           CALL  CLOCO001          USING  IF-CHOCO001             
011110           MOVE  "N"                  TO  Ｗ−異常終了−フラグ    
011120                                                                  
011130        WHEN  -60                                                 
011140*--<       振出人取引先コード和振出人契約先コード >               
011150           MOVE  "1"                  TO  共１−イベント種別      
011160           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011170           MOVE  "9"                  TO  共１−復帰コード        
011180           MOVE  "IKO001"             TO  共１−処理テーブルＩＤ  
011190           MOVE  "SELECT"             TO  共１−処理識別          
011200           MOVE  SQLCODE              TO  共１−データ内容        
011210           MOVE  SQLERRMC             TO  共１−その他メッセージ  
011220           CALL  CLOCO001          USING  IF-CHOCO001             
011230           MOVE  "N"                  TO  Ｗ−異常終了−フラグ    
011240                                                                  
011250	         WHEN  -70                                              
011260*--<       基準適用日ファイルオープンエラー >                     
011270           MOVE  "1"                  TO  共１−イベント種別      
011280           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011290           MOVE  "9"                  TO  共１−復帰コード        
011300           MOVE  "CISPF001"           TO  共１−処理テーブルＩＤ  
011310           MOVE  "OPEN"               TO  共１−処理識別          
011320           MOVE  Ｗ−状態             TO  共１−データ内容        
011330           MOVE  "基準適用日ファイルオープンエラー"               
011340                                      TO  共１−その他メッセージ  
011350           CALL  CLOCO001          USING  IF-CHOCO001             
011360                                                                  
011370        WHEN  -80                                                 
011380*--<       基準日読み込みファイルエラー >                         
011390           MOVE  "1"                  TO  共１−イベント種別      
011400           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
011410           MOVE  "9"                  TO  共１−復帰コード        
011420           MOVE  "CISPF001"           TO  共１−処理テーブルＩＤ  
011430           MOVE  "READ"               TO  共１−処理識別          
011440           MOVE  Ｗ−状態             TO  共１−データ内容        
011450           MOVE  "基準日ファイル読み込みエラー"                   
011460                                      TO  共１−その他メッセージ  
011470           CALL  CLOCO001          USING  IF-CHOCO001             
011480           MOVE  "N"                  TO  Ｗ−異常終了−フラグ    
011490                                                                  
011500*                                                                 
011510        WHEN  OTHER                                               
011520           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
011530     END-EVALUATE.                                                
011540*                                                                 
011550     IF Ｗ−異常終了−フラグ  =  "Y"                              
011560        PERFORM  ＤＢロールバック処理                             
011570*                                                                 
011580        PERFORM  終了メッセージ出力                               
011590*                                                                 
011600*--<    プログラム異常終了のリターンコード >                      
011610        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
011620*                                                                 
011630        EXIT  PROGRAM                                             
011640     END-IF.                                                      
011650*                                                                 
011660 エラー判定処理−ＥＸＩＴ.                                        
011670     EXIT.                                                        
011680******************************************************************
011690*                  END OF PROGRAM                                *
011700******************************************************************
