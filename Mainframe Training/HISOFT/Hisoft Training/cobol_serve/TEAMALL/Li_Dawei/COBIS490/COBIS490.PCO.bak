000010******************************************************************
000020*         CP(A)                                     *
000030*      1. vO    F_񔄊|׈ڍs                 *
000040*      2. vOID    FCOBIS490                             *
000050*      3. Tv        Frtllhst@N^Oca A*
000060*                           _񔄊|׃e[u쐬B *
000070*      4. 쐬          F                               *
000080*      5. 쐬          F2005.03.31                           *
000090******************************************************************
000100*                                                                 
000110******************************************************************
000120*    cdmshehb`shnm  chuhrhnm                *
000130******************************************************************
000140 IDENTIFICATION                       DIVISION.                   
000150*                                                                 
000160 PROGRAM-ID.                          COBIS490.                   
000170******************************************************************
000180*    dmuhqnmldms        chuhrhnm              *
000190******************************************************************
000200 ENVIRONMENT                          DIVISION.                   
000210******************************************************************
000220*    c`s`                      chuhrhnm              *
000230******************************************************************
000240 DATA                                 DIVISION.                   
000250******************************************************************
000260*  vnqjhmf|rsnq`fd  rdbshnm                *
000270******************************************************************
000280 WORKING-STORAGE                      SECTION.                    
000290*----------------------------------------------------------------*
000300*    zXgϐ`GA                                        *
000310*----------------------------------------------------------------*
000320     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000330*                                                                 
000340 01  vr|N                   PIC  9(10) VALUE ZERO.      
000350 01  vr|Г敪               PIC  X(01) VALUE ZERO.      
000360 01  vr|                   PIC  X(10) VALUE ZERO.      
000370 01  vr|敪           PIC  X(01) VALUE ZERO.      
000380*                                                                 
000390*--< nq`bkdʕϐ >                                       
000400     EXEC  SQL  INCLUDE  SQLCOM.CBL             END-EXEC.         
000410*                                                                 
000420*--< nq`bkd rpks (SQLCA) >                        
000430     EXEC  SQL  INCLUDE  SQLCA.COB              END-EXEC.         
000440*                                                                 
000450*--< SUMMIŢݸޔ| >                                     
000460     EXEC  SQL  INCLUDE  LTRFCU.CBL             END-EXEC.         
000470*                                                                 
000480*--< SUMMIŢݸފ{ >                                     
000490     EXEC  SQL  INCLUDE  LTRFCK.CBL             END-EXEC.         
000500*                                                                 
000510*--< _񔄊|ׂca >                                       
000520     EXEC  SQL  INCLUDE  D414USM.CBL            END-EXEC.         
000530*                                                                 
000540*--< ϊe[u >                                               
000550     EXEC  SQL  INCLUDE  IKOTBL001.CBL          END-EXEC.         
000560*                                                                 
000570     EXEC  SQL  END      DECLARE      SECTION   END-EXEC.         
000580*----------------------------------------------------------------*
000590*    Ɨ̈`                                                *
000600*----------------------------------------------------------------*
000610 01  vnqj|GA.                                            
000620*                                                                 
000630*--< G[R[h >                                               
000640     03  v|G[R[h             PIC S9(02).                 
000650*                                                                 
000660*--< GA >                                                 
000670     03  GA.                                              
000680        05  v|́|            PIC  9(09).                 
000690        05  v|ó|            PIC  9(09).                 
000700*                                                                 
000710*--< tOAA >                                               
000720     03  tO|GA.                                          
000730        05  v|I|tO          PIC  X(01).                 
000740        05  v|ُI|tO      PIC  X(01).                 
000750*                                                                 
000760*--< L[GA >                                                 
000770     03  v|L[GA.                                          
000780         05  mdvL[.                                          
000790            07  m|_ԍ          PIC  X(10).                 
000800            07  m|הԍ          PIC  9(03).                 
000810         05  nkcL[.                                          
000820            07  n|_ԍ          PIC  X(10).                 
000830            07  n|הԍ          PIC  9(03).                 
000840*                                                                 
000850*----------------------------------------------------------------*
000860*   Ԓ`                                                 *
000870*----------------------------------------------------------------*
000880*--< ʏ >                                                   
000890 01  v|ʏ.                                                
000900     03  v|VXet.                                        
000910         05  v|I                 PIC  X(02) VALUE  "20".     
000920         05  v|N               PIC  X(06).                 
000930     03  v|VXe             PIC  X(08).                 
000940     03  v|S                   PIC  X(08) VALUE "IKPO    ".
000950*----------------------------------------------------------------*
000960*    Tu[`                                              *
000970*----------------------------------------------------------------*
000980 01  CALL-AREA.                                                   
000990*--< ʃOTu[` >                                       
001000     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001010     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001020*----------------------------------------------------------------*
001030*    bnoẍ                                                *
001040*----------------------------------------------------------------*
001050*--< ʃOpp[^ >                                       
001060 01  IF-CHOCO001.                                                 
001070     COPY  CHOCO001  REPLACING  ==()==  BY  ==P|==.           
001080*                                                                 
001090*----------------------------------------------------------------*
001100*    hmht@CǍTu[`pp^̈                *
001110*----------------------------------------------------------------*
001120 01  PARA-AREA.                                                   
001130     COPY CPBCO001.                                               
001140******************************************************************
001150*    萔pf[^`GA                                      *
001160******************************************************************
001170 CONSTANT                             SECTION.                    
001180 01  萔̈.                                                    
001190     03  萔|vOhc         PIC  X(08) VALUE "COBIS490".
001200     03  萔|vO           PIC  X(80) VALUE            
001210                                       "_񔄊|׈ڍs".    
001220     03  萔|rpknj             PIC  9(04) VALUE  0000.     
001230     03  萔|rpkdmc           PIC  9(04) VALUE  0100.     
001240     03  萔|               PIC  9(04) VALUE  ZERO.     
001250     03  萔|ُ               PIC  9(04) VALUE  0009.     
001260******************************************************************
001270*    oqnbdctqd            chuhrhnm              *
001280******************************************************************
001290 PROCEDURE                            DIVISION.                   
001300*                                                                 
001310     PERFORM  .                                           
001320*                                                                 
001330     PERFORM  又  UNTIL  v|I|tO  =  "Y".            
001340*                                                                 
001350     PERFORM  I.                                           
001360*                                                                 
001370     STOP RUN.                                                    
001380*                                                                 
001390******************************************************************
001400*                                                        *
001410******************************************************************
001420                              SECTION.                    
001430 |rs`qs.                                            
001440*                                                                 
001450*----------------------------------------------------------------*
001460*     JnbZ[Wo                                         *
001470*----------------------------------------------------------------*
001480     INITIALIZE                       IF-CHOCO001.                
001490     MOVE  "3"                        TO  P|Cxg.     
001500     MOVE  萔|vOhc       TO  P|\[Xhc.       
001510     MOVE  "0"                        TO  P|AR[h.       
001520     MOVE  "START"                    TO  P|.         
001530     MOVE  萔|vO         TO  P|̑bZ[W. 
001540     CALL  CLOCO001                USING  IF-CHOCO001.            
001550*                                                                 
001560*----------------------------------------------------------------*
001570*    Ɨ̈̏lݒ                                        *
001580*----------------------------------------------------------------*
001590     MOVE  SPACE                      TO  vnqj|GA.       
001600     INITIALIZE                           vnqj|GA.       
001610*                                                                 
001620*--< bott擾 >                                           
001630     ACCEPT  v|N               FROM  DATE.                 
001640*                                                                 
001650*--< bot擾 >                                           
001660     ACCEPT  v|VXe         FROM  TIME.                 
001670*----------------------------------------------------------------*
001680*    nq`bkdڑ                                            *
001690*----------------------------------------------------------------*
001700     PERFORM  nq`bkdڑ.                                   
001710*----------------------------------------------------------------*
001720*    e[uJ[\`                                    *
001730*----------------------------------------------------------------*
001740     PERFORM   e[uJ[\`                           
001750*----------------------------------------------------------------*
001760*    e[uJ[\Ǎ(P)                            *
001770*----------------------------------------------------------------*
001780     PERFORM  e[uJ[\Ǎ.                           
001790*----------------------------------------------------------------*
001800  |dwhs.                                             
001810     EXIT.                                                        
001820******************************************************************
001830*    nq`bkdڑ                                            *
001840******************************************************************
001850 nq`bkdڑ                     SECTION.                    
001860 nq`bkdڑ|rs`qs.                                    
001870*                                                                 
001880*--< hmht@CǍTu[`Ăяo >                     
001890     CALL  COBCO001                USING  PARA-AREA.              
001900*                                                                 
001910     MOVE  PARA-DBSTRING              TO  DB-STRING.              
001920     MOVE  PARA-USERNAME              TO  USERNAME.               
001930     MOVE  PARA-PASSWORD              TO  PASSWD.                 
001940*                                                                 
001950*----------------------------------------------------------------*
001960*    Jnڑ                                                    *
001970*----------------------------------------------------------------*
001980     IF  DB-STRING  =  SPACE                                      
001990        EXEC  SQL                                                 
002000           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
002010        END-EXEC                                                  
002020     ELSE                                                         
002030        EXEC  SQL                                                 
002040           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
002050             USING  :DB-STRING                                    
002060        END-EXEC                                                  
002070     END-IF.                                                      
002080*                                                                 
002090*----------------------------------------------------------------*
002100*    ڑԔ                                                *
002110*----------------------------------------------------------------*
002120     EVALUATE  SQLCODE                                            
002130        WHEN  萔|rpknj                                    
002140*--<       ڑ >                                             
002150           CONTINUE                                               
002160        WHEN  OTHER                                               
002170*--<       ڑG[ >                                           
002180           MOVE     -1                TO  v|G[R[h        
002190           PERFORM  G[                                    
002200     END-EVALUATE.                                                
002210*                                                                 
002220 nq`bkdڑ|dwhs.                                      
002230     EXIT.                                                        
002240******************************************************************
002250*    e[uJ[\`                                    *
002260******************************************************************
002270*                                                                 
002280 e[uJ[\`             SECTION.                    
002290 e[uJ[\`|rs`qs.                            
002300*--< e[uJ[\`  >                                  
002310     EXEC SQL                                                     
002320        DECLARE CUR1 CURSOR FOR                                   
002330         SELECT  LTRFCU._ԍ                                  
002340		      ,LTRFCK.zʋz                                  
002350		      ,LTRFCK.                                      
002360		      ,LTRFCU.                                  
002370		      ,LTRFCU.ԓ                                  
002380		      ,LTRFCU.                                    
002390		      ,LTRFCU.                                    
002400		      ,LTRFCU.萔                                
002410		      ,LTRFCU.萔œz                      
002420		      ,LTRFCU.z                                  
002430		      ,LTRFCK.Г                                  
002440		      ,LTRFCK.ev                                    
002450		      ,LTRFCK.Г                                  
002460		      ,LTRFCK.ev                                    
002470		      ,LTRFCU.Oٓ                              
002480           FROM  LTRFCK                                           
002490                ,LTRFCU                                           
002500          WHERE  LTRFCU._ԍ = LTRFCK._ԍ                
002510     END-EXEC.                                                    
002520*                                                                 
002530*----------------------------------------------------------------*
002540*    J[\nodm                                        *
002550*----------------------------------------------------------------*
002560     EXEC  SQL                                                    
002570        OPEN  CUR1                                                
002580     END-EXEC.                                                    
002590*----------------------------------------------------------------*
002600*    J[\I[vmF                                        *
002610*----------------------------------------------------------------*
002620     EVALUATE  SQLCODE                                            
002630        WHEN  萔|rpknj                                    
002640*--<        >                                                 
002650           CONTINUE                                               
002660        WHEN  OTHER                                               
002670*--<       J[\I[vG[ >                               
002680           MOVE     -2                TO  v|G[R[h        
002690           PERFORM  G[                                    
002700     END-EVALUATE.                                                
002710*                                                                 
002720 e[uJ[\`|dwhs.                              
002730     EXIT.                                                        
002740******************************************************************
002750*    e[uJ[\Ǎ                                    *
002760******************************************************************
002770 e[uJ[\Ǎ             SECTION.                    
002780 e[uJ[\Ǎ|rs`qs.                            
002790*                                                                 
002800     EXEC  SQL                                                    
002810        FETCH  CUR1                                               
002820           INTO  :ksqebt|_ԍ                          
002830                ,:ksqebj|zʋz                          
002840		      ,:ksqebj|                              
002850		      ,:ksqebt|                          
002860		      ,:ksqebt|ԓ                          
002870		      ,:ksqebt|                            
002880		      ,:ksqebt|                            
002890		      ,:ksqebt|萔                        
002900		      ,:ksqebt|萔œz              
002910		      ,:ksqebt|z                          
002920		      ,:ksqebj|Г                          
002930		      ,:ksqebj|ev                            
002940		      ,:ksqebj|ev                            
002950		      ,:ksqebt|Oٓ                      
002960     END-EXEC.                                                    
002970*----------------------------------------------------------------*
002980*    e[uJ[\ǍG[                              *
002990*----------------------------------------------------------------*
003000     EVALUATE   SQLCODE                                           
003010        WHEN   萔|rpknj                                   
003020*--<        >                                                 
003070           COMPUTE  v|́|    =  v|́|  +  1     
003080        WHEN   萔|rpkdmc                                 
003090*--<       ǍI >                                             
003100           MOVE  "Y"                  TO  v|I|tO        
003110        WHEN   OTHER                                              
003120*--<       ǍG[ >                                           
003130           MOVE     -3                TO  v|G[R[h        
003140           PERFORM  G[                                    
003150     END-EVALUATE.                                                
003160*                                                                 
003170 e[uJ[\Ǎ|dwhs.                              
003180     EXIT.                                                        
003190*                                                                 
003200******************************************************************
003210*    又                                                      *
003220******************************************************************
003230 又                               SECTION.                    
003240 又|rs`qs.                                              
003250*----------------------------------------------------------------*
003260*--<  ҏWo͏ >                                             *
003270*---------------------------------------------------------------- 
003280        PERFORM  ҏW                                         
003290        PERFORM  o͏                                         
003300*                                                                 
003310*--< e[uJ[\ǍiQڈȍ~j >                     
003320     PERFORM  e[uJ[\Ǎ.                           
003330*                                                                 
003340 又|dwhs.                                                
003350     EXIT.                                                        
003360******************************************************************
003370*    ϊP                                                  *
003380******************************************************************
003390 ϊP                           SECTION.                    
003400 ϊP|rs`qs.                                          
003410*                                                                 
003420     EXEC  SQL                                                    
003430           SELECT  VR[h                                 
003440             INTO :hjnOOP|VR[h                   
003450             FROM  IKOTBL001                                      
003460                  ,LTRFCK                                         
003470            WHERE  LTRFCK.[U[R[h                          
003480                                      =                           
003490                                       :hjnOOP|[UR[h
003500              AND  IKOTBL001.ړIbc = '2'                       
003510     END-EXEC.                                                    
003520*                                                                 
003530*----------------------------------------------------------------*
003540*    ϊPmF                                              *
003550*----------------------------------------------------------------*
003560     EVALUATE  SQLCODE                                            
003570        WHEN  萔|rpknj                                    
003580*--<        >                                                 
003590           CONTINUE                                               
003600        WHEN  OTHER                                               
003610*--<       ϊPG[ >                                     
003620           MOVE     SPACE             TO                          
003630                                      hjnOOP|VR[h
003640     END-EVALUATE.                                                
003650*                                                                 
003660  ϊP|dwhs.                                           
003670     EXIT.                                                        
003680*                                                                 
003690******************************************************************
003700*    ϊQ                                                  *
003710******************************************************************
003720 ϊQ                           SECTION.                    
003730 ϊQ|rs`qs.                                          
003740*                                                                 
003750     EXEC  SQL                                                    
003760           SELECT  }                                           
003770             INTO :hjnOOP|}                             
003780             FROM  LTRFCK                                         
003790                  ,IKOTBL001                                      
003800            WHERE  LTRFCK.[U[R[h =                        
003810                                       :hjnOOP|[UR[h
003820              AND  IKOTBL001.ړIbc    = '2'                    
003830     END-EXEC.                                                    
003840*                                                                 
003850*----------------------------------------------------------------*
003860*    ϊQmF                                              *
003870*----------------------------------------------------------------*
003880     EVALUATE  SQLCODE                                            
003890        WHEN  萔|rpknj                                    
003900*--<        >                                                 
003910           CONTINUE                                               
003920        WHEN  OTHER                                               
003930*--<       ϊQG[ >                                     
003940           MOVE     SPACE             TO  hjnOOP|}      
003950     END-EVALUATE.                                                
003960*                                                                 
003970 ϊQ|dwhs.                                            
003980     EXIT.                                                        
003990*                                                                 
004000******************************************************************
004010*    ϊR                                                  *
004020******************************************************************
004030 ϊR                           SECTION.                    
004040 ϊR|rs`qs.                                          
004050*                                                                 
004060     EXEC  SQL                                                    
004070           SELECT  }                                           
004080             INTO :hjnOOP|}                             
004090             FROM  LTRFCK                                         
004100                  ,IKOTBL001                                      
004110            WHERE  LTRFCK.R[h =                          
004120                                       :hjnOOP|R[h
004130              AND  IKOTBL001.ړIbc  = '3'                      
004140     END-EXEC.                                                    
004150*                                                                 
004160*----------------------------------------------------------------*
004170*    ϊRmF                                              *
004180*----------------------------------------------------------------*
004190     EVALUATE  SQLCODE                                            
004200        WHEN  萔|rpknj                                    
004210*--<        >                                                 
004220           CONTINUE                                               
004230        WHEN  OTHER                                               
004240*--<       ϊRG[ >                                     
004250           MOVE     SPACE             TO  hjnOOP|}      
004260     END-EVALUATE.                                                
004270 ϊR|dwhs.                                            
004280      EXIT.                                                       
004290*                                                                 
004300******************************************************************
004310*     ҏW                                                   *
004320******************************************************************
004330 ҏW                             SECTION.                    
004340 ҏW|rs`qs.                                            
004350*                                                                 
004360*----------------------------------------------------------------*
004370*                                                      *
004380*----------------------------------------------------------------*
004390        MOVE  SPACE                   TO  _񔄊|.       
004400        INITIALIZE                        _񔄊|.       
004410*                                                                 
004420*----------------------------------------------------------------*
004430*       ڕҏW                                             *
004440*----------------------------------------------------------------*
004450*--<    No.01 >                                                   
004460        MOVE  ksqebt|_ԍ  TO  cSPS|_ԍ.     
004470*--<    No.02 >                                                   
004480        MOVE  v|ó|          TO  cSPS|הԍ.     
004490*--<    No.03 >                                                   
004500        PERFORM ϊP.                                       
004510        MOVE   hjnOOP|VR[h                       
004520                                      TO  cSPS|R[h. 
004530*--<    No.04 >                                                   
004540        PERFORM ϊQ.                                       
004550        MOVE  hjnOOP|}      TO  cSPS|_R[h. 
004560*--<    No.05 >                                                   
004570	      MOVE  ksqebj|zʋz  TO  cSPS|zʋz.     
004580*--<    No.06 >		                                        
004590        MOVE  ksqebj|      TO  cSPS|.         
004600*--<    No.07 >		                                        
004610	      MOVE  ksqebt|  TO  cSPS|.     
004620*--<    No.08 >		                                        
004630	      MOVE  ksqebt|ԓ  TO  cSPS|.         
004640*--<    No.09 >	                                                
004650	      MOVE  ksqebt|    TO  cSPS|.       
004660*--<    No.10 >		                                        
004670	      MOVE  ksqebt|    TO  cSPS|.       
004680*--<    No.11 >		                                        
004690	      MOVE  ksqebt|萔                            
004700                                      TO  cSPS|旧萔. 
004710*--<    No.12 >	       	                                        
004720	      MOVE  ksqebt|萔œz                  
004730                                      TO                          
004740                                  cSPS|旧萔Ŋz. 
004750*--<    No.13 >		                                        
004760	      MOVE  ksqebt|z  TO  cSPS|z.   
004770*--<    No.14 >		                                        
004780	      MOVE  vr|Г敪      TO  cSPS|Г敪. 
004790*--<    No.15 >		                                        
004800	      MOVE  ksqebj|Г  TO  cSPS|Г.     
004810*--<    No.16 >	                                                
004820	      MOVE  vr|N          TO  cSPS|N.     
004830*--<    No.17 >		                                        
004840	      MOVE  ksqebj|ev    TO  cSPS|e.         
004850*--<    No.18 >                                                   
004860        PERFORM ϊR.                                       
004870	      MOVE  hjnOOP|}      TO  cSPS|R[h. 
004880*--<    No.19 >		                                        
004890        MOVE  ksqebj|Г  TO                          
004900                                        cSPS|Г|. 
004910*--<    No.20 >		                                        
004920	      MOVE  ksqebj|ev    TO  cSPS|e|.   
004930*--<    No.21 >		                                        
004940	      MOVE  ksqebt|Oٓ                          
004950                                      TO  cSPS|Oϓ. 
004960*--<    No.22 >		                                        
004970	      MOVE  vr|          TO  cSPS|.     
004980*--<    No.23 >		                                        
004990	      MOVE  vr|敪  TO                          
005000                                      cSPS|敪. 
005010*--<    No.24 >	                                                
005020	      MOVE   v|VXet       TO  cSPS|XVN.   
005030*--<    No.25 >	       	                                        
005040	      MOVE   v|VXe       TO  cSPS|XV.     
005050*--<    No.26 >	                                                
005060	      MOVE   v|S             TO  cSPS|XV.       
005070*--<    No.27 >	 	                                        
005080	      MOVE   v|S             TO                          
005090                                      cSPS|͒S҃R[h. 
005100*--<    No.28 >		                                        
005110	      MOVE   v|VXet       TO  cSPS|o^N.   
005120*--<    No.29 >		                                        
005130	      MOVE   v|VXe       TO  cSPS|o^.     
005140*--<    No.30 >		                                        
005150	      MOVE   v|S             TO  cSPS|o^S.   
005160*                                                                 
005170        MOVE mdvL[               TO  nkcL[.             
005180*                                                                 
005190 ҏWo͏|dwhs.                                          
005200     EXIT.                                                        
005210******************************************************************
005220*    o͏                                                    *
005230******************************************************************
005240 o͏                             SECTION.                    
005250 o͏|rs`qs.                                            
005260*                                                                 
005270       EXEC  SQL                                                  
005280        INSERT  INTO  D414USM_TBL                                 
005290           ( _ԍ                                             
005300            ,הԍ                                             
005310            ,R[h                                         
005320            ,_R[h                                         
005330            ,zʋz                                             
005340            ,                                                 
005350            ,                                             
005360            ,                                                 
005370            ,                                               
005380            ,                                               
005390            ,旧萔                                         
005400		  ,旧萔Ŋz                                 
005410		  ,z                                           
005420		  ,Г敪                                         
005430		  ,Г                                             
005440		  ,N                                             
005450		  ,e                                                 
005460		  ,R[h                                         
005470		  ,Г_                                        
005480		  ,e_                                            
005490		  ,Oϓ                                         
005500		  ,                                             
005510		  ,敪                                     
005520            ,XVN                                           
005530            ,XV                                             
005540            ,XV                                               
005550            ,͒S҃R[h                                     
005560            ,o^N                                           
005570            ,o^                                             
005580            ,o^S)                                          
005590       VALUES                                                     
005600           ( :cSPS|_ԍ                                  
005610            ,:cSPS|הԍ                                  
005620            ,:cSPS|R[h                              
005630            ,:cSPS|_R[h                              
005640            ,:cSPS|zʋz                                  
005650		  ,:cSPS|                                      
005660		  ,:cSPS|                                  
005670		  ,:cSPS|                                      
005680		  ,:cSPS|                                    
005690		  ,:cSPS|                                    
005700		  ,:cSPS|旧萔                              
005710		  ,:cSPS|旧萔Ŋz                      
005720		  ,:cSPS|z                                
005730		  ,:cSPS|Г敪                              
005740		  ,:cSPS|Г                                  
005750		  ,:cSPS|N                                  
005760		  ,:cSPS|e                                      
005770		  ,:cSPS|R[h                              
005780		  ,:cSPS|Г|                            
005790		  ,:cSPS|e|                                
005800		  ,:cSPS|Oϓ                              
005810		  ,:cSPS|                                  
005820		  ,:cSPS|敪                          
005830		  ,:cSPS|XVN                                
005840		  ,:cSPS|XV                                  
005850		  ,:cSPS|XV                                    
005860		  ,:cSPS|͒S҃R[h                          
005870		  ,:cSPS|o^N                                
005880		  ,:cSPS|o^                                  
005890            ,:cSPS|o^S)                               
005900     END-EXEC.                                                    
005910*                                                                 
005920*----------------------------------------------------------------*
005930*    ǉmF                                              *
005940*----------------------------------------------------------------*
005950     EVALUATE  SQLCODE                                            
005960        WHEN   萔|rpknj                                   
005970*--<       ǉ >                                             
005980           COMPUTE  v|ó|  =  v|ó|  +  1       
005990        WHEN   OTHER                                              
006000*--<       ǉG[ >                                       
006010           MOVE     -4                TO  v|G[R[h        
006020           PERFORM  G[                                    
006030     END-EVALUATE.                                                
006040*                                                                 
006050 o͏|dwhs.                                              
006060     EXIT.                                                        
006070*                                                                 
006080******************************************************************
006090*    I                                                    *
006100******************************************************************
006110 I                             SECTION.                    
006120 I|rs`qs.                                            
006130*                                                                 
006140*----------------------------------------------------------------*
006150*    caN[Y                                            *
006160*----------------------------------------------------------------*
006170     PERFORM caN[Y.                                    
006180*----------------------------------------------------------------*
006190*    caR~bg                                             
006200*----------------------------------------------------------------*
006210     PERFORM  caR~bg                                    
006220*----------------------------------------------------------------*
006230*    bZ[Wo͏                                      *
006240*----------------------------------------------------------------*
006250     PERFORM  bZ[Wo.                                 
006260*----------------------------------------------------------------*
006270*    IbZ[Wo͏                                      *
006280*----------------------------------------------------------------*
006290     PERFORM  IbZ[Wo.                                 
006300*                                                                 
006310*--< vOI >                                         
006320     MOVE  萔|             TO  PROGRAM-STATUS.         
006330*                                                                 
006340 I|dwhs.                                              
006350     EXIT.                                                        
006360******************************************************************
006370*    bZ[Wo͏                                      *
006380******************************************************************
006390 bZ[Wo                   SECTION.                    
006400 bZ[Wó|rs`qs.                                  
006410*                                                                 
006420     INITIALIZE                       IF-CHOCO001.                
006430     MOVE  "3"                        TO  P|Cxg.     
006440     MOVE  萔|vOhc       TO  P|\[Xhc.       
006450     MOVE  "0"                        TO  P|AR[h.       
006460     MOVE  "LTRFCU"                   TO  P|e[uhc. 
006470     MOVE  "COUNT"                    TO  P|.         
006480     MOVE  v|́|             TO  P|f[^e.       
006490     MOVE  "SUMMIŢݸޔ|Ǎ"                       
006500                                      TO  P|̑bZ[W. 
006510     CALL  CLOCO001                USING  IF-CHOCO001.            
006520*                                                                 
006530     INITIALIZE                       IF-CHOCO001.                
006540     MOVE  "3"                        TO  P|Cxg.     
006550     MOVE  萔|vOhc       TO  P|\[Xhc.       
006560     MOVE  "0"                        TO  P|AR[h.       
006570     MOVE  "D414USM"                  TO  P|e[uhc. 
006580     MOVE  "COUNT"                    TO  P|.         
006590     MOVE  v|ó|             TO  P|f[^e.       
006600     MOVE  "_񔄊|דo^"                             
006610                                      TO  P|̑bZ[W. 
006620     CALL  CLOCO001                USING  IF-CHOCO001.            
006630*                                                                 
006640 bZ[Wó|dwhs.                                    
006650     EXIT.                                                        
006660*                                                                 
006670******************************************************************
006680*    IbZ[Wo͏                                      *
006690******************************************************************
006700 IbZ[Wo                   SECTION.                    
006710 IbZ[Wó|rs`qs.                                  
006720*                                                                 
006730     INITIALIZE                       IF-CHOCO001.                
006740     MOVE  "3"                        TO  P|Cxg.     
006750     MOVE  萔|vOhc       TO  P|\[Xhc.       
006760     MOVE  "0"                        TO  P|AR[h.       
006770     MOVE  "END"                      TO  P|.         
006780     MOVE  萔|vO         TO  P|̑bZ[W. 
006790     CALL  CLOCO001                USING  IF-CHOCO001.            
006800*                                                                 
006810 IbZ[Wó|dwhs.                                    
006820     EXIT.                                                        
006830*                                                                 
006840******************************************************************
006850*    caN[Y                                                *
006860******************************************************************
006870 caN[Y                     SECTION.                    
006880 caN[Y|rs`qs.                                    
006890*                                                                 
006900*--< J[\ N[Y >                                          
006910     EXEC SQL                                                     
006920        CLOSE  CUR1                                               
006930     END-EXEC.                                                    
006940*                                                                 
006950 caN[Y|dwhs.                                      
006960     EXIT.                                                        
006970******************************************************************
006980*    caR~bg                                            *
006990******************************************************************
007000 caR~bg                     SECTION.                    
007010 caR~bg|rs`qs.                                    
007020*                                                                 
007030     EXEC  SQL                                                    
007040        COMMIT  WORK  RELEASE                                     
007050     END-EXEC.                                                    
007060*                                                                 
007070     INITIALIZE                       IF-CHOCO001.                
007080     MOVE  "3"                        TO  P|Cxg.     
007090     MOVE  萔|vOhc       TO  P|\[Xhc.       
007100     MOVE  "0"                        TO  P|AR[h.       
007110     MOVE  "COMMIT"                   TO  P|.         
007120     MOVE  "R~bg{"             TO  P|̑bZ[W. 
007130     CALL  CLOCO001                USING  IF-CHOCO001.            
007140*                                                                 
007150 caR~bg|dwhs.                                      
007160     EXIT.                                                        
007170******************************************************************
007180*    ca[obN                                        *
007190******************************************************************
007200 ca[obN                 SECTION.                    
007210 ca[obN|rs`qs.                                
007220*                                                                 
007230     EXEC  SQL                                                    
007240        ROLLBACK WORK  RELEASE                                    
007250     END-EXEC.                                                    
007260*                                                                 
007270     INITIALIZE                       IF-CHOCO001.                
007280     MOVE  "1"                        TO  P|Cxg.     
007290     MOVE  萔|vOhc       TO  P|\[Xhc.       
007300     MOVE  "9"                        TO  P|AR[h.       
007310     MOVE  "ROLLBACK"                 TO  P|.         
007320     MOVE  "[obN{"         TO  P|̑bZ[W. 
007330     CALL  CLOCO001                USING  IF-CHOCO001.            
007340*                                                                 
007350 ca[obN|dwhs.                                  
007360     EXIT.                                                        
007370
007380******************************************************************
007390*    G[                                                  *
007400******************************************************************
007410 G[                           SECTION.                    
007420 G[|rs`qs.                                          
007430*                                                                 
007440     MOVE  "Y"                        TO  v|ُI|tO.   
007450     INITIALIZE                       IF-CHOCO001.                
007460*                                                                 
007470     EVALUATE  v|G[R[h                                   
007480        WHEN  -1                                                  
007490*--<       nq`bkdڑs >                                 
007500           MOVE  "1"                  TO  P|Cxg      
007510           MOVE  萔|vOhc TO  P|\[Xhc        
007520           MOVE  "9"                  TO  P|AR[h        
007530           MOVE  "CONNECT"            TO  P|          
007540           MOVE  SQLCODE              TO  P|f[^e        
007550           MOVE  SQLERRMC             TO  P|̑bZ[W  
007560           CALL  CLOCO001          USING  IF-CHOCO001             
007570*                                                                 
007580        WHEN  -2                                                  
007590*--<       J[\I[vG[  >                              
007600           MOVE  "1"                  TO  P|Cxg      
007610           MOVE  萔|vOhc TO  P|\[Xhc        
007620           MOVE  "9"                  TO  P|AR[h        
007630           MOVE  "LTRFCU"             TO  P|e[uhc  
007640           MOVE  "OPEN"               TO  P|          
007650           MOVE  SQLCODE              TO  P|f[^e        
007660           MOVE  SQLERRMC             TO  P|̑bZ[W  
007670           CALL  CLOCO001          USING  IF-CHOCO001             
007680*                                                                 
007690        WHEN  -3                                                  
007700*--<       e[uJ[\ǍG[ >                       
007710           MOVE  "1"                  TO  P|Cxg      
007720           MOVE  萔|vOhc TO  P|\[Xhc        
007730           MOVE  "9"                  TO  P|AR[h        
007740           MOVE  SQLCODE              TO  P|e[uhc  
007750           MOVE  "SELECT"             TO  P|          
007760           MOVE  SQLCODE              TO  P|f[^e        
007770           MOVE  SQLERRMC             TO  P|̑bZ[W  
007780           CALL  CLOCO001          USING  IF-CHOCO001             
007790*                                                                 
007800        WHEN  -4                                                  
007810*--<       ǉG[  >                                      
007820           MOVE  "1"                  TO  P|Cxg      
007830           MOVE  萔|vOhc TO  P|\[Xhc        
007840           MOVE  "9"                  TO  P|AR[h        
007850           MOVE  "D414USM"            TO  P|e[uhc  
007860           MOVE  "INSERT"             TO  P|          
007870           MOVE  SQLCODE              TO  P|f[^e        
007880           MOVE  SQLERRMC             TO  P|̑bZ[W  
007890           CALL  CLOCO001          USING  IF-CHOCO001             
007900*                                                                 
007910        WHEN  OTHER                                               
007920           MOVE  "N"                  TO  v|ُI|tO    
007930     END-EVALUATE.                                                
007940*                                                                 
007950     IF  v|ُI|tO =  "Y"                              
007960*--<    bZ[Wo >                                      
007970        PERFORM  bZ[Wo                               
007980*--<    IbZ[Wo͏ >                                  
007990        PERFORM  IbZ[Wo                               
008000*--<    vO^[R[h >                                
008010        MOVE  萔|ُ          TO  PROGRAM-STATUS          
008020        EXIT  PROGRAM                                             
008030     END-IF.                                                      
008040*                                                                 
008050 G[|dwhs.                                            
008060     EXIT.                                                        
008070******************************************************************
008080*                  END OF PROGRAM                                *
008090******************************************************************
