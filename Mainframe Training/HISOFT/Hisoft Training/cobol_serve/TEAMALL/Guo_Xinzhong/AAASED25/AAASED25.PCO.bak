000010******************************************************************
000020*         ＜海輝軟件(大連)＞                                     *
000030*      1. プログラム名  : 前受金受払残高ファイル作成             *
000040*      2. プログラムID  : AAASED25                               *
000050*      3. 処理概要      :経理締処理（帳票作成）                  *
000060*                         (リース前受関連帳票抽出）              *
000080*                                                                *
000090*      4. 作成者        : 郭新鐘                                 *
000100*      5. 作成日        : 2005.03.26                             *
000110******************************************************************
000120*                                                                 
000130******************************************************************
000140*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000150******************************************************************
000160 IDENTIFICATION                       DIVISION.                   
000170*                                                                 
000180 PROGRAM-ID.                          AAASED25.                   
000190******************************************************************
000200*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000210******************************************************************
000220 ENVIRONMENT                          DIVISION.                   
000230*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000240******************************************************************
000250 INPUT-OUTPUT                         SECTION.                    
000260 FILE-CONTROL.                                                    
000270*                                                                 
000280     SELECT         出力ファイル      ASSIGN    TO   U11          
000290     FILE STATUS    IS                Ｗ−状態                    
000300     ORGANIZATION   IS     LINE       SEQUENTIAL.                 
000310*                                                                 
000320******************************************************************
000330*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000340******************************************************************
000350 DATA                                 DIVISION.                   
000360******************************************************************
000370*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000380******************************************************************
000390 FILE                                 SECTION.                    
000400*----------------------------------------------------------------*
000410*    出力ファイル                                                *
000420*----------------------------------------------------------------*
000430 FD  出力ファイル                                                 
000440     LABEL  RECORD    IS              STANDARD                    
000450     BLOCK  CONTAINS  0               RECORDS.                    
000460*                                                                 
000470 01  出力−レコード.                                              
000480     COPY   CPSCE50   REPLACING      ==()==  BY  ==出力−==.      
000490*                                                                 
000500******************************************************************
000510*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000520******************************************************************
000530  WORKING-STORAGE                     SECTION.                    
000540*----------------------------------------------------------------*
000550*    ホスト変数定義エリア                                        *
000560*----------------------------------------------------------------*
000570     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000580 01  ＷＳ−名称１                       PIC  X(60).               
000590 01  ＷＳ−名称２                       PIC  X(60).               
000600 01  ＷＳ−業務管理ＩＤ                 PIC  X(8).                
000610 01  ＷＳ−コードＮＯ０３８             PIC  X(012)  VALUE  '038'.
000620 01  ＷＳ−コードＮＯ００５             PIC  X(012)  VALUE  '005'.
000630*                                                                 
000640*--< ＯＲＡＣＬＥ共通変数 >                                       
000650     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000660*                                                                 
000670*--< ＯＲＡＣＬＥ  ＳＱＬ実行情報 >                               
000680     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000690*                                                                 
000700*--< 前受情報ＤＢ >                                               
000710     EXEC  SQL  INCLUDE  M40MAB.CBL           END-EXEC.           
000720*                                                                 
000730*--< 業務管理テーブル >                                           
000740     EXEC  SQL  INCLUDE  D70GYM.CBL           END-EXEC.           
000750*                                                                 
000760*--< 取引先マスタ>                                                
000770     EXEC  SQL  INCLUDE  D01TRS.CBL            END-EXEC.          
000780*                                                                 
000790*--< 請求先マスタ>                                                
000800     EXEC  SQL  INCLUDE  D02SQS.CBL            END-EXEC.          
000810*                                                                 
000820*--< 項目名称マスタ>                                              
000830     EXEC  SQL  INCLUDE  D19MSY.CBL           END-EXEC.           
000840*                                                                 
000850*--< 債権情報（一般）Ｄ>                                          
000860     EXEC  SQL  INCLUDE  M01SAJ.CBL            END-EXEC.          
000870*                                                                 
000880     EXEC  SQL  END  DECLARE          SECTION  END-EXEC.          
000890*                                                                 
000900*----------------------------------------------------------------*
000910*    ＷＯＲＫエリア                                              *
000920*----------------------------------------------------------------*
000930 01  ＷＯＲＫ−エリア.                                            
000940     03 Ｗ−当月消化額              PIC S9(13).                   
000950	   03 Ｗ−当月末残高              PIC S9(13).                   
000960*                                                                 
000970*--< ファイル状態 >                                               
000980     03  Ｗ−状態エリア.                                          
000990         05  Ｗ−状態                 PIC  X(02).                 
001000*                                                                 
001010*--< エラーコード >                                               
001020     03  Ｗ−エラーコード             PIC S9(03).                 
001030*                                                                 
001040*--< ファイル状態 >                                               
001050     03  ファイル状態                 PIC  X(02).                 
001060*                                                                 
001070*--< フラグアリア >                                               
001080     03  フラグアリア.                                            
001090         05  Ｗ−終了−フラグ         PIC  X(01).                 
001100         05  Ｗ−異常終了−フラグ     PIC  X(01).                 
001110*                                                                 
001130*--< 件数エリア >                                                 
001140     03  件数エリア.                                              
001150         05  Ｗ−入力−件数           PIC  9(09).                 
001160         05  Ｗ−出力−件数           PIC  9(09).                 
001170*                                                                 
001410*----------------------------------------------------------------*
001420*    サブルーチン名                                              *
001430*----------------------------------------------------------------*
001440 01  CALL-AREA.                                                   
001450*--< 共通ログサブルーチン >                                       
001460     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001470     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001480*                                                                 
001490*----------------------------------------------------------------*
001500*    ＣＯＰＹ領域                                                *
001510*----------------------------------------------------------------*
001520*--< 共通ログ用パラメータ >                                       
001530 01  IF-CHOCO001.                                                 
001540     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001550*                                                                 
001560*----------------------------------------------------------------*
001570*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001580*----------------------------------------------------------------*
001590 01  PARA-AREA.                                                   
001600     COPY CPBCO001.                                               
001610******************************************************************
001620*    定数用データ定義エリア                                      *
001630******************************************************************
001640 CONSTANT                             SECTION.                    
001650 01  定数領域.                                                    
001660     03  定数−プログラムＩＤ         PIC  X(08) VALUE "AAASED25".  
001670     03  定数−プログラム名           PIC  X(80)                  
001680                         VALUE  "前受金受払残高ファイル作成".     
001690     03  定数−ＳＱＬＯＫ             PIC S9(04)  VALUE  ZERO.    
001700     03  定数−ＳＱＬＥＮＤ           PIC S9(04)  VALUE  0100.    
001710     03  定数−正常状態               PIC S9(04)  VALUE  ZERO.    
001720     03  定数−異常状態               PIC S9(04)  VALUE  0009.    
001730******************************************************************
001740*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001750******************************************************************
001760 PROCEDURE                            DIVISION.                   
001770*                                                                 
001780     PERFORM  初期処理.                                           
001790*                                                                 
001800     PERFORM  主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".            
001810*                                                                 
001820     PERFORM  終了処理.                                           
001830*                                                                 
001840     STOP     RUN.                                                
001850*                                                                 
001860******************************************************************
001870*    初期処理                                                    *
001880******************************************************************
001890 初期処理                             SECTION.                    
001900 初期処理−ＳＴＡＲＴ.                                            
001910*                                                                 
001920*----------------------------------------------------------------*
001930*    開始メッセージ出力処理                                      *
001940*----------------------------------------------------------------*
001950     INITIALIZE                       IF-CHOCO001.                
001960     MOVE  "3"                        TO  共１−イベント種別.     
001970     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001980     MOVE  "0"                        TO  共１−復帰コード.       
001990     MOVE  "START"                    TO  共１−処理識別.         
002000     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
002010     CALL  CLOCO001                USING  IF-CHOCO001.            
002020*----------------------------------------------------------------*
002040*    作業領域の初期値処理                                        *
002050*----------------------------------------------------------------*
002060     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
002070     INITIALIZE                           ＷＯＲＫ−エリア.       
002160*                                                                 
002170*----------------------------------------------------------------*
002180*    ＯＲＡＣＬＥ接続                                            *
002190*----------------------------------------------------------------*
002200*--< ＯＲＡＣＬＥ接続 >                                           
002210     PERFORM   ＯＲＡＣＬＥ接続.                                  
002220*                                                                 
      *--< 業務管理テーブル読込 >
           PERFORM   業務管理テーブル読込.
      *--< ファイルオープン >
001890     PERFORM  ファイルオープン.                                   

002230*--< 結合テーブルカーソル定義 >                                   
002240     PERFORM  結合テーブルカーソル定義.                           
002250*                                                                 
002260*--< 結合テーブルカーソル読込(１件目) >                           
002270     PERFORM  結合テーブルカーソル読込.                           
002280*                                                                 
002290 初期処理−ＥＸＩＴ.                                              
002300     EXIT.                                                        
002310******************************************************************
002320*    ＯＲＡＣＬＥ接続                                            *
002330******************************************************************
002340 ＯＲＡＣＬＥ接続                     SECTION.                    
002350 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002360*                                                                 
002370*--< ＤＢ接続用情報を取得処理 >                                   
002380     CALL  COBCO001                USING  PARA-AREA.              
002390*                                                                 
002400     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002410     MOVE  PARA-USERNAME              TO  USERNAME.               
002420     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002430*                                                                 
002440*----------------------------------------------------------------*
002450*    開始接続                                                    *
002460*----------------------------------------------------------------*
002470     IF    DB-STRING  =  SPACE                                    
002480        EXEC SQL                                                  
002490           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002500        END-EXEC                                                  
002510     ELSE                                                         
002520        EXEC SQL                                                  
002530           CONNECT  :USERNAME IDENTIFIED BY :PASSWD               
002540             USING  :DB-STRING                                    
002550        END-EXEC                                                  
002560     END-IF.                                                      
002570*                                                                 
002580*----------------------------------------------------------------*
002590*    接続確認                                                    *
002600*----------------------------------------------------------------*
002610     EVALUATE  SQLCODE                                            
002620        WHEN   定数−ＳＱＬＯＫ                                   
002630           CONTINUE                                               
002640        WHEN   OTHER                                              
002650*--<       接続エラー >                                           
002660           MOVE     -10               TO  Ｗ−エラーコード        
002670           PERFORM  エラー判定処理                                
002680     END-EVALUATE.                                                
002690*                                                                 
002850 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
002860     EXIT.                                                        
002870*                                                                 
002310******************************************************************
002320*    業務管理テーブル読込                                            *
002330******************************************************************
       業務管理テーブル読込             SECTION.                    
002930 業務管理テーブル読込−ＳＴＡＲＴ.
002710     EXEC SQL                                                     
002720        SELECT  バッチ用業務年月                                  
002730          INTO :Ｄ７０−業務年月                                  
002740          FROM  D70GYM_TBL                                        
002750          WHERE  D70GYM_TBL.業務管理ＩＤ =  :ＷＳ−業務管理ＩＤ   
002760     END-EXEC.                                                    
002770     EVALUATE  SQLCODE                                            
002780        WHEN  定数−ＳＱＬＯＫ                                    
002790*--<       正常 >                                                 
002800           CONTINUE                                               
002810        WHEN  OTHER                                               
002820           MOVE -100                   TO  Ｗ−エラーコード       
002830           PERFORM エラー判定処理                                 
002840      END-EVALUATE.
003570 業務管理テーブル読込−ＥＸＩＴ.                              
003580     EXIT.
003880******************************************************************
003890*    ファイルオープン処理                                <1.6>   *
003900******************************************************************
003910 ファイルオープン                     SECTION.                    
003920 ファイルオープン−ＳＴＡＲＴ.                                    
003930*                                                                 
003940     OPEN  OUTPUT  出力ファイル.                                  
003950*----------------------------------------------------------------*
003960*    ファイルオープン確認                                        *
003970*----------------------------------------------------------------*
003980     EVALUATE  Ｗ−状態                                           
003990        WHEN  ZERO                                                
004000*--<       正常 >                                                 
004010           CONTINUE                                               
004020        WHEN  OTHER                                               
004030*--<       ファイルＯＰＥＮエラー >                               
004040           MOVE     -40               TO  Ｗ−エラーコード        
004050           PERFORM  エラー処理                                    
004060     END-EVALUATE.                                                
004070 ファイルオープン−ＥＸＩＴ.                                      
004080     EXIT.            
002890******************************************************************
002900*        結合テーブルカーソル定義                                *
002910******************************************************************
002920 結合テーブルカーソル定義             SECTION.                    
002930 結合テーブルカーソル定義−ＳＴＡＲＴ.                            
002940*                                                                 
002950*----------------------------------------------------------------*
002960*    カーソルＯＰＥＮ処理                                        *
002970*----------------------------------------------------------------*
002980     EXEC SQL                                                     
002990        DECLARE CUR1  CURSOR FOR                                  
003000           SELECT 						
003010                  M40MAB_TBL.レコード区分			        
003020                 ,M40MAB_TBL.経理用主契約区分			
003030                 ,M40MAB_TBL.顧客区分				
003040                 ,NVL(D01TRS_TBL.名寄せコード,RPAD(' ',40,' '))   
003060                 ,M40MAB_TBL.請求先取引先コード			
003070                 ,M40MAB_TBL.請求先コード			        
003080                 ,M40MAB_TBL.契約番号				
003090                 ,M40MAB_TBL.契約種類				
003100                 ,M40MAB_TBL.担当部課コード	         	
003110                 ,M40MAB_TBL.再リース回数			        
003120                 ,M40MAB_TBL.充当開始年月			        
003130                 ,M40MAB_TBL.充当月数				
003140                 ,M40MAB_TBL.前払回収方法	        	        
003150                 ,M40MAB_TBL.入金日				
003160                 ,M40MAB_TBL.入金区分		        	
003170                 ,NVL(D01TRS_TBL.取引先名称,RPAD(' ',80,' '))	
003180                 ,NVL(D02SQS_TBL.請求先名称,RPAD(' ',80,' '))	
003190                 ,M40MAB_TBL.前月末残高				
003200                 ,M40MAB_TBL.当月回収額				
003210                 ,M40MAB_TBL.当月消化額			        
003220                 ,M40MAB_TBL.当月末残高                           
003230             FROM  M40MAB_TBL                                     
003240                  ,D01TRS_TBL                                     
003250                  ,D02SQS_TBL                                     
003260            WHERE  M40MAB_TBL.前受金受払残高表対象フラグ          
003270                                =  '1'                            
003280              AND  M40MAB_TBL.請求先取引先コード                  
003290                                 =  D01TRS_TBL.取引先コード(+)    
003300              AND  M40MAB_TBL.請求先取引先コード                  
003310                                 =  D02SQS_TBL.取引先コード(+)    
003320              AND  M40MAB_TBL.請求先コード                        
003330                                 =  D02SQS_TBL.請求先コード(+)    
003340         ORDER BY  M40MAB_TBL.レコード区分                        
003350                  ,M40MAB_TBL.契約番号                            
003360     END-EXEC.                                                    
003370*----------------------------------------------------------------*
003380*    カーソルＯＰＥＮ処理                                        *
003390*----------------------------------------------------------------*
003400     EXEC  SQL                                                    
003410        OPEN  CUR1                                                
003420     END-EXEC.                                                    
003430*                                                                 
003440*----------------------------------------------------------------*
003450*    カーソルＯＰＥＮ確認                                        *
003460*----------------------------------------------------------------*
003470     EVALUATE  SQLCODE                                            
003480        WHEN  定数−ＳＱＬＯＫ                                    
003490*--<       正常 >                                                 
003500           CONTINUE                                               
003510        WHEN  OTHER                                               
003520*--<       カーソルＯＰＥＮエラー >                               
003530           MOVE -20                   TO  Ｗ−エラーコード        
003540           PERFORM  エラー判定処理                                
003550     END-EVALUATE.                                                
003560*                                                                 
003570 結合テーブルカーソル定義−ＥＸＩＴ.                              
003580     EXIT.                                                        
003590******************************************************************
003600*    結合テーブルカーソル読込                                    *
003610******************************************************************
003620 結合テーブルカーソル読込             SECTION.                    
003630 結合テーブルカーソル読込−ＳＴＡＲＴ.                            
003640*                                                                 
003650*--< 結合テーブルカーソル読込 >                                   
003660     EXEC SQL                                                     
003670         FETCH  CUR1                                              
003680          INTO  :Ｍ４０−レコード区分                             
003690               ,:Ｍ４０−経理用主契約区分                         
003700               ,:Ｍ４０−顧客区分					
003710               ,:Ｄ０１−名寄せコード				
003720               ,:Ｍ４０−請求先取引先コード			
003730               ,:Ｍ４０−請求先コード				
003740               ,:Ｍ４０−契約番号					
003750               ,:Ｍ４０−契約種類				        
003760               ,:Ｍ４０−担当部課コード				
003770               ,:Ｍ４０−再リース回数				
003780               ,:Ｍ４０−充当開始年月			        
003790               ,:Ｍ４０−充当月数					
003800               ,:Ｍ４０−前払回収方法			        
003810               ,:Ｍ４０−入金日					
003820               ,:Ｍ４０−入金区分				        
003830               ,:Ｄ０１−取引先名称				
003840               ,:Ｄ０２−請求先名称				
003850               ,:Ｍ４０−前月末残高				
003860               ,:Ｍ４０−当月回収額			        
003870               ,:Ｍ４０−当月消化額				
003880               ,:Ｍ４０−当月末残高                               
003890     END-EXEC.                                                    
003910*----------------------------------------------------------------*
003920*    結合テーブルカーソル読込を確認                              *
003930*----------------------------------------------------------------*
003940     EVALUATE   SQLCODE                                           
003950        WHEN   定数−ＳＱＬＯＫ                                   
003960*--<       正常 >                                                 
003970*                                                                 
003980           COMPUTE  Ｗ−入力−件数  =  Ｗ−入力−件数  +  1       
003990        WHEN   定数−ＳＱＬＥＮＤ                                 
004000*--<       読込終了 >                                             
004010           MOVE  "Y"                  TO  Ｗ−終了−フラグ        
004020        WHEN   OTHER                                              
004030*--<       読込エラー >                                           
004040           MOVE     -30               TO  Ｗ−エラーコード        
004050           PERFORM  エラー判定処理                                
004060     END-EVALUATE.                                                
004070*                                                                 
004080 結合テーブルカーソル読込−ＥＸＩＴ.                              
004090     EXIT.                                                        
004100******************************************************************
004110*    主処理                                                      *
004120******************************************************************
004130 主処理                               SECTION.                    
004140 主処理−ＳＴＡＲＴ.                                              
004150     PERFORM  項目名称抽出処理.                                   
004160                                                                  
004170     PERFORM  債権情報の抽出処理.                                 
004180*                                                                 
004190     IF Ｍ０１−担保区分 NOT = '1'                               
004200	      PERFORM 編集出力処理                                      
004210	   .                                                            
004220*--< 結合テーブルカーソル読込（２件目以降） >                     
004230     PERFORM  結合テーブルカーソル読込.                           
004240*                                                                 
004250 主処理−ＥＸＩＴ.                                                
004260     EXIT.                                                        
004270******************************************************************
004280*     項目名称マスタより項目の抽出処理                            
004290******************************************************************
004300 項目名称抽出処理                     SECTION.                    
004320 項目名称抽出処理ーＳＴＡＲＴ.                                    
004340     PERFORM 主契約区分名称の抽出処理.                            
004350                                                                  
004360     PERFORM 顧客区分名称の抽出処理.                              
004370                                                                  
004380 項目名称抽出処理−ＥＸＩＴ.                                      
004390     EXIT.                                                        
004400******************************************************************
004410*--<項目名称マスタより主契約区分名称の抽出処理>                   
004420 主契約区分名称の抽出処理   SECTION.                              
004430                                                                  
004440 主契約区分名称の抽出処理ーＳＴＡＲＴ.                            
004450*                                                                 
004460     EXEC SQL                                                     
004470        SELECT  名称                                              
004480          INTO :ＷＳ−名称１                                      
004490          FROM  D19MSY_TBL,M40MAB_TBL                             
004500        WHERE   D19MSY_TBL.コードＮＯ = :ＷＳ−コードＮＯ０３８   
004510          AND   SUBSTR ( コード,1,1 )                             
004520		                 = :Ｍ４０−経理用主契約区分          
004530     END-EXEC.                                                    
004540     EVALUATE  SQLCODE                                            
004550        WHEN  定数−ＳＱＬＯＫ                                    
004560*--<       正常 >                                                 
004570           CONTINUE                                               
004580        WHEN  OTHER                                               
004590*--<       カーソルＯＰＥＮエラー >                               
004890           MOVE      SPACE            TO  ＷＳ−名称１
004600           MOVE -200                   TO  Ｗ−エラーコード       
004610           PERFORM  エラー判定処理                                
004620     END-EVALUATE.                                                
004630*                                                                 
004640 主契約区分名称−ＥＸＩＴ.                                        
004650     EXIT.                                                        
004660*--<項目名称マスタより顧客区分名称の抽出処理>                     
004670 顧客区分名称の抽出処理   SECTION.                                
004680 顧客区分名称の抽出処理ーＳＴＡＲＴ.                              
004690*                                                                 
004700     EXEC SQL                                                     
004710        SELECT  名称                                              
004720          INTO :ＷＳ−名称２                                      
004730          FROM  D19MSY_TBL,M40MAB_TBL                             
004740        WHERE   D19MSY_TBL.コードＮＯ = :ＷＳ−コードＮＯ００５   
004750          AND   SUBSTR ( コード,1,2 )                             
004760		                 = :Ｍ４０−顧客区分                  
004770     END-EXEC.                                                    
004780*                                                                 
004790     EVALUATE  SQLCODE                                            
004800        WHEN  定数−ＳＱＬＯＫ                                    
004810*--<       正常 >                                                 
004820           CONTINUE                                               
004830        WHEN  OTHER                                               
004840*--<       カーソルＯＰＥＮエラー >                               
005120           MOVE      SPACE            TO  ＷＳ−名称２
004850           MOVE -200                   TO  Ｗ−エラーコード       
004860           PERFORM  エラー判定処理                                
004870     END-EVALUATE.                                                
004880*                                                                 
004890 顧客区分名称−ＥＸＩＴ.                                          
004900     EXIT.                                                        
004910******************************************************************
004920*     債権情報（一般）ＤＢより項目の抽出処理                      
004930******************************************************************
004940 債権情報の抽出処理                     SECTION.                  
004950 債権情報の抽出処理ーＳＴＡＲＴ.                                  
004960     EXEC SQL                                                     
004970        SELECT  状態フラグ,債権契約件名,担保区分                  
004980          INTO :Ｍ０１−状態フラグ,                               
004990                Ｍ０１−債権契約件名,                             
005000                Ｍ０１−担保区分                                  
005010          FROM  M01SAJ_TBL,M40MAB_TBL                             
005020          WHERE M01SAJ_TBL.レコード区分	= '1'	                
005030          AND   M01SAJ_TBL.契約番号 =  :Ｍ４０−契約番号	
005040          AND   M01SAJ_TBL.再リース回数                           
005050                               = :Ｍ４０−再リース回数          
005060          AND   M01SAJ_TBL.契約種類 = :Ｍ４０−契約種類	        
005070     END-EXEC.                                                    
005080     EVALUATE  SQLCODE                                            
005090        WHEN  定数−ＳＱＬＯＫ                                    
005100*--<       正常 >                                                 
005110           CONTINUE                                               
005120        WHEN  OTHER                                               
005490           MOVE     ZERO              TO  Ｍ０１−状態フラグ      
005500           MOVE     SPACE             TO  Ｍ０１−債権契約件名    
005510           MOVE     ZERO              TO  Ｍ０１−担保区分        
005130           MOVE -300                   TO  Ｗ−エラーコード       
005140           PERFORM エラー判定処理                                 
005160     END-EVALUATE.                                                
005170 債権情報の抽出処理−ＥＸＩＴ.                                    
005180     EXIT.                                                        
005190******************************************************************
005200*     編集出力処理                                               *
005210******************************************************************
005220 編集出力処理                         SECTION.                    
005230 編集出力処理−ＳＴＡＲＴ.                                        
005240*                                                                 
005290         PERFORM 他社分項目編集処理                               
005300         PERFORM 出力処理                                         
005250     IF  Ｍ０１−協調区分  = '2'
005320	       PERFORM 自社分項目編集処理                               
005330         PERFORM 出力処理                                         
005380     END-IF.                                                      
005390 編集出力処理−ＥＸＩＴ.                                          
005400     EXIT.                                                        
005410*                                                                 
005420*----------------------------------------------------------------*
005430*       初期化処理                                               *
005440*----------------------------------------------------------------*
005450*                                                                 
005460*----------------------------------------------------------------*
005470*       自社分項目編集処理                                       *
005480*----------------------------------------------------------------*
005490 自社分項目編集処理               SECTION.                        
005500 自社分項目編集処理−ＳＴＡＲＴ.                                  
005510                                                                  
005520*--<    No.01 >                                                   
005530        IF    Ｍ０１−状態フラグ < 3                              
005540        MOVE  3 TO  出力−自他社区分                              
005550        ELSE                                                      
005560	      MOVE 1 TO 出力−自他社区分                                
005570        END-IF.                                                   
005590*--<    No.02 >                                                   
005600        MOVE  Ｍ４０−レコード区分  TO  出力−前受区分.           
005610                                                                  
005620*--<    No.03 >                                                   
005630        MOVE  Ｍ４０−経理用主契約区分     TO  出力−主契約区分.  
005640*                                                                 
005650*--<    No.04 >                                                   
005660        MOVE  Ｍ４０−顧客区分          TO  出力−連結区分.       
005670*                                                                 
005680*--<    No.05 >                                                   
005690        MOVE  Ｄ０１−名寄せコード      TO  出力−名寄せコード.   
005700*                                                                 
005710*--<    No.06 >                                                   
005720        MOVE  Ｍ４０−請求先取引先コード                          
005730                                      TO  出力−取引先コード.     
005740*                                                                 
005750*--<    No.07 >                                                   
005760        MOVE  Ｍ４０−請求先コード      TO  出力−請求先コード.   
005770*                                                                 
005780*--<    No.08 >                                                   
005790        MOVE  Ｍ４０−契約番号        TO  出力−契約番号.         
005800*                                                                 
005810*--<    No.09 >                                                   
005820        MOVE  Ｍ４０−契約種類    TO  出力−契約種類.             
005830*                                                                 
005840*--<    No.10 >                                                   
005850        MOVE  Ｄ７０−業務年月        TO  出力−業務年月.         
005860*                                                                 
005870*--<    No.11 >                                                   
005880        MOVE  Ｍ４０−担当部課コード                              
005890                               TO  出力−担当部課コード.          
005900*                                                                 
005910*--<    No.12 >                                                   
005920        MOVE  Ｍ０１−債権契約件名     TO  出力−契約件名.        
005930*                                                                 
005940*--<    No.13 >                                                   
005950        MOVE  Ｍ４０−再リース回数      TO  出力−再リース回数.   
005960*                                                                 
005970*--<    No.14 >                                                   
005980        MOVE  Ｍ４０−充当開始年月        TO  出力−充当開始年月. 
005990*                                                                 
006000*--<    No.15 >                                                   
006010        MOVE  Ｍ４０−充当月数        TO  出力−充当月数.         
006020*                                                                 
006030*--<    No.16 >                                                   
006040        MOVE  Ｍ４０−前払回収方法       TO  出力−前払回収方法.  
006050*                                                                 
006060*--<    No.17 >                                                   
006070        MOVE  Ｍ４０−入金日              TO  出力−入金日.       
006080*                                                                 
006090*--<    No.18 >                                                   
006100        MOVE  Ｍ４０−入金区分              TO  出力−入金区分.   
006110*                                                                 
006120*--<    No.19 >                                                   
006130        MOVE  Ｄ０１−取引先名称        TO  出力−取引先名称.     
006140*                                                                 
006150*--<    No.20 >                                                   
006160        MOVE  Ｄ０２−請求先名称        TO  出力−請求先名称.     
006170*                                                                 
006180*--<    No.21 >                                                   
006190        MOVE  ＷＳ−名称１             TO  出力−主契約区分名称.  
006200*                                                                 
006210*--<    No.22 >                                                   
006220        MOVE  ＷＳ−名称２              TO  出力−連結区分名称.   
006230*                                                                 
006240*--<    No.23 >                                                   
006250        MOVE  Ｍ４０−前月末残高          TO  出力−前月末残高.   
006260*                                                                 
006270*--<    No.24 >                                                   
006280        MOVE  Ｍ４０−当月回収額        TO  出力−当月入金額.     
006290*                                                                 
006300*--<    No.25 >                                                   
006310        MOVE  Ｍ４０−当月消化額        TO  出力−当月消化額.     
006320*                                                                 
006330*--<    No.26 >                                                   
006340        MOVE  Ｍ４０−当月末残高          TO  出力−当月末残高.   
006350 自社分項目編集処理−ＥＸＩＴ.                                    
006370     EXIT.                                                        
006380*                                                                 
006390*----------------------------------------------------------------*
006400*       他社分項目編集処理                                       *
006410*----------------------------------------------------------------*
006420 他社分項目編集処理               SECTION.                        
006430 他社分項目編集処理−ＳＴＡＲＴ.                                  
006440*--<    No.01 >                                                   
006450        IF   Ｍ０１−状態フラグ < '3'                               
006460        MOVE '4' TO  出力−自他社区分                               
006470        ELSE                                                      
006480	      MOVE '2' TO 出力−自他社区分                                
006490        END-IF.                                                   
006500*                                                                 
006510*--<    No.02 >                                                   
006520        MOVE  Ｍ４０−レコード区分  TO  出力−前受区分.           
006530                                                                  
006540*--<    No.03 >                                                   
006550        MOVE  Ｍ４０−経理用主契約区分     TO  出力−主契約区分.  
006560*                                                                 
006570*--<    No.04 >                                                   
006580        MOVE  Ｍ４０−顧客区分          TO  出力−連結区分.       
006590*                                                                 
006600*--<    No.05 >                                                   
006610        MOVE  Ｄ０１−名寄せコード      TO  出力−名寄せコード.   
006620*                                                                 
006630*--<    No.06 >                                                   
006640        MOVE  Ｍ４０−請求先取引先コード                          
006650                                     TO  出力−取引先コード.      
006660*                                                                 
006670*--<    No.07 >                                                   
006680        MOVE  Ｍ４０−請求先コード      TO  出力−請求先コード.   
006690*                                                                 
006700*--<    No.08 >                                                   
006710        MOVE  Ｍ４０−契約番号        TO  出力−契約番号.         
006720*                                                                 
006730*--<    No.09 >                                                   
006740        MOVE  Ｍ４０−契約種類    TO  出力−契約種類.             
006750*                                                                 
006760*--<    No.10 >                                                   
006770        MOVE  Ｄ７０−業務年月        TO  出力−業務年月.         
006780*                                                                 
006790*--<    No.11 >                                                   
006800        MOVE  Ｍ４０−担当部課コード                              
006810                                  TO  出力−担当部課コード.       
006820*                                                                 
006830*--<    No.12 >                                                   
006840        MOVE  Ｍ０１−債権契約件名      TO  出力−契約件名.       
006850*                                                                 
006860*--<    No.13 >                                                   
006870        MOVE  Ｍ４０−再リース回数      TO  出力−再リース回数.   
006880*                                                                 
006890*--<    No.14 >                                                   
006900        MOVE  Ｍ４０−充当開始年月     TO  出力−充当開始年月.    
006910*                                                                 
006920*--<    No.15 >                                                   
006930        MOVE  Ｍ４０−充当月数        TO  出力−充当月数.         
006940*                                                                 
006950*--<    No.16 >                                                   
006960        MOVE  Ｍ４０−前払回収方法     TO  出力−前払回収方法.    
006970*                                                                 
006980*--<    No.17 >                                                   
006990        MOVE  Ｍ４０−入金日         TO  出力−入金日.            
007000*                                                                 
007010*--<    No.18 >                                                   
007020        MOVE  Ｍ４０−入金区分       TO  出力−入金区分.          
007030*                                                                 
007040*--<    No.19 >                                                   
007050        MOVE  Ｄ０１−取引先名称     TO  出力−取引先名称.        
007060*                                                                 
007070*--<    No.20 >                                                   
007080        MOVE  Ｄ０２−請求先名称        TO  出力−請求先名称.     
007090*                                                                 
007100*--<    No.21 >                                                   
007110        MOVE  ＷＳ−名称１          TO  出力−主契約区分名称.     
007120*                                                                 
007130*--<    No.22 >                                                   
007140        MOVE  ＷＳ−名称２              TO  出力−連結区分名称.   
007150*                                                                 
007160*--<    No.23 >                                                   
007170        MOVE  Ｍ４０−前月末残高他社   TO  出力−前月末残高.      
007180*                                                                 
007190*--<    No.24 >                                                   
007200        MOVE  Ｍ４０−当月回収額他社    TO  出力−当月入金額.     
007210*                                                                 
007220*--<    No.25 >                                                   
007230        COMPUTE   Ｗ−当月消化額 = Ｍ４０−当月消化額他社         
007240            + Ｍ４０−当月他社解約分料金                          
007250            + Ｍ４０−当月他社解約分消費税.                       
007260         MOVE Ｗ−当月消化額        TO  出力−当月消化額.         
007270*                                                                 
007280*--<    No.26 >                                                   
007290        COMPUTE  Ｗ−当月末残高 = Ｍ４０−当月消化額他社          
007300                -  Ｍ４０−当月他社解約分料金                     
007310		      -  Ｍ４０−当月他社解約分消費税.                  
007320	      MOVE Ｗ−当月末残高	TO  出力−当月末残高.           
007340 他社分項目編集処理−ＥＸＩＴ.                                    
007350     EXIT.                                                        
007360*                                                                 
007370*                                                                 
007380******************************************************************
007390*    出力処理                                                    *
007400******************************************************************
007410 出力処理                             SECTION.                    
007420 出力処理−ＳＴＡＲＴ.                                            
007430         IF  出力−前月末残高 = ZERO                              
007440	       AND 出力−当月入金額 = ZERO                              
007450         AND 出力−当月消化額 = ZERO                              
007460	       AND 出力−当月末残高 = ZERO                              
007470            CONTINUE                                              
007480         ELSE                                                     
007490            WRITE  出力−レコード.                                
007500*                                                                 
007510*----------------------------------------------------------------*
007520*    追加処理を確認                                              *
007530*----------------------------------------------------------------*
007540     EVALUATE  Ｗ−状態                                    
007550        WHEN   ZERO                                   
007560*--<       追加成功 >                                             
007570           COMPUTE  Ｗ−出力−件数  =  Ｗ−出力−件数  +  1       
007580        WHEN   OTHER                                              
007590*--<       追加処理エラー >                                       
007600           MOVE     -40               TO  Ｗ−エラーコード        
007610           PERFORM  エラー判定処理                                
007620     END-EVALUATE.                                                
007630*                                                                 
007640 出力処理−ＥＸＩＴ.                                              
007650     EXIT.                                                        
007660******************************************************************
007670*    終了処理                                                    *
007680******************************************************************
007690 終了処理                             SECTION.                    
007700 終了処理−ＳＴＡＲＴ.                                            
007710*                                                                 
007720     PERFORM  ＤＢクローズ処理.                                   
007730*                                                                 
007740     PERFORM  ＤＢコミット処理.                                   
007750*                                                                 
007760     PERFORM  終了メッセージ出力.                                 
007770*                                                                 
007780*--< プログラム正常終了 >                                         
007790     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
007800*                                                                 
007810 終了処理−ＥＸＩＴ.                                              
007820     EXIT.                                                        
007830******************************************************************
007840*    終了メッセージ出力                                          *
007850******************************************************************
007860 終了メッセージ出力                   SECTION.                    
007870 終了メッセージ出力−ＳＴＡＲＴ.                                  
007880*                                                                 
007890*----------------------------------------------------------------*
007900*    件数メッセージ出力処理                                      *
007910*----------------------------------------------------------------*
007270*----------------------------------------------------------------*
007280*    前受情報（結合）ＤＢ入力件数                                *
007290*----------------------------------------------------------------*
007300     INITIALIZE                       IF-CHOCO001.                
007310     MOVE  "3"                        TO  共１−イベント種別.     
007320     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007330     MOVE  "0"                        TO  共１−復帰コード.       
007340     MOVE  "M40MAB"                   TO  共１−処理テーブルＩＤ. 
007350     MOVE  "COUNT"                    TO  共１−処理識別.         
007360     MOVE  Ｗ−入力−件数             TO  共１−データ内容.       
007370     MOVE  "前受情報テーブル（入力）" TO  共１−その他メッセージ. 
007380     CALL  CLOCO001                USING  IF-CHOCO001.            
007390                                                                  
007400*----------------------------------------------------------------*
007410*    前受金受払残高中間Ｆ出力件数                                *
007420*----------------------------------------------------------------*
007430     INITIALIZE                       IF-CHOCO001.                
007440     MOVE  "3"                        TO  共１−イベント種別.     
007450     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007460     MOVE  "0"                        TO  共１−復帰コード.       
007470     MOVE  "SFHSED25"                 TO  共１−処理テーブルＩＤ. 
007480     MOVE  "COUNT"                    TO  共１−処理識別.         
007490     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
007500     MOVE  "前受金受払残高ファイル"   TO  共１−その他メッセージ. 
007510     CALL  CLOCO001                USING  IF-CHOCO001.            
008130*----------------------------------------------------------------*
008140*    終了メッセージ出力                                          *
008150*----------------------------------------------------------------*
008160     INITIALIZE                       IF-CHOCO001.                
008170     MOVE  "3"                        TO  共１−イベント種別.     
008180     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008190     MOVE  "0"                        TO  共１−復帰コード.       
008200     MOVE  "END"                      TO  共１−処理識別.         
008210     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
008220     CALL  CLOCO001                USING  IF-CHOCO001.            
008230*                                                                 
008240 終了メッセージ出力−ＥＸＩＴ.                                    
008250     EXIT.                                                        
008260******************************************************************
008270*    ＤＢクローズ                                                *
008280******************************************************************
008290 ＤＢクローズ処理                     SECTION.                    
008300 ＤＢクローズ処理−ＳＴＡＲＴ.                                    
008310*                                                                 
008320*--< カーソル クローズ >                                          
008330     EXEC SQL                                                     
008340        CLOSE  CUR1                                               
008350     END-EXEC.                                                    
008360*                                                                 
008370 ＤＢクローズ処理−ＥＸＩＴ.                                      
008380     EXIT.                                                        
008390******************************************************************
008400*    ＤＢコミット処理                                            *
008410******************************************************************
008420 ＤＢコミット処理                     SECTION.                    
008430 ＤＢコミット処理−ＳＴＡＲＴ.                                    
008440*                                                                 
008450     EXEC  SQL                                                    
008460        COMMIT  WORK  RELEASE                                     
008470     END-EXEC.                                                    
008480*                                                                 
008490     INITIALIZE                       IF-CHOCO001.                
008500     MOVE  "3"                        TO  共１−イベント種別.     
008510     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
008520     MOVE  "0"                        TO  共１−復帰コード.       
008530     MOVE  "COMMIT"                   TO  共１−処理識別.         
008540     MOVE  "コミット実施"             TO  共１−その他メッセージ. 
008550     CALL  CLOCO001                USING  IF-CHOCO001.            
008560*                                                                 
008570 ＤＢコミット処理−ＥＸＩＴ.                                      
008580     EXIT.                                                        
008790******************************************************************
008800*    エラー処理                                                  *
008810******************************************************************
008820 エラー判定処理                       SECTION.                    
008830 エラー判定処理−ＳＴＡＲＴ.                                      
008840*                                                                 
008850     MOVE  "Y"                        TO Ｗ−異常終了−フラグ.    
008860     INITIALIZE                           IF-CHOCO001.            
008870*                                                                 
008880     EVALUATE  Ｗ−エラーコード                                   
008890        WHEN  -10                                                 
008900*--<       ＯＲＡＣＬＥ接続失敗 >                                 
008910           MOVE  "1"                  TO  共１−イベント種別      
008920           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008930           MOVE  "9"                  TO  共１−復帰コード        
008940           MOVE  "CONNECT"            TO  共１−処理識別          
008950           MOVE  SQLCODE              TO  共１−データ内容        
008960           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008970           CALL  CLOCO001          USING  IF-CHOCO001             
008980*                                                                 
008990        WHEN  -20                                                 
009000*--<       結合テーブルカーソルオープン失敗 >                     
009010           MOVE  "1"                  TO  共１−イベント種別      
009020           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009030           MOVE  "9"                  TO  共１−復帰コード        
009040           MOVE  "M40MAB"             TO  共１−処理テーブルＩＤ  
009050           MOVE  "OPEN"               TO  共１−処理識別          
009060           MOVE  SQLCODE              TO  共１−データ内容        
009070           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009080           CALL  CLOCO001          USING  IF-CHOCO001             
009090*                                                                 
009100        WHEN  -30                                                 
009110*--<       結合テーブル読込失敗 >                                 
009120           MOVE  "1"                  TO  共１−イベント種別      
009130           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009140           MOVE  "9"                  TO  共１−復帰コード        
009150           MOVE  "M40MAB"             TO  共１−処理テーブルＩＤ  
009160           MOVE  "FETCH"              TO  共１−処理識別          
009170           MOVE  SQLCODE              TO  共１−データ内容        
009180           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009190           CALL  CLOCO001          USING  IF-CHOCO001             
009310*                                                                 
009320        WHEN  -100                                                
009330*--<       バッチ用業務年月失敗 >                                 
009340           MOVE  "1"                  TO  共１−イベント種別      
009350           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009360           MOVE  "9"                  TO  共１−復帰コード        
009370           MOVE  "D70GYM"             TO  共１−処理テーブルＩＤ  
009380           MOVE  "OPEN"               TO  共１−処理識別          
009390           MOVE  SQLCODE              TO  共１−データ内容        
009400           MOVE  "バッチ用業務年月失敗"                           
009410                                      TO  共１−その他メッセージ  
009420           CALL  CLOCO001          USING  IF-CHOCO001             
009430        WHEN  -200                                                
009440*--<       項目名称マスタより主契約(顧客)区分名称の抽出失敗 >     
009450           MOVE  "2"                  TO  共１−イベント種別      
009460           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009470           MOVE  "9"                  TO  共１−復帰コード        
009480           MOVE  "D19MSY"             TO  共１−処理テーブルＩＤ  
009490           MOVE  "SELECT"             TO  共１−処理識別          
009500           MOVE  SQLCODE              TO  共１−データ内容        
009510           MOVE  SQLERRMC             TO  共１−その他メッセージ  
009520           CALL  CLOCO001          USING  IF-CHOCO001             
009530           MOVE  "N"                  TO  Ｗ−異常終了−フラグ    
009540*                                                                 
009550        WHEN  -300                                                
009560*--<       債権情報（一般）ＤＢより項目の抽出失敗 >               
009570           MOVE  "2"                  TO  共１−イベント種別      
009580           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
009590           MOVE  "9"                  TO  共１−復帰コード        
009600           MOVE  "M01SAJ"             TO  共１−処理テーブルＩＤ  
009610           MOVE  "SELECT"             TO  共１−処理識別          
009620           MOVE  SQLCODE              TO  共１−データ内容        
009630           MOVE  "項目の抽出失敗"                                 
009640                                      TO  共１−その他メッセージ  
009650           CALL  CLOCO001          USING  IF-CHOCO001             
009660           MOVE  "N"                  TO  Ｗ−異常終了−フラグ    
009670        WHEN  OTHER                                               
009680           MOVE  "N"                  TO Ｗ−異常終了−フラグ     
009690     END-EVALUATE.                                                
009700*                                                                 
009710     IF Ｗ−異常終了−フラグ  =  "Y"                                                          
009730*                                                                 
009740        PERFORM  終了メッセージ出力                               
009750*                                                                 
009760*--<    プログラム異常終了のリターンコード >                      
009770        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
009780*                                                                 
009790        EXIT  PROGRAM                                             
009800     END-IF.                                                      
009810*                                                                 
009820 エラー処理−ＥＸＩＴ.                                            
009830     EXIT.                                                        
009840******************************************************************
009850*                  END OF PROGRAM                                *
009860******************************************************************
