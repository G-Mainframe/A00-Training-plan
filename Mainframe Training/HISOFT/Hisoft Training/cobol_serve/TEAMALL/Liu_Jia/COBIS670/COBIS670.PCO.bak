000010
000020******************************************************************
000030*         ＜海輝軟件(大連)＞                                     *
000040*      1. プログラム名    ：管理与信展開移行処理                 *
000050*      2. プログラムID    ：COBIS670                             *
000060*      3. 処理概要        ：FOCUS.与信(展開)を主体に全件対象     *
000070*                           として、管理与信展開を作成する。     *
000080*                                                                *
000090*      4. 作成者          ：劉佳                                 *
000100*      5. 作成日          ：2005.04.02                           *
000110******************************************************************
000120*                                                                *
000130******************************************************************
000140*    ＩＤＥＮＴＩＦＩＣＡＴＩＯＮ  ＤＩＶＩＳＩＯＮ              *
000150******************************************************************
000160 IDENTIFICATION                       DIVISION.                   
000170*                                                                 
000180 PROGRAM-ID.                          COBIS670.                   
000190******************************************************************
000200*    ＥＮＶＩＲＯＮＭＥＮＴ        ＤＩＶＩＳＩＯＮ              *
000210******************************************************************
000220 ENVIRONMENT                          DIVISION.                   
000230******************************************************************
000240*    ＩＮＰＵＴ−ＯＵＴＰＵＴ      ＳＥＣＴＩＯＮ                *
000250******************************************************************
000260 INPUT-OUTPUT                         SECTION.                    
000270 FILE-CONTROL.                                                    
000280*                                                                 
000290     SELECT    出力ファイル           ASSIGN    TO     U11        
000300     FILE      STATUS     IS          Ｗ−状態                    
000310     ORGANIZATION         IS          LINE      SEQUENTIAL.       
000320*                                                                 
000330******************************************************************
000340*    ＤＡＴＡ                      ＤＩＶＩＳＩＯＮ              *
000350******************************************************************
000360 DATA                                 DIVISION.                   
000370******************************************************************
000380*    ＦＩＬＥ                      ＳＥＣＴＩＯＮ                *
000390******************************************************************
000400 FILE                                 SECTION.                    
000410*----------------------------------------------------------------*
000420*    出力ファイル                                                *
000430*----------------------------------------------------------------*
000440 FD  出力ファイル                                                 
000450     LABEL     RECORD     IS          STANDARD                    
000460     BLOCK     CONTAINS   0           RECORDS.                    
000470*                                                                 
000480 01  出力−レコード.                                              
000490     COPY  CISUF670  REPLACING  ==()==  BY  ==出カ−==.           
000500*                                                                 
000510******************************************************************
000520*  ＷＯＲＫＩＮＧ−ＳＴＯＲＡＧＥ  ＳＥＣＴＩＯＮ                *
000530******************************************************************
000540 WORKING-STORAGE                      SECTION.                    
000550*----------------------------------------------------------------*
000560*    ホスト変数定義エリア                                        *
000570*----------------------------------------------------------------*
000580     EXEC  SQL  BEGIN  DECLARE        SECTION  END-EXEC.          
000590 01  ＷＳ−管理与信先コード           PIC  X(08).                 
000600*--< ＯＲＡＣＬＥ共通変数 >                                       
000610     EXEC  SQL  INCLUDE  SQLCOM.CBL            END-EXEC.          
000620*                                                                 
000630*--< ＯＲＡＣＬＥ  ＳＱＬ実行情報 >                               
000640     EXEC  SQL  INCLUDE  SQLCA.COB             END-EXEC.          
000650*                                                                 
000660*--< 変換テーブル >                                               
000670     EXEC  SQL  INCLUDE  IKOTBL001.CBL         END-EXEC.          
000680*                                                                 
000690*--< 変換テーブル >                                               
000700     EXEC  SQL  INCLUDE  IKOTBL002.CBL         END-EXEC.          
000710*                                                                 
000720*--< 与信(明細) >                                                 
000730     EXEC  SQL  INCLUDE  YOSHINMEISAI.CBL      END-EXEC.          
000740*                                                                 
000750*--< 与信(展開) >                                                 
000760     EXEC  SQL  INCLUDE  YOSHINTENKAI.CBL      END-EXEC.          
000770*                                                                 
000780     EXEC  SQL  END      DECLARE      SECTION  END-EXEC.          
000790*----------------------------------------------------------------*
000800*   作業領域定義                                                 *
000810*----------------------------------------------------------------*
000820 01  ＷＯＲＫ−エリア.                                            
000830*--< エラーコード >                                               
000840     03  Ｗ−エラーコード             PIC S9(04).                 
000850*                                                                 
000860*--< ファイル状態 >                                               
000870     03 Ｗ−状態                      PIC  X(02).                 
000880     03 Ｗ−管理与信状態              PIC  X(02).                 
000890*                                                                 
000900*--< 件数エリア >                                                 
000910     03 件数エリア.                                               
000920        05  Ｗ−入力−件数１          PIC  9(09).                 
000930        05  Ｗ−入力−件数２          PIC  9(09).                 
000940        05  Ｗ−出力−件数            PIC  9(09).                 
000950*                                                                 
000960*--< フラグアリア >                                               
000970     03 フラグ−エリア.                                           
000980        05  Ｗ−終了−フラグ          PIC  X(01).                 
000990        05  異常終了−フラグ          PIC  X(01).                 
001000*                                                                 
001010*--< キーエリア >                                                 
001020     03  ＫＥＹ−エリア.                                          
001030        05  ＮＥＷキー.                                           
001040            07 ＷＮ−与信管理先コード PIC  X(09).                 
001050            07 ＷＮ−契約番号         PIC  X(10).               
001060            07 ＷＮ−再リース回数     PIC S9(02).               
001070            07 ＷＮ−契約種類         PIC  X(03).               
001080        05  ＯＬＤキー.                                           
001090            07 ＷＯ−与信管理先コード PIC  X(09).               
001100            07 ＷＯ−契約番号         PIC  X(10).               
001110            07 ＷＯ−再リース回数     PIC S9(02).               
001120            07 ＷＯ−契約種類         PIC  X(03).               
001130*                                                                 
001140*--< 連番 >                                                       
001150     03 Ｗ−連番                      PIC  9(03).                 
001160*                                                                 
001170*----------------------------------------------------------------*
001180*   処理時間定義                                                 *
001190*----------------------------------------------------------------*
001200*--< 共通情報 >                                                   
001210 01  Ｗ−共通情報.                                                
001220     03  Ｗ−システム日付.                                        
001230         05  Ｗ−世紀                 PIC  X(02) VALUE  "20".     
001240         05  Ｗ−年月日               PIC  X(06).                 
001250     03  Ｗ−システム時刻             PIC  X(08).                 
001260     03  Ｗ−担当者                   PIC  X(08) VALUE "IKOPG   ".
001270*----------------------------------------------------------------*
001280*    サブルーチン名                                              *
001290*----------------------------------------------------------------*
001300 01  CALL-AREA.                                                   
001310*--< 共通ログサブルーチン >                                       
001320     03  CLOCO001                     PIC  X(08) VALUE "CLOCO001".
001330     03  COBCO001                     PIC  X(08) VALUE "COBCO001".
001340*----------------------------------------------------------------*
001350*    ＣＯＰＹ領域                                                *
001360*----------------------------------------------------------------*
001370*--< 共通ログ用パラメータ >                                       
001380 01  IF-CHOCO001.                                                 
001390     COPY  CHOCO001  REPLACING  ==()==  BY  ==共１−==.           
001400*                                                                 
001410*----------------------------------------------------------------*
001420*    ＩＮＩファイル読込サブルーチン用パラメタ領域                *
001430*----------------------------------------------------------------*
001440 01  PARA-AREA.                                                   
001450     COPY CPBCO001.                                               
001460******************************************************************
001470*    定数用データ定義エリア                                      *
001480******************************************************************
001490 CONSTANT                             SECTION.                    
001500 01  定数領域.                                                    
001510     03  定数−プログラムＩＤ         PIC  X(08) VALUE "COBIS670".
001520     03  定数−プログラム名           PIC  X(80)                  
001530                                    VALUE  "管理与信展開移行処理".
001540     03  定数−ＳＱＬＯＫ             PIC  9(04)  VALUE  ZERO.    
001550     03  定数−ＳＱＬＥＮＤ           PIC  9(04)  VALUE  0100.    
001560     03  定数−正常状態               PIC  9(04)  VALUE  ZERO.    
001570     03  定数−異常状態               PIC  9(04)  VALUE  0009.    
001580******************************************************************
001590*    ＰＲＯＣＥＤＵＲＥ            ＤＩＶＩＳＩＯＮ              *
001600******************************************************************
001610 PROCEDURE                            DIVISION.                   
001620*                                                                 
001630     PERFORM   初期処理.                                          
001640*                                                                 
001650     PERFORM   主処理  UNTIL  Ｗ−終了−フラグ  =  "Y".           
001660*                                                                 
001670     PERFORM   終了処理.                                          
001680*                                                                 
001690     STOP RUN.                                                    
001700*                                                                 
001710******************************************************************
001720*    初期処理                                            <1.0>   *
001730******************************************************************
001740 初期処理                             SECTION.                    
001750 初期処理−ＳＴＡＲＴ.                                            
001760*                                                                 
001770*----------------------------------------------------------------*
001780*    開始メッセージ出力                                          *
001790*----------------------------------------------------------------*
001800     INITIALIZE                       IF-CHOCO001.                
001810     MOVE  "3"                        TO  共１−イベント種別.     
001820     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
001830     MOVE  "ZERO"                     TO  共１−復帰コード.       
001840     MOVE  "START"                    TO  共１−処理識別.         
001850     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
001860     CALL  CLOCO001                USING  IF-CHOCO001.            
001870*                                                                 
001880*----------------------------------------------------------------*
001890*    作業領域の初期値設定                                        *
001900*----------------------------------------------------------------*
001910     MOVE  SPACE                      TO  ＷＯＲＫ−エリア.       
001920     INITIALIZE                           ＷＯＲＫ−エリア.       
001930*                                                                 
001940*--< ＣＰＵ日付を取得 >                                           
001950     ACCEPT  Ｗ−年月日               FROM  DATE.                 
001960*                                                                 
001970*--< ＣＰＵ時刻を取得 >                                           
001980     ACCEPT  Ｗ−システム時刻         FROM  TIME.                 
001990*----------------------------------------------------------------*
002000*    ＯＲＡＣＬＥ接続                                    <1.1>   *
002010*----------------------------------------------------------------*
002020     PERFORM  ＯＲＡＣＬＥ接続.                                   
002030*                                                                 
002040*----------------------------------------------------------------*
002050*    結合テーブルカーソル宣言                            <1.2>   *
002060*----------------------------------------------------------------*
002070     PERFORM  カーソル宣言.                                       
002080*                                                                 
002090*----------------------------------------------------------------*
002100*    ファイルオープン                                    <1.3>   *
002110*----------------------------------------------------------------*
002120     PERFORM  ファイルオープン.                                   
002130*                                                                 
002140*----------------------------------------------------------------*
002150*    結合テーブル読込（１件目）                          <C.1>   *
002160*----------------------------------------------------------------*
002170     PERFORM  結合テーブル読込.                                   
002180*                                                                 
002190******************************************************************
002200*    主処理                                              <2.0>   *
002210******************************************************************
002220 主処理                               SECTION.                    
002230 主処理−ＳＴＡＲＴ.                                              
002240*----------------------------------------------------------------*
002250*    編集処理                                            <2.1>   *
002260*----------------------------------------------------------------*
002270     PERFORM  編集処理.                                           
002280*                                                                 
002290*----------------------------------------------------------------*
002300*    管理与信展開出力処理                                <2.2>   *
002310*----------------------------------------------------------------*
002320     PERFORM  管理与信展開出力処理.                                           
002330*                                                                 
002340*----------------------------------------------------------------*
002350*    結合テーブル読込. (２件目以降)                      <C.1>   *
002360*----------------------------------------------------------------*
002370     PERFORM   結合テーブル読込.                                
002380*                                                                 
002390 主処理−ＥＸＩＴ.                                                
002400     EXIT.                                                        
002410******************************************************************
002420*    終了処理                                            <3.0>   *
002430******************************************************************
002440 終了処理                             SECTION.                    
002450 終了処理−ＳＴＡＲＴ.                                            
002460*                                                                 
002470*----------------------------------------------------------------*
002480*    ＤＢクローズ                                        <3.1>   *
002490*----------------------------------------------------------------*
002500     PERFORM   ＤＢクローズ.                                      
002510*                                                                 
002520*--< ファイルクローズ >                                           
002530     CLOSE  出力ファイル.                                         
002540*                                                                 
002550*----------------------------------------------------------------*
002560*    終了メッセージ出力処理                              <C.3>   *
002570*----------------------------------------------------------------*
002580     PERFORM  終了メッセージ出力.                                 
002590*                                                                 
002600*--< プログラム正常終了 >                                         
002610     MOVE  定数−正常状態             TO  PROGRAM-STATUS.         
002620*                                                                 
002630 終了処理−ＥＸＩＴ.                                              
002640     EXIT.                                                        
002650******************************************************************
002660*    ＯＲＡＣＬＥ接続                                    <1.1>   *
002670******************************************************************
002680 ＯＲＡＣＬＥ接続                     SECTION.                    
002690 ＯＲＡＣＬＥ接続−ＳＴＡＲＴ.                                    
002700*                                                                 
002710*--< ＩＮＩファイル読込サブルーチン呼び出し >                     
002720     CALL  COBCO001                USING  PARA-AREA.              
002730*                                                                 
002740     MOVE  PARA-DBSTRING              TO  DB-STRING.              
002750     MOVE  PARA-USERNAME              TO  USERNAME.               
002760     MOVE  PARA-PASSWORD              TO  PASSWD.                 
002770*                                                                 
002780*----------------------------------------------------------------*
002790*    開始接続                                                    *
002800*----------------------------------------------------------------*
002810     IF  DB-STRING  =  SPACE                                      
002820        EXEC  SQL                                                 
002830           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
002840        END-EXEC                                                  
002850     ELSE                                                         
002860        EXEC  SQL                                                 
002870           CONNECT  :USERNAME  IDENTIFIED  BY  :PASSWD            
002880             USING  :DB-STRING                                    
002890        END-EXEC                                                  
002900     END-IF.                                                      
002910*                                                                 
002920*----------------------------------------------------------------*
002930*    接続状態判定                                                *
002940*----------------------------------------------------------------*
002950     EVALUATE  SQLCODE                                            
002960        WHEN  定数−ＳＱＬＯＫ                                    
002970*--<       接続正常 >                                             
002980           CONTINUE                                               
002990        WHEN  OTHER                                               
003000*--<       接続エラー >                                           
003010           MOVE     -10               TO  Ｗ−エラーコード        
003020           PERFORM  エラー処理                                    
003030     END-EVALUATE.                                                
003040*                                                                 
003050 ＯＲＡＣＬＥ接続−ＥＸＩＴ.                                      
003060     EXIT.                                                        
003070******************************************************************
003080*    結合テーブルカーソル宣言                            <1.2>   *
003090******************************************************************
003100*                                                                 
003110 カーソル宣言                         SECTION.                    
003120 カーソル宣言−ＳＴＡＲＴ.                                        
003130*                                                                 
003140*----------------------------------------------------------------*
003150*    カーソル宣言                                                *
003160*----------------------------------------------------------------*
003170     EXEC  SQL                                                    
003180        DECLARE  CUR1  CURSOR  FOR                                
003190           SELECT  YOSHINMEISAI.管理与信先コード                  
003200			,YOSHINTENKAI.契約ＮＯ                          
003210                  ,YOSHINTENKAI.展開年月                          
003220                  ,YOSHINTENKAI.展開日付                          
003230                  ,YOSHINTENKAI.入金フラグ                        
003240                  ,YOSHINTENKAI.展開支払回数                      
003250                  ,YOSHINTENKAI.実リース料                        
003260                  ,YOSHINTENKAI.利息額                            
003270                  ,YOSHINTENKAI.元本内入                          
003280                  ,YOSHINTENKAI.元本残                            
003290                  ,YOSHINTENKAI.債権残                            
003300                  ,YOSHINTENKAI.諸費用                            
003310                  ,YOSHINTENKAI.約定利率                          
003320                  ,YOSHINTENKAI.事故後入金                        
003330             FROM  YOSHINTENKAI                                   
003340                  ,YOSHINMEISAI                                   
003350            WHERE  YOSHINTENKAI.管理与信先コード =                
003360                            YOSHINMEISAI.管理与信先コード         
003370              AND  YOSHINTENKAI.管理与信区分  =                   
003380                            YOSHINMEISAI.管理与信区分  	        
003390		    AND  YOSHINTENKAI.自動与信区分  =                   
003400                            YOSHINMEISAI.自動与信区分  	        
003410              AND  YOSHINTENKAI.事故日 =                          
003420                            YOSHINMEISAI.事故日  	                
003430              AND  YOSHINTENKAI.契約ＮＯ =                        
003440                            YOSHINMEISAI.契約ＮＯ  	        
003450              AND  YOSHINTENKAI.勘定コード =                      
003460                            YOSHINMEISAI.勘定コード   	        
003470*                                                                 
003480     END-EXEC.                                                    
003490*                                                                 
003500*----------------------------------------------------------------*
003510*    カーソルオープン                                            *
003520*----------------------------------------------------------------*
003530     EXEC  SQL                                                    
003540        OPEN  CUR1                                                
003550     END-EXEC.                                                    
003560*                                                                 
003570*----------------------------------------------------------------*
003580*    カーソルオープンを確認                                      *
003590*----------------------------------------------------------------*
003600     EVALUATE   SQLCODE                                           
003610        WHEN   定数−ＳＱＬＯＫ                                   
003620*--<       正常 >                                                 
003630           CONTINUE                                               
003640        WHEN   OTHER                                              
003650*--<       カーソルオープン失敗、プログラムが異常終了 >           
003660           MOVE      -20              TO  Ｗ−エラーコード        
003670           PERFORM   エラー処理                                   
003680     END-EVALUATE.                                                
003690*                                                                 
003700 カーソル宣言−ＥＸＩＴ.                                          
003710     EXIT.                                                        
003720*                                                                 
003730******************************************************************
003740*    出力ファイルＯＰＥＮ                                <1.3>   *
003750******************************************************************
003760 ファイルオープン                     SECTION.                    
003770 ファイルオープン−ＳＴＡＲＴ.                                    
003780     OPEN             OUTPUT          出力ファイル.               
003790*----------------------------------------------------------------*
003800*    管理与信展開ファイルオープン確認                            *
003810*----------------------------------------------------------------*
003820     EVALUATE  Ｗ−状態                                           
003830        WHEN  ZERO                                                
003840*--<       正常 >                                                 
003850           CONTINUE                                               
003860        WHEN  OTHER                                               
003870*--<       管理与信展開ファイルＯＰＥＮエラー >                   
003880           MOVE -30                   TO  Ｗ−エラーコード        
003890           PERFORM  エラー処理                                    
003900     END-EVALUATE.                                                
003910*                                                                 
003920 ファイルオープン−ＥＸＩＴ.                                      
003930     EXIT.                                                        
003940*                                                                 
003950******************************************************************
003960*    結合テーブル読込                                    <C.1>   *
003970******************************************************************
003980 結合テーブル読込                     SECTION.                    
003990 結合テーブル読込−ＳＴＡＲＴ.                                    
004000*                                                                 
004010*--< 結合テーブル読込 >                                           
004020     EXEC SQL                                                     
004030         FETCH  CUR1                                              
004040          INTO     :ＹＯＳＨＩＮＭＥＩＳＡＩ−管理与信先コード    
004050                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−契約ＮＯ            
004060                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−展開年月 	        
004070                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−展開日付            
004080                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−入金フラグ 	        
004090			,:ＹＯＳＨＩＮＴＥＮＫＡＩ−展開支払回数        
004100                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−実リース料          
004110                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−利息額              
004120			,:ＹＯＳＨＩＮＴＥＮＫＡＩ−元本内入            
004130                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−元本残              
004140                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−債権残	        
004150                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−諸費用	        
004160                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−約定利率	        
004170                  ,:ＹＯＳＨＩＮＴＥＮＫＡＩ−事故後入金          
004180     END-EXEC.                                                    
004190*                                                                 
004200*----------------------------------------------------------------*
004210*    結合テーブル読込を確認                                      *
004220*----------------------------------------------------------------*
004230     EVALUATE   SQLCODE                                           
004240        WHEN   定数−ＳＱＬＯＫ                                   
004250*--<       正常   >                                               
004260           COMPUTE  Ｗ−入力−件数１  =  Ｗ−入力−件数１  +  1   
004270           COMPUTE  Ｗ−入力−件数２  =  Ｗ−入力−件数２  +  1   
004280        WHEN   定数−ＳＱＬＥＮＤ                                 
004290*--<       読込終了   >                                           
004300           MOVE  "Y"                  TO  Ｗ−終了−フラグ        
004310        WHEN   OTHER                                              
004320*--<       結合テーブル読込エラー   >                             
004330           MOVE     -40               TO  Ｗ−エラーコード        
004340           PERFORM  エラー処理                                    
004350     END-EVALUATE.                                                
004360*                                                                 
004370 結合テーブル読込−ＥＸＩＴ.                                      
004380     EXIT.                                                        
004390******************************************************************
004400*    編集処理                                            <2.1>   *
004410******************************************************************
004420 編集処理                             SECTION.                    
004430 編集処理−ＳＴＡＲＴ.                                            
004440*                                                                 
004450*--< 出力レコードを初期化 >                                       
004460*                                                                 
004470     MOVE  SPACE                      TO  出力−レコード.         
004480     INITIALIZE                           出力−レコード.         
004490*                                                                 
004500*----------------------------------------------------------------*
004510*    編集処理                                                    *
004520*----------------------------------------------------------------*
004530*--< No.01 >                                                      
004540     PERFORM  管理与信先コード.                                   
004550     IF Ｗ−管理与信状態 = "Y"                                    
004560        PERFORM  結合テーブル読込                                 
004561*       PERFORM  編集処理  
004562*    END-IF.                                       
004570     MOVE     ＷＳ−管理与信先コード                              
004580                                      TO  出カ−与信管理先コード. 
004590*                                                                 
004600*--< No.02 >                                                      
004610     MOVE     ＹＯＳＨＩＮＴＥＮＫＡＩ−契約ＮＯ                  
004620                                      TO  出カ−契約番号.         
004630*                                                                 
004640*--< No.03 >                                                      
004650     PERFORM  再リース回数処理.                                   
004660     MOVE     ＩＫＯ００２−再リース回数                          
004670                                      TO  出カ−再リース回数.     
004680*                                                                 
004690*--< No.04 >                                                      
004700     PERFORM  契約種類処理.                                       
004710     MOVE    ＩＫＯ００２−契約種類   TO  出カ−契約種類.         
004720*                                                                 
004730*--< No.05 >                                                      
004740     PERFORM  連番処理.                                           
004750     MOVE     Ｗ−連番                TO  出カ−連番.             
004760*                                                                 
004770*--< No.06 >                                                      
004780     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−展開年月                     
004790                                      TO  出カ−展開年月.         
004800*                                                                 
004810*--< No.07 >                                                      
004820     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−展開日付                     
004830                                      TO  出カ−展開日付.         
004840*                                                                 
004850*--< No.08 >                                                      
004860     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−入金フラグ                   
004870                                      TO  出カ−入金フラグ.       
004880*                                                                 
004890*--< No.09 >                                                      
004900     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−展開支払回数                 
004910                                      TO  出カ−展開支払回数.     
004920*                                                                 
004930*--< No.10 >                                                      
004940     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−実リース料                   
004950                                      TO  出カ−実リース料.       
004960*                                                                 
004970*--< No.11 >                                                      
004980     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−利息額                       
004990                                      TO  出カ−利息額.           
005000*                                                                 
005010*--< No.12 >                                                      
005020     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−元本内入                     
005030                                      TO  出カ−元本内入.         
005040*                                                                 
005050*--< No.13 >                                                      
005060     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−元本残                       
005070                                      TO  出カ−元本残.           
005080*                                                                 
005090*--< No.14 >                                                      
005100     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−債権残                       
005110                                      TO  出カ−債権残.           
005120*                                                                 
005130*--< No.15 >                                                      
005140     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−諸費用                       
005150                                      TO  出カ−諸費用.           
005160*                                                                 
005170*--< No.16 >                                                      
005180     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−約定利率                     
005190                                      TO  出カ−約定利率.         
005200*                                                                 
005210*--< No.17 >                                                      
005220     MOVE  ＹＯＳＨＩＮＴＥＮＫＡＩ−事故後入金                   
005230                                      TO  出カ−事故後入金.       
005240*                                                                 
005250*--< No.18 >                                                      
005260     MOVE  Ｗ−システム日付           TO  出カ−登録年月日.       
005270*                                                                 
005280*--< No.19 >                                                      
005290     MOVE  Ｗ−システム時刻           TO  出カ−登録時間.         
005300*                                                                 
005310*--< No.20 >                                                      
005320     MOVE  Ｗ−担当者                 TO  出カ−登録担当者.       
005330*                                                                 
005340*--< No.21 >                                                      
005350     MOVE  Ｗ−システム日付           TO  出カ−更新年月日.       
005360*                                                                 
005370*--< No.22 >                                                      
005380     MOVE  Ｗ−システム時刻           TO  出カ−更新時間.         
005390*                                                                 
005400*--< No.23 >                                                      
005410     MOVE  Ｗ−担当者                 TO  出カ−更新者.           
005420*                                                                 
005430*--< No.24 >                                                      
005440     MOVE  Ｗ−担当者                 TO                          
005450                                      出カ−入力担当者コード.     
005460*                                                                 
005470 編集処理−ＥＸＩＴ.                                              
005480     EXIT.                                                        
005490******************************************************************
005500*    管理与信先コード処理                                <No.01> *
005510******************************************************************
005520 管理与信先コード                     SECTION.                    
005530 管理与信先コード−ＳＴＡＲＴ.                                    
005540     EVALUATE  ＹＯＳＨＩＮＭＥＩＳＡＩ−管理与信先コード         
005550        WHEN     "02683250"                                       
005560           MOVE  "02683233"           TO                          
005570                       ＷＳ−管理与信先コード                     
005580        WHEN     "T2677944"                                       
005590           MOVE  "T2672500"           TO                          
005600                       ＷＳ−管理与信先コード                     
005610        WHEN     "S1519455"                                       
005620           MOVE  "S1519684"           TO                          
005630                       ＷＳ−管理与信先コード                     
005640	      WHEN OTHER                                                
005650	      PERFORM  変換テーブル処理                                 
005660     END-EVALUATE.                                                
005670 管理与信先コード−ＥＸＩＴ.                                      
005680     EXIT.                                                        
005690******************************************************************
005700*    変換テーブル処理                                            *
005710******************************************************************
005720 変換テーブル処理                     SECTION.                    
005730 変換テーブル処理−ＳＴＡＲＴ.                                    
005740     EXEC SQL                                                     
005750        SELECT 新取引先コード                                     
005760              ,取引先コード                                       
005770          INTO :ＩＫＯ００１−新取引先コード                      
005780              ,:ＩＫＯ００１−取引先コード                        
005790          FROM IKOTBL001                                          
005800         WHERE 取引先コード =                                     
005810                      :ＹＯＳＨＩＮＭＥＩＳＡＩ−管理与信先コード 
005820           AND 目的ＣＤ = '2'                                     
005830     END-EXEC.                                                    
005840*----------------------------------------------------------------*
005850*    変換テーブル処理確認                                        *
005860*----------------------------------------------------------------*
005870     EVALUATE   SQLCODE                                           
005880        WHEN   定数−ＳＱＬＯＫ                                   
005890*--<       正常   >                                               
005900           MOVE  ＩＫＯ００１−新取引先コード  TO                 
005910                 ＷＳ−管理与信先コード  
005920    
006020* 	 MOVE "N" TO  Ｗ−管理与信状態                         
005930           CONTINUE                                               
005940        WHEN   OTHER                                              
005950*--<       変換テーブル読込エラー   >                             
005960           DISPLAY                                                
005970               "与信管理先コード変換エラーとして管理与信先コード" 
005980		 DISPLAY                                                
005990               ＩＫＯ００１−取引先コード "="                     
006000	             ＹＯＳＨＩＮＭＥＩＳＡＩ−管理与信先コード         
006010            DISPLAY  "目的ＣＤ = '2'"                             
006020  	  MOVE "Y" TO  Ｗ−管理与信状態                         
006030     END-EVALUATE.                                                
006040*                                                                 
006050 変換テーブル処理−ＥＸＩＴ.                                      
006060     EXIT.                                                        
006070*                                                                 
006080******************************************************************
006090*    再リース回数処理                                    <No.03> *
006100******************************************************************
006110 再リース回数処理                     SECTION.                    
006120 再リース回数処理−ＳＴＡＲＴ.                                    
006130     EXEC SQL                                                     
006140        SELECT MAX(再リース回数)                                  
006150          INTO :ＩＫＯ００２−再リース回数                        
006160          FROM IKOTBL002                                          
006170         WHERE 契約ＮＯ = :ＹＯＳＨＩＮＴＥＮＫＡＩ−契約ＮＯ     
006180     END-EXEC.                                                    
006190*----------------------------------------------------------------*
006200*    再リース回数処理確認                                        *
006210*----------------------------------------------------------------*
006220     EVALUATE   SQLCODE                                           
006230        WHEN   定数−ＳＱＬＯＫ                                   
006240*--<       正常   >                                               
006250           CONTINUE 
006260        WHEN   OTHER                                              
006270*--<       再リース回数読込エラー   >                             
006280           MOVE       -50           TO    Ｗ−エラーコード        
006290           PERFORM  エラー処理                                    
006300           MOVE       ZERO          TO    出カ−再リース回数      
006310     END-EVALUATE.                                                
006320*                                                                 
006330 再リース回数処理−ＥＸＩＴ.                                      
006340     EXIT.                                                        
006350*                                                                 
006360******************************************************************
006370*    契約種類処理                                        <No.04> *
006380******************************************************************
006390 契約種類処理                         SECTION.                    
006400 契約種類処理−ＳＴＡＲＴ.                                        
006410     EXEC SQL                                                     
006420        SELECT MIN(契約種類)                                      
006430          INTO :ＩＫＯ００２−契約種類                            
006440          FROM IKOTBL002                                          
006450         WHERE 再リース回数 = :ＩＫＯ００２−再リース回数         
006460     END-EXEC.                                                    
006470*----------------------------------------------------------------*
006480*    契約種類処理確認                                            *
006490*----------------------------------------------------------------*
006500     EVALUATE   SQLCODE                                           
006510        WHEN   定数−ＳＱＬＯＫ                                   
006520*--<       正常   >                                               
006530            CONTINUE  
006540        WHEN   OTHER                                              
006550*--<       契約種類読込エラー   >                                 
006560           MOVE       -60           TO    Ｗ−エラーコード        
006570           PERFORM  エラー処理                                    
006580     END-EVALUATE.                                                
006590*                                                                 
006600 契約種類処理−ＥＸＩＴ.                                          
006610     EXIT.                                                        
006620******************************************************************
006630*    連番処理                                            <No.05> *
006640******************************************************************
006650 連番処理                             SECTION.                    
006660 連番処理−ＳＴＡＲＴ.                                            
006670     MOVE ＹＯＳＨＩＮＭＥＩＳＡＩ−管理与信先コード              
006680                                      TO ＷＮ−与信管理先コード   
006690     MOVE ＹＯＳＨＩＮＴＥＮＫＡＩ−契約ＮＯ                      
006700                                      TO ＷＮ−契約番号           
006710     MOVE ＩＫＯ００２−再リース回数  TO ＷＮ−再リース回数       
006720     MOVE ＩＫＯ００２−契約種類      TO ＷＮ−契約種類           
006730     IF ＮＥＷキー    NOT   =   ＯＬＤキー                        
006740	      MOVE          1               TO Ｗ−連番                 
006750	      MOVE     ＮＥＷキー           TO ＯＬＤキー               
006760	   ELSE                                                         
006770        COMPUTE  Ｗ−連番  =  Ｗ−連番  +  1.                     
006780*                                                                 
006790 連番処理−ＥＸＩＴ.                                              
006800     EXIT.                                                        
006810******************************************************************
006820*    管理与信展開出力処理	                                <2.2>  *
006830******************************************************************
006840 管理与信展開出力処理                 SECTION.                    
006850 管理与信展開−ＳＴＡＲＴ.                                        
006860*                                                                 
006870     WRITE  出力−レコード.                                       
006880*                                                                 
006890*--< 出力処理の状態判定 >                                         
006900     EVALUATE  Ｗ−状態                                           
006910        WHEN  ZERO                                                
006920*--<       出力処理の加算 >                                       
006930           COMPUTE   Ｗ−出力−件数  =  Ｗ−出力−件数  + 1       
006940        WHEN  OTHER                                               
006950*--<       ファイル出力エラー >                                   
006960           MOVE     -70                TO  Ｗ−エラーコード       
006970           PERFORM  エラー処理                                    
006980     END-EVALUATE.                                                
006990 管理与信展開−ＥＸＩＴ.                                          
007000     EXIT.                                                        
007010******************************************************************
007020*    ＤＢクローズ                                        <3.1>   *
007030******************************************************************
007040 ＤＢクローズ                         SECTION.                    
007050 ＤＢクローズ−ＳＴＡＲＴ.                                        
007060*                                                                 
007070*--< カーソルのクローズ >                                         
007080     EXEC  SQL                                                    
007090        CLOSE  CUR1                                               
007100     END-EXEC.                                                    
007110*                                                                 
007120 ＤＢクローズ−ＥＸＩＴ.                                          
007130     EXIT.                                                        
007140*                                                                 
007150******************************************************************
007160*    終了メッセージ出力                                  <C.3>   *
007170******************************************************************
007180  終了メッセージ出力                  SECTION.                    
007190  終了メッセージ出力−ＳＴＡＲＴ.                                 
007200*                                                                 
007210*----------------------------------------------------------------*
007220*    与信(明細)ファイル入力件数                                  *
007230*----------------------------------------------------------------*
007240     INITIALIZE                       IF-CHOCO001.                
007250     MOVE  "3"                        TO  共１−イベント種別.     
007260     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007270     MOVE  "0"                        TO  共１−復帰コード.       
007280     MOVE  "YOSHINME"                 TO  共１−処理テーブルＩＤ. 
007290     MOVE  "COUNT"                    TO  共１−処理識別.         
007300     MOVE  Ｗ−入力−件数１           TO  共１−データ内容.       
007310     MOVE  "与信(明細)読込件数"       TO  共１−その他メッセージ. 
007320     CALL  CLOCO001                USING  IF-CHOCO001.            
007330*                                                                 
007340*----------------------------------------------------------------*
007350*    与信(展開)ファイル入力件数                                  *
007360*----------------------------------------------------------------*
007370     INITIALIZE                       IF-CHOCO001.                
007380     MOVE  "3"                        TO  共１−イベント種別.     
007390     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007400     MOVE  "0"                        TO  共１−復帰コード.       
007410     MOVE  "YOSHINTE"                 TO  共１−処理テーブルＩＤ. 
007420     MOVE  "COUNT"                    TO  共１−処理識別.         
007430     MOVE  Ｗ−入力−件数２           TO  共１−データ内容.       
007440     MOVE  "与信(展開)読込件数"       TO  共１−その他メッセージ. 
007450     CALL  CLOCO001                USING  IF-CHOCO001.            
007460*                                                                 
007470*----------------------------------------------------------------*
007480*    管理与信展開マスタ出力件数                                  *
007490*----------------------------------------------------------------*
007500     INITIALIZE                       IF-CHOCO001.                
007510     MOVE  "3"                        TO  共１−イベント種別.     
007520     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007530     MOVE  "0"                        TO  共１−復帰コード.       
007540     MOVE  "FFUSI670"                 TO  共１−処理テーブルＩＤ. 
007550     MOVE  "COUNT"                    TO  共１−処理識別.         
007560     MOVE  Ｗ−出力−件数             TO  共１−データ内容.       
007570     MOVE  "管理与信展開出力件数"     TO  共１−その他メッセージ. 
007580     CALL  CLOCO001                USING  IF-CHOCO001.            
007590*                                                                 
007600*----------------------------------------------------------------*
007610*    終了メッセージ 出力                                         *
007620*----------------------------------------------------------------*
007630     INITIALIZE                       IF-CHOCO001.                
007640     MOVE  "3"                        TO  共１−イベント種別.     
007650     MOVE  定数−プログラムＩＤ       TO  共１−ソースＩＤ.       
007660     MOVE  "0"                        TO  共１−復帰コード.       
007670     MOVE  "END"                      TO  共１−処理識別.         
007680     MOVE  定数−プログラム名         TO  共１−その他メッセージ. 
007690     CALL  CLOCO001                USING  IF-CHOCO001.            
007700*                                                                 
007710 終了メッセージ出力−ＥＸＩＴ.                                    
007720     EXIT.                                                        
007730******************************************************************
007740*    エラー処理                                          <4.0>   *
007750******************************************************************
007760 エラー処理                           SECTION.                    
007770 エラー処理−ＳＴＡＲＴ.                                          
007780*                                                                 
007790     MOVE  "Y"                        TO  異常終了−フラグ.       
007800     INITIALIZE                       IF-CHOCO001.                
007810*                                                                 
007820     EVALUATE  Ｗ−エラーコード                                   
007830*                                                                 
007840*                                                                 
007850        WHEN  -10                                                 
007860*--<       ＯＲＡＣＬＥ接続失敗 >                                 
007870           MOVE  "1"                  TO  共１−イベント種別      
007880           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007890           MOVE  "9"                  TO  共１−復帰コード        
007900           MOVE  "CONNECT"            TO  共１−処理識別          
007910           MOVE  SQLCODE              TO  共１−データ内容        
007920           MOVE  SQLERRMC             TO  共１−その他メッセージ  
007930           CALL  CLOCO001          USING  IF-CHOCO001             
007940*                                                                 
007950        WHEN  -20                                                 
007960*--<       カーソルオープン失敗 >                                 
007970           MOVE  "1"                  TO  共１−イベント種別      
007980           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
007990           MOVE  "9"                  TO  共１−復帰コード        
008000           MOVE  "YOSHINT1"           TO  共１−処理テーブルＩＤ  
008010           MOVE  "OPEN"               TO  共１−処理識別          
008020           MOVE  SQLCODE              TO  共１−データ内容        
008030           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008040           CALL  CLOCO001          USING  IF-CHOCO001             
008050*                                                                 
008060        WHEN  -30                                                 
008070*--<       管理与信展開ファイルＯＰＥＮ失敗 >                     
008080           MOVE  "1"                  TO  共１−イベント種別      
008090           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008100           MOVE  "9"                  TO  共１−復帰コード        
008110           MOVE  "CISUF670"           TO  共１−処理テーブルＩＤ  
008120           MOVE  "OPEN"               TO  共１−処理識別          
008130           MOVE  Ｗ−状態         TO  共１−データ内容            
008140           MOVE  "管理与信展開ファイルオープン失敗"               
008150                                      TO  共１−その他メッセージ  
008160           CALL  CLOCO001          USING  IF-CHOCO001             
008170*                                                                 
008180        WHEN  -40                                                 
008190*--<       結合テーブル読込失敗 >                                 
008200           MOVE  "1"                  TO  共１−イベント種別      
008210           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008220           MOVE  "9"                  TO  共１−復帰コード        
008230           MOVE  "YOSHINT2"           TO  共１−処理テーブルＩＤ  
008240           MOVE  "FETCH"              TO  共１−処理識別          
008250           MOVE  SQLCODE              TO  共１−データ内容        
008260           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008270           CALL  CLOCO001          USING  IF-CHOCO001             
008280*                                                                 
008290        WHEN  -50                                                 
008300*--<       再リース回数読込失敗 >                                 
008310           MOVE  "2"                  TO  共１−イベント種別      
008320           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008330           MOVE  "9"                  TO  共１−復帰コード        
008340           MOVE  "IKO002"             TO  共１−処理テーブルＩＤ  
008350           MOVE  "SELECT"             TO  共１−処理識別          
008360           MOVE  SQLCODE              TO  共１−データ内容        
008370           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008380           CALL  CLOCO001          USING  IF-CHOCO001             
008390           MOVE  "N"                  TO  異常終了−フラグ        
008400*                                                                 
008410        WHEN  -60                                                 
008420*--<       契約種類読込失敗 >                                     
008430           MOVE  "2"                  TO  共１−イベント種別      
008440           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008450           MOVE  "9"                  TO  共１−復帰コード        
008460           MOVE  "IKO002"             TO  共１−処理テーブルＩＤ  
008470           MOVE  "SELECT"             TO  共１−処理識別          
008480           MOVE  SQLCODE              TO  共１−データ内容        
008490           MOVE  SQLERRMC             TO  共１−その他メッセージ  
008500           CALL  CLOCO001          USING  IF-CHOCO001             
008510           MOVE  "N"                  TO  異常終了−フラグ        
008520*                                                                 
008530        WHEN  -70                                                 
008540*--<       管理与信展開ファイル出力処理失敗 >                     
008550           MOVE  "1"                  TO  共１−イベント種別      
008560           MOVE  定数−プログラムＩＤ TO  共１−ソースＩＤ        
008570           MOVE  "9"                  TO  共１−復帰コード        
008580           MOVE  "FFUSI670"           TO  共１−処理テーブルＩＤ  
008590           MOVE  "WRITE"              TO  共１−処理識別          
008600           MOVE  Ｗ−状態         TO  共１−データ内容            
008610           MOVE  "管理与信展開ファイル出力処理失敗"               
008620                                      TO  共１−その他メッセージ  
008630           CALL  CLOCO001          USING  IF-CHOCO001             
008640*                                                                 
008650        WHEN  OTHER                                               
008660           MOVE  "N"                  TO  異常終了−フラグ        
008670     END-EVALUATE.                                                
008680*                                                                 
008690     IF  異常終了−フラグ  =  "Y"                                 
008700*----------------------------------------------------------------*
008710*    終了出力処理                                                *
008720*----------------------------------------------------------------*
008730        PERFORM  終了メッセージ出力                               
008740*                                                                 
008750*--<    プログラムリターンコード >                                
008760        MOVE  定数−異常状態          TO  PROGRAM-STATUS          
008770        EXIT  PROGRAM                                             
008780     END-IF.                                                      
008790*                                                                 
008800 エラー処理−ＥＸＩＴ.                                            
008810      EXIT.                                                       
008820******************************************************************
008830*                  END OF PROGRAM                                *
008840******************************************************************
